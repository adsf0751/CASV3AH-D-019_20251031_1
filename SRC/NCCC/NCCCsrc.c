#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#include <stdarg.h>
#include <unistd.h>
#include <ctosapi.h>
#include <curl/curl.h>
#include <sqlite3.h>
#include <libxml/tree.h>
#include "../SOURCE/INCLUDES/Define_1.h"
#include "../SOURCE/INCLUDES/Define_2.h"
#include "../SOURCE/INCLUDES/TransType.h"
#include "../SOURCE/INCLUDES/Transaction.h"
#include "../SOURCE/INCLUDES/AllStruct.h"
#include "../SOURCE/DISPLAY/Display.h"
#include "../SOURCE/DISPLAY/DispMsg.h"
#include "../SOURCE/DISPLAY/DisTouch.h"
#include "../SOURCE/PRINT/Print.h"
#include "../SOURCE/COMM/Comm.h"
#include "../SOURCE/COMM/Modem.h"
#include "../SOURCE/COMM/Ftps.h"
#include "../SOURCE/COMM/TLS.h"
#include "../SOURCE/FUNCTION/Sqlite.h"
#include "../SOURCE/FUNCTION/ASMC.h"
#include "../SOURCE/FUNCTION/Accum.h"
#include "../SOURCE/FUNCTION/Batch.h"
#include "../SOURCE/FUNCTION/File.h"
#include "../SOURCE/FUNCTION/Function.h"
#include "../SOURCE/FUNCTION/FuncTable.h"
#include "../SOURCE/FUNCTION/CDT.h"
#include "../SOURCE/FUNCTION/CDTX.h"
#include "../SOURCE/FUNCTION/Card.h"
#include "../SOURCE/FUNCTION/CPT.h"
#include "../SOURCE/FUNCTION/HDT.h"
#include "../SOURCE/FUNCTION/CFGT.h"
#include "../SOURCE/FUNCTION/EDC.h"
#include "../SOURCE/FUNCTION/HDPT.h"
#include "../SOURCE/FUNCTION/ECR.h"
#include "../SOURCE/FUNCTION/RS232.h"
#include "../SOURCE/FUNCTION/SCDT.h"
#include "../SOURCE/FUNCTION/VWT.h"
#include "../SOURCE/FUNCTION/TDT.h"
#include "../SOURCE/FUNCTION/PIT.h"
#include "../SOURCE/FUNCTION/NexsysSDK.h"
#include "../SOURCE/FUNCTION/CastlePWD.h"
#include "../SOURCE/FUNCTION/Utility.h"
#include "../SOURCE/FUNCTION/APDU.h"
#include "../SOURCE/FUNCTION/TMSIPDT.h"
#include "../SOURCE/FUNCTION/XML.h"
#include "../SOURCE/EVENT/MenuMsg.h"
#include "../SOURCE/EVENT/Flow.h"
#include "../SOURCE/EVENT/Menu.h"
#include "../HG/HGsrc.h"
#include "../HG/HGiso.h"
#include "../CREDIT/Creditfunc.h"
#include "../CREDIT/CreditprtByBuffer.h"
#include "../FISC/NCCCfisc.h"
#include "../EMVSRC/EMVsrc.h"
#include "../CTLS/CTLS.h"
#include "NCCCsrc.h"
#include "NCCCats.h"
#include "NCCCmfes.h"
#include "NCCCtmk.h"
#include "NCCCdcc.h"
#include "NCCCesc.h"
#include "NCCCloyalty.h"
#include "NCCCTicketSrc.h"
#include "NCCCtmsCPT.h"
#include "NCCCtmsFTPFLT.h"
#include "NCCCtmsFTP.h"
#include "NCCCtms.h"
#include "NCCCtSAM.h"
#include "NCCCTrust.h"
#include "TAKAsrc.h"
#include "TAKAiso.h"
#include "NCCCEWsrc.h"

#define max(x, y) (((x) > (y)) ? (x) : (y))
#define min(x, y) (((x) < (y)) ? (x) : (y))

int			ginMacError = 0;		/* MAC錯誤次數 */
/* 之後預計把ATS和MFES的global變數整合過來 2020/8/26 上午 9:52 */
char			gszMAC_F_03[2 + 1] = {0};	/* Field_3:	Processing Code */
char			gszMAC_F_04[12 + 1] = {0};	/* Field_4:	Amount, Transaction */
char			gszMAC_F_11[2 + 1] = {0};	/* Field_11:	System Trace Audit Number */
char			gszMAC_F_35[40 + 1] = {0};	/* Field_35:	TRACK 2 Data */
char			gszMAC_F_59[18 + 1] = {0};	/* Field_59:	F _59 之 Table ID “ 電票交易訊 )18 碼。 */
char			gszMAC_F_63[45 + 1] = {0};	/* Field_63:	Reserved-Private Data(票證45Byte ATS30 Byte取最大值45) */
unsigned char		guszField_35 = VS_FALSE;
unsigned char		guszField_55 = VS_FALSE;
unsigned char		guszField_56 = VS_FALSE;
unsigned char		guszField_59 = VS_FALSE;
unsigned char		gusztSAMKeyIndex = 0x00;
unsigned char		gusztSAMCheckSum_35[4 + 1] = {0};
unsigned char		gusztSAMCheckSum_55[4 + 1] = {0};
unsigned char		gusztSAMCheckSum_56[4 + 1] = {0};
unsigned char		gusztSAMCheckSum_59[4 + 1] = {0};
int                     ginNCCCDCCInvoice = 0;

extern  int		ginDebug;		/* Debug使用 extern */
extern  int		ginISODebug;		/* Debug使用 extern */
extern	int		ginDCCHostIndex;
extern	int		ginMachineType;
extern	int		ginAPVersionType;
extern	int		ginContactlessSupport;
extern	int		ginTouchEnable;
extern	char		gszTermVersionID[16 + 1];
extern	long		glnESC_PokaYoke_TestAmt;		/* 測試ESC防呆機制使用金額 */
extern	unsigned long	gulDemoRedemptionPointsBalance;
extern	unsigned char	gusztSAMKeyIndex;
extern	unsigned char	gusztSAMCheckSum_59[4 + 1];
extern	int		ginSpecialSituation;
extern  int		ginTouch_Handle;
extern	char		gszReprintDBPath[100 + 1];
extern	SQLITE_TAG_TABLE TABLE_REPRINT_TITLE_TAG[];
extern	int		ginHGHostIndex;
extern	FPG_FTC_REC	gsrFPG_FTC_Rec;
extern	unsigned char	guszCus123UnlockBit;
extern	unsigned char	guszNoChooseHostBit;
extern	int		ginHalfLCD;
extern	int		ginTAKAHostIndex;
extern	int		ginTAKACommIndex;
extern	DEMO_EW_REC	gsrDEMO_EWRec[6];
extern	char		gszTranDBPath[100 + 1];
extern	char		gszParamDBPath[100 + 1];
extern	ECR_TABLE	gsrECROb;
extern	unsigned long	gulPCIRebootTime;
extern  DEMO_TRUST_REC  gsrDEMO_TRUSTRec;

int SALE_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_GET_4DBC_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_CURRENCYOPTION_,
	_NCCC_DCC_FUNCTION_CHECK_TRANS_FUNCTION_,
	_NCCC_DCC_ONLINERATE_,
	_NCCC_DCC_FINAL_DCC_OPTION_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,			/* 若判定是DCC流程，就不跑 */
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
	_UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
	_FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
        _CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int SALE_ICC_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_CURRENCYOPTION_,
	_NCCC_DCC_FUNCTION_CHECK_TRANS_FUNCTION_,
	_NCCC_DCC_ONLINERATE_,
	_NCCC_DCC_FINAL_DCC_OPTION_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,			/* 若判定是DCC流程，就不跑 */
        _EMV_PROCESS_,					/* 晶片卡因為在_EMV_PROCESS_才抓卡號，這時才會有對應HOST，所以把_NCCC_FUNCTION_MAKE_REFNO_拉進去(_NCCC_DCC_CHECK_原因相同) */
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int SALE_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_CURRENCYOPTION_,
	_NCCC_DCC_FUNCTION_CHECK_TRANS_FUNCTION_,
	_NCCC_DCC_ONLINERATE_,
	_NCCC_DCC_FINAL_DCC_OPTION_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,			/* 若判定是DCC流程，就不跑 */
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int VOID_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _NCCC_FUNCTION_VOID_CHECK_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _NCCC_FUNCTION_VOID_CONFIRM_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
        _HG_VOID_RUN_MULTI_FLOW_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        /*
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        */
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_HG_FUNCTION_DISPLAY_COMPLETE_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int REFUND_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_TRANSACTION_ORIGIN_CHECK,
	_CREDIT_FUNCTION_GET_DCC_ORI_TRANSDATE_,
	_CREDIT_FUNCTION_GET_DCC_ORI_AMOUNT_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,			/* 若判定是DCC流程，就不跑 */
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
        _NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int REFUND_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_TRANSACTION_ORIGIN_CHECK,
	_CREDIT_FUNCTION_GET_DCC_ORI_TRANSDATE_,
	_CREDIT_FUNCTION_GET_DCC_ORI_AMOUNT_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
        _NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int SETTLE_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
	_NCCC_ESC_UPLOAD_SETTLE_,
        _FUNCTION_PREPRINT_AUTO_REPORT_BY_BUFFER_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_SETTLEMENT_XML_NCCC_START_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
        _FUNCTION_DELETE_BATCH_FLOW_,
        _FUNCTION_PRINT_TOTAL_REPORT_BY_BUFFER_,
        _FUNCTION_DELETE_ACCUM_FLOW_,
        _FUNCTION_REST_BATCH_INV_,
	_FUNCTION_UPDATE_BATCH_NUM_,
	_NCCC_FUNCTION_SETTLEMENT_XML_NCCC_END_,
	_NCCC_FUNCTION_DISPLAY_PLEASE_LOGON_FIRST_ONLY_ISO_,
        _FLOW_NULL_,
};

int TIP_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
        _NCCC_FUNCTION_TIP_CHECK_,
        _CREDIT_FUNCTION_GET_TIP_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int SALE_OFFLINE_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_FUNCTION_DISCLAIM_AUTH_,
        _CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int SALE_OFFLINE_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_FUNCTION_DISCLAIM_AUTH_,
        _CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int PRE_AUTH_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_GET_4DBC_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int PRE_AUTH_ICC_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_GET_4DBC_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_EMV_PROCESS_,				/* 晶片卡因為在_EMV_PROCESS_才抓卡號，這時才會有對應HOST，所以把_NCCC_FUNCTION_MAKE_REFNO_拉進去(_NCCC_DCC_CHECK_原因相同) */
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int PRE_AUTH_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_GET_4DBC_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int PRE_COMP_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
	_CREDIT_FUNCTION_GET_ORI_PREAUTH_AMOUNT_,
	_CREDIT_FUNCTION_GET_PRECOMP_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_CURRENCYOPTION_,
	_NCCC_DCC_FUNCTION_CHECK_TRANS_FUNCTION_,
	_CREDIT_FUNCTION_GET_DCC_ORI_TRANSDATE_,
	_NCCC_DCC_ONLINERATE_,
	_NCCC_DCC_FINAL_DCC_OPTION_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
	_UPDATE_ACCUM_,
	_UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int PRE_COMP_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
	_CREDIT_FUNCTION_GET_ORI_PREAUTH_AMOUNT_,
	_CREDIT_FUNCTION_GET_PRECOMP_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_CURRENCYOPTION_,
	_NCCC_DCC_FUNCTION_CHECK_TRANS_FUNCTION_,
	_CREDIT_FUNCTION_GET_DCC_ORI_TRANSDATE_,
	_NCCC_DCC_ONLINERATE_,
	_NCCC_DCC_FINAL_DCC_OPTION_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
	_UPDATE_ACCUM_,
	_UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int INST_SALE_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_PERIOD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int INST_SALE_ICC_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_PERIOD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_EMV_PROCESS_,				/* 晶片卡因為在_EMV_PROCESS_才抓卡號，這時才會有對應HOST，所以把_NCCC_FUNCTION_MAKE_REFNO_拉進去(_NCCC_DCC_CHECK_原因相同) */
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int INST_SALE_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_PERIOD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int INST_REFUND_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_PERIOD_,
	_CREDIT_FUNCTION_GET_DOWNPAYMENT_,
	_CREDIT_FUNCTION_GET_INSTPAYMENT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int INST_REFUND_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_PERIOD_,
	_CREDIT_FUNCTION_GET_DOWNPAYMENT_,
	_CREDIT_FUNCTION_GET_INSTPAYMENT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int INST_ADJUST_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_PERIOD_,
	_CREDIT_FUNCTION_GET_DOWNPAYMENT_,
	_CREDIT_FUNCTION_GET_INSTPAYMENT_,
	_NCCC_FUNCTION_DISCLAIM_AUTH_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int INST_ADJUST_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_PERIOD_,
	_CREDIT_FUNCTION_GET_DOWNPAYMENT_,
	_CREDIT_FUNCTION_GET_INSTPAYMENT_,
	_NCCC_FUNCTION_DISCLAIM_AUTH_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int REDEEM_SALE_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int REDEEM_SALE_ICC_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_EMV_PROCESS_,				/* 晶片卡因為在_EMV_PROCESS_才抓卡號，這時才會有對應HOST，所以把_NCCC_FUNCTION_MAKE_REFNO_拉進去(_NCCC_DCC_CHECK_原因相同) */
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int REDEEM_SALE_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int REDEEM_REFUND_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_PAY_AMOUNT_,
	_CREDIT_FUNCTION_GET_REDEEM_POINT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int REDEEM_REFUND_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_PAY_AMOUNT_,
	_CREDIT_FUNCTION_GET_REDEEM_POINT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int REDEEM_ADJUST_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_PAY_AMOUNT_,
	_CREDIT_FUNCTION_GET_REDEEM_POINT_,
	_NCCC_FUNCTION_DISCLAIM_AUTH_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int REDEEM_ADJUST_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_PAY_AMOUNT_,
	_CREDIT_FUNCTION_GET_REDEEM_POINT_,
	_NCCC_FUNCTION_DISCLAIM_AUTH_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_SALE_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_GET_CUP_PIN,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_SALE_ICC_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_EMV_PROCESS_,				/* 晶片卡因為在_EMV_PROCESS_才抓卡號，這時才會有對應HOST，所以把_NCCC_FUNCTION_MAKE_REFNO_拉進去(_NCCC_DCC_CHECK_原因相同) */
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_SALE_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_GET_CUP_PIN,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
        _NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_REFUND_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
	_NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_FUNCTION_CUP_REFUND_LIMIT_CHECK_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_REFUND_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
	_NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_FUNCTION_CUP_REFUND_LIMIT_CHECK_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_PRE_AUTH_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_GET_CUP_PIN,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_PRE_AUTH_ICC_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_EMV_PROCESS_,				/* 晶片卡因為在_EMV_PROCESS_才抓卡號，這時才會有對應HOST，所以把_NCCC_FUNCTION_MAKE_REFNO_拉進去(_NCCC_DCC_CHECK_原因相同) */
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_PRE_AUTH_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_GET_CUP_PIN,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_PRE_COMP_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
	_NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
	_CREDIT_FUNCTION_GET_ORI_PREAUTH_AMOUNT_,
	_CREDIT_FUNCTION_GET_PRECOMP_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_ACCUM_,
	_UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_PRE_COMP_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
	_NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
	_CREDIT_FUNCTION_GET_ORI_PREAUTH_AMOUNT_,
	_CREDIT_FUNCTION_GET_PRECOMP_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_ACCUM_,
	_UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_VOID_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_CUP_VOID_CHECK_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _NCCC_FUNCTION_CUP_VOID_CONFIRM_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
        _HG_VOID_RUN_MULTI_FLOW_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        /*
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
         */
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_PRE_AUTH_VOID_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_CUP_VOID_CHECK_,
        _NCCC_FUNCTION_CUP_VOID_CONFIRM_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_BATCH_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_PRE_COMP_VOID_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_CUP_VOID_CHECK_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _NCCC_FUNCTION_CUP_VOID_CONFIRM_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_ACCUM_,
	_UPDATE_BATCH_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_INST_SALE_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_PERIOD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_GET_CUP_PIN,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_INST_SALE_ICC_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_PERIOD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_EMV_PROCESS_,				/* 晶片卡因為在_EMV_PROCESS_才抓卡號，這時才會有對應HOST，所以把_NCCC_FUNCTION_MAKE_REFNO_拉進去(_NCCC_DCC_CHECK_原因相同) */
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_INST_SALE_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_PERIOD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_INST_REFUND_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_FUNCTION_CUP_REFUND_LIMIT_CHECK_,
	_CREDIT_FUNCTION_GET_PERIOD_,
	_CREDIT_FUNCTION_GET_DOWNPAYMENT_,
	_CREDIT_FUNCTION_GET_INSTPAYMENT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_INST_REFUND_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_FUNCTION_CUP_REFUND_LIMIT_CHECK_,
	_CREDIT_FUNCTION_GET_PERIOD_,
	_CREDIT_FUNCTION_GET_DOWNPAYMENT_,
	_CREDIT_FUNCTION_GET_INSTPAYMENT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_REDEEM_SALE_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_GET_CUP_PIN,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_REDEEM_SALE_ICC_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_EMV_PROCESS_,				/* 晶片卡因為在_EMV_PROCESS_才抓卡號，這時才會有對應HOST，所以把_NCCC_FUNCTION_MAKE_REFNO_拉進去(_NCCC_DCC_CHECK_原因相同) */
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_REDEEM_SALE_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_REDEEM_REFUND_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_PAY_AMOUNT_,
	_CREDIT_FUNCTION_GET_REDEEM_POINT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_REDEEM_REFUND_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_PAY_AMOUNT_,
	_CREDIT_FUNCTION_GET_REDEEM_POINT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int FISC_SALE_ICC_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_FISC_CARD_ENTER_PIN_,
	_FISC_CARD_POWER_ON_AND_SELECT_AID_,
	_FISC_CARD_VERIFY_PIN_,
        _FISC_CARD_PROCESS_TRAN_,
	_FISC_CARD_POWER_OFF_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int FISC_SALE_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int FISC_VOID_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _NCCC_FUNCTION_FISC_VOID_CHECK_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _NCCC_FUNCTION_FISC_VOID_CONFIRM_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int FISC_REFUND_ICC_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_FISC_ORI_TRANSDATE_,
	_CREDIT_FUNCTION_GET_FISC_RRN_,
        _CREDIT_FUNCTION_GET_FISC_REFUND_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_FISC_CARD_POWER_ON_AND_SELECT_AID_,
	_FISC_CARD_PROCESS_TRAN_,
	_FISC_CARD_POWER_OFF_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
	_NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int FISC_REFUND_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_FISC_ORI_TRANSDATE_,
	_CREDIT_FUNCTION_GET_FISC_RRN_,
        _CREDIT_FUNCTION_GET_FISC_REFUND_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
	_NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int MAIL_ORDER_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_GET_4DBC_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_MAIL_ORDER_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_MAIL_ORDER_REFUND_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
	_NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_FUNCTION_CUP_REFUND_LIMIT_CHECK_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_MAIL_ORDER_REFUND_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
	_NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_FUNCTION_CUP_REFUND_LIMIT_CHECK_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int LOYALTY_REDEEM_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
	_UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
	_FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,				/* 優惠兌換不重印故不存ESC_TEMP */
        _FLOW_NULL_,
};

int LOYALTY_REDEEM_VOID_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
        _CREDIT_FUNCTION_CHECKRESULT_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,				/* 優惠兌換不重印故不存ESC_TEMP */
	_FLOW_NULL_,
};

int FORCE_CASH_ADVANCE_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_FUNCTION_DISCLAIM_AUTH_,
        _CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int FORCE_CASH_ADVANCE_CTLS_TRT_NCCC_ATS_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
	_NCCC_FUNCTION_CHECK_AMOUNT_BY_CARD_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_FUNCTION_DISCLAIM_AUTH_,
        _CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_NCCC_FUNCTION_BDAU_DELETE_ACCUM_BATCH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

TRT_TABLE TRANSACTION_NCCC_ATS_TABLE[] =
{
        {_TRT_SALE_,				SALE_TRT_NCCC_ATS_TABLE},
        {_TRT_SALE_ICC_,			SALE_ICC_TRT_NCCC_ATS_TABLE},
        {_TRT_SALE_CTLS_,			SALE_CTLS_TRT_NCCC_ATS_TABLE},
        {_TRT_VOID_,				VOID_TRT_NCCC_ATS_TABLE},
        {_TRT_REFUND_,				REFUND_TRT_NCCC_ATS_TABLE},
	{_TRT_REFUND_CTLS_,			REFUND_CTLS_TRT_NCCC_ATS_TABLE},
        {_TRT_SETTLE_,				SETTLE_TRT_NCCC_ATS_TABLE},
        {_TRT_TIP_,				TIP_TRT_NCCC_ATS_TABLE},
        {_TRT_SALE_OFFLINE_,			SALE_OFFLINE_TRT_NCCC_ATS_TABLE},
	{_TRT_SALE_OFFLINE_CTLS_,		SALE_OFFLINE_CTLS_TRT_NCCC_ATS_TABLE},
        {_TRT_PRE_AUTH_,			PRE_AUTH_TRT_NCCC_ATS_TABLE},
	{_TRT_PRE_AUTH_ICC_,			PRE_AUTH_ICC_TRT_NCCC_ATS_TABLE},
	{_TRT_PRE_AUTH_CTLS_,			PRE_AUTH_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_PRE_COMP_,			PRE_COMP_TRT_NCCC_ATS_TABLE},
	{_TRT_PRE_COMP_CTLS_,			PRE_COMP_CTLS_TRT_NCCC_ATS_TABLE},
        {_TRT_INST_SALE_,			INST_SALE_TRT_NCCC_ATS_TABLE},
	{_TRT_INST_SALE_ICC_,			INST_SALE_ICC_TRT_NCCC_ATS_TABLE},
	{_TRT_INST_SALE_CTLS_,			INST_SALE_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_INST_REFUND_,			INST_REFUND_TRT_NCCC_ATS_TABLE},
	{_TRT_INST_REFUND_CTLS_,		INST_REFUND_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_INST_ADJUST_,			INST_ADJUST_TRT_NCCC_ATS_TABLE},
	{_TRT_INST_ADJUST_CTLS_,		INST_ADJUST_CTLS_TRT_NCCC_ATS_TABLE},
        {_TRT_REDEEM_SALE_,			REDEEM_SALE_TRT_NCCC_ATS_TABLE},
	{_TRT_REDEEM_SALE_ICC_,			REDEEM_SALE_ICC_TRT_NCCC_ATS_TABLE},
	{_TRT_REDEEM_SALE_CTLS_,		REDEEM_SALE_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_REDEEM_REFUND_,			REDEEM_REFUND_TRT_NCCC_ATS_TABLE},
	{_TRT_REDEEM_REFUND_CTLS_,		REDEEM_REFUND_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_REDEEM_ADJUST_,			REDEEM_ADJUST_TRT_NCCC_ATS_TABLE},
	{_TRT_REDEEM_ADJUST_CTLS_,		REDEEM_ADJUST_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_SALE_,			CUP_SALE_TRT_NCCC_ATS_TABLE},
        {_TRT_CUP_SALE_ICC_,			CUP_SALE_ICC_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_SALE_CTLS_,			CUP_SALE_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_REFUND_,			CUP_REFUND_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_REFUND_CTLS_,			CUP_REFUND_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_PRE_AUTH_,			CUP_PRE_AUTH_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_PRE_AUTH_ICC_,		CUP_PRE_AUTH_ICC_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_PRE_AUTH_CTLS_,		CUP_PRE_AUTH_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_PRE_COMP_,			CUP_PRE_COMP_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_PRE_COMP_CTLS_,		CUP_PRE_COMP_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_VOID_,			CUP_VOID_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_PRE_AUTH_VOID_,		CUP_PRE_AUTH_VOID_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_PRE_COMP_VOID_,		CUP_PRE_COMP_VOID_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_INST_SALE_,			CUP_INST_SALE_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_INST_SALE_ICC_,		CUP_INST_SALE_ICC_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_INST_SALE_CTLS_,		CUP_INST_SALE_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_INST_REFUND_,			CUP_INST_REFUND_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_INST_REFUND_CTLS_,		CUP_INST_REFUND_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_REDEEM_SALE_,			CUP_REDEEM_SALE_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_REDEEM_SALE_ICC_,		CUP_REDEEM_SALE_ICC_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_REDEEM_SALE_CTLS_,		CUP_REDEEM_SALE_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_REDEEM_REFUND_,		CUP_REDEEM_REFUND_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_REDEEM_REFUND_CTLS_,		CUP_REDEEM_REFUND_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_FISC_SALE_ICC_,			FISC_SALE_ICC_TRT_NCCC_ATS_TABLE},
	{_TRT_FISC_SALE_CTLS_,			FISC_SALE_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_FISC_VOID_,			FISC_VOID_TRT_NCCC_ATS_TABLE},
	{_TRT_FISC_REFUND_ICC_,			FISC_REFUND_ICC_TRT_NCCC_ATS_TABLE},
	{_TRT_FISC_REFUND_CTLS_,		FISC_REFUND_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_MAIL_ORDER_,			MAIL_ORDER_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_MAIL_ORDER_,			CUP_MAIL_ORDER_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_MAIL_ORDER_REFUND_,		CUP_MAIL_ORDER_REFUND_TRT_NCCC_ATS_TABLE},
	{_TRT_CUP_MAIL_ORDER_REFUND_CTLS_,	CUP_MAIL_ORDER_REFUND_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_CASH_ADVANCE_,			SALE_TRT_NCCC_ATS_TABLE},
	{_TRT_CASH_ADVANCE_ICC_,		SALE_ICC_TRT_NCCC_ATS_TABLE},
	{_TRT_CASH_ADVANCE_CTLS_,		SALE_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_FORCE_CASH_ADVANCE_,		FORCE_CASH_ADVANCE_TRT_NCCC_ATS_TABLE},
	{_TRT_FORCE_CASH_ADVANCE_CTLS_,		FORCE_CASH_ADVANCE_CTLS_TRT_NCCC_ATS_TABLE},
	{_TRT_LOYALTY_REDEEM_,			LOYALTY_REDEEM_TRT_NCCC_ATS_TABLE},
	{_TRT_VOID_LOYALTY_REDEEM_,		LOYALTY_REDEEM_VOID_TRT_NCCC_ATS_TABLE},
        {_FLOW_NULL_,				NULL}
};

int VOID_TRT_NCCC_DCC_TABLE[] =
{
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_FUNCTION_CHECK_TRANS_FUNCTION_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _NCCC_FUNCTION_VOID_CHECK_,
        _NCCC_DCC_FUNC_VOID_CONFIRM_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int TIP_TRT_NCCC_DCC_TABLE[] =
{
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_FUNCTION_CHECK_TRANS_FUNCTION_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
        _NCCC_FUNCTION_TIP_CHECK_,
        _CREDIT_FUNCTION_GET_DCC_TIP_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_DCC_CHECK_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int SETTLE_TRT_NCCC_DCC_TABLE[] =
{
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_FUNCTION_CHECK_TRANS_FUNCTION_,
	_NCCC_ESC_UPLOAD_SETTLE_,
        _FUNCTION_PREPRINT_AUTO_REPORT_BY_BUFFER_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_SETTLEMENT_XML_NCCC_START_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
        _FUNCTION_DELETE_BATCH_FLOW_,
        _FUNCTION_PRINT_TOTAL_REPORT_BY_BUFFER_,
        _FUNCTION_DELETE_ACCUM_FLOW_,
        _FUNCTION_REST_BATCH_INV_,
	_FUNCTION_UPDATE_BATCH_NUM_,
	_NCCC_FUNCTION_DCC_SETTLE_DOWNLOAD_,
	_NCCC_FUNCTION_SETTLEMENT_XML_NCCC_END_,
        _FLOW_NULL_,
};

TRT_TABLE TRANSACTION_NCCC_DCC_TABLE[] =
{
        {_TRT_VOID_,			VOID_TRT_NCCC_DCC_TABLE},
	{_TRT_TIP_,			TIP_TRT_NCCC_DCC_TABLE},
	{_TRT_SETTLE_,			SETTLE_TRT_NCCC_DCC_TABLE},
        {_FLOW_NULL_,			NULL}
};

int SALE_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_GET_4DBC_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_CURRENCYOPTION_,
	_NCCC_DCC_FUNCTION_CHECK_TRANS_FUNCTION_,
	_NCCC_DCC_ONLINERATE_,
	_NCCC_DCC_FINAL_DCC_OPTION_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int SALE_ICC_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_CURRENCYOPTION_,
	_NCCC_DCC_FUNCTION_CHECK_TRANS_FUNCTION_,
	_NCCC_DCC_ONLINERATE_,
	_NCCC_DCC_FINAL_DCC_OPTION_,
        _EMV_PROCESS_,				/* 晶片卡因為在_EMV_PROCESS_才抓卡號，這時才會有對應HOST，所以把_NCCC_FUNCTION_MAKE_REFNO_拉進去(_NCCC_DCC_CHECK_原因相同) */
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int SALE_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_CURRENCYOPTION_,
	_NCCC_DCC_FUNCTION_CHECK_TRANS_FUNCTION_,
	_NCCC_DCC_ONLINERATE_,
	_NCCC_DCC_FINAL_DCC_OPTION_,
        _NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int VOID_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _NCCC_FUNCTION_VOID_CHECK_,
        _NCCC_FUNCTION_VOID_CONFIRM_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
        _HG_VOID_RUN_MULTI_FLOW_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        /*
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        */
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_HG_FUNCTION_DISPLAY_COMPLETE_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int REFUND_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_TRANSACTION_ORIGIN_CHECK,
	_CREDIT_FUNCTION_GET_DCC_ORI_TRANSDATE_,
	_CREDIT_FUNCTION_GET_DCC_ORI_AMOUNT_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int REFUND_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_TRANSACTION_ORIGIN_CHECK,
	_CREDIT_FUNCTION_GET_DCC_ORI_TRANSDATE_,
	_CREDIT_FUNCTION_GET_DCC_ORI_AMOUNT_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int SETTLE_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
	_NCCC_ESC_UPLOAD_SETTLE_,
        _FUNCTION_PREPRINT_AUTO_REPORT_BY_BUFFER_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_SETTLEMENT_XML_NCCC_START_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
        _FUNCTION_DELETE_BATCH_FLOW_,
        _FUNCTION_PRINT_TOTAL_REPORT_BY_BUFFER_,
        _FUNCTION_DELETE_ACCUM_FLOW_,
        _FUNCTION_REST_BATCH_INV_,
	_FUNCTION_UPDATE_BATCH_NUM_,
	_NCCC_FUNCTION_SETTLEMENT_XML_NCCC_END_,
	_NCCC_FUNCTION_DISPLAY_PLEASE_LOGON_FIRST_ONLY_ISO_,
        _FLOW_NULL_,
};

int TIP_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
        _NCCC_FUNCTION_TIP_CHECK_,
        _CREDIT_FUNCTION_GET_TIP_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int SALE_OFFLINE_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_FUNCTION_DISCLAIM_AUTH_,
        _CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int SALE_OFFLINE_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_FUNCTION_DISCLAIM_AUTH_,
        _CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int PRE_AUTH_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_GET_4DBC_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int PRE_AUTH_ICC_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_GET_4DBC_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_EMV_PROCESS_,				/* 晶片卡因為在_EMV_PROCESS_才抓卡號，這時才會有對應HOST，所以把_NCCC_FUNCTION_MAKE_REFNO_拉進去(_NCCC_DCC_CHECK_原因相同) */
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int PRE_AUTH_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_GET_4DBC_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int PRE_COMP_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
	_CREDIT_FUNCTION_GET_ORI_PREAUTH_AMOUNT_,
	_CREDIT_FUNCTION_GET_PRECOMP_AMOUNT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_CURRENCYOPTION_,
	_NCCC_DCC_FUNCTION_CHECK_TRANS_FUNCTION_,
	_CREDIT_FUNCTION_GET_DCC_ORI_TRANSDATE_,
	_NCCC_DCC_ONLINERATE_,
	_NCCC_DCC_FINAL_DCC_OPTION_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_ACCUM_,
	_UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int PRE_COMP_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
	_CREDIT_FUNCTION_GET_ORI_PREAUTH_AMOUNT_,
	_CREDIT_FUNCTION_GET_PRECOMP_AMOUNT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_DCC_CHECK_,
	_NCCC_DCC_CURRENCYOPTION_,
	_NCCC_DCC_FUNCTION_CHECK_TRANS_FUNCTION_,
	_CREDIT_FUNCTION_GET_DCC_ORI_TRANSDATE_,
	_NCCC_DCC_ONLINERATE_,
	_NCCC_DCC_FINAL_DCC_OPTION_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_ACCUM_,
	_UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int INST_SALE_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_PERIOD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int INST_SALE_ICC_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_PERIOD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_EMV_PROCESS_,				/* 晶片卡因為在_EMV_PROCESS_才抓卡號，這時才會有對應HOST，所以把_NCCC_FUNCTION_MAKE_REFNO_拉進去(_NCCC_DCC_CHECK_原因相同) */
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int INST_SALE_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_PERIOD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int INST_REFUND_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_PERIOD_,
	_CREDIT_FUNCTION_GET_DOWNPAYMENT_,
	_CREDIT_FUNCTION_GET_INSTPAYMENT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int INST_REFUND_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_PERIOD_,
	_CREDIT_FUNCTION_GET_DOWNPAYMENT_,
	_CREDIT_FUNCTION_GET_INSTPAYMENT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int INST_ADJUST_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_PERIOD_,
	_CREDIT_FUNCTION_GET_DOWNPAYMENT_,
	_CREDIT_FUNCTION_GET_INSTPAYMENT_,
	_NCCC_FUNCTION_DISCLAIM_AUTH_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int INST_ADJUST_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_PERIOD_,
	_CREDIT_FUNCTION_GET_DOWNPAYMENT_,
	_CREDIT_FUNCTION_GET_INSTPAYMENT_,
	_NCCC_FUNCTION_DISCLAIM_AUTH_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int REDEEM_SALE_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int REDEEM_SALE_ICC_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_EMV_PROCESS_,				/* 晶片卡因為在_EMV_PROCESS_才抓卡號，這時才會有對應HOST，所以把_NCCC_FUNCTION_MAKE_REFNO_拉進去(_NCCC_DCC_CHECK_原因相同) */
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int REDEEM_SALE_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int REDEEM_REFUND_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_PAY_AMOUNT_,
	_CREDIT_FUNCTION_GET_REDEEM_POINT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int REDEEM_REFUND_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_PAY_AMOUNT_,
	_CREDIT_FUNCTION_GET_REDEEM_POINT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int REDEEM_ADJUST_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_PAY_AMOUNT_,
	_CREDIT_FUNCTION_GET_REDEEM_POINT_,
	_NCCC_FUNCTION_DISCLAIM_AUTH_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int REDEEM_ADJUST_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_PAY_AMOUNT_,
	_CREDIT_FUNCTION_GET_REDEEM_POINT_,
	_NCCC_FUNCTION_DISCLAIM_AUTH_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_SALE_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_GET_CUP_PIN,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_SALE_ICC_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_EMV_PROCESS_,				/* 晶片卡因為在_EMV_PROCESS_才抓卡號，這時才會有對應HOST，所以把_NCCC_FUNCTION_MAKE_REFNO_拉進去(_NCCC_DCC_CHECK_原因相同) */
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_SALE_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_GET_CUP_PIN,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
        _NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_REFUND_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
	_NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_FUNCTION_CUP_REFUND_LIMIT_CHECK_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_REFUND_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
	_NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_FUNCTION_CUP_REFUND_LIMIT_CHECK_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_PRE_AUTH_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_GET_CUP_PIN,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_PRE_AUTH_ICC_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_EMV_PROCESS_,				/* 晶片卡因為在_EMV_PROCESS_才抓卡號，這時才會有對應HOST，所以把_NCCC_FUNCTION_MAKE_REFNO_拉進去(_NCCC_DCC_CHECK_原因相同) */
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_PRE_AUTH_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_GET_CUP_PIN,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_PRE_COMP_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
	_NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
	_CREDIT_FUNCTION_GET_ORI_PREAUTH_AMOUNT_,
	_CREDIT_FUNCTION_GET_PRECOMP_AMOUNT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_ACCUM_,
	_UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_PRE_COMP_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
	_NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
	_CREDIT_FUNCTION_GET_ORI_PREAUTH_AMOUNT_,
	_CREDIT_FUNCTION_GET_PRECOMP_AMOUNT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_ACCUM_,
	_UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_VOID_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_CUP_VOID_CHECK_,
        _NCCC_FUNCTION_CUP_VOID_CONFIRM_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
        _HG_VOID_RUN_MULTI_FLOW_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        /*
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        */
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_PRE_AUTH_VOID_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_CUP_VOID_CHECK_,
        _NCCC_FUNCTION_CUP_VOID_CONFIRM_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_BATCH_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_PRE_COMP_VOID_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_CUP_VOID_CHECK_,
        _NCCC_FUNCTION_CUP_VOID_CONFIRM_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_ACCUM_,
	_UPDATE_BATCH_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_INST_SALE_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_PERIOD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_GET_CUP_PIN,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_INST_SALE_ICC_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_PERIOD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_EMV_PROCESS_,				/* 晶片卡因為在_EMV_PROCESS_才抓卡號，這時才會有對應HOST，所以把_NCCC_FUNCTION_MAKE_REFNO_拉進去(_NCCC_DCC_CHECK_原因相同) */
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_INST_SALE_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_PERIOD_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_INST_REFUND_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_FUNCTION_CUP_REFUND_LIMIT_CHECK_,
	_CREDIT_FUNCTION_GET_PERIOD_,
	_CREDIT_FUNCTION_GET_DOWNPAYMENT_,
	_CREDIT_FUNCTION_GET_INSTPAYMENT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_INST_REFUND_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_NCCC_FUNCTION_CUP_REFUND_LIMIT_CHECK_,
	_CREDIT_FUNCTION_GET_PERIOD_,
	_CREDIT_FUNCTION_GET_DOWNPAYMENT_,
	_CREDIT_FUNCTION_GET_INSTPAYMENT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_INSTALLMENT_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_REDEEM_SALE_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_GET_CUP_PIN,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_REDEEM_SALE_ICC_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_EMV_PROCESS_,				/* 晶片卡因為在_EMV_PROCESS_才抓卡號，這時才會有對應HOST，所以把_NCCC_FUNCTION_MAKE_REFNO_拉進去(_NCCC_DCC_CHECK_原因相同) */
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_REDEEM_SALE_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_FUNCTION_DUPLICATE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _CREDIT_FUNCTION_GET_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_DUPLICATE_SAVE_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
        _FLOW_NULL_,
};

int CUP_REDEEM_REFUND_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_PAY_AMOUNT_,
	_CREDIT_FUNCTION_GET_REDEEM_POINT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int CUP_REDEEM_REFUND_CTLS_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_CREDIT_FUNCTION_GET_ORI_TRANSDATE_,
        _CREDIT_FUNCTION_GET_REFUND_AMOUNT_,
        _FUNCTION_CHECK_BATCH_LIMIT_,
	_CREDIT_FUNCTION_GET_PAY_AMOUNT_,
	_CREDIT_FUNCTION_GET_REDEEM_POINT_,
	_CREDIT_FUNCTION_GET_AUTHCODE_,
        _CREDIT_FUNCTION_GET_STOREID_,
	_CREDIT_FUNCTION_GET_PRODUCT_CODE_,
	_NCCC_FUNCTION_MAKE_REDEEM_DATA_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_GET_PAY_ITEM_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
	_NCCC_FUNCTION_ESC_FUNCPROCESS_,
	_CREDIT_FUNCTION_CHECKRESULT_,
	_FUNCTION_GET_SIGNPAD_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,
	_FLOW_NULL_,
};

int LOYALTY_REDEEM_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
	_NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
	_UPDATE_ACCUM_,
        _UPDATE_BATCH_,
        _FUNCTION_UPDATE_INV_,
	_FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,				/* 優惠兌換不重印故不存ESC_TEMP */
        _FLOW_NULL_,
};

int LOYALTY_REDEEM_VOID_TRT_NCCC_MFES_TABLE[] =
{
	_NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_,
        _NCCC_FUNCTION_MUST_SETTLE_CHECK_,
	_NCCC_DCC_FUNC_MUST_SETTLE_CHECK_,
	_COMM_MODEM_PREDIAL_,
        _NCCC_FUNCTION_MAKE_REFNO_,
	_NCCC_ESC_CHECK_,
	_NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_,
	_NCCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_FLOW_,
        _NCCC_FUNCTION_BUILD_AND_SEND_PACKET_FLOW_,
	_NCCC_FUNCTION_BEEP_AFTER_AUTH_,
	_NCCC_FUNCTION_GET_TRANSACTION_NO_FROM_PAN_,
        _UPDATE_ACCUM_,
        _UPDATE_BATCH_,
	_FUNCTION_UPDATE_INV_,
        _FUNCTION_ECR_SEND_TRANSACTION_RESULT_,
        _CREDIT_FUNCTION_CHECKRESULT_,
        _FUNCTION_PRINT_RECEIPT_BY_BUFFER_FLOW_,
	_NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_,
	_NCCC_FUNCTION_RECEIVE_EI_FLOW_,
	_NCCC_ESC_UPLOAD_,				/* 優惠兌換不重印故不存ESC_TEMP */
	_FLOW_NULL_,
};

TRT_TABLE TRANSACTION_NCCC_MFES_TABLE[] =
{
        {_TRT_SALE_,			SALE_TRT_NCCC_MFES_TABLE},
        {_TRT_SALE_ICC_,		SALE_ICC_TRT_NCCC_MFES_TABLE},
        {_TRT_SALE_CTLS_,		SALE_CTLS_TRT_NCCC_MFES_TABLE},
        {_TRT_VOID_,			VOID_TRT_NCCC_MFES_TABLE},
        {_TRT_REFUND_,			REFUND_TRT_NCCC_MFES_TABLE},
	{_TRT_REFUND_CTLS_,		REFUND_CTLS_TRT_NCCC_MFES_TABLE},
        {_TRT_SETTLE_,			SETTLE_TRT_NCCC_MFES_TABLE},
        {_TRT_TIP_,			TIP_TRT_NCCC_MFES_TABLE},
        {_TRT_SALE_OFFLINE_,		SALE_OFFLINE_TRT_NCCC_MFES_TABLE},
	{_TRT_SALE_OFFLINE_CTLS_,	SALE_OFFLINE_CTLS_TRT_NCCC_MFES_TABLE},
        {_TRT_PRE_AUTH_,		PRE_AUTH_TRT_NCCC_MFES_TABLE},
	{_TRT_PRE_AUTH_ICC_,		PRE_AUTH_ICC_TRT_NCCC_MFES_TABLE},
	{_TRT_PRE_AUTH_CTLS_,		PRE_AUTH_CTLS_TRT_NCCC_MFES_TABLE},
	{_TRT_PRE_COMP_,		PRE_COMP_TRT_NCCC_MFES_TABLE},
	{_TRT_PRE_COMP_CTLS_,		PRE_COMP_CTLS_TRT_NCCC_MFES_TABLE},
        {_TRT_INST_SALE_,		INST_SALE_TRT_NCCC_MFES_TABLE},
	{_TRT_INST_SALE_ICC_,		INST_SALE_ICC_TRT_NCCC_MFES_TABLE},
	{_TRT_INST_SALE_CTLS_,		INST_SALE_CTLS_TRT_NCCC_MFES_TABLE},
	{_TRT_INST_REFUND_,		INST_REFUND_TRT_NCCC_MFES_TABLE},
	{_TRT_INST_REFUND_CTLS_,	INST_REFUND_CTLS_TRT_NCCC_MFES_TABLE},
	{_TRT_INST_ADJUST_,		INST_ADJUST_TRT_NCCC_MFES_TABLE},
	{_TRT_INST_ADJUST_CTLS_,	INST_ADJUST_CTLS_TRT_NCCC_MFES_TABLE},
        {_TRT_REDEEM_SALE_,		REDEEM_SALE_TRT_NCCC_MFES_TABLE},
	{_TRT_REDEEM_SALE_ICC_,		REDEEM_SALE_ICC_TRT_NCCC_MFES_TABLE},
	{_TRT_REDEEM_SALE_CTLS_,	REDEEM_SALE_CTLS_TRT_NCCC_MFES_TABLE},
	{_TRT_REDEEM_REFUND_,		REDEEM_REFUND_TRT_NCCC_MFES_TABLE},
	{_TRT_REDEEM_REFUND_CTLS_,	REDEEM_REFUND_CTLS_TRT_NCCC_MFES_TABLE},
	{_TRT_REDEEM_ADJUST_,		REDEEM_ADJUST_TRT_NCCC_MFES_TABLE},
	{_TRT_REDEEM_ADJUST_CTLS_,	REDEEM_ADJUST_CTLS_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_SALE_,		CUP_SALE_TRT_NCCC_MFES_TABLE},
        {_TRT_CUP_SALE_ICC_,		CUP_SALE_ICC_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_SALE_CTLS_,		CUP_SALE_CTLS_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_REFUND_,		CUP_REFUND_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_REFUND_CTLS_,		CUP_REFUND_CTLS_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_PRE_AUTH_,		CUP_PRE_AUTH_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_PRE_AUTH_ICC_,	CUP_PRE_AUTH_ICC_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_PRE_AUTH_CTLS_,	CUP_PRE_AUTH_CTLS_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_PRE_COMP_,		CUP_PRE_COMP_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_PRE_COMP_CTLS_,	CUP_PRE_COMP_CTLS_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_VOID_,		CUP_VOID_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_PRE_AUTH_VOID_,	CUP_PRE_AUTH_VOID_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_PRE_COMP_VOID_,	CUP_PRE_COMP_VOID_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_INST_SALE_,		CUP_INST_SALE_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_INST_SALE_ICC_,	CUP_INST_SALE_ICC_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_INST_SALE_CTLS_,	CUP_INST_SALE_CTLS_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_INST_REFUND_,		CUP_INST_REFUND_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_INST_REFUND_CTLS_,	CUP_INST_REFUND_CTLS_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_REDEEM_SALE_,		CUP_REDEEM_SALE_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_REDEEM_SALE_ICC_,	CUP_REDEEM_SALE_ICC_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_REDEEM_SALE_CTLS_,	CUP_REDEEM_SALE_CTLS_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_REDEEM_REFUND_,	CUP_REDEEM_REFUND_TRT_NCCC_MFES_TABLE},
	{_TRT_CUP_REDEEM_REFUND_CTLS_,	CUP_REDEEM_REFUND_CTLS_TRT_NCCC_MFES_TABLE},
	{_TRT_LOYALTY_REDEEM_,		LOYALTY_REDEEM_TRT_NCCC_MFES_TABLE},
	{_TRT_VOID_LOYALTY_REDEEM_,	LOYALTY_REDEEM_VOID_TRT_NCCC_MFES_TABLE},
        {_FLOW_NULL_,			NULL}
};

SQLITE_TAG_TABLE TABLE_DUTY_FREE_PWD_TAG[] = 
{
	{"inTableID"			,"INTEGER"	,"PRIMARY KEY"	,""},	/* Table ID Primary key, sqlite table專用避免PRIMARY KEY重複 */
	{"szReprintPwd"			,"TEXT"		,""		,""},
	{"szDetailPwd"			,"TEXT"		,""		,""},
	{""},
};

SQLITE_TAG_TABLE TABLE_DUTY_FREE_FUNCTION_TAG[] = 
{
	{"inTableID"			,"INTEGER"	,"PRIMARY KEY"	,""},	/* Table ID Primary key, sqlite table專用避免PRIMARY KEY重複 */
	{"szEverRichSCDTEnable"		,"TEXT"		,""		,"DEFAULT 'N'"},	/* 昇恆昌聯名卡活動*/
	{""},
};

/*
Function        :inNCCC_RunTRT
Date&Time       :2016/9/19 下午 3:44
Describe        :
*/
int inNCCC_RunTRT(TRANSACTION_OBJECT *pobTran, int inTRTCode)
{
        int     *inTRTID = NULL;
        int     i, inRetVal = VS_ERROR ;
	char	szFESMode[2 + 1] = {0};
	char	szCFESMode[2 + 1] = {0};
	
	memset(szFESMode, 0x00, sizeof(szFESMode));
	inGetNCCCFESMode(szFESMode);
	memset(szCFESMode, 0x00, sizeof(szCFESMode));
	inGetCloud_MFES(szCFESMode);//'N'
        for (i = 0 ;; i ++)
        {
		if (memcmp(szFESMode, _NCCC_03_MFES_MODE_, 2) == 0)
		{
			/* (需求單 - 107276)自助交易標準做法 by Russell 2019/3/5 下午 4:39 */
			if (memcmp(szCFESMode, "Y", strlen("Y")) == 0)
			{
				if (TRANSACTION_NCCC_ATS_TABLE[i].inTRTCode == inTRTCode)
				{
					inTRTID = TRANSACTION_NCCC_ATS_TABLE[i].inTRTID;
					break;
				}
				else if (TRANSACTION_NCCC_ATS_TABLE[i].inTRTCode == -1)
				{
					break;
				}
			}
			else
			{
				if (TRANSACTION_NCCC_MFES_TABLE[i].inTRTCode == inTRTCode)
				{
					inTRTID = TRANSACTION_NCCC_MFES_TABLE[i].inTRTID;
					break;
				}
				else if (TRANSACTION_NCCC_MFES_TABLE[i].inTRTCode == -1)
				{
					break;
				}
			}
			
		}/* 現在MPAS和ATS共用電文 */
		else if (memcmp(szFESMode, _NCCC_05_ATS_MODE_, 2) == 0	||
			 memcmp(szFESMode, _NCCC_04_MPAS_MODE_, 2) == 0)
		{
			if (TRANSACTION_NCCC_ATS_TABLE[i].inTRTCode == inTRTCode)
			{
				inTRTID = TRANSACTION_NCCC_ATS_TABLE[i].inTRTID;
				break;
			}
			else if (TRANSACTION_NCCC_ATS_TABLE[i].inTRTCode == -1)
			{
				break;
			}
			
		}
		else
		{
			inTRTID = NULL;
		}
                
        }

        if (inTRTID == NULL)
        {
                return (VS_ERROR);
        }

        for (i = 0 ; ; i ++)
        {
                if (inTRTID[i] == VS_ERROR)
                        break;

                inRetVal = inFLOW_RunFunction(pobTran, inTRTID[i]);

                if (inRetVal != VS_SUCCESS)
                {
                        break;
                }
        }
	
	/* 如果有插SmartPay錯誤要Power Off */
	if (pobTran->uszFISCBit == VS_TRUE)
	{
		inFLOW_RunFunction(pobTran, _FISC_CARD_POWER_OFF_);
	}

	/* 斷線 */
	inCOMM_End(pobTran);

        return (inRetVal);
}

/*
Function        :inNCCC_Func_Get4DBC
Date&Time       :2015/9/11 上午 10:51
Describe        :輸入AE卡的4DBC
*/
int inNCCC_Func_Get4DBC(TRANSACTION_OBJECT *pobTran)
{
        int     	inRetVal;
        char    	szErrorMsg[_DEBUG_MESSAGE_SIZE_ + 1];
        char    	sz4DBCEnable [1 + 1];
        DISPLAY_OBJECT  srDispObj;
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get4DBC START!");

        if (ginDebug == VS_TRUE)
        {
                inLogPrintf(AT, "inNCCC_Func_Get4DBC()_START");
        }
	
	if (ginFindRunTime == VS_TRUE)
	{
		inFunc_RecordTime_Append("%d %s", __LINE__, __FUNCTION__);
	}

        memset(&srDispObj, 0x00, sizeof(DISPLAY_OBJECT));

        /* 不是AE卡 return */
        if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_AMEX_, 4))
        {
                if (ginDebug == VS_TRUE)
                {
                        memset(szErrorMsg, 0x00, sizeof(szErrorMsg));
                        sprintf(szErrorMsg, "CardLabel = %s", pobTran->srBRec.szCardLabel);
                        inLogPrintf(AT, szErrorMsg);
                }

                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get4DBC not AE CARD(%s) END!", pobTran->srBRec.szCardLabel);
                return (VS_SUCCESS);
        }

        /* CFGT 4DBC開關 */
        memset(sz4DBCEnable, 0x00, sizeof(sz4DBCEnable));
        inGet4DBCEnable(sz4DBCEnable);

        if (sz4DBCEnable[0] == 'N')
        {
                if (ginDebug == VS_TRUE)
                {
                        memset(szErrorMsg, 0x00, sizeof(szErrorMsg));
                        sprintf(szErrorMsg, "4DBCEnable == OFF ");
                        inLogPrintf(AT, szErrorMsg);
                }

                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get4DBC sz4DBCEnable=N(%s) END!", sz4DBCEnable);
                return (VS_SUCCESS);
        }
	
	/* 晶片卡或感應卡不輸入4DBC */
	if (pobTran->srBRec.inChipStatus == _EMV_CARD_	||
	    pobTran->srBRec.uszContactlessBit == VS_TRUE)
	{
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get4DBC Not_megstripe_card(%d)(0x%02X) END!", pobTran->srBRec.inChipStatus, pobTran->srBRec.uszContactlessBit);
		return (VS_SUCCESS);
	}
	
	inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
	inDISP_PutGraphic(_GET_AMEX_4DBC_, 0, _COORDINATE_Y_LINE_8_4_);

        while (1)
        {
		srDispObj.inX = 12;
                srDispObj.inY = _LINE_8_8_;
                srDispObj.inR_L = _DISP_RIGHT_;
                srDispObj.inMaxLen = 4;
		srDispObj.inColor = _COLOR_RED_;
		srDispObj.uszNotClearScreen = VS_TRUE;
                strcpy(srDispObj.szPromptMsg, "");

		memset(srDispObj.szOutput, 0x00, sizeof(srDispObj.szOutput));
		srDispObj.inOutputLen = 0;
	
                /* 鍵盤輸入4碼 4DBC */
                inRetVal = inDISP_Enter8x16(&srDispObj);

                if (inRetVal == VS_TIMEOUT || inRetVal == VS_USER_CANCEL)
                {
                        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get4DBC Timeout_Or_UserCancel(%d) END!", inRetVal);
			return (inRetVal);
                }

                if (srDispObj.inOutputLen == 4)
                {
                        memset(pobTran->srBRec.szAMEX4DBC, 0x00, sizeof(pobTran->srBRec.szAMEX4DBC));
                        memcpy(&pobTran->srBRec.szAMEX4DBC[0], &srDispObj.szOutput[0], srDispObj.inOutputLen);
                        break;
                }
                else
                {
                        inDISP_BEEP(1, 0);
			inDISP_Clear_Area(srDispObj.inX, srDispObj.inY, 16, srDispObj.inY, srDispObj.inFoneSize);
                        continue;
                }
        }

        if (ginDebug == VS_TRUE)
        {
                memset(szErrorMsg, 0x00, sizeof(szErrorMsg));
                sprintf(szErrorMsg, "inNCCC_Func_Get4DBC()_[%s]_END", pobTran->srBRec.szAMEX4DBC);
                inLogPrintf(AT, szErrorMsg);
        }
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get4DBC END!");

        return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_VOID_Confirm
Date&Time       :2015/10/22 下午 04:00
Describe        :按0確認是否要進行取消交易
*/
int inNCCC_Func_VOID_Confirm(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = VS_ERROR;
        char    szAuthCodeMsg[_DISP_MSG_SIZE_ + 1] = {0};
        char    szAmountMsg[_DISP_MSG_SIZE_ + 1] = {0};
        char    szKey = 0x00;
	char	szCustomerIndicator[3 + 1] = {0};

	vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_VOID_Confirm START!");
	
        /* 確認金額 */
        if (pobTran->srBRec.lnTotalTxnAmount <= 0)
                return (VS_ERROR);

	/* (需求單 - 107227)邦柏科技自助作業客製化 客製化107不顯示確認畫面亦不用按0確認 by Russell 2018/12/7 下午 2:35 */
	/* (需求單 - 107276)自助交易標準400做法 by Russell 2018/12/27 上午 11:20 */
	/* 客製化123比照客製化119比照客製化111，取消不用按0 */
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	if ((!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_107_BUMPER_, _CUSTOMER_INDICATOR_SIZE_)           ||
	     !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_111_KIOSK_STANDARD_, _CUSTOMER_INDICATOR_SIZE_)   ||
             !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_098_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)        ||
             !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_105_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)        ||
             !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_123_IKEA_, _CUSTOMER_INDICATOR_SIZE_)		||
	     !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_124_EVER_RICH_, _CUSTOMER_INDICATOR_SIZE_))	&&
	     pobTran->uszECRBit == VS_TRUE)
	{
		inRetVal = VS_SUCCESS;
	}
	/* (需求單 - 109327)V3機型開發支援Vx520的客製化參數需求 (002-耐斯廣場/王子大飯店) 取消不按零確認 by Russell 2020/10/6 下午 4:46 */
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_002_NICE_PLAZA_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inRetVal = VS_SUCCESS;
	}
	/* (需求單 - 109327)V3機型開發支援Vx520的客製化參數需求 (005-FPG) 取消不按零確認 by Russell 2022/10/5 下午 7:38 */
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_005_FPG_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inRetVal = VS_SUCCESS;
	}
	else
	{
		memset(szAuthCodeMsg, 0x00, sizeof(szAuthCodeMsg));
		memset(szAmountMsg, 0x00, sizeof(szAmountMsg));
	
		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		/* 提示檢核金額和授權碼 */
		inDISP_PutGraphic(_CHECK_AUTH_AMT_, 0, _COORDINATE_Y_LINE_8_4_);
		/* 顯示授權碼 */
		sprintf(szAuthCodeMsg, "%s", pobTran->srBRec.szAuthCode);
		inDISP_EnglishFont_Point_Color(szAuthCodeMsg, _FONTSIZE_8X16_, _LINE_8_5_, _COLOR_RED_,_COLOR_WHITE_, 11);

		/* 顯示金額 */
		if (pobTran->srBRec.inOrgCode == _REFUND_ || pobTran->srBRec.inOrgCode == _INST_REFUND_ || pobTran->srBRec.inOrgCode == _REDEEM_REFUND_)
		{
			sprintf(szAmountMsg, "%ld", 0 - pobTran->srBRec.lnTotalTxnAmount);
			inFunc_Amount_Comma(szAmountMsg, "NT$" , ' ', _SIGNED_NONE_, 13, _PADDING_LEFT_);
		}
		else
		{
			sprintf(szAmountMsg, "%ld", pobTran->srBRec.lnTotalTxnAmount);
			inFunc_Amount_Comma(szAmountMsg, "NT$" , ' ', _SIGNED_NONE_, 13, _PADDING_LEFT_);
		}

                if (strlen(szAmountMsg) > 13)
                        inDISP_EnglishFont_Point_Color(szAmountMsg, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_RED_,_COLOR_WHITE_, 7);
                else
                        inDISP_EnglishFont_Point_Color(szAmountMsg, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_RED_,_COLOR_WHITE_, 8);

		while (1)
		{
			szKey = uszKBD_GetKey(_EDC_TIMEOUT_);

			if (szKey == _KEY_0_)
			{
				inRetVal = VS_SUCCESS;
				break;
			}
			else if (szKey == _KEY_CANCEL_)
			{
				inRetVal = VS_USER_CANCEL;
				break;
			}
			else if (szKey == _KEY_TIMEOUT_)
			{
				inRetVal = VS_TIMEOUT;
				break;
			}
		}
	}
	
	/* pobTran->uszUpdateBatchBit 表示 uszUpdateBatchBit / TRANS_BATCH_KEY】是要更新記錄 */
	/* 暫時放這裡 */
	if (inRetVal == VS_SUCCESS)
	{
            pobTran->uszUpdateBatchBit = VS_TRUE;
            pobTran->srBRec.uszVOIDBit = VS_TRUE;
            pobTran->srBRec.inOrgCode = pobTran->srBRec.inCode;
            pobTran->srBRec.inCode = pobTran->inTransactionCode;
	}
	else
	{
		
	}

        return (inRetVal);
}

/*
Function        :inNCCC_Func_VOID_Check
Date&Time       :2015/10/22 下午 04:00
Describe        :確認是否能進行取消交易
*/
int inNCCC_Func_VOID_Check(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = VS_SUCCESS;
        int     inTimeout = _EDC_TIMEOUT_;
	char	szNCCCFESMode[2 + 1];
        char	szTRTFileName[12 + 1];
	char	szCFESMode[1 + 1] = {0};
        char	szCustomerIndicator[3 + 1] = {0};
	
	vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_VOID_Check START!");

	memset(szNCCCFESMode, 0x00, sizeof(szNCCCFESMode));
        /* NCCC FES 模式 , 01 = 集訓機  02 = R-FES 03 = M-FES 04 = MPAS 05 = ATS */
	inGetNCCCFESMode(szNCCCFESMode);
	
	memset(szCFESMode, 0x00, sizeof(szCFESMode));
        /* 是否為雲端MFES，預設值=N。Y=雲端MFES。 N=一般MFES。*/
	inGetCloud_MFES(szCFESMode);
            
        memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
	inGetTRTFileName(szTRTFileName);
        
        memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
        inGetCustomIndicator(szCustomerIndicator);
        
        if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_098_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)     ||
            !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_105_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)) 
        {
                inTimeout = _CUSTOMER_105_MCDONALDS_DISPLAY_TIMEOUT_;
        }
/* 這邊的pobTran->srBRec.uszVOIDBit == VS_TRUE 很可能是之前已經做過一次取消所保留的設定Bit On */
        if (pobTran->srBRec.uszVOIDBit == VS_TRUE)
        {
                /* 顯示此交易已取消 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_CANCEL_ALREADY_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = inTimeout;
		strcpy(srDispMsgObj.szErrMsg1, "");
		srDispMsgObj.inErrMsg1Line = 0;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
                inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
                pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
		return (inRetVal);
        }
	/* 擋銀聯交易 沒按銀聯鍵取消 */
	else if (pobTran->srBRec.uszCUPTransBit == VS_TRUE)
	{
		/* 請按銀聯鍵 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_PLEASE_PRESS_CUP_BUTTON_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = inTimeout;
		strcpy(srDispMsgObj.szErrMsg1, "");
		srDispMsgObj.inErrMsg1Line = 0;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
		inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
                pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
		return (inRetVal);
	}
	/* NCCC 小費不能取消 */
        else if (pobTran->srBRec.inCode == _TIP_)
	{
		/* 顯示小費交易 交易不能取消 請按清除鍵 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_CAN_NOT_CANCEL_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = inTimeout;
		strcpy(srDispMsgObj.szErrMsg1, "小費交易");
		srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
		inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
		pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
		return (inRetVal);
	}
	/* 預先授權不能取消 */
        else if (pobTran->srBRec.inOrgCode == _PRE_AUTH_)
	{
		/* 顯示預先授權不能取消 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_PREAUTH_CANCEL_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = inTimeout;
		strcpy(srDispMsgObj.szErrMsg1, "");
		srDispMsgObj.inErrMsg1Line = 0;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
		inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
		pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
		return (inRetVal);
	}
	else if (pobTran->srBRec.inOrgCode == _PRE_COMP_		&& 
		!(memcmp(szNCCCFESMode, _NCCC_05_ATS_MODE_, 2) == 0	||
		  memcmp(szNCCCFESMode, _NCCC_04_MPAS_MODE_, 2) == 0	||
		 (memcmp(szNCCCFESMode, _NCCC_03_MFES_MODE_, 2) == 0	&&
		  memcmp(szCFESMode, "Y", strlen("Y")) == 0)))
	{
		/* 只限ATS主機提供pre-auth complete cancel功能。 */
		/* 僅限MFES不能做 */
		/* 交易不能取消 */
		/* 請改用退貨 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_CAN_NOT_CANCEL_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_5_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = inTimeout;
		strcpy(srDispMsgObj.szErrMsg1, "請改用退貨");
		srDispMsgObj.inErrMsg1Line = _LINE_8_6_;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
		inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
		pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
		return (inRetVal);
	}
	else if (pobTran->srBRec.inOrgCode == _LOYALTY_REDEEM_)
	{
		/* 無交易紀錄 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_RECORD_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
		srDispMsgObj.inMsgType = _ENTER_KEY_MSG_;
		srDispMsgObj.inTimeout = inTimeout;
		strcpy(srDispMsgObj.szErrMsg1, "");
		srDispMsgObj.inErrMsg1Line = 0;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
		inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
		pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
		return (inRetVal);
	}
	else if (pobTran->srBRec.uszFiscTransBit == VS_TRUE)
	{
                /* Mirror Message */
                if (pobTran->uszECRBit == VS_TRUE)
                {
                        inECR_SendMirror(pobTran, _MIRROR_MSG_WRONG_CARD_ERROR_);
                }
                                                
		/* 取消交易不能取消Smart Pay交易 */
		/* 請依正確卡別操作 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_PLEASE_FOLLOW_RIGHT_OPT_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_5_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = inTimeout;
		strcpy(srDispMsgObj.szErrMsg1, "");
		srDispMsgObj.inErrMsg1Line = 0;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
		inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
                pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
		return (inRetVal);
	}
        else
        {
                if (pobTran->srBRec.uszHappyGoMulti == TRUE) 
                {
                        if (!memcmp(szTRTFileName, _TRT_FILE_NAME_HG_, strlen(_TRT_FILE_NAME_HG_)))
                        {
                                /* 取消HG混合交易，要選擇信用卡主機 */
                                /* 請選擇信用卡主機 */
				DISPLAY_OBJECT	srDispMsgObj;
				memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
				strcpy(srDispMsgObj.szDispPic1Name, _ERR_CHOOSE_CREDIT_HOST_);
				srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_5_;
				srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
				srDispMsgObj.inTimeout = inTimeout;
				strcpy(srDispMsgObj.szErrMsg1, "");
				srDispMsgObj.inErrMsg1Line = 0;
				srDispMsgObj.inBeepTimes = 1;
				srDispMsgObj.inBeepInterval = 0;
                                inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
				pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
                                return (inRetVal);
                        }
                        else
                        {
                                                           
                        }
                }
        }
        
        /* 客製化098，收銀機取消金額需與原金額比對 */
        if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_098_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)     ||
            !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_105_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_))   
        {
                if (pobTran->uszECRBit == VS_TRUE)
                {
                        if (pobTran->lnVoidCheckAmt != pobTran->srBRec.lnTxnAmount) 
                        {   
                                /* Mirror Message */
                                inECR_SendMirror(pobTran, _MIRROR_MSG_AMOUNT_ERROR_);

                                DISPLAY_OBJECT	srDispMsgObj;
                                memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
                                strcpy(srDispMsgObj.szDispPic1Name, _ERR_AMOUNT_NOT_MATCH_);
                                srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
                                srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
                                srDispMsgObj.inTimeout = inTimeout;
                                strcpy(srDispMsgObj.szErrMsg1, "");
                                srDispMsgObj.inErrMsg1Line = 0;
                                srDispMsgObj.inBeepTimes = 1;
                                srDispMsgObj.inBeepInterval = 0;
                                inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
				pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;

                                return (inRetVal);
                        }
                }
        }
        
	return (inRetVal);
}

/*
Function        :inNCCC_Func_TIP_Confirm
Date&Time       :2015/10/22 下午 04:00
Describe        :確認是否能進行小費交易
*/
int inNCCC_Func_TIP_Check(TRANSACTION_OBJECT *pobTran)
{
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_TIP_Check START!");
        
	/* 改正向表列比較簡單 */
	if (pobTran->srBRec.inCode != _SALE_		&&
	    pobTran->srBRec.inCode != _INST_SALE_	&&
	    pobTran->srBRec.inCode != _REDEEM_SALE_	&&
	    pobTran->srBRec.inCode != _SALE_OFFLINE_	)
        {
		/* 比照520要顯示不同的錯誤訊息 by Russell 2019/12/12 下午 1:35 */
		if (pobTran->srBRec.inCode == _TIP_)
		{
			/* 顯示已輸入小費 */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, "");
			srDispMsgObj.inDispPic1YPosition = 0;
			srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
			srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
			strcpy(srDispMsgObj.szErrMsg1, "已輸入小費");
			srDispMsgObj.inErrMsg1Line = _LINE_8_6_;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;

			inDISP_Msg_BMP(&srDispMsgObj);
			pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		}
		else if (pobTran->srBRec.inCode == _INST_ADJUST_	||
			 pobTran->srBRec.inCode == _REDEEM_ADJUST_	||
			 pobTran->srBRec.inCode == _PRE_AUTH_		||
			 pobTran->srBRec.inCode == _PRE_COMP_)
		{
			/* 顯示 分期調帳，不能有小費 */
			/* 顯示 紅利調帳，不能有小費 */
			/* 顯示 預先授權，不能有小費 */
			/* 顯示 預先授權完成，不能有小費 */
			
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			
			if (pobTran->srBRec.inCode == _INST_ADJUST_)
			{
				strcpy(srDispMsgObj.szErrMsg1, "分期調帳");
			}
			else if (pobTran->srBRec.inCode == _REDEEM_ADJUST_)
			{
				strcpy(srDispMsgObj.szErrMsg1, "紅利調帳");
			}
			else if (pobTran->srBRec.inCode == _PRE_AUTH_)
			{
				strcpy(srDispMsgObj.szErrMsg1, "預先授權");
			}
			else if (pobTran->srBRec.inCode == _PRE_COMP_)
			{
				strcpy(srDispMsgObj.szErrMsg1, "預先授權完成");
			}
			
			strcpy(srDispMsgObj.szDispPic1Name, "");
			srDispMsgObj.inDispPic1YPosition = 0;
			srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
			srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
			srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
			strcpy(srDispMsgObj.szErrMsg2, "不能有小費");
			srDispMsgObj.inErrMsg2Line = _LINE_8_6_;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;

			inDISP_Msg_BMP(&srDispMsgObj);
			pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		}
		else
		{
			/* 顯示不能做小費 */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, _ERR_TIP_);
			srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
			srDispMsgObj.inMsgType = _ENTER_KEY_MSG_;
			srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
			strcpy(srDispMsgObj.szErrMsg1, "");
			srDispMsgObj.inErrMsg1Line = 0;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;

			inDISP_Msg_BMP(&srDispMsgObj);
			pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		}
		
		return (VS_ERROR);
        }
	/* (需求單-109455)-Üny實體掃碼需求 by Russell 2021/9/10 上午 10:32 */
	else if (pobTran->srBRec.uszUnyTransBit == VS_TRUE)
	{
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szErrMsg1, "掃碼交易");
		strcpy(srDispMsgObj.szDispPic1Name, "");
		srDispMsgObj.inDispPic1YPosition = 0;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
		srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
		strcpy(srDispMsgObj.szErrMsg2, "不支援小費");
		srDispMsgObj.inErrMsg2Line = _LINE_8_6_;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;

		inDISP_Msg_BMP(&srDispMsgObj);
		pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
		return (VS_ERROR);
	}
        else
	{
                return (VS_SUCCESS);
	}
}

/*
Function        :inNCCC_Func_ADJUST_Confirm
Date&Time       :2015/10/22 下午 04:00
Describe        :確認是否能進行調帳交易
*/
int inNCCC_Func_ADJUST_Check(TRANSACTION_OBJECT *pobTran)
{
        if (pobTran->srBRec.inCode == _TIP_			||
            pobTran->srBRec.inCode == _VOID_			||
            pobTran->srBRec.inCode == _REFUND_			||
            pobTran->srBRec.inCode == _INST_REFUND_		||
            pobTran->srBRec.inCode == _REDEEM_REFUND_		||
	    pobTran->srBRec.inCode == _CUP_REFUND_		||
	    pobTran->srBRec.inCode == _CUP_MAIL_ORDER_REFUND_	||
            pobTran->srBRec.inCode == _ADJUST_			||
            pobTran->srBRec.inCode == _INST_ADJUST_		||
            pobTran->srBRec.inCode == _REDEEM_ADJUST_ )
        {
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_ADJUST_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
		srDispMsgObj.inMsgType = _ENTER_KEY_MSG_;
		srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
		strcpy(srDispMsgObj.szErrMsg1, "");
		srDispMsgObj.inErrMsg1Line = 0;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
			
                inDISP_Msg_BMP(&srDispMsgObj);
		
		return (VS_ERROR);
        }
        else
                return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Must_SETTLE
Date&Time       :2015/10/22 下午 04:00
Describe        :確認是否要先結帳
*/
int inNCCC_Func_Must_SETTLE(TRANSACTION_OBJECT *pobTran)
{
	int	inNCCC_HostIndex;
        char    szMustSettleBit[2 + 1] = {0};
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Must_SETTLE START!");
	
	if (ginFindRunTime == VS_TRUE)
	{
		inFunc_RecordTime_Append("%d %s", __LINE__, __FUNCTION__);
	}
	
	if (inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_CREDIT_NCCC_, &inNCCC_HostIndex) != VS_SUCCESS)
	{
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Must_SETTLE inFunc_Find_Specific_HDTindex failed ");
		/* 找不到直接return VS_ERROR */
		return (VS_ERROR);
	}
        inLoadHDPTRec(inNCCC_HostIndex);
        memset(szMustSettleBit, 0x00, sizeof(szMustSettleBit));

        if (inGetMustSettleBit(szMustSettleBit) == VS_ERROR)
        {
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Must_SETTLE inGetMustSettleBit failed");
                return (VS_ERROR);
        }

	/* Load完了要load回原來的HDPT避免意外，如果有的話 */
	inLoadHDPTRec(pobTran->srBRec.inHDTIndex);
	
        if (!memcmp(szMustSettleBit, "Y", 1))
        {
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Must_SETTLE szMustSettleBit:Y ");
                /* 表示要結帳 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_MUST_SETTLE_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
		strcpy(srDispMsgObj.szErrMsg1, _HOST_NAME_CREDIT_NCCC_);
		srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
                inDISP_Msg_BMP(&srDispMsgObj);
		
		return (VS_ERROR);
	}
        else
	{
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Must_SETTLE END!");
                
                return (VS_SUCCESS);
	}
}

/*
Function        :inNCCC_Func_GenMAC
Date&Time       :2015/12/21 上午 11:58
Describe        :
*/
int inNCCC_Func_GenMAC(TRANSACTION_OBJECT *pobTran, char *szF_03, char *szF_04, char *szF_11, char *szF_35, char *szF_41, char *szF_63)
{
	int 	inMACLen = 0;
	int 	inRetVal;
	char	szDebugMsg[128 + 1], szDataBuf[128 + 1];
	char	szAscii[16 + 1];
	

	/* 處理中‧‧‧‧‧ */
	inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
	inDISP_PutGraphic(_PROCESS_, 0, _COORDINATE_Y_LINE_8_7_); 

	if (pobTran->inISOTxnCode == _SETTLE_ || pobTran->inISOTxnCode == _CLS_SETTLE_ || pobTran->inISOTxnCode == _CLS_BATCH_)
	{
		/*
			(2)	Message Type為 0500 結帳時，使用下面四項資料進行MAC演算
				1.ISO8583 F_11(STAN)後2碼(BCD to ASCII)
				2.ISO8583 F_41(TID)8碼
				3.Process Code前兩碼 2 碼 (BCD to ASCII)
				4.ISO8583 F_63 Data
					例：Sale Count + Sale Amount +
					    Refund Count + Refund Amount(共計30 Bytes)
		*/
		memset(szDataBuf, 0x00, sizeof(szDataBuf));
		/* ISO8583 F_11(STAN)後2碼(BCD to ASCII) */
		strcat(szDataBuf, szF_11);
		/* Terminal ID */
		strcat(szDataBuf, szF_41);
		/* Process Code前兩碼 2 碼 (BCD to ASCII) */
		strcat(szDataBuf, szF_03);
		/* ISO8583 F_63 Data */
		strcat(szDataBuf, szF_63);
		
		if (ginDebug == VS_TRUE)
		{
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "F11: %s", szF_11);
			inLogPrintf(AT, szDebugMsg);
			
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "F41: %s", szF_41);
			inLogPrintf(AT, szDebugMsg);
			
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "F03: %s", szF_03);
			inLogPrintf(AT, szDebugMsg);
			
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "F63: %s", szF_63);
			inLogPrintf(AT, szDebugMsg);
		}
		
	}
	else
	{
		/*
			(1) Message Type為 0100、0200、0220、0320之相關交易使用下面五項資料進行MAC演算。
				1.ISO8583 F_11(STAN)後2碼(BCD to ASCII)
				2.ISO8583 F_41(TID)8碼
				3.Process Code前兩碼 2 碼 (BCD to ASCII)
				4.ISO8583 F_35 Data
					例：Track 2 =493817XXXXXXXX0001=1812201XXXXXXXX
					刷磁卡或插晶片(完整Track 2) = 493817XXXXXXXX0001=1812201XXXXXXXX
					人工輸入卡號 = 493817XXXXXXXX0001=1812
				5.ISO8583 F_04 Data
					例：NT$ 123 => 則DATA為”000000012300” 12碼。
		*/
		memset(szDataBuf, 0x00, sizeof(szDataBuf));
		/* ISO8583 F_11(STAN)後2碼(BCD to ASCII) */
		strcat(szDataBuf, szF_11);
		/* Terminal ID */
		strcat(szDataBuf, szF_41);
		/* Process Code前兩碼 2 碼 (BCD to ASCII) */
		strcat(szDataBuf, szF_03);
		/* ISO8583 F_35 Data */
		strcat(szDataBuf, szF_35);
		/* ISO8583 F_04 Data */
		strcat(szDataBuf, szF_04);
		
		if (ginDebug == VS_TRUE)
		{
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "F11: %s", szF_11);
			inLogPrintf(AT, szDebugMsg);
			
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "F41: %s", szF_41);
			inLogPrintf(AT, szDebugMsg);
			
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "F03: %s", szF_03);
			inLogPrintf(AT, szDebugMsg);
			
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "F35: %s", szF_35);
			inLogPrintf(AT, szDebugMsg);
			
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "F04: %s", szF_04);
			inLogPrintf(AT, szDebugMsg);
		}
		
	}

	inMACLen = strlen(szDataBuf);

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "==========================================");
		
		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "GenMAC Length [%d]", inMACLen);
		inLogPrintf(AT, szDebugMsg);
		
		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "GenMAC Data [%s]", szDataBuf);
		inDISP_LogPrintf_Format(szDebugMsg, "  ", 34);
		
		inLogPrintf(AT, "==========================================");
	}
	
	if (ginISODebug == VS_TRUE)
	{
		inPRINT_ChineseFont("==========================================", _PRT_ISO_);
		
		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "GenMAC Length [%d]", inMACLen);
		inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
		
		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "GenMAC Data [%s]", szDataBuf);
		inPRINT_ChineseFont_Format(szDebugMsg, "  ", 34, _PRT_ISO_);
		
		inPRINT_ChineseFont("==========================================", _PRT_ISO_);
	}

	inRetVal = inNCCC_TMK_CalculateMac(szDataBuf, pobTran->szMAC_HEX);
		
	if (ginDebug == VS_TRUE)
	{
                memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		memset(szAscii, 0x00, sizeof(szAscii));
		inFunc_BCD_to_ASCII(szAscii, (unsigned char*)pobTran->szMAC_HEX, 8);
        	sprintf(szDebugMsg, "MAC RESULT [%d][%s]", strlen(pobTran->szMAC_HEX), szAscii);
                inDISP_LogPrintf_Format(szDebugMsg, "  ", 34);
        }
	
	if (ginISODebug == VS_TRUE)
	{
                memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		memset(szAscii, 0x00, sizeof(szAscii));
		inFunc_BCD_to_ASCII(szAscii, (unsigned char*)pobTran->szMAC_HEX, 8);
        	sprintf(szDebugMsg, "MAC RESULT [%d][%s]", strlen(pobTran->szMAC_HEX), szAscii);
                inPRINT_ChineseFont_Format(szDebugMsg, "  ", 34, _PRT_ISO_);
        }

        if (inRetVal != VS_SUCCESS)
	        return (VS_ERROR);

        return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_MFES_GenMAC
Date&Time       :2017/1/10 下午 1:35
Describe        :MFES GEN MAC 規則似乎不同，參照inPinPadGenMAC_PINPad1000SE()
*/
int inNCCC_Func_MFES_GenMAC(TRANSACTION_OBJECT *pobTran, char *szF_03, char *szF_04, char *szF_11, char *szF_35, char *szF_41, char *szF_63)
{
	int	i;
	int 	inMACLen = 0;
	int 	inRetVal;
	char	szDebugMsg[128 + 1], szDataBuf[128 + 1];
	char	szAscii[16 + 1];
	char	szTemplate[12 + 1];
	char	szTxnCode[2 + 1];
	char	szTrack2Data[50 + 1];
	char	szFinalPAN[20 + 1];		/* 為了U CARD */
	
	/* 處理中‧‧‧‧‧ */
	inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
	inDISP_PutGraphic(_PROCESS_, 0, _COORDINATE_Y_LINE_8_7_); 
	
	/***** Message for MAC *****/
	/* Message Data
		a. Transmission Number : 2 Bytes
		b. TID : 16 Bytes
		c. Transaction Code : 2 Bytes
		d. Track 2 Data : FID q , variable length
		e. Amount : FID B , 18 Bytes
	*/
	
	/* Track2和F35邏輯不同，這裡再組一次(Refund 和 offline sale只要卡號+有效期 ) */
	/* 應該是 HAPPY_GO Bugger */
	memset(szTrack2Data, 0x00, sizeof(szTrack2Data));
	memset(szFinalPAN, 0x00, sizeof(szFinalPAN));
	/* (需求單 - 106349)移除原U CARD邏輯判斷 2018/10/31 下午 3:41 by Russell */
	strcpy(szFinalPAN, pobTran->srBRec.szPAN);
	
	if (pobTran->srBRec.uszManualBit == VS_TRUE		||
	    pobTran->srBRec.uszVOIDBit == VS_TRUE		||
	    pobTran->inTransactionCode == _VOID_		||
	    pobTran->inTransactionCode == _SALE_OFFLINE_	||
	    pobTran->inTransactionCode == _INST_ADJUST_		|| 
	    pobTran->inTransactionCode == _REDEEM_ADJUST_	||
	    pobTran->inTransactionCode == _ADJUST_		||
	    pobTran->inTransactionCode == _PRE_COMP_)
	{
		/* (需求單 - 106349)移除原U CARD邏輯判斷 2018/10/31 下午 3:41 by Russell */
		if ((pobTran->srBRec.uszCUPTransBit == VS_FALSE)	&&
		    (pobTran->inTransactionCode == _SALE_OFFLINE_	||
		     pobTran->inTransactionCode == _INST_ADJUST_	||
		     pobTran->inTransactionCode == _REDEEM_ADJUST_	||
		     pobTran->inTransactionCode == _REFUND_		||
		     pobTran->inTransactionCode == _REDEEM_REFUND_	||
		     pobTran->inTransactionCode == _INST_REFUND_	||
		     pobTran->inTransactionCode == _ADJUST_		||
		    (pobTran->inEMVDecision == _EMV_DECESION_OFFLINE && !memcmp(pobTran->srBRec.szAuthCode, "Y1", 2))))
		{
			strcat(szTrack2Data, szFinalPAN);
			strcat(szTrack2Data, "=");
			strcat(szTrack2Data, pobTran->srBRec.szExpDate);
		}
		/* 信用卡的取消交易壓MAC時,只用手動輸入的方式來壓 */
		else if ((pobTran->srBRec.uszVOIDBit == VS_TRUE && pobTran->srBRec.uszCUPTransBit == VS_FALSE) ||
			(pobTran->srBRec.uszVOIDBit == VS_TRUE && (pobTran->inTransactionCode == _CUP_VOID_ || pobTran->inTransactionCode == _CUP_PRE_AUTH_VOID_)))	/* 2013-12-02 AM 10:12:19 add by kakab 新增銀聯取消及退貨比照一般信用卡交易流程 */
		{
			/* (需求單 - 106349)移除原U CARD邏輯判斷 2018/10/31 下午 3:41 by Russell */
			strcat(szTrack2Data, szFinalPAN);
			strcat(szTrack2Data, "=");
			strcat(szTrack2Data, pobTran->srBRec.szExpDate);
		}
		else if (pobTran->srBRec.uszManualBit == VS_TRUE	&&
			 pobTran->srBRec.uszCUPTransBit == VS_TRUE)
		{
			/* 銀聯預先授權及銀聯預先授權取消 人工輸入送 卡號 + EXP date */
			strcat(szTrack2Data, szFinalPAN);
			strcat(szTrack2Data, "=");
			strcat(szTrack2Data, pobTran->srBRec.szExpDate);
		}
		else
		{
//			/* 原Verifone Code，不確定銀聯取消是否送Track2，保留以備萬一 2017/1/11 上午 11:43 */
//			if (pobTran->srBRec.uszVOIDBit == VS_TRUE && pobTran->srBRec.uszCUPTransBit == VS_TRUE && pobTran->srBRec.inOrgCode != _PRE_COMP_)
//			{
//				strcat(szTrack2Data, pobTran->srBRec.stT2Data);
//			}
//			else
//			{
//				strcat(szTrack2Data, szFinalPAN);
//				strcat(szTrack2Data, "=");
//				strcat(szTrack2Data, pobTran->srBRec.szExpDate);
//				strcat(szTrack2Data, pobTran->srBRec.szServiceCode);
//			}

			/* (需求單 - 106349)移除原U CARD邏輯判斷 2018/10/31 下午 3:41 by Russell */
			strcat(szTrack2Data, szFinalPAN);
			strcat(szTrack2Data, "=");
			strcat(szTrack2Data, pobTran->srBRec.szExpDate);
			strcat(szTrack2Data, pobTran->srBRec.szServiceCode);
		}	
	}
	else
	{
		if ((pobTran->inEMVDecision == _EMV_DECESION_OFFLINE && !memcmp(pobTran->srBRec.szAuthCode, "Y1", 2)) ||
		     !memcmp(pobTran->srBRec.szAuthCode, "Y3", 2) ||
		     !memcmp(pobTran->srBRec.szAuthCode, "VLP", 3) ||
		     !memcmp(pobTran->srBRec.szAuthCode, "JCB", 3))
		{
			strcat(szTrack2Data, szFinalPAN);
			strcat(szTrack2Data, "=");
			strcat(szTrack2Data, pobTran->srBRec.szExpDate);
			strcat(szTrack2Data, pobTran->srBRec.szServiceCode);
		}
		else
		{
			/* (需求單 - 106349)移除原U CARD邏輯判斷 2018/10/31 下午 3:41 by Russell */
			if ((pobTran->srBRec.uszCUPTransBit == VS_FALSE)	&&
			    (pobTran->inTransactionCode == _SALE_OFFLINE_	||
			     pobTran->inTransactionCode == _INST_ADJUST_	|| 
			     pobTran->inTransactionCode == _REDEEM_ADJUST_	||
			     pobTran->inTransactionCode == _REFUND_		|| 
			     pobTran->inTransactionCode == _REDEEM_REFUND_	||
			     pobTran->inTransactionCode == _INST_REFUND_	||
			     pobTran->inTransactionCode == _ADJUST_))
			{
				strcat(szTrack2Data, szFinalPAN);
				strcat(szTrack2Data, "=");
				strcat(szTrack2Data, pobTran->srBRec.szExpDate);
			}
			else
			{
				strcat(szTrack2Data, pobTran->szTrack2);
				for (i = 0; i < strlen(szTrack2Data); i++)
				{
					if (szTrack2Data[i] == 'D')
						szTrack2Data[i] = '=';
				}

			}
		}
	}

	if (pobTran->inISOTxnCode == _SETTLE_ || pobTran->inISOTxnCode == _CLS_SETTLE_ || pobTran->inISOTxnCode == _CLS_BATCH_)
	{
		/*
			(2)	Message Type為 0500 結帳時，使用下面四項資料進行MAC演算
				1.ISO8583 F_11(STAN)後2碼(BCD to ASCII)
				2.ISO8583 F_41(TID)16 bytes
				3.Process Code前兩碼 2 碼 (BCD to ASCII)
				4.ISO8583 F_63 Data
					例：Sale Count + Sale Amount +
					    Refund Count + Refund Amount(共計30 Bytes)
		*/
		memset(szDataBuf, 0x00, sizeof(szDataBuf));
		/* ISO8583 F_11(STAN)後2碼(BCD to ASCII) */
		strcat(szDataBuf, szF_11);
		/* Terminal ID */
		strcat(szDataBuf, szF_41);
		strcat(szDataBuf, "        ");
		/* TxnCode 2 碼 */
		memset(szTxnCode, 0x00, sizeof(szTxnCode));
		inNCCC_Func_GetTxnCode(pobTran, szTxnCode);
		strcat(szDataBuf, szTxnCode);
		/* ISO8583 F_63 Data */
		strcat(szDataBuf, szF_63);
		
		if (ginDebug == VS_TRUE)
		{
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "F11: %s", szF_11);
			inLogPrintf(AT, szDebugMsg);
			
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "F41: %s", szF_41);
			inLogPrintf(AT, szDebugMsg);
			
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "F03: %s", szF_03);
			inLogPrintf(AT, szDebugMsg);
			
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "F63: %s", szF_63);
			inLogPrintf(AT, szDebugMsg);
		}
		
	}
	else
	{
		/***** Message for MAC *****/
		/* Message Data
			a. Transmission Number : 2 Bytes
			b. TID : 16 Bytes
			c. Transaction Code : 2 Bytes
			d. Track 2 Data : FID q , variable length
			e. Amount : FID B , 18 Bytes
		*/
		memset(szDataBuf, 0x00, sizeof(szDataBuf));
		/* ISO8583 F_11(STAN)後2碼(BCD to ASCII) */
		strcat(szDataBuf, szF_11);
		/* Terminal ID (16碼 TID + 8碼空白) */
		strcat(szDataBuf, szF_41);
		strcat(szDataBuf, "        ");
		/* TxnCode 2 碼 */
		memset(szTxnCode, 0x00, sizeof(szTxnCode));
		inNCCC_Func_GetTxnCode(pobTran, szTxnCode);
		strcat(szDataBuf, szTxnCode);
		
		/* Entry ID( ; 或 M ) */
		if (pobTran->srBRec.uszManualBit == VS_TRUE	||
		   (pobTran->srBRec.uszCUPTransBit == VS_FALSE && pobTran->srBRec.uszVOIDBit == VS_TRUE)	||
		   (pobTran->srBRec.uszCUPTransBit == VS_FALSE && (pobTran->inTransactionCode == _SALE_OFFLINE_ ||
								   pobTran->inTransactionCode == _INST_ADJUST_	|| pobTran->inTransactionCode == _REDEEM_ADJUST_ ||
								   pobTran->inTransactionCode == _REFUND_	|| pobTran->inTransactionCode == _REDEEM_REFUND_ || pobTran->inTransactionCode == _INST_REFUND_ ||
								   pobTran->inTransactionCode == _ADJUST_))	||
		(pobTran->inEMVDecision == _EMV_DECESION_OFFLINE && !memcmp(pobTran->srBRec.szAuthCode, "Y1", 2)) ||
		(pobTran->srBRec.uszVOIDBit == VS_TRUE && (pobTran->inTransactionCode == _CUP_VOID_ || pobTran->inTransactionCode == _CUP_PRE_AUTH_VOID_)))
		{
			strcat(szDataBuf, "M");
		}
		else
		{
			strcat(szDataBuf, ";");
		}
		
		strcat(szDataBuf, szTrack2Data);
		
		/* End sentinel( ? )*/
		strcat(szDataBuf, "?");
		
		/* ISO8583 F_04 Data 變動長度，至多18byte (例：NT$ 123 => 則DATA為”12300” 5碼。) */
		memset(szTemplate, 0x00, sizeof(szTemplate));
		sprintf(szTemplate, "%ld", atol(szF_04));
		strcat(szDataBuf, szTemplate);

	}

	inMACLen = strlen(szDataBuf);

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "==========================================");
		
		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "GenMAC Length [%d]", inMACLen);
		inLogPrintf(AT, szDebugMsg);
		
		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "GenMAC Data [%s]", szDataBuf);
		inDISP_LogPrintf_Format(szDebugMsg, "  ", 34);
		
		inLogPrintf(AT, "==========================================");
	}
	
	if (ginISODebug == VS_TRUE)
	{
		inPRINT_ChineseFont("==========================================", _PRT_ISO_);
		
		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "GenMAC Length [%d]", inMACLen);
		inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
		
		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "GenMAC Data [%s]", szDataBuf);
		inPRINT_ChineseFont_Format(szDebugMsg, "  ", 34, _PRT_ISO_);
		
		inPRINT_ChineseFont("==========================================", _PRT_ISO_);
	}

	inRetVal = inNCCC_TMK_CalculateMac(szDataBuf, pobTran->szMAC_HEX);
		
	if (ginDebug == VS_TRUE)
	{
                memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		memset(szAscii, 0x00, sizeof(szAscii));
		inFunc_BCD_to_ASCII(szAscii, (unsigned char*)pobTran->szMAC_HEX, 8);
        	sprintf(szDebugMsg, "MAC RESULT [%d][%s]", strlen(pobTran->szMAC_HEX), szAscii);
                inDISP_LogPrintf_Format(szDebugMsg, "  ", 34);
        }
	
	if (ginISODebug == VS_TRUE)
	{
                memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		memset(szAscii, 0x00, sizeof(szAscii));
		inFunc_BCD_to_ASCII(szAscii, (unsigned char*)pobTran->szMAC_HEX, 8);
        	sprintf(szDebugMsg, "MAC RESULT [%d][%s]", strlen(pobTran->szMAC_HEX), szAscii);
                inPRINT_ChineseFont_Format(szDebugMsg, "  ", 34, _PRT_ISO_);
        }

        if (inRetVal != VS_SUCCESS)
	        return (VS_ERROR);

        return (VS_SUCCESS);
}

/*
Function        :inNCCC__FuncMakeRefNo
Date&Time       :2015/12/23 下午 13:00
Describe        :
*/
int inNCCC_Func_MakeRefNo(TRANSACTION_OBJECT *pobTran)
{
	char		szTemplate[32 + 1] ;
	char		szBatchNum[6 + 1];
	char		szOrgInvoiceNum[6 + 1];
	char		szNCCCFESMode[2 + 1];
	char		szTerminalID[8 + 1];
        char            szRRN[12 + 1] = {0};
	RTC_NEXSYS	srRTC;
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_MakeRefNo START!");

	if (ginFindRunTime == VS_TRUE)
	{
		inFunc_RecordTime_Append("%d %s", __LINE__, __FUNCTION__);
	}
	
	/* 如果是集訊機版本【RRN】是由主機給，其餘由端末機產生 */
	memset(szNCCCFESMode, 0x00, sizeof(szNCCCFESMode));
	inGetNCCCFESMode(szNCCCFESMode);
	
	/* 不是_NCCC_01_SPDH_MODE_(集訊機版本) */
	if (memcmp(szNCCCFESMode, _NCCC_01_SPDH_MODE_, 2) != 0)
	{
		memset(szRRN, 0x00, sizeof(szRRN));
		strcpy(szRRN, "9");
		/* Terminal ID */
		memset(szTerminalID, 0x00, sizeof(szTerminalID));
		inGetTerminalID(szTerminalID);
		memcpy(&szRRN[1], &szTerminalID[3], 5);
		/* Batch Number */;
		memset(szBatchNum, 0x00, sizeof(szBatchNum));
		sprintf(szBatchNum, "%06ld", pobTran->srBRec.lnBatchNum);
		memcpy(&szRRN[6], &szBatchNum[4], 2);
		/* Invoice Number */
		memset(szOrgInvoiceNum, 0x00, sizeof(szOrgInvoiceNum));
		sprintf(szOrgInvoiceNum, "%06ld", pobTran->srBRec.lnOrgInvNum);
		memcpy(&szRRN[8], &szOrgInvoiceNum[3], 3);
		/* 補空白 */
		inFunc_PAD_ASCII(szRRN, szRRN, ' ', 12, _PADDING_RIGHT_);

		/*
			優惠序號(Award S/N)
			註1. 本序號為唯一值，由端末機產生邏輯為TID(8Bytes)+YYYYMMDDhhmmss
			註2. 取消(含沖銷取消)須上傳原交易之優惠序號。
			註3. 主機回覆原端末機上傳之值。
		*/
		memset(szTemplate, 0x00, sizeof(szTemplate));
		memset(pobTran->srBRec.szAwardSN, 0x00, sizeof(pobTran->srBRec.szAwardSN));
		memset(&srRTC, 0x00, sizeof(srRTC));

		inFunc_GetSystemDateAndTime(&srRTC);
		sprintf(szTemplate, "20%02d%02d%02d%02d%02d%02d", srRTC.uszYear, srRTC.uszMonth, srRTC.uszDay, srRTC.uszHour, srRTC.uszMinute, srRTC.uszSecond);
		strcpy(pobTran->srBRec.szAwardSN, szTerminalID);
		memcpy(&pobTran->srBRec.szAwardSN[8], &szTemplate[0], 14);
	}
	else
	{
		/* 集訊機版本【RRN】是由主機給 */
	}
        
        if (pobTran->srTrustRec.uszTrustTransBit == VS_TRUE)
        {
                if (strlen(szRRN) > 0)
                {
                        memset(pobTran->srTrustRec.szTrustRRN, 0x00, sizeof(pobTran->srTrustRec.szTrustRRN));
                        strncpy(pobTran->srTrustRec.szTrustRRN, szRRN, sizeof(pobTran->srTrustRec.szTrustRRN));
                }
		
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "RRN:(%s)", pobTran->srTrustRec.szTrustRRN);
		}
        }
        else
        {
                if (strlen(szRRN) > 0)
                {
                        memset(pobTran->srBRec.szRefNo, 0x00, sizeof(pobTran->srBRec.szRefNo));
                        strncpy(pobTran->srBRec.szRefNo, szRRN, sizeof(pobTran->srBRec.szRefNo));
                }
		
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "RRN:(%s)", pobTran->srBRec.szRefNo);
		}
        }

        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_MakeRefNo END!");
        
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_MakeInstData
Date&Time       :2016/6/14 下午 2:23
Describe        :用來確認分期所需資料
*/
int inNCCC_Func_MakeInstData(TRANSACTION_OBJECT *pobTran)
{
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_MakeInstData START!");
        
	/* 聯合分期付款_【“I”: Service Fee Included】【“E”: Service Fee Excluded】 */
	memset(pobTran->srBRec.szInstallmentIndicator, 0x00, sizeof(pobTran->srBRec.szInstallmentIndicator));
	if (pobTran->srBRec.lnInstallmentFormalityFee == 0L)
		strcpy(pobTran->srBRec.szInstallmentIndicator, "I");
	else
		strcpy(pobTran->srBRec.szInstallmentIndicator, "E");


        return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_MakeRedeemData
Date&Time       :2016/6/14 下午 2:23
Describe        :用來確認紅利所需資料
*/
int inNCCC_Func_MakeRedeemData(TRANSACTION_OBJECT *pobTran)
{
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_MakeRedeemData START!");
        
	memset(pobTran->srBRec.szRedeemIndicator, 0x00, sizeof(pobTran->srBRec.szRedeemIndicator));
	if (pobTran->srBRec.lnRedemptionPaidCreditAmount == 0L)
		strcpy(pobTran->srBRec.szRedeemIndicator, "1");
	else
		strcpy(pobTran->srBRec.szRedeemIndicator, "2");
	
	/* 紅利扣抵剩餘紅利點數，不輸入也不印 */
	pobTran->srBRec.lnRedemptionPointsBalance = 0L;
	/* Sign of Balance(剩餘點數之正負值)	‘-‘，表負值	‘ ’，表正值 */
	pobTran->srBRec.szRedeemSignOfBalance[0] = ' ';


        return (VS_SUCCESS);
}

/*
Function        :inNCCC_DCC_RunTRT
Date&Time       :2016/9/19 下午 3:31
Describe        :
*/
int inNCCC_DCC_RunTRT(TRANSACTION_OBJECT *pobTran, int inTRTCode)
{
        int     *inTRTID = NULL;
        int     i, inRetVal = VS_ERROR ;

        for (i = 0 ;; i ++)
        {
                if (TRANSACTION_NCCC_DCC_TABLE[i].inTRTCode == inTRTCode)
                {
                        inTRTID = TRANSACTION_NCCC_DCC_TABLE[i].inTRTID;
                        break;
                }
                else if (TRANSACTION_NCCC_DCC_TABLE[i].inTRTCode == -1)
                        break;
        }

        if (inTRTID == NULL)
        {
                return (VS_ERROR);
        }

        for (i = 0 ; ; i ++)
        {
                if (inTRTID[i] == VS_ERROR)
                        break;

                inRetVal = inFLOW_RunFunction(pobTran, inTRTID[i]);

                if (inRetVal != VS_SUCCESS)
                {
                        break;
                }
        }

	/* 斷線 */
	inCOMM_End(pobTran);
		
        return (inRetVal);
}

/*
Function        :inNCCC_DCC_Func_VOID_Confirm
Date&Time       :2016/9/19 下午 3:48
Describe        :按0確認是否要進行取消交易
*/
int inNCCC_DCC_Func_VOID_Confirm(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = VS_ERROR;
        char    szAuthCodeMsg[_DISP_MSG_SIZE_ + 1] = {0};
        char    szAmountMsg[_DISP_MSG_SIZE_ + 1] = {0};
        char    szKey = 0;
	char	szCustomerIndicator[3 + 1] = {0};

        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_DCC_Func_VOID_Confirm START!");
        
        /* 確認金額 */
        if (pobTran->srBRec.lnTotalTxnAmount <= 0)
        {
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_DCC_Func_VOID_Confirm  (%ld)<=0 END!", pobTran->srBRec.lnTotalTxnAmount);
                return (VS_ERROR);
        }

	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	/* (需求單 - 109327)V3機型開發支援Vx520的客製化參數需求 (002-耐斯廣場/王子大飯店) 取消不按零確認 by Russell 2020/10/6 下午 4:46 */
	if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_002_NICE_PLAZA_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inRetVal = VS_SUCCESS;
	}
	/* (需求單 - 109327)V3機型開發支援Vx520的客製化參數需求 (005-FPG) 取消不按零確認 by Russell 2022/10/5 下午 7:38 */
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_005_FPG_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inRetVal = VS_SUCCESS;
	}
	else
	{
		memset(szAuthCodeMsg, 0x00, sizeof(szAuthCodeMsg));
		memset(szAmountMsg, 0x00, sizeof(szAmountMsg));

		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		/* 提示檢核簽名和授權碼 */
		inDISP_PutGraphic(_CHECK_AUTH_AMT_, 0, _COORDINATE_Y_LINE_8_4_);
		/* 顯示授權碼 */
		sprintf(szAuthCodeMsg, "%s", pobTran->srBRec.szAuthCode);
		inDISP_EnglishFont_Point_Color(szAuthCodeMsg, _FONTSIZE_8X16_, _LINE_8_5_, _COLOR_RED_,_COLOR_WHITE_, 11);

		/* 顯示金額 */
		if (pobTran->srBRec.inOrgCode == _REFUND_)
		{
			inFunc_Amount_Comma_DCC(pobTran->srBRec.szDCC_FCA, "" , ' ', _SIGNED_MINUS_, 15, _PADDING_LEFT_, pobTran->srBRec.szDCC_FCMU, pobTran->srBRec.szDCC_FCAC, szAmountMsg);
		}
		else
		{
			inFunc_Amount_Comma_DCC(pobTran->srBRec.szDCC_FCA, "" , ' ', _SIGNED_NONE_, 15, _PADDING_LEFT_, pobTran->srBRec.szDCC_FCMU, pobTran->srBRec.szDCC_FCAC, szAmountMsg);
		}

		if (strlen(szAmountMsg) > 15)
		{
			inDISP_EnglishFont_Point_Color(szAmountMsg, _FONTSIZE_8X33_, _LINE_8_6_, _COLOR_RED_,_COLOR_WHITE_, 8);
		}
		else
		{
			inDISP_EnglishFont_Point_Color(szAmountMsg, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_RED_,_COLOR_WHITE_, 6);
		}

		while (1)
		{
			szKey = uszKBD_GetKey(_EDC_TIMEOUT_);

			if (szKey == _KEY_0_)
			{
				inRetVal = VS_SUCCESS;
				break;
			}
			else if (szKey == _KEY_CANCEL_)
			{
				inRetVal = VS_USER_CANCEL;
				break;
			}
			else if (szKey == _KEY_TIMEOUT_)
			{
				inRetVal = VS_TIMEOUT;
				break;
			}
		}
	}
	
	if (inRetVal == VS_SUCCESS)
	{
		pobTran->uszUpdateBatchBit = VS_TRUE;
		pobTran->srBRec.uszVOIDBit = VS_TRUE;
		pobTran->srBRec.inOrgCode = pobTran->srBRec.inCode;
		pobTran->srBRec.inCode = pobTran->inTransactionCode;
	}
	else
	{
		
	}

        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_DCC_Func_VOID_Confirm (%d) END!", inRetVal);
        
        return (inRetVal);
}

/*
Function        :inNCCC_DCC_Func_Must_SETTLE
Date&Time       :2016/8/31 下午 4:03
Describe        :確認是否要先結帳
*/
int inNCCC_DCC_Func_Must_SETTLE(TRANSACTION_OBJECT *pobTran)
{
	int	inDCC_HostIndex;
        char    szMustSettleBit[2 + 1] = {0};
	char	szHostEnable[2 + 1] = {0};
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_DCC_Func_Must_SETTLE START!");
	
	if (inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_DCC_, &inDCC_HostIndex) != VS_SUCCESS)
	{
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_DCC_Func_Must_SETTLE inFunc_Find_Specific_HDTindex failed");
		/* 找不到直接return VS_ERROR */
		return (VS_ERROR);
	}
	
	memset(szHostEnable, 0x00, sizeof(szHostEnable));
	if (inNCCC_DCC_GetDCC_Enable(pobTran->srBRec.inHDTIndex, szHostEnable) != VS_SUCCESS)
	{
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_DCC_Func_Must_SETTLE inNCCC_DCC_GetDCC_Enable failed");
		/* 無法確定的狀況下，直接return VS_ERROR */
		return (VS_ERROR);
	}
	
	/* 代表Host沒開 */
	if (memcmp(szHostEnable, "Y", 1) != 0)
	{
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_DCC_Func_Must_SETTLE szHostEnable:(%s)", szHostEnable);
		return (VS_SUCCESS);
	}
	
	inLoadHDPTRec(inDCC_HostIndex);
	
        memset(szMustSettleBit, 0x00, sizeof(szMustSettleBit));
        /* 是否結帳的flag，預設值為N */
        if (inGetMustSettleBit(szMustSettleBit) == VS_ERROR)
        {
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_DCC_Func_Must_SETTLE Get szMustSettleBit failed:(%s)", szMustSettleBit);
                return (VS_ERROR);
        }

	/* 回覆原host */
	inLoadHDPTRec(pobTran->srBRec.inHDTIndex);
	
        if (!memcmp(szMustSettleBit, "Y", 1))
        {
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_DCC_Func_Must_SETTLE szMustSettleBit:(%s)", szMustSettleBit);
                /* 表示要結帳 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_MUST_SETTLE_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
		strcpy(srDispMsgObj.szErrMsg1, _HOST_NAME_DCC_);
		srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
                inDISP_Msg_BMP(&srDispMsgObj);
		
		return (VS_ERROR);
	}
        else
	{
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_DCC_Func_Must_SETTLE END!");
                
                return (VS_SUCCESS);
	}
	
}

/*
Function        :inNCCC_Func_Check_Transaction_Function
Date&Time       :2017/11/7 下午 6:29
Describe        :確認交易功能是否打開，
*/
int inNCCC_Func_Check_Transaction_Function(int inCode)
{
	char		szTransFunc[20 + 1] = {0};
	char		szFunEnable[2 + 1] = {0};
	unsigned char	uszTxnEnable = VS_TRUE;
	
	/* 只檢查NCCC的功能 */
	inLoadHDTRec(0);
	
	memset(szTransFunc, 0x00, sizeof(szTransFunc));
	if (inGetTransFunc(szTransFunc) != VS_SUCCESS)
		return (VS_ERROR);
	
	if (inCode == _SALE_	||
	    inCode == _CUP_SALE_||
	    inCode == _FISC_SALE_)
	{
		if (memcmp(&szTransFunc[0], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	else if (inCode == _VOID_		||
		 inCode == _CUP_VOID_		||
		 inCode == _CUP_PRE_AUTH_VOID_	||
		 inCode == _CUP_PRE_COMP_VOID_	||
		 inCode == _FISC_VOID_)
	{
		if (memcmp(&szTransFunc[1], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	else if (inCode == _SETTLE_)
	{
		if (memcmp(&szTransFunc[2], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	else if (inCode == _REFUND_		||
		 inCode == _CUP_REFUND_		||
		 inCode == _FISC_REFUND_)
	{
		if (memcmp(&szTransFunc[3], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	/* NCCC(含MPAS)的退貨功能一併管理分期、紅利退貨 */
	/* 分期退貨要看兩個開關 */
	else if (inCode == _INST_REFUND_	||
		 inCode == _CUP_INST_REFUND_)
	{
		if ((memcmp(&szTransFunc[3], "Y", 1) != 0) || (memcmp(&szTransFunc[7], "Y", 1) != 0))
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	/* 紅利退貨要看兩個開關 */
	else if (inCode == _REDEEM_REFUND_	||
		 inCode == _CUP_REDEEM_REFUND_)
	{
		if ((memcmp(&szTransFunc[3], "Y", 1) != 0) || (memcmp(&szTransFunc[8], "Y", 1) != 0))
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	/* 該Byte Map=0為關閉交易補登功能， Byte Map=1為開啟 Online 交易補登，Byte Map = 2為開啟 Offline交易補登。 */
	else if (inCode == _SALE_OFFLINE_)
	{
		if (memcmp(&szTransFunc[4], "0", 1) == 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	else if (inCode == _PRE_AUTH_	||
		 inCode == _PRE_COMP_	||
		 inCode == _CUP_PRE_AUTH_	||
		 inCode == _CUP_PRE_COMP_)
	{
		if (memcmp(&szTransFunc[5], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	else if (inCode == _TIP_)
	{
		if (memcmp(&szTransFunc[6], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	else if (inCode == _INST_SALE_	||
		 inCode == _CUP_INST_SALE_)
	{
		if (memcmp(&szTransFunc[7], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	else if (inCode == _REDEEM_SALE_	||
		 inCode == _CUP_REDEEM_SALE_)
	{
		if (memcmp(&szTransFunc[8], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	else if (inCode == _INST_ADJUST_)
	{
		if (memcmp(&szTransFunc[9], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	else if (inCode == _REDEEM_ADJUST_)
	{
		if (memcmp(&szTransFunc[10], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	else if (inCode == _MAIL_ORDER_	||
		 inCode == _CUP_MAIL_ORDER_)
	{
		if (memcmp(&szTransFunc[11], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	else if (inCode == _CUP_MAIL_ORDER_REFUND_)
	{
		/* 郵購開關 && 退貨開關 */
		if (memcmp(&szTransFunc[3], "Y", 1) != 0 || memcmp(&szTransFunc[11], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}

	}

	/* 關閉銀聯分期紅利 */
	if (inCode == _CUP_INST_SALE_	||
	    inCode == _CUP_REDEEM_SALE_)
	{
		uszTxnEnable = VS_FALSE;
	}
	
	/* 交易別是銀聯的，銀聯功能未開要擋(For ECR) */
	if (inCode == _CUP_SALE_		||
	    inCode == _CUP_REFUND_		||
	    inCode == _CUP_VOID_		||
	    inCode == _CUP_INST_SALE_		||
	    inCode == _CUP_INST_REFUND_		||
	    inCode == _CUP_REDEEM_SALE_		||
	    inCode == _CUP_REDEEM_REFUND_	||
	    inCode == _CUP_PRE_AUTH_		||
	    inCode == _CUP_PRE_AUTH_VOID_	||
	    inCode == _CUP_PRE_COMP_		||
	    inCode == _CUP_PRE_COMP_VOID_	||
	    inCode == _CUP_MAIL_ORDER_		||
	    inCode == _CUP_MAIL_ORDER_REFUND_)
	{
		memset(szFunEnable, 0x00, sizeof(szFunEnable));
		inGetCUPFuncEnable(szFunEnable);
		if (memcmp(szFunEnable, "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	
	/* 交易別是金融卡的，金融卡功能未開要擋(For ECR) */
	if (inCode == _FISC_SALE_		||
	    inCode == _FISC_REFUND_		||
	    inCode == _FISC_VOID_)
	{
		memset(szFunEnable, 0x00, sizeof(szFunEnable));
		inGetFiscFuncEnable(szFunEnable);
		if (memcmp(szFunEnable, "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	
	/* 此功能已關閉 */
	if (uszTxnEnable == VS_FALSE)
	{
		return (VS_ERROR);
	}
	else
	{
		return (VS_SUCCESS);
	}
}

/*
Function        :inNCCC_Func_Check_Transaction_Function_Award
Date&Time       :2018/11/6 上午 10:36
Describe        :
*/
int inNCCC_Func_Check_Transaction_Function_Award(TRANSACTION_OBJECT *pobTran)
{
	char		szCustomerIndicator[3 + 1] = {0};
	unsigned char	uszTxnEnable = VS_TRUE;
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Check_Transaction_Function_Award() START !");
	}
	
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	
	/* 優惠兌換開關 */
	if (pobTran->srBRec.inCode == _LOYALTY_REDEEM_		||
	    pobTran->srBRec.inCode == _VOID_LOYALTY_REDEEM_	||
	    pobTran->srBRec.inCode == _LOYALTY_REDEEM_REFUND_)
	{
		/* 第一個先看是否支援ASM詢問電文 */
		if (inNCCC_Loyalty_ASM_Flag() != VS_SUCCESS)
		{
			uszTxnEnable = VS_FALSE;
		}
		else
		{
			if (pobTran->srBRec.inCode == _LOYALTY_REDEEM_)
			{
				/* 優惠兌換要分刷卡兌換和條碼兌換 */
				if (pobTran->szL3_AwardWay[0] == '1'	||
				    pobTran->szL3_AwardWay[0] == '2'	||
				    pobTran->szL3_AwardWay[0] == '3')
				{
					if (inNCCC_Loyalty_BarCodeFlag(_TRANS_TYPE_NULL_) != VS_SUCCESS)
					{
						uszTxnEnable = VS_FALSE;
					}
				}
				else
				{
					if (inNCCC_Loyalty_CreditCardFlag(_TRANS_TYPE_NULL_) != VS_SUCCESS)
					{
						uszTxnEnable = VS_FALSE;
					}
				}
			}
			else if (pobTran->srBRec.inCode == _VOID_LOYALTY_REDEEM_)
			{
				if (inNCCC_Loyalty_VoidRedeemFlag(_TRANS_TYPE_NULL_) != VS_SUCCESS)
				{
					uszTxnEnable = VS_FALSE;
				}
			}
			else if (pobTran->srBRec.inCode == _LOYALTY_REDEEM_REFUND_)
			{
				if (inNCCC_Loyalty_RefundFlag(_TRANS_TYPE_NULL_) != VS_SUCCESS)
				{
					uszTxnEnable = VS_FALSE;
				}
			}
			else
			{
				uszTxnEnable = VS_FALSE;
			}
		}
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Check_Transaction_Function_Award(%d) END !", uszTxnEnable);
		inLogPrintf(AT, "----------------------------------------");
	}
	
	/* 此功能已關閉 */
	if (uszTxnEnable == VS_FALSE)
	{
		return (VS_ERROR);
	}
	else
	{
		return (VS_SUCCESS);
	}
}

/*
Function        :inNCCC_Func_Check_Transaction_Function_Flow
Date&Time       :2016/10/26 下午 3:40
Describe        :確認交易功能是否打開，因為根據Host，所以每個Host一個Function
*/
int inNCCC_Func_Check_Transaction_Function_Flow(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_SUCCESS;
	unsigned char	uszTxnEnable = VS_TRUE;

        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Transaction_Function_Flow START!");
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Check_Transaction_Function_Flow() START !");
	}
	
	if (ginFindRunTime == VS_TRUE)
	{
		inFunc_RecordTime_Append("%d %s", __LINE__, __FUNCTION__);
	}
	
	/* 加油機版本補登交易不參考TMS開關，配合TMS母板 */
	if (memcmp(gszTermVersionID, _CEE_UPT1000_TERMINAL_VERSION_, strlen(_CEE_UPT1000_TERMINAL_VERSION_)) == 0)
	{
		if (pobTran->srBRec.inCode == _SALE_OFFLINE_)
		{
			
		}
		else
		{
			inRetVal = inNCCC_Func_Check_Transaction_Function(pobTran->inTransactionCode);
			if (inRetVal != VS_SUCCESS)
			{
                                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Transaction_Function_Flow inNCCC_Func_Check_Transaction_Function failed");
				uszTxnEnable = VS_FALSE;
			}

			/* 優惠兌換開關 */
			inRetVal = inNCCC_Func_Check_Transaction_Function_Award(pobTran);
			if (inRetVal != VS_SUCCESS)
			{
                                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Transaction_Function_Flow inNCCC_Func_Check_Transaction_Function_Award failed");
				uszTxnEnable = VS_FALSE;
			}
		}
	}
	else
	{       //檢查HDT的交易功能參數是否有開，預設為'N' return success
		inRetVal = inNCCC_Func_Check_Transaction_Function(pobTran->inTransactionCode);
		if (inRetVal != VS_SUCCESS)
		{
                        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Transaction_Function_Flow inNCCC_Func_Check_Transaction_Function failed");
			uszTxnEnable = VS_FALSE;
		}

		/* 優惠兌換開關 */
		inRetVal = inNCCC_Func_Check_Transaction_Function_Award(pobTran);
		if (inRetVal != VS_SUCCESS)
		{
                        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Transaction_Function_Flow inNCCC_Func_Check_Transaction_Function_Award failed");
			uszTxnEnable = VS_FALSE;
		}
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Check_Transaction_Function_Flow(%d) END !", uszTxnEnable);
		inLogPrintf(AT, "----------------------------------------");
	}
	
	/* 此功能已關閉 */
	if (uszTxnEnable == VS_FALSE)
	{
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Transaction_Function_Flow func_close");
		pobTran->inErrorMsg = _ERROR_CODE_V3_FUNC_CLOSE_;
		
		return (VS_ERROR);
	}
	else
	{
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Transaction_Function_Flow END!");
                
		return (VS_SUCCESS);
	}
}

/*
Function        :inNCCC_DCC_Func_CheckTransactionFunction
Date&Time       :2016/10/26 下午 3:40
Describe        :確認交易功能是否打開，因為根據Host，所以每個Host一個Function
*/
int inNCCC_DCC_Func_CheckTransactionFunction(TRANSACTION_OBJECT *pobTran)
{
	char		szTransFunc[20 + 1];
	unsigned char	uszTxnEnable = VS_TRUE;
	
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_DCC_Func_CheckTransactionFunction START!");
        
	if (pobTran->srBRec.uszDCCTransBit != VS_TRUE)
        {
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_DCC_Func_CheckTransactionFunction NotDCC PASS END!");
		return (VS_SUCCESS);
        }
	
	memset(szTransFunc, 0x00, sizeof(szTransFunc));
	if (inGetTransFunc(szTransFunc) != VS_SUCCESS)
	{
		vdUtility_SYSFIN_LogMessage(AT, "inNCCC_DCC_Func_CheckTransactionFunction inGetTransFunc failed");
		return (VS_ERROR);
	} 
	
	if (pobTran->inTransactionCode == _SALE_)
	{
		if (memcmp(&szTransFunc[0], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	else if (pobTran->inTransactionCode == _VOID_)
	{
		if (memcmp(&szTransFunc[1], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	else if (pobTran->inTransactionCode == _SETTLE_)
	{
		if (memcmp(&szTransFunc[2], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	else if (pobTran->inTransactionCode == _REFUND_)
	{
		if (memcmp(&szTransFunc[3], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	/* 保留1 Byte DCC沒有補登 */
	else if (pobTran->inTransactionCode == _PRE_COMP_)
	{
		if (memcmp(&szTransFunc[5], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	else if (pobTran->inTransactionCode == _TIP_)
	{
		if (memcmp(&szTransFunc[6], "Y", 1) != 0)
		{
			uszTxnEnable = VS_FALSE;
		}
	}
	
	/* 此功能已關閉 */
	if (uszTxnEnable == VS_FALSE)
	{
		vdUtility_SYSFIN_LogMessage(AT, "inNCCC_DCC_Func_CheckTransactionFunction pobTran->inTransactionCode(%d)", pobTran->inTransactionCode);
		pobTran->inErrorMsg = _ERROR_CODE_V3_FUNC_CLOSE_;
		
		return (VS_ERROR);
	}
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_DCC_Func_CheckTransactionFunction END!");
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_FISC_GenMAC
Date&Time       :2016/11/7 上午 10:33
Describe        :SmartPay使用
*/
int inNCCC_Func_FISC_GenMAC(TRANSACTION_OBJECT *pobTran)
{
	int 	inMACLen = 0;
	int 	inRetVal;
	char	szDebugMsg[128 + 1], szDataBuf[128 + 1];
        char    szTemplate[128 + 1];
	char	szAscii[16 + 1];
	

	/* 處理中‧‧‧‧‧ */
	inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
	inDISP_PutGraphic(_PROCESS_, 0, _COORDINATE_Y_LINE_8_7_); 

        /*
                1. 交易金額(Transaction Amount)12 碼(ASCII)。
                  例：NT$ 123 => 則DATA 為”000000012300” 12 碼。
                2. 端末機代號(Terminal ID) 8 碼(ASCII)。
                3. 交易日期時間 (需同Field_58 Tag S7)14 碼。
                4. Smart Pay 帳號16 碼 (ASCII)。
        */
        memset(szDataBuf, 0x00, sizeof(szDataBuf));
        /* Transaction Amount */
        memset(szTemplate, 0x00, sizeof(szTemplate));
        sprintf(szTemplate, "%010ld00", (pobTran->srBRec.lnTxnAmount));
        strcat(szDataBuf, szTemplate);
        /* Terminal ID */
        memset(szTemplate, 0x00, sizeof(szTemplate));
        inGetTerminalID(szTemplate);
        strcat(szDataBuf, szTemplate);
        /* 交易日期時間 */
        memset(szTemplate, 0x00, sizeof(szTemplate));
        memcpy(szTemplate, pobTran->srBRec.szFiscDateTime, 14);
        strcat(szDataBuf, szTemplate);
        /* SmartPay 帳號 */
        memset(szTemplate, 0x00, sizeof(szTemplate));
        memcpy(szTemplate, pobTran->srBRec.szFiscAccount, 16);
        strcat(szDataBuf, szTemplate);        
        
	inMACLen = strlen(szDataBuf);

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "==========================================");
		
		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "GenMAC Length [%d]", inMACLen);
		inLogPrintf(AT, szDebugMsg);
		
		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "GenMAC Data [%s]", szDataBuf);
		inLogPrintf(AT, szDebugMsg);
		
		inLogPrintf(AT, "==========================================");
	}

	inRetVal = inNCCC_TMK_CalculateMac(szDataBuf, pobTran->szMAC_HEX);
		
	if (ginDebug == VS_TRUE)
	{
                memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		memset(szAscii, 0x00, sizeof(szAscii));
		inFunc_BCD_to_ASCII(szAscii, (unsigned char*)pobTran->szMAC_HEX, 8);
        	sprintf(szDebugMsg, "MAC RESULT [%d][%s]", strlen(pobTran->szMAC_HEX), szAscii);
                inLogPrintf(AT, szDebugMsg);
        }

        if (inRetVal != VS_SUCCESS)
	        return (VS_ERROR);
	else
		return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Get_CUP_PIN
Date&Time       :2016/11/10 下午 5:08
Describe        :重置是否輸入密碼狀態(Void 會紀錄之前輸入密碼的狀態，所以要找一個地方重置)，並輸入CUP密碼
*/
int inNCCC_Func_Get_CUP_PIN(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = VS_SUCCESS;
	long	lnCheckAmount = 0;
	char	szPinpadMode[2 + 1] = {0};
	char	szDebugMsg[100 + 1] = {0};
	char	szCVMRequiredLimit[12 + 1] = {0};
	char	szTemplate[256 + 1] = {0};
	
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_CUP_PIN START!");
        
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Get_CUP_PIN() START !");
	}
	
	if (pobTran->srBRec.uszContactlessBit == VS_TRUE && pobTran->srBRec.uszCUPTransBit == VS_TRUE)
	{
		if (!memcmp(&pobTran->srEMVRec.usz84_DF_NAME[0], "\xA0\x00\x00\x03\x33\x01\x01\x01", pobTran->srEMVRec.in84_DFNameLen))
		{
			/* 閃付PIN及免簽名判斷邏輯.docx 判斷是否為Debit AID，如果為Debit AID就要直接輸入Online PIN */
			/* QuickPass 需要輸入密碼 */
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "Debit AID No Need PIN");
			}
		}
		else
		{
			memset(szCVMRequiredLimit, 0x00, sizeof(szCVMRequiredLimit));
			memset(szTemplate, 0x00, sizeof(szTemplate));

			/* Quick Pass 有兩個CVM Limit 一個用來判斷免簽 一個用來判斷是否輸入Pin*/
			inGetCVMRequiredLimit(szTemplate);
			memcpy(szCVMRequiredLimit, szTemplate, 10);

			lnCheckAmount = atol(szCVMRequiredLimit);
			
			/* 閃付EDC判斷邏輯.docx 
			 * 額外判斷CVM Required Limit的目的，避免Tx.Amount < CVM Required Limit時(Reader異常，或是卡片Perso錯誤)，被要求輸入密碼
			 * Tag 99 = "00"，表示本交易CVM為Online Pin (目前只有CUP Debit卡片才會有Tag 99) */
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "Tag99:0x%02X", pobTran->uszQuickPassTag99);
				inLogPrintf(AT, "lnTxnAmount:%0ld", pobTran->srBRec.lnTxnAmount);
				inLogPrintf(AT, "lnCheckAmount:%0ld", lnCheckAmount);
			}
			
			if (pobTran->uszQuickPassTag99 == VS_TRUE && pobTran->srBRec.lnTxnAmount >= lnCheckAmount)
			{
				
				/* QuickPass 需要輸入密碼 */
			}
			else
			{
                                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_CUP_PIN CUP_Credit_AID_No_Tag99 PASS END!");
				return (VS_SUCCESS);
			}
			
		}
	}
	else if (pobTran->srBRec.inCode == _CUP_PRE_AUTH_ && pobTran->srBRec.uszManualBit == VS_TRUE)
	{
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_CUP_PIN _CUP_PRE_AUTH_&uszManualBit PASS END!");
		/* 銀聯預先授權，手動輸入不須密碼 */
		return (VS_SUCCESS);
	}
	else if (pobTran->srBRec.uszCUPEMVQRCodeBit == VS_TRUE)
        {
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_CUP_PIN uszCUPEMVQRCodeBit PASS END!");
		/* 如果是QRCode掃碼 不需要輸入PIN */
		return (VS_SUCCESS);
	}
	inFunc_ResetTitle(pobTran);
	
	/* 預設為False */
	pobTran->srBRec.uszPinEnterBit = VS_FALSE;
	
	memset(pobTran->szPIN, 0x00, sizeof(pobTran->szPIN));
	memset(szPinpadMode, 0x00, sizeof(szPinpadMode));
	inGetPinpadMode(szPinpadMode);
	
	/* 不使用密碼機 */
	if (memcmp(szPinpadMode, _PINPAD_MODE_0_NO_, strlen(_PINPAD_MODE_0_NO_)) == 0)
	{
		if (ginDebug == VS_TRUE)
		{
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "不使用密碼機");
			inLogPrintf(AT, szDebugMsg);
		}
		
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_CUP_PIN No_Pinpad END!");
		/* 要輸入密碼又不開密碼機，回傳錯誤 */
		return (VS_ERROR);
	}
	/* 內建密碼機 */
	else if (memcmp(szPinpadMode, _PINPAD_MODE_1_INTERNAL_, strlen(_PINPAD_MODE_1_INTERNAL_)) == 0)
	{
		if (ginDebug == VS_TRUE)
		{
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "內建密碼機");
			inLogPrintf(AT, szDebugMsg);
		}
                
                /* Mirror Message */ 
                if (pobTran->uszECRBit == VS_TRUE)
                {
                        inECR_SendMirror(pobTran, _MIRROR_MSG_ENTER_PW_);
                }
		
		/* 丟進去轉出來就是BCD了 */
		inRetVal = inNCCC_TMK_CalculatePINBlock(pobTran, pobTran->szPIN);
		if (inRetVal != VS_SUCCESS)
		{
			pobTran->srBRec.uszPinEnterBit = VS_FALSE;
                        
                        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_CUP_PIN CalculatePINBlock Fail END!");
			return (inRetVal);
		}
		else
		{
			/* 若輸入密碼BYPASS，此Bit不會On */
			if (strlen(pobTran->szPIN) > 0)
			{
				pobTran->srBRec.uszPinEnterBit = VS_TRUE;
			}
			else
			{
				pobTran->srBRec.uszPinEnterBit = VS_FALSE;
			}
		}
		
	}
	/* 外接密碼機 */
	else if (memcmp(szPinpadMode, _PINPAD_MODE_2_EXTERNAL_, strlen(_PINPAD_MODE_2_EXTERNAL_)) == 0)
	{
		if (ginDebug == VS_TRUE)
		{
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "外接密碼機");
			inLogPrintf(AT, szDebugMsg);
		}
                
                /* Mirror Message */
                if (pobTran->uszECRBit == VS_TRUE)
                {
                        inECR_SendMirror(pobTran, _MIRROR_MSG_ENTER_PW_);
                }
		
		inDISP_PutGraphic(_CUP_GET_PASSWORD_OUT_, 0, _COORDINATE_Y_LINE_8_4_);
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Get_CUP_PIN() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_CUP_PIN END!");
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_CUP_VOID_Confirm
Date&Time       :2016/11/14 下午 6:42
Describe        :按0確認是否要進行取消交易，這隻純粹是因為要改incode為CUP_VOID所以才分出來
*/
int inNCCC_Func_CUP_VOID_Confirm(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = VS_ERROR;
        char    szAuthCodeMsg[_DISP_MSG_SIZE_ + 1] = {0};
        char    szAmountMsg[_DISP_MSG_SIZE_ + 1] = {0};
	char    szTempMsg[_DISP_MSG_SIZE_ + 1] = {0};
        char    szKey = 0x00;
	char	szCustomerIndicator[3 + 1] = {0};

        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_CUP_VOID_Confirm START!");
        
        /* 確認金額 */
        if (pobTran->srBRec.lnTotalTxnAmount <= 0)
        {
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_CUP_VOID_Confirm END!");
                return (VS_ERROR);
        }

	/* (需求單 - 107227)邦柏科技自助作業客製化 客製化107不顯示確認畫面亦不用按0確認 by Russell 2018/12/7 下午 2:35 */
	/* (需求單 - 107276)自助交易標準400做法 by Russell 2018/12/27 上午 11:20 */
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	if ((!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_107_BUMPER_, _CUSTOMER_INDICATOR_SIZE_)           ||
	     !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_111_KIOSK_STANDARD_, _CUSTOMER_INDICATOR_SIZE_)   ||
             !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_098_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)        ||
             !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_105_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)	||
	     !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_123_IKEA_, _CUSTOMER_INDICATOR_SIZE_)		||
	     !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_124_EVER_RICH_, _CUSTOMER_INDICATOR_SIZE_))	&&
	     pobTran->uszECRBit == VS_TRUE)
	{
		inRetVal = VS_SUCCESS;
	}
	/* (需求單 - 109327)V3機型開發支援Vx520的客製化參數需求 (002-耐斯廣場/王子大飯店) 取消不按零確認 by Russell 2020/10/6 下午 4:46 */
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_002_NICE_PLAZA_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inRetVal = VS_SUCCESS;
	}
	/* (需求單 - 109327)V3機型開發支援Vx520的客製化參數需求 (005-FPG) 取消不按零確認 by Russell 2022/10/5 下午 7:38 */
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_005_FPG_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inRetVal = VS_SUCCESS;
	}
	else
	{
		/* 現在只有銀聯優計畫使用，取消畫面金額在上，授權碼在下 */
		if (gsrECROb.srTransData.szECRIndicator[0] == 'Q' &&
		    pobTran->srBRec.uszUnyTransBit != VS_TRUE && 
		    pobTran->srEWRec.uszEWTransBit != VS_TRUE)
		{
			memset(szAuthCodeMsg, 0x00, sizeof(szAuthCodeMsg));
			memset(szAmountMsg, 0x00, sizeof(szAmountMsg));

			inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);

			/* 顯示金額 */
			inDISP_ChineseFont("金額", _FONTSIZE_8X16_, _LINE_8_5_, _DISP_LEFT_);
			if (pobTran->srBRec.inOrgCode == _REFUND_ || pobTran->srBRec.inOrgCode == _INST_REFUND_ || pobTran->srBRec.inOrgCode == _REDEEM_REFUND_)
			{
				sprintf(szAmountMsg, "%ld", 0 - pobTran->srBRec.lnTotalTxnAmount);
				inFunc_Amount_Comma(szAmountMsg, "" , '\x00', _SIGNED_NONE_, 13, _PADDING_RIGHT_);
			}
			else
			{
				sprintf(szAmountMsg, "%ld", pobTran->srBRec.lnTotalTxnAmount);
				inFunc_Amount_Comma(szAmountMsg, "" , '\x00', _SIGNED_NONE_, 13, _PADDING_RIGHT_);
			}
			memset(szTempMsg, 0x00, sizeof(szTempMsg));
			strncpy(szTempMsg, szAmountMsg, sizeof(szTempMsg));
			sprintf(szAmountMsg, "NT　$%s ", szTempMsg);
			inDISP_ChineseFont_Color(szAmountMsg, _FONTSIZE_8X22_, _LINE_8_5_, _COLOR_RED_, _DISP_RIGHT_);
			
			/* 顯示授權碼 */
			inDISP_ChineseFont("授權碼", _FONTSIZE_8X16_, _LINE_8_6_, _DISP_LEFT_);
			sprintf(szAuthCodeMsg, "%s", pobTran->srBRec.szAuthCode);
			inDISP_EnglishFont_Point_Color(szAuthCodeMsg, _FONTSIZE_8X16_, _LINE_8_6_, _COLOR_RED_,_COLOR_WHITE_, 11);
			
			inDISP_PutGraphic(_ERR_0_, 0, _COORDINATE_Y_LINE_8_7_);
		}
		else
		{
			memset(szAuthCodeMsg, 0x00, sizeof(szAuthCodeMsg));
			memset(szAmountMsg, 0x00, sizeof(szAmountMsg));

			inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
			/* 提示檢核金額和授權碼 */
			inDISP_PutGraphic(_CHECK_AUTH_AMT_, 0, _COORDINATE_Y_LINE_8_4_);
			/* 顯示授權碼 */
			sprintf(szAuthCodeMsg, "%s", pobTran->srBRec.szAuthCode);
			inDISP_EnglishFont_Point_Color(szAuthCodeMsg, _FONTSIZE_8X16_, _LINE_8_5_, _COLOR_RED_,_COLOR_WHITE_, 11);

			/* 顯示金額 */
			if (pobTran->srBRec.inOrgCode == _CUP_REFUND_	||
			    pobTran->srBRec.inOrgCode == _CUP_MAIL_ORDER_REFUND_)
			{
				sprintf(szAmountMsg, "%ld", 0 - pobTran->srBRec.lnTotalTxnAmount);
				inFunc_Amount_Comma(szAmountMsg, "NT$" , ' ', _SIGNED_NONE_, 13, VS_TRUE);
			}
			else
			{
				sprintf(szAmountMsg, "%ld", pobTran->srBRec.lnTotalTxnAmount);
				inFunc_Amount_Comma(szAmountMsg, "NT$" , ' ', _SIGNED_NONE_, 13, VS_TRUE);
			}

			inDISP_EnglishFont_Point_Color(szAmountMsg, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_RED_,_COLOR_WHITE_, 8);
		}

		while (1)
		{
			szKey = uszKBD_GetKey(_EDC_TIMEOUT_);

			if (szKey == _KEY_0_)
			{
				inRetVal = VS_SUCCESS;
				break;
			}
			else if (szKey == _KEY_CANCEL_)
			{
				inRetVal = VS_USER_CANCEL;
				break;
			}
			else if (szKey == _KEY_TIMEOUT_)
			{
				inRetVal = VS_TIMEOUT;
				break;
			}
		}
	}

	if (inRetVal == VS_SUCCESS)
	{
		pobTran->uszUpdateBatchBit = VS_TRUE;
		pobTran->srBRec.uszVOIDBit = VS_TRUE;
		pobTran->srBRec.inOrgCode = pobTran->srBRec.inCode;
		pobTran->srBRec.inCode = pobTran->inTransactionCode;
	}
	else
	{
		
	}
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_CUP_VOID_Confirm RetVal(%d) END!", inRetVal);

        return (inRetVal);
}

/*
Function        :inNCCC_Func_CUP_VOID_Check
Date&Time       :2016/11/22 下午 3:33
Describe        :檔非銀聯交易的取消
*/
int inNCCC_Func_CUP_VOID_Check(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = VS_SUCCESS;
        int     inTimeout = _EDC_TIMEOUT_;
        char	szCustomerIndicator[3 + 1] = {0};
	
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_CUP_VOID_Check START!");
        
        memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
        inGetCustomIndicator(szCustomerIndicator);
        
        if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_098_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)     ||
            !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_105_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_))  
        {
                inTimeout = _CUSTOMER_105_MCDONALDS_DISPLAY_TIMEOUT_;
        }
	
        if (pobTran->srBRec.uszVOIDBit == VS_TRUE)
        {
                /* 顯示此交易已取消 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_CANCEL_ALREADY_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = inTimeout;
		strcpy(srDispMsgObj.szErrMsg1, "");
		srDispMsgObj.inErrMsg1Line = 0;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
                inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
                pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
		return (inRetVal);
        }
	/* 擋非銀聯交易 按銀聯鍵取消 */
	else if (pobTran->srBRec.uszCUPTransBit != VS_TRUE)
	{
		/* 請勿按銀聯鍵 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_NOT_PRESS_CUP_BUTTON_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = inTimeout;
		strcpy(srDispMsgObj.szErrMsg1, "");
		srDispMsgObj.inErrMsg1Line = 0;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
		inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
		pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
		return (inRetVal);
	}
	else if (pobTran->srBRec.uszFiscTransBit == VS_TRUE)
	{
                /* Mirror Message */
                if (pobTran->uszECRBit == VS_TRUE)
                {
                        inECR_SendMirror(pobTran, _MIRROR_MSG_WRONG_CARD_ERROR_);
                }
                                                
		/* 請依正確卡別操作 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_PLEASE_FOLLOW_RIGHT_OPT_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_5_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = inTimeout;
		strcpy(srDispMsgObj.szErrMsg1, "");
		srDispMsgObj.inErrMsg1Line = 0;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
		inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
		pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
		return (inRetVal);
	}
	
	if (pobTran->inTransactionCode == _CUP_VOID_)
	{
		if (pobTran->srBRec.inOrgCode == _CUP_PRE_AUTH_)
		{
			/* 請按預先授權取消 */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, _ERR_PLEASE_PRESS_PREAUTH_VOID_);
			srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
			srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
			srDispMsgObj.inTimeout = inTimeout;
			strcpy(srDispMsgObj.szErrMsg1, "");
			srDispMsgObj.inErrMsg1Line = 0;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
			pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;

			return (inRetVal);
		}
		else if (pobTran->srBRec.inOrgCode == _CUP_PRE_COMP_)
		{
			/* 請按授權完成取消 */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, _ERR_PLEASE_PRESS_PRECOMP_VOID_);
			srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
			srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
			srDispMsgObj.inTimeout = inTimeout;
			strcpy(srDispMsgObj.szErrMsg1, "");
			srDispMsgObj.inErrMsg1Line = 0;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
			pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;

			return (inRetVal);
		}
		else if (pobTran->srBRec.inOrgCode == _LOYALTY_REDEEM_)
		{
			/* 無交易紀錄 */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, _ERR_RECORD_);
			srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
			srDispMsgObj.inMsgType = _ENTER_KEY_MSG_;
			srDispMsgObj.inTimeout = inTimeout;
			strcpy(srDispMsgObj.szErrMsg1, "");
			srDispMsgObj.inErrMsg1Line = 0;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
			pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;

			return (inRetVal);
		}

	}
	else if (pobTran->inTransactionCode == _CUP_PRE_AUTH_VOID_)
	{
		if (pobTran->srBRec.inOrgCode == _CUP_SALE_	||
		    pobTran->srBRec.inOrgCode == _CUP_REFUND_	|| 
		    pobTran->srBRec.inOrgCode == _CUP_MAIL_ORDER_REFUND_)
		{
			/* 請按銀聯取消 */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, _ERR_PLEASE_PRESS_CUP_VOID_);
			srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
			srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
			srDispMsgObj.inTimeout = inTimeout;
			strcpy(srDispMsgObj.szErrMsg1, "");
			srDispMsgObj.inErrMsg1Line = 0;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
			pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;

			return (inRetVal);
		}
		else if (pobTran->srBRec.inOrgCode == _CUP_PRE_COMP_)
		{
			/* 請按授權完成取消 */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, _ERR_PLEASE_PRESS_PRECOMP_VOID_);
			srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
			srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
			srDispMsgObj.inTimeout = inTimeout;
			strcpy(srDispMsgObj.szErrMsg1, "");
			srDispMsgObj.inErrMsg1Line = 0;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
			pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;

			return (inRetVal);
		}
		else if (pobTran->srBRec.inOrgCode == _LOYALTY_REDEEM_)
		{
			/* 無交易紀錄 */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, _ERR_RECORD_);
			srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
			srDispMsgObj.inMsgType = _ENTER_KEY_MSG_;
			srDispMsgObj.inTimeout = inTimeout;
			strcpy(srDispMsgObj.szErrMsg1, "");
			srDispMsgObj.inErrMsg1Line = 0;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
			pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;

			return (inRetVal);
		}
	}
	else if (pobTran->inTransactionCode == _CUP_PRE_COMP_VOID_)
	{
		if (pobTran->srBRec.inOrgCode == _CUP_SALE_	||
		    pobTran->srBRec.inOrgCode == _CUP_REFUND_	|| 
		    pobTran->srBRec.inOrgCode == _CUP_MAIL_ORDER_REFUND_)
		{
			/* 請按銀聯取消 */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, _ERR_PLEASE_PRESS_CUP_VOID_);
			srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
			srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
			srDispMsgObj.inTimeout = inTimeout;
			strcpy(srDispMsgObj.szErrMsg1, "");
			srDispMsgObj.inErrMsg1Line = 0;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
			pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
			
			return (inRetVal);
		}
		else if (pobTran->srBRec.inOrgCode == _CUP_PRE_AUTH_)
		{
			/* 請按預先授權取消 */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, _ERR_PLEASE_PRESS_PREAUTH_VOID_);
			srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
			srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
			srDispMsgObj.inTimeout = inTimeout;
			strcpy(srDispMsgObj.szErrMsg1, "");
			srDispMsgObj.inErrMsg1Line = 0;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
			pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;

			return (inRetVal);
		}
		else if (pobTran->srBRec.inOrgCode == _LOYALTY_REDEEM_)
		{
			/* 無交易紀錄 */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, _ERR_RECORD_);
			srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
			srDispMsgObj.inMsgType = _ENTER_KEY_MSG_;
			srDispMsgObj.inTimeout = inTimeout;
			strcpy(srDispMsgObj.szErrMsg1, "");
			srDispMsgObj.inErrMsg1Line = 0;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
			pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;

			return (inRetVal);
		}
	}
	
	
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_CUP_Refund_Limit_Check
Date&Time       :2016/11/15 上午 10:27
Describe        :不能超出CFGT設定的限額
*/
int inNCCC_Func_CUP_Refund_Limit_Check(TRANSACTION_OBJECT *pobTran)
{
	char	szCUPRefundLimit[12 + 1];
	char	szTemplate[10 + 1];
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_CUP_Refund_Limit_Check START!");
	
	/* CUP退貨限額(含)，包含兩位小數位, 預設值="999999999900" */
	memset(szCUPRefundLimit, 0x00, sizeof(szCUPRefundLimit));
	inGetCUPRefundLimit(szCUPRefundLimit);
	
	/* 只取整數位 */
	memset(szTemplate, 0x00, sizeof(szTemplate));
	memcpy(szTemplate, szCUPRefundLimit, 10);
	
	if (pobTran->srBRec.lnTxnAmount > atol(szTemplate))
	{
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_CUP_Refund_Limit_Check (%ld) > (%s)END!", pobTran->srBRec.lnTxnAmount, szTemplate);
                
		/* 退貨金額超過上限 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_REFUND_OVER_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
		strcpy(srDispMsgObj.szErrMsg1, "");
		srDispMsgObj.inErrMsg1Line = 0;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
		inDISP_Msg_BMP(&srDispMsgObj);
		
		return (VS_ERROR);
	}
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_CUP_Refund_Limit_Check END!");
		
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_FISC_VOID_Confirm
Date&Time       :2016/11/14 下午 6:42
Describe        :按0確認是否要進行取消交易，這隻純粹是因為要改incode為FISC_VOID所以才分出來
*/
int inNCCC_Func_FISC_VOID_Confirm(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = VS_ERROR;
        char    szAuthCodeMsg[_DISP_MSG_SIZE_ + 1] = {0};
        char    szAmountMsg[_DISP_MSG_SIZE_ + 1] = {0};
        char    szKey = 0x00;
	char	szCustomerIndicator[3 + 1] = {0};

        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_FISC_VOID_Confirm START!");
        
        /* 確認金額 */
        if (pobTran->srBRec.lnTotalTxnAmount <= 0)
        {
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_FISC_VOID_Confirm (%d)<0 END!", pobTran->srBRec.lnTotalTxnAmount);
                return (VS_ERROR);
        }

	/* (需求單 - 107227)邦柏科技自助作業客製化 客製化107不顯示確認畫面亦不用按0確認 by Russell 2018/12/7 下午 2:35 */
	/* (需求單 - 107276)自助交易標準400做法 by Russell 2018/12/27 上午 11:20 */
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	if ((!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_107_BUMPER_, _CUSTOMER_INDICATOR_SIZE_)           ||
	     !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_111_KIOSK_STANDARD_, _CUSTOMER_INDICATOR_SIZE_)   ||
             !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_098_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)        ||
             !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_105_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)	||
	     !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_123_IKEA_, _CUSTOMER_INDICATOR_SIZE_)		||
	     !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_124_EVER_RICH_, _CUSTOMER_INDICATOR_SIZE_))	&&
	     pobTran->uszECRBit == VS_TRUE)
	{
		inRetVal = VS_SUCCESS;
	}
	/* (需求單 - 109327)V3機型開發支援Vx520的客製化參數需求 (002-耐斯廣場/王子大飯店) 取消不按零確認 by Russell 2020/10/6 下午 4:46 */
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_002_NICE_PLAZA_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inRetVal = VS_SUCCESS;
	}
	/* (需求單 - 109327)V3機型開發支援Vx520的客製化參數需求 (005-FPG) 取消不按零確認 by Russell 2022/10/5 下午 7:38 */
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_005_FPG_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inRetVal = VS_SUCCESS;
	}
	else
	{
		memset(szAuthCodeMsg, 0x00, sizeof(szAuthCodeMsg));
		memset(szAmountMsg, 0x00, sizeof(szAmountMsg));

		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		/* 提示檢核金額和授權碼 */
		inDISP_PutGraphic(_CHECK_AUTH_AMT_SMARTPAY_, 0, _COORDINATE_Y_LINE_8_4_);

		/* 顯示金額(SmartPy退貨不能取消) */
		sprintf(szAmountMsg, "%ld", pobTran->srBRec.lnTotalTxnAmount);
		inFunc_Amount_Comma(szAmountMsg, "NT$" , ' ', _SIGNED_NONE_, 13, VS_TRUE);

		inDISP_EnglishFont_Point_Color(szAmountMsg, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_RED_,_COLOR_WHITE_, 8);

		while (1)
		{
			szKey = uszKBD_GetKey(_EDC_TIMEOUT_);

			if (szKey == _KEY_0_)
			{
				inRetVal = VS_SUCCESS;
				break;
			}
			else if (szKey == _KEY_CANCEL_)
			{
				inRetVal = VS_USER_CANCEL;
				break;
			}
			else if (szKey == _KEY_TIMEOUT_)
			{
				inRetVal = VS_TIMEOUT;
				break;
			}
		}
	}
	
	/* pobTran->uszUpdateBatchBit 表示 uszUpdateBatchBit / TRANS_BATCH_KEY】是要更新記錄 */
	/* 暫時放這裡 */
	if (inRetVal == VS_SUCCESS)
	{
		pobTran->uszUpdateBatchBit = VS_TRUE;
		pobTran->srBRec.uszVOIDBit = VS_TRUE;
		pobTran->srBRec.inOrgCode = pobTran->srBRec.inCode;
		pobTran->srBRec.inCode = pobTran->inTransactionCode;
	}
	else
	{
		
	}
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_FISC_VOID_Confirm (%d) END!", inRetVal);

        return (inRetVal);
}

/*
Function        :inNCCC_Func_FISC_VOID_Check
Date&Time       :2016/11/22 下午 3:33
Describe        :檔非銀聯交易的取消
*/
int inNCCC_Func_FISC_VOID_Check(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal;
        int     inTimeout = _EDC_TIMEOUT_;
        char	szCustomerIndicator[3 + 1] = {0};
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_FISC_VOID_Check START!");
	
        memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
        inGetCustomIndicator(szCustomerIndicator);
        
        if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_098_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)     ||
            !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_105_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)) 
        {
                inTimeout = _CUSTOMER_105_MCDONALDS_DISPLAY_TIMEOUT_;
        }
	
        if (pobTran->srBRec.uszVOIDBit == VS_TRUE)
        {
                /* 顯示此交易已取消 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_CANCEL_ALREADY_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = inTimeout;
		strcpy(srDispMsgObj.szErrMsg1, "");
		srDispMsgObj.inErrMsg1Line = 0;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
                inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
                pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
		return (inRetVal);
        }
	/* NCCC 小費不能取消 */
        else if (pobTran->srBRec.inCode == _TIP_)
	{
		/* 顯示小費交易 交易不能取消 請按清除鍵 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_CAN_NOT_CANCEL_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = inTimeout;
		strcpy(srDispMsgObj.szErrMsg1, "小費交易");
		srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
		inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
		pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
		return (inRetVal);
	}
	/* 擋銀聯交易 按SmartPay取消 */
	else if (pobTran->srBRec.uszCUPTransBit == VS_TRUE)
	{
		/* 請按銀聯鍵 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_PLEASE_PRESS_CUP_BUTTON_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = inTimeout;
		strcpy(srDispMsgObj.szErrMsg1, "");
		srDispMsgObj.inErrMsg1Line = 0;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
		inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
                pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
		return (inRetVal);
	}
	else if (pobTran->srBRec.uszFiscTransBit != VS_TRUE)
	{
                /* Mirror Message */
                if (pobTran->uszECRBit == VS_TRUE)
                {
                        inECR_SendMirror(pobTran, _MIRROR_MSG_WRONG_CARD_ERROR_);
                }
                                                
		/* 請依正確卡別操作 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_PLEASE_FOLLOW_RIGHT_OPT_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_5_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = inTimeout;
		strcpy(srDispMsgObj.szErrMsg1, "");
		srDispMsgObj.inErrMsg1Line = 0;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
		inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
                pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
		return (inRetVal);
	}
	else if (pobTran->srBRec.inOrgCode == _FISC_REFUND_)
	{
		/* 退費交易不能取消 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_CAN_NOT_CANCEL_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = inTimeout;
		strcpy(srDispMsgObj.szErrMsg1, "退費");
		srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
		inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
		pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
		
		return (inRetVal);
	}
        
        /* 客製化098，收銀機取消金額需與原金額比對 */
        if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_098_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)     ||
            !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_105_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_))   
        {
                if (pobTran->uszECRBit == VS_TRUE)
                {
                        if (pobTran->lnVoidCheckAmt != pobTran->srBRec.lnTxnAmount) 
                        {   
                                /* Mirror Message */
                                inECR_SendMirror(pobTran, _MIRROR_MSG_AMOUNT_ERROR_);

                                DISPLAY_OBJECT	srDispMsgObj;
                                memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
                                strcpy(srDispMsgObj.szDispPic1Name, _ERR_AMOUNT_NOT_MATCH_);
                                srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
                                srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
                                srDispMsgObj.inTimeout = inTimeout;
                                strcpy(srDispMsgObj.szErrMsg1, "");
                                srDispMsgObj.inErrMsg1Line = 0;
                                srDispMsgObj.inBeepTimes = 1;
                                srDispMsgObj.inBeepInterval = 0;
                                inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
				pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;

                                return (inRetVal);
                        }
                }
        }
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_CUP_PowerOn_LogOn
Date&Time       :2016/10/26 上午 10:36
Describe        :開機換Key
*/
int inNCCC_Func_CUP_PowerOn_LogOn(TRANSACTION_OBJECT* pobTran)
{
	int	inRetVal = VS_SUCCESS;
	int	inChoice = _DisTouch_No_Event_;
	int	inTouchSensorFunc = _Touch_CUP_LOGON_;
	char	szKey = 0x00;
	char	szFESMode[2 + 1] = {0};
	char	szCFESMode[2 + 1] = {0};
	char	szDemoMode[2 + 1] = {0};
        char    szCustomerIndicator[3 + 1] = {0};
	
#ifndef _COMMUNICATION_CAPBILITY_
	return (VS_SUCCESS);
#endif
	/* 教育訓練模式 */
	memset(szDemoMode, 0x00, sizeof(szDemoMode));
	inGetDemoMode(szDemoMode);
	if (memcmp(szDemoMode, "Y", strlen("Y")) == 0)
	{
		int	inTMKindex = 2;
		int	inPINLen = 32;
		char	szKeyCheckValue[6 + 1] = {0};
		char	szKeyExChange[32 + 1] = {0};
		
		memset(szKeyExChange, 0x00, sizeof(szKeyExChange));
		strcpy(szKeyExChange, "D340D9F5FC939A7245BD1A45080F9F98");
		
		memset(szKeyCheckValue, 0x00, sizeof(szKeyCheckValue));
		
		/* DEMO版 銀聯晶片卡算PIN會有問題，要亂寫一把進去 */
		inNCCC_TMK_Write_PINKey(inTMKindex, inPINLen/2, szKeyExChange, szKeyCheckValue);
		
		vdUtility_SYSFIN_LogMessage(AT, "DEMO write PIN Key");
		
		return (VS_SUCCESS);
	}
	else
	{
                memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
                inGetCustomIndicator(szCustomerIndicator);
                
		/* 如果不是開機流程，要先詢問 */
		if (pobTran->inRunOperationID != _OPERATION_EDC_BOOTING_	&&
		    pobTran->inRunOperationID != _OPERATION_EDC_SDK_INITIAL_BOOTING_)
		{
			inDISP_ClearAll();
			inFunc_Display_LOGO( 0,  _COORDINATE_Y_LINE_16_2_);			/* 第一層顯示 LOGO */
			inDISP_PutGraphic(_MENU_LOGON_TITLE_, 0, _COORDINATE_Y_LINE_8_3_);	/* 第一層顯示 <安全認證> */
			inDISP_PutGraphic(_CHECK_LOGON_, 0, _COORDINATE_Y_LINE_8_4_);
			inDISP_BEEP(1, 0);

			/* 設定Timeout */
			inDISP_Timer_Start(_TIMER_NEXSYS_1_, _EDC_TIMEOUT_);

			/* 執行下載請按確認，不執行請按清除 */
			while (1)
			{
				inChoice = inDisTouch_TouchSensor_Click_Slide(inTouchSensorFunc);
				szKey = uszKBD_Key();

				/* TimeOut */
				if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
				{
					szKey = _KEY_TIMEOUT_;
				}

				if (szKey == _KEY_ENTER_			|| 
				    inChoice == _CUPLogOn_Touch_KEY_1_)
				{
					inRetVal = VS_SUCCESS;
					break;
				}
				else if (szKey == _KEY_CANCEL_			|| 
					 inChoice == _CUPLogOn_Touch_KEY_2_)
				{
					inRetVal = VS_USER_CANCEL;
					break;
				}
				else if (szKey == _KEY_TIMEOUT_)
				{
					inRetVal = VS_TIMEOUT;
					break;
				}

			}
			/* 清空Touch資料 */
			inDisTouch_Flush_TouchFile();

			/* 確認是否重試 */
			if (inRetVal == VS_USER_CANCEL	||
			    inRetVal == VS_TIMEOUT)
			{
				return (inRetVal);
			}
			else
			{
				/* 執行下載往下面的迴圈走，否則回傳 */
			}
		}

		while (1)
		{

			memset(szFESMode, 0x00, sizeof(szFESMode));
			inGetNCCCFESMode(szFESMode);
			memset(szCFESMode, 0x00, sizeof(szCFESMode));
			inGetCloud_MFES(szCFESMode);
			
			if (memcmp(szFESMode, _NCCC_03_MFES_MODE_, strlen(_NCCC_03_MFES_MODE_)) == 0)
			{
				if (memcmp(szCFESMode, "Y", strlen("Y")) == 0)
				{
					inRetVal = inNCCC_ATS_CUP_LogOn(pobTran);
				}
				else
				{
					inRetVal = inNCCC_MFES_CUP_LogOn(pobTran);
				}
			}
			else if (memcmp(szFESMode, _NCCC_05_ATS_MODE_, strlen(_NCCC_05_ATS_MODE_)) == 0	||
				 memcmp(szFESMode, _NCCC_04_MPAS_MODE_, strlen(_NCCC_04_MPAS_MODE_)) == 0)
			{
				inRetVal = inNCCC_ATS_CUP_LogOn(pobTran);
			}

			if (inRetVal != VS_SUCCESS)
			{
				if (memcmp(gszTermVersionID, "MD731UAGAS001", strlen("MD731UAGAS001")) == 0)
				{
					inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
					inDISP_ChineseFont("安全認證失敗", _FONTSIZE_8X16_, _LINE_8_5_, _PRINT_CENTER_);
					inDISP_BEEP(1, 0);
					/* 當SDK使用，不顯示讓人重試 */
					inRetVal = VS_USER_CANCEL;
				}
				else
				{
					inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
					inDISP_PutGraphic(_CHECK_LOGON_, 0, _COORDINATE_Y_LINE_8_4_);
					inDISP_BEEP(1, 0);

					/* 設定Timeout */
                                        if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_124_EVER_RICH_, _CUSTOMER_INDICATOR_SIZE_))
                                        {
                                                inDISP_Timer_Start(_TIMER_NEXSYS_1_, _CUSTOMER_111_KIOSK_STANDARD_DISPLAY_TIMEOUT_);
                                        }
                                        else
                                        {
                                                inDISP_Timer_Start(_TIMER_NEXSYS_1_, _EDC_TIMEOUT_);
                                        }

					/* 執行下載請按確認，不執行請按清除 */
					while (1)
					{
						inChoice = inDisTouch_TouchSensor_Click_Slide(inTouchSensorFunc);
						szKey = uszKBD_Key();

						/* TimeOut */
						if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
						{
							szKey = _KEY_TIMEOUT_;
						}

						if (szKey == _KEY_ENTER_			|| 
						    inChoice == _CUPLogOn_Touch_KEY_1_)
						{
							inRetVal = VS_SUCCESS;
							break;
						}
						else if (szKey == _KEY_CANCEL_			|| 
							 inChoice == _CUPLogOn_Touch_KEY_2_)
						{
							inRetVal = VS_USER_CANCEL;
							break;
						}
						else if (szKey == _KEY_TIMEOUT_)
						{
							inRetVal = VS_TIMEOUT;
							break;
						}

					}
					/* 清空Touch資料 */
					inDisTouch_Flush_TouchFile();
				}
				
				/* 確認是否重試 */
				if (inRetVal == VS_USER_CANCEL	||
				    inRetVal == VS_TIMEOUT)
				{
					return (inRetVal);
				}
				else
				{
					continue;
				}
				
			}
			else
			{
				/* 安全認證成功後重置 */
				ginMacError = 0;
				return (VS_SUCCESS);
			}

		}
	}
}

/*
Function        :inNCCC_Func_GetTxnCode
Date&Time       :2017/1/10 下午 6:13
Describe        :MFES組MAC會用到，照Code抄
*/
int inNCCC_Func_GetTxnCode(TRANSACTION_OBJECT *pobTran, char *szTxnCode)
{
	switch (pobTran->inISOTxnCode)
	{
		case _SALE_ :
		case _SALE_OFFLINE_ :
		case _FORCE_CASH_ADVANCE_ :
		case _INST_SALE_ :
		case _REDEEM_SALE_ :
		case _INST_ADJUST_ :
		case _REDEEM_ADJUST_ :
		case _CUP_SALE_ :
		case _TC_UPLOAD_ :
			strcat(szTxnCode, "00");
			break;
		case _VOID_ :
		case _CUP_VOID_ :
		case _CUP_PRE_AUTH_VOID_ :
		case _CUP_PRE_COMP_VOID_ :
		case _TIP_ :
			if (pobTran->srBRec.inOrgCode == _REFUND_		||
			    pobTran->srBRec.inOrgCode == _REDEEM_REFUND_	||
			    pobTran->srBRec.inOrgCode == _INST_REFUND_		||
			    pobTran->srBRec.inOrgCode == _CUP_REFUND_		||
			    pobTran->srBRec.inOrgCode == _CUP_MAIL_ORDER_REFUND_)
				strcat(szTxnCode, "12");
			else
				strcat(szTxnCode, "11");

			break;
		case _REFUND_ :
		case _REDEEM_REFUND_ :
		case _INST_REFUND_ :
		case _CUP_REFUND_ :
		case _CUP_MAIL_ORDER_REFUND_ :
			strcat(szTxnCode, "04");
			break;
		case _PRE_AUTH_ :
		case _CUP_PRE_AUTH_ :
			strcat(szTxnCode, "01");
			break;
		case _PRE_COMP_ :
		case _CUP_PRE_COMP_ :
			strcat(szTxnCode, "02");
			break;
		case _MAIL_ORDER_ :
		case _CUP_MAIL_ORDER_ :
			strcat(szTxnCode, "03");
			break;
		case _SETTLE_ :
			strcat(szTxnCode, "60");
			break;
		default :
			break;
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_FormatPAN_UCARD
Date&Time       :2017/1/23 上午 11:03
Describe        :
*/
int inNCCC_Func_FormatPAN_UCARD(char *szPAN)
{
	char	szTemplate[_PAN_UCARD_SIZE_ + 1];

	memset(szTemplate, 0x00, sizeof(szTemplate));
	memcpy(szTemplate, &szPAN[4], 2);
	memcpy(&szTemplate[2], "-", 1);
	memcpy(&szTemplate[3], &szPAN[6], 7);
	memcpy(&szTemplate[10], "-", 1);
	memcpy(&szTemplate[11], &szPAN[13], 2);

	memset(szPAN, 0x00, sizeof(szPAN));
	strcpy(szPAN, szTemplate);
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_HG_MakeRefNo
Date&Time       :2017/1/23 上午 10:39
Describe        :組HG RRN使用NCCC RRN，所以用Diners CARD要load回NCCC
*/
int inNCCC_Func_HG_MakeRefNo(TRANSACTION_OBJECT *pobTran) 
{
	int	inNCCCIndex = -1;
        int     inOrgHostIdex;
        char	szTRTFileName[12 + 1];
        char	szBatchNum[6 + 1];
	char	szOrgInvoiceNum[6 + 1];
	char	szTerminalID[8 + 1];
	
	memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
        inGetTRTFileName(szTRTFileName);
        
        if (pobTran->srBRec.uszHappyGoMulti == VS_TRUE && !memcmp(szTRTFileName, _TRT_FILE_NAME_CREDIT_, strlen(_TRT_FILE_NAME_CREDIT_)))
	{
                memset(pobTran->srBRec.szRefNo, 0x00, sizeof(pobTran->srBRec.szRefNo));
		strcpy(pobTran->srBRec.szRefNo, "9");
		/* Terminal ID */
		memset(szTerminalID, 0x00, sizeof(szTerminalID));
		inGetTerminalID(szTerminalID);
		memcpy(&pobTran->srBRec.szRefNo[1], &szTerminalID[3], 5);
		/* Batch Number */;
		memset(szBatchNum, 0x00, sizeof(szBatchNum));
		sprintf(szBatchNum, "%06ld", pobTran->srBRec.lnBatchNum);
		memcpy(&pobTran->srBRec.szRefNo[6], &szBatchNum[4], 2);
		/* Invoice Number */
		memset(szOrgInvoiceNum, 0x00, sizeof(szOrgInvoiceNum));
		sprintf(szOrgInvoiceNum, "%06ld", pobTran->srBRec.lnOrgInvNum);
		memcpy(&pobTran->srBRec.szRefNo[8], &szOrgInvoiceNum[3], 3);
		/* 補空白 */
		inFunc_PAD_ASCII(pobTran->srBRec.szRefNo, pobTran->srBRec.szRefNo, ' ', 12, _PADDING_RIGHT_);
                memcpy(&pobTran->srBRec.szHGRefNo[0], &pobTran->srBRec.szRefNo[0], 12);
        }
	/* 2018/5/8 下午 2:10 DFS需求不再使用大來主機 */
        else
        {
		inOrgHostIdex = pobTran->srBRec.inHDTIndex;
                
		inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_CREDIT_NCCC_, &inNCCCIndex);
		if (inNCCCIndex == -1)
			return (VS_ERROR);
                inLoadHDTRec(inNCCCIndex);
		
                memset(pobTran->srBRec.szHGRefNo, 0x00, sizeof(pobTran->srBRec.szHGRefNo));
		strcpy(pobTran->srBRec.szHGRefNo, "9");
		/* Terminal ID */
		memset(szTerminalID, 0x00, sizeof(szTerminalID));
		inGetTerminalID(szTerminalID);
		memcpy(&pobTran->srBRec.szHGRefNo[1], &szTerminalID[3], 5);
		/* Batch Number */;
		memset(szBatchNum, 0x00, sizeof(szBatchNum));
		sprintf(szBatchNum, "%06ld", pobTran->srBRec.lnBatchNum);
		memcpy(&pobTran->srBRec.szHGRefNo[6], &szBatchNum[4], 2);
		/* Invoice Number */
		memset(szOrgInvoiceNum, 0x00, sizeof(szOrgInvoiceNum));
		sprintf(szOrgInvoiceNum, "%06ld", pobTran->srBRec.lnOrgInvNum);
		memcpy(&pobTran->srBRec.szHGRefNo[8], &szOrgInvoiceNum[3], 3);
		/* 補空白 */
		inFunc_PAD_ASCII(pobTran->srBRec.szHGRefNo, pobTran->srBRec.szHGRefNo, ' ', 12, _PADDING_RIGHT_);
		
		inLoadHDTRec(inOrgHostIdex);
                pobTran->srBRec.inHDTIndex = inOrgHostIdex;
        }
        
        return (VS_SUCCESS);
}

/*
Function	:inNCCC_Func_Sync_InvoiceNumber
Date&Time	:2017/3/7 上午 9:36
Describe        :同步NCCC和DCC和HG的invoice Number
*/
int inNCCC_Func_Sync_InvoiceNumber(TRANSACTION_OBJECT *pobTran)
{
	int	i = 0;
	int	inDCC_Hostindex = -1;
	int	inNCCC_HostIndex = -1;
	int	inHG_HostIndex = -1;
	int	inMax_InvoiceNum = -1;
	int	inInvoiceArray[3] = {0};
        int     inHostCnt = 0;
	char	szInvoiceNumDCC[6 + 1] = {0};
	char	szInvoiceNumNCCC[6 + 1] = {0};
	char	szInvoiceNumHG[6 + 1] = {0};
	char	szInvoiceNumMax[6 + 1] = {0};
	char	szHostEnable[1 + 1] = {0};
	
	inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_CREDIT_NCCC_, &inNCCC_HostIndex);
	inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_DCC_, &inDCC_Hostindex);
	inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_HG_, &inHG_HostIndex);
	
        inHostCnt = 0;
        if (inNCCC_HostIndex >= 0)
        {
                /* 信用卡理論上一定有，不計算 */
        }
        else
        {
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Sync_InvoiceNumber Can't find NCCC");
		
		return (VS_ERROR);
        }
        
        if (inDCC_Hostindex >= 0)
        {
                inHostCnt++;
        }
        
        if (inHG_HostIndex >= 0)
        {
                inHostCnt++;
        }
        
        if (inHostCnt > 0)
        {
                /* 需要同步 */
        }
        else
        {
                if (ginDebug == VS_TRUE)
                {
                        inLogPrintf(AT, "inNCCC_Func_Sync_InvoiceNumber No need sync");
                }
                
                return (VS_SUCCESS);
        }
	
	/* 獲得NCCC invoice Number */
	if (inLoadHDPTRec(inNCCC_HostIndex) != VS_SUCCESS)
		return (VS_ERROR);
	memset(szInvoiceNumNCCC, 0x00, sizeof(szInvoiceNumNCCC));
	if (inGetInvoiceNum(szInvoiceNumNCCC) != VS_SUCCESS)
		return (VS_ERROR);

	/* 獲得DCC invoice Number */
        if (inDCC_Hostindex >= 0)
        {
                if (inLoadHDPTRec(inDCC_Hostindex) != VS_SUCCESS)
                        return (VS_ERROR);
                if (inLoadHDTRec(inDCC_Hostindex) != VS_SUCCESS)
                        return (VS_ERROR);
                memset(szInvoiceNumDCC, 0x00, sizeof(szInvoiceNumDCC));
                memset(szHostEnable, 0x00, sizeof(szHostEnable));
                inGetHostEnable(szHostEnable);
                if (!memcmp(szHostEnable, "Y", 1))
                {
                        if (inGetInvoiceNum(szInvoiceNumDCC) != VS_SUCCESS)
                                return (VS_ERROR);
                }
        }
	
	/* 獲得HG invoice Number */
        if (inHG_HostIndex > 0)
        {
                if (inLoadHDPTRec(inHG_HostIndex) != VS_SUCCESS)
                        return (VS_ERROR);
                if (inLoadHDTRec(inHG_HostIndex) != VS_SUCCESS)
                        return (VS_ERROR);
                memset(szInvoiceNumHG, 0x00, sizeof(szInvoiceNumHG));
                memset(szHostEnable, 0x00, sizeof(szHostEnable));
                inGetHostEnable(szHostEnable);
                if (!memcmp(szHostEnable, "Y", 1))
                {
                        if (inGetInvoiceNum(szInvoiceNumHG) != VS_SUCCESS)
                                return (VS_ERROR);
                }
        }

	/* 先找最大值 */
	inInvoiceArray[0] = atoi(szInvoiceNumNCCC);
        if (inDCC_Hostindex >= 0)
        {
                inInvoiceArray[1] = atoi(szInvoiceNumDCC);
        }
        else
        {
                inInvoiceArray[1] = 0;
        }
        
        if (inHG_HostIndex > 0)
        {
                inInvoiceArray[2] = atoi(szInvoiceNumHG);
        }
        else
        {
                inInvoiceArray[2] = 0;
        }
	
	for (i = 0; i < 3; i++)
	{
		inMax_InvoiceNum = max(inInvoiceArray[i], inMax_InvoiceNum);
	}
	
	memset(szInvoiceNumMax, 0x00, sizeof(szInvoiceNumMax));
	sprintf (szInvoiceNumMax, "%06d", inMax_InvoiceNum);
	/*找到三個主機的Invoice Num ，讓三個Invoice Num同步最大的那個值*/
	if (inMax_InvoiceNum > atoi(szInvoiceNumNCCC))
	{
		if (inLoadHDPTRec(inNCCC_HostIndex) != VS_SUCCESS)
			return (VS_ERROR);
		if (inSetInvoiceNum(szInvoiceNumMax) != VS_SUCCESS)
			return (VS_ERROR);
		if (inSaveHDPTRec(inNCCC_HostIndex) != VS_SUCCESS)
			return (VS_ERROR);
	}
	
        if (inDCC_Hostindex > 0)
        {
                if (inMax_InvoiceNum > atoi(szInvoiceNumDCC))
                {
                        if (inLoadHDPTRec(inDCC_Hostindex) != VS_SUCCESS)
                                return (VS_ERROR);
                        if (inSetInvoiceNum(szInvoiceNumMax) != VS_SUCCESS)
                                return (VS_ERROR);
                        if (inSaveHDPTRec(inDCC_Hostindex) != VS_SUCCESS)
                                return (VS_ERROR);
                }
        }

        if (inHG_HostIndex > 0)
        {
                if (inMax_InvoiceNum > atoi(szInvoiceNumHG))
                {
                        if (inLoadHDPTRec(inHG_HostIndex) != VS_SUCCESS)
                                return (VS_ERROR);
                        if (inSetInvoiceNum(szInvoiceNumMax) != VS_SUCCESS)
                                return (VS_ERROR);
                        if (inSaveHDPTRec(inHG_HostIndex) != VS_SUCCESS)
                                return (VS_ERROR);
                }
        }
	
	/* 同步完了要load回原來的HDPT避免意外 */
	if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) != VS_SUCCESS)
		return (VS_ERROR);
	if (inLoadHDTRec(pobTran->srBRec.inHDTIndex) != VS_SUCCESS)
		return (VS_ERROR);
		
	return (VS_SUCCESS);
}

/*
Function	:inNCCC_Func_Sync_Reset_InvoiceNumber
Date&Time	:2017/3/7 上午 9:36
Describe        :同步NCCC和DCC和HG的invoice Number回歸到1
*/
int inNCCC_Func_Sync_Reset_InvoiceNumber(TRANSACTION_OBJECT *pobTran)
{
	int	inDCC_Hostindex = -1;
	int	inNCCC_HostIndex = -1;
	int	inHG_HostIndex = -1;
	char	szInvoiceNumDCC[6 + 1];
	char	szInvoiceNumNCCC[6 + 1];
	char	szInvoiceNumHG[6 + 1];
	char	szInvoiceNumOne[6 + 1];
	
	inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_CREDIT_NCCC_, &inNCCC_HostIndex);
	inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_DCC_, &inDCC_Hostindex);
	inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_HG_, &inHG_HostIndex);
	
        if (inNCCC_HostIndex >= 0)
        {
                /* 信用卡理論上一定有，不計算 */
        }
        else
        {
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Sync_Reset_InvoiceNumber Can't find NCCC");
		
		return (VS_ERROR);
        }
        
        
	/* 獲得NCCC invoice Number */
	if (inLoadHDPTRec(inNCCC_HostIndex) != VS_SUCCESS)
		return (VS_ERROR);
	memset(szInvoiceNumNCCC, 0x00, sizeof(szInvoiceNumNCCC));
	if (inGetInvoiceNum(szInvoiceNumNCCC) != VS_SUCCESS)
		return (VS_ERROR);

        if (inDCC_Hostindex >= 0)
        {
                /* 獲得DCC invoice Number */
                if (inLoadHDPTRec(inDCC_Hostindex) != VS_SUCCESS)
                        return (VS_ERROR);
                memset(szInvoiceNumDCC, 0x00, sizeof(szInvoiceNumDCC));
                if (inGetInvoiceNum(szInvoiceNumDCC) != VS_SUCCESS)
                        return (VS_ERROR);
        }
	
        if (inHG_HostIndex >= 0)
        {
                /* 獲得HG invoice Number */
                if (inLoadHDPTRec(inHG_HostIndex) != VS_SUCCESS)
                        return (VS_ERROR);
                memset(szInvoiceNumHG, 0x00, sizeof(szInvoiceNumHG));
                if (inGetInvoiceNum(szInvoiceNumHG) != VS_SUCCESS)
                        return (VS_ERROR);
        }

	memset(szInvoiceNumOne, 0x00, sizeof(szInvoiceNumOne));
	sprintf (szInvoiceNumOne, "%06d", 1);
	
	if (atoi(szInvoiceNumNCCC) != 1)
	{
		if (inLoadHDPTRec(inNCCC_HostIndex) != VS_SUCCESS)
			return (VS_ERROR);
		if (inSetInvoiceNum(szInvoiceNumOne) != VS_SUCCESS)
			return (VS_ERROR);
		if (inSaveHDPTRec(inNCCC_HostIndex) != VS_SUCCESS)
			return (VS_ERROR);
	}
	
        if (inDCC_Hostindex >= 0)
        {
                if (atoi(szInvoiceNumDCC) != 1)
                {
                        if (inLoadHDPTRec(inDCC_Hostindex) != VS_SUCCESS)
                                return (VS_ERROR);
                        if (inSetInvoiceNum(szInvoiceNumOne) != VS_SUCCESS)
                                return (VS_ERROR);
                        if (inSaveHDPTRec(inDCC_Hostindex) != VS_SUCCESS)
                                return (VS_ERROR);
                }
        }

        if (inHG_HostIndex >= 0)
        {
                if (atoi(szInvoiceNumHG) != 1)
                {
                        if (inLoadHDPTRec(inHG_HostIndex) != VS_SUCCESS)
                                return (VS_ERROR);
                        if (inSetInvoiceNum(szInvoiceNumOne) != VS_SUCCESS)
                                return (VS_ERROR);
                        if (inSaveHDPTRec(inHG_HostIndex) != VS_SUCCESS)
                                return (VS_ERROR);
                }
        }
	
	/* 同步完了要load回原來的HDPT避免意外 */
	if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) != VS_SUCCESS)
		return (VS_ERROR);
		
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_CardNumber_Hash
Date&Time       :2017/4/5 上午 9:54
Describe        :
*/
int inNCCC_Func_CardNumber_Hash(char *szInputData, char *szOutputData)
{
	int		inRetVal;
	char		szOutput[50];
	unsigned char	uszHash[20 + 1];
	unsigned char	uszOutputHash[32 + 1];
	unsigned long	ulnHashSizes = 0;

        memset(uszHash, 0x00, sizeof(uszHash));
	memcpy(uszHash, szInputData, strlen(szInputData));
	ulnHashSizes += strlen((char*)uszHash);

        /* SHA256加密 : 16 => 32 */
        memset(uszOutputHash, 0x00, sizeof(uszOutputHash));
        inFunc_SHA256(uszHash, ulnHashSizes, uszOutputHash);

        /* Base64加密 : 32 => 44 */
        memset(szOutput, 0x00, sizeof(szOutput));
        inRetVal = inFunc_Base64_Encryption((char *)uszOutputHash, 32, szOutput);

	memcpy(&szOutputData[0], &szOutput[0], strlen(szOutput));
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Get_Transaction_No_From_PAN
Date&Time       :2017/5/17 下午 1:37
Describe        :利用TID運算出卡號的Transaction Number 儲存至 srBRec.szTxNo
*/
int inNCCC_Func_Get_Transaction_No_From_PAN(TRANSACTION_OBJECT *pobTran)
{
	int	i, j, inTempCard, inTempKey;
	char	szTID[8 + 1];
	char	szTemplate[24 + 1];
	char	szKeyNo1[8 + 1], szKeyNo2[8 + 1];
	char	szPAN[20 + 1], szTxNo[24 + 1] ,szPANTemp[24 + 1];
	char	szFuncEnable[2 + 1];

        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_Transaction_No_From_PAN START!");
        
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Get_Transaction_No_From_PAN() START !");
	}
	if (ginFindRunTime == VS_TRUE)
	{
		inFunc_RecordTime_Append("%d %s", __LINE__, __FUNCTION__);
	}
	
	/* 【需求單 - 108097】Card BIN由ATS查核 add by LingHsiung 2020/2/3 下午 5:19 */
	memset(szTemplate, 0x00, sizeof(szTemplate));
	inGetBIN_CHECK(szTemplate);//'N'

	if (memcmp(szTemplate, "A", strlen("A")) == 0)
	{
		/* 由主機回覆是否遮掩 */
		if (pobTran->srBRec.uszTxNoCheckBit == VS_TRUE)
		{
			/* config2 StoreStubCardNoTruncateEnable未開啟 */
			memset(szFuncEnable, 0x00, sizeof(szFuncEnable));
			inGetStore_Stub_CardNo_Truncate_Enable(szFuncEnable);
			if (memcmp(szFuncEnable, "Y", strlen("Y")) != 0)
                        {
                                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_Transaction_No_From_PAN Not_Enable END!");
				return (VS_SUCCESS);
                        }

			/* 沒有卡號 */
			if (strlen(pobTran->srBRec.szPAN) == 0)
                        {
                                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_Transaction_No_From_PAN NO_PAN END!");
				return (VS_SUCCESS);
                        }
		}
		else
		{
                        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_Transaction_No_From_PAN uszTxNoCheckBit=False END!");
			return (VS_SUCCESS);
		}
	}
	else
	{
		/* 商店自存聯卡號遮掩開關初始化 */
		pobTran->srBRec.uszTxNoCheckBit = VS_FALSE;

		/* config2 StoreStubCardNoTruncateEnable未開啟 */
		memset(szFuncEnable, 0x00, sizeof(szFuncEnable));
		inGetStore_Stub_CardNo_Truncate_Enable(szFuncEnable);//'Y'
		if (memcmp(szFuncEnable, "Y", strlen("Y")) != 0)
                {
                        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_Transaction_No_From_PAN Not_Enable END!");
			return (VS_SUCCESS);
                }

		/* 沒有卡號 */
		if (strlen(pobTran->srBRec.szPAN) == 0)
                {
                        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_Transaction_No_From_PAN NO_PAN END!");
			return (VS_SUCCESS);
                }

		/* PrintTxNoCheckNo開關判斷 */
		memset(szFuncEnable, 0x00, sizeof(szFuncEnable));
                /* N = 該卡別交易簽單，不列印交易編號、列印檢查碼及不遮掩商店存根聯之卡號 */
		inGetPrint_Tx_No_Check_No(szFuncEnable);
		if (memcmp(szFuncEnable, "Y", strlen("Y")) == 0)
		{
			pobTran->srBRec.uszTxNoCheckBit = VS_TRUE;
		}
		else
		{
			pobTran->srBRec.uszTxNoCheckBit = VS_FALSE;
                        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_Transaction_No_From_PAN END!");
			return (VS_SUCCESS);
		}
	}

	/* Get Terminal ID */
	memset(szTID, 0x00, sizeof(szTID));
	inGetTerminalID(szTID);//00000001

	/* 鍵值一：用10減端末機代號後4碼，連同原端末機代號後4碼，得到鍵值一，舉例說明：原端末機代號為13994017
		   10  10  10  10
		   -   -   -   -
		   4   0   1   7   4   0   1   7
		 = 6   0   9   3   4   0   1   7
	*/

	/* 鍵值一第1碼 */
	memset(szTemplate, 0x00, sizeof(szTemplate));
	memcpy(&szTemplate[0], &szTID[4], 1);
	inTempKey = atoi(szTemplate);
	if (inTempKey > 0)
		inTempKey = 10 - inTempKey;
	memset(szKeyNo1, 0x00, sizeof(szKeyNo1));
	sprintf(szKeyNo1, "%d", inTempKey);

	/* 鍵值一第2碼 */
	memcpy(&szTemplate[0], &szTID[5], 1);
	inTempKey = atoi(szTemplate);
	if (inTempKey > 0)
		inTempKey = 10 - inTempKey;
	sprintf(&szKeyNo1[1], "%d", inTempKey);

	/* 鍵值一第3碼 */
	memcpy(&szTemplate[0], &szTID[6], 1);
	inTempKey = atoi(szTemplate);
	if (inTempKey > 0)
		inTempKey = 10 - inTempKey;
	sprintf(&szKeyNo1[2], "%d", inTempKey);

	/* 鍵值一第4碼 */
	memcpy(&szTemplate[0], &szTID[7], 1);
	inTempKey = atoi(szTemplate);
	if (inTempKey > 0)
		inTempKey = 10 - inTempKey;
	sprintf(&szKeyNo1[3], "%d", inTempKey);

	/* 鍵值一第5~8碼 */
	memcpy(&szKeyNo1[4], &szTID[4], 4);

	/* 鍵值二：用鍵值一每個數值加上本身的數值後取個位數
		   6   0   9   3   4   0   1   7
		   +   +   +   +   +   +   +   +
		   6   0   9   3   4   0   1   7
		 = 2   0   8   6   8   0   2   4
	*/

	memset(szKeyNo2, 0x00, sizeof(szKeyNo2));

	/* 鍵值二第1~8碼 */
	for ( i = 0 ; i < 8 ; i++)
	{
		memcpy(&szTemplate[0], &szKeyNo1[i], 1);
		inTempKey = atoi(szTemplate);
		inTempKey = inTempKey + inTempKey;

		if (inTempKey >= 10)
			inTempKey = inTempKey - 10;

		sprintf(&szKeyNo2[i], "%d", inTempKey);
	}

	/* 1.卡號當被加數/被減數
	   2.鍵值一、鍵值二當加數/減數，並依卡號長度決定此加數/減數共幾位數，各數值說明如下：
		第一位數為鍵值二第3碼
		第二位數為鍵值一第5碼
		第三位數為鍵值二第7碼
		第四位數為鍵值一第3碼
		第五位數為鍵值二第1碼
		第六位數為鍵值一第6碼
		第七位數為鍵值二第2碼
		第八位數為鍵值一第2碼
		第九位數為鍵值二第5碼
		第十位數為鍵值一第7碼
		第十一位數為鍵值二第8碼
		第十二位數為鍵值一第4碼
		第十三位數為鍵值二第4碼
		第十四位數為鍵值一第8碼
		第十五位數為鍵值二第6碼
		第十六位數為鍵值一第1碼
		第十七位數為鍵值二第3碼
		第十八位數為鍵值一第5碼
		第十九位數為鍵值二第7碼
	   3.奇數位採相加，偶數位採相減，被減數若小於減數，則被減數先加10再和減數相減；
	     反之，還原時，偶採數位採相加，奇數位採相減，被減數若小於減數，則被減數先加10再和減數相減
	*/

	/* 取得卡號 */
	/* (需求單 - 106349)移除原U CARD邏輯判斷 2018/10/31 下午 3:41 by Russell */
	memset(szPANTemp, 0x00, sizeof(szPANTemp));
	if (!memcmp(&pobTran->srBRec.szPAN[0], "000000", 6))			/* 大高 10 碼 */
		memcpy(&szPANTemp[0], &pobTran->srBRec.szPAN[6], 10);
	else
		strcpy(szPANTemp, pobTran->srBRec.szPAN);

	j = strlen(szPANTemp); /* 卡號長度 */

	memset(szPAN, 0x00, sizeof(szPAN)); /* 儲存卡號鍵值運算數值 */

	for (i = 0; i < j ; i++)
	{
		switch (i)
		{
			case 0:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[2], 1);
				inTempKey = atoi(szTemplate);

				inTempCard = inTempCard + inTempKey;

				if (inTempCard >= 10)
					inTempCard = inTempCard - 10;

				sprintf(&szPAN[0], "%d", inTempCard);

				break;
			case 1:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[4], 1);
				inTempKey = atoi(szTemplate);

				if (inTempCard < inTempKey)
					inTempCard = inTempCard + 10;

				inTempCard = inTempCard - inTempKey;

				sprintf(&szPAN[1], "%d", inTempCard);

				break;
			case 2:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[6], 1);
				inTempKey = atoi(szTemplate);

				inTempCard = inTempCard + inTempKey;

				if (inTempCard >= 10)
					inTempCard = inTempCard - 10;

				sprintf(&szPAN[2], "%d", inTempCard);

				break;

			case 3:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[2], 1);
				inTempKey = atoi(szTemplate);

				if (inTempCard < inTempKey)
					inTempCard = inTempCard + 10;

				inTempCard = inTempCard - inTempKey;

				sprintf(&szPAN[3], "%d", inTempCard);

				break;
			case 4:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[0], 1);
				inTempKey = atoi(szTemplate);

				inTempCard = inTempCard + inTempKey;

				if (inTempCard >= 10)
					inTempCard = inTempCard - 10;

				sprintf(&szPAN[4], "%d", inTempCard);

				break;
			case 5:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[5], 1);
				inTempKey = atoi(szTemplate);

				if (inTempCard < inTempKey)
					inTempCard = inTempCard + 10;

				inTempCard = inTempCard - inTempKey;

				sprintf(&szPAN[5], "%d", inTempCard);

				break;
			case 6:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[1], 1);
				inTempKey = atoi(szTemplate);

				inTempCard = inTempCard + inTempKey;

				if (inTempCard >= 10)
					inTempCard = inTempCard - 10;

				sprintf(&szPAN[6], "%d", inTempCard);

				break;
			case 7:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[1], 1);
				inTempKey = atoi(szTemplate);

				if (inTempCard < inTempKey)
					inTempCard = inTempCard + 10;

				inTempCard = inTempCard - inTempKey;

				sprintf(&szPAN[7], "%d", inTempCard);

				break;
			case 8:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[4], 1);
				inTempKey = atoi(szTemplate);

				inTempCard = inTempCard + inTempKey;

				if (inTempCard >= 10)
					inTempCard = inTempCard - 10;

				sprintf(&szPAN[8], "%d", inTempCard);

				break;
			case 9:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[6], 1);
				inTempKey = atoi(szTemplate);

				if (inTempCard < inTempKey)
					inTempCard = inTempCard + 10;

				inTempCard = inTempCard - inTempKey;

				sprintf(&szPAN[9], "%d", inTempCard);

				break;
			case 10:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[7], 1);
				inTempKey = atoi(szTemplate);

				inTempCard = inTempCard + inTempKey;

				if (inTempCard >= 10)
					inTempCard = inTempCard - 10;

				sprintf(&szPAN[10], "%d", inTempCard);

				break;
			case 11:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[3], 1);
				inTempKey = atoi(szTemplate);

				if (inTempCard < inTempKey)
					inTempCard = inTempCard + 10;

				inTempCard = inTempCard - inTempKey;

				sprintf(&szPAN[11], "%d", inTempCard);

				break;
			case 12:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[3], 1);
				inTempKey = atoi(szTemplate);

				inTempCard = inTempCard + inTempKey;

				if (inTempCard >= 10)
					inTempCard = inTempCard - 10;

				sprintf(&szPAN[12], "%d", inTempCard);

				break;
			case 13:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[7], 1);
				inTempKey = atoi(szTemplate);

				if (inTempCard < inTempKey)
					inTempCard = inTempCard + 10;

				inTempCard = inTempCard - inTempKey;

				sprintf(&szPAN[13], "%d", inTempCard);

				break;
			case 14:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[5], 1);
				inTempKey = atoi(szTemplate);

				inTempCard = inTempCard + inTempKey;

				if (inTempCard >= 10)
					inTempCard = inTempCard - 10;

				sprintf(&szPAN[14], "%d", inTempCard);

				break;
			case 15:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[0], 1);
				inTempKey = atoi(szTemplate);

				if (inTempCard < inTempKey)
					inTempCard = inTempCard + 10;

				inTempCard = inTempCard - inTempKey;

				sprintf(&szPAN[15], "%d", inTempCard);

				break;
			case 16:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[2], 1);
				inTempKey = atoi(szTemplate);

				inTempCard = inTempCard + inTempKey;

				if (inTempCard >= 10)
					inTempCard = inTempCard - 10;

				sprintf(&szPAN[16], "%d", inTempCard);

				break;
			case 17:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[4], 1);
				inTempKey = atoi(szTemplate);

				if (inTempCard < inTempKey)
					inTempCard = inTempCard + 10;

				inTempCard = inTempCard - inTempKey;

				sprintf(&szPAN[17], "%d", inTempCard);

				break;
			case 18:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szPANTemp[i], 1);
				inTempCard = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[6], 1);
				inTempKey = atoi(szTemplate);

				inTempCard = inTempCard + inTempKey;

				if (inTempCard >= 10)
					inTempCard = inTempCard - 10;

				sprintf(&szPAN[18], "%d", inTempCard);

				break;
			default:
                                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_Transaction_No_From_PAN PAN_length_no_such_case");
				return (VS_ERROR);

		} /* end switch 卡號和鍵值運算 */
	} /* end for */


	/* 交易編號：以上計算的結果再將原端末機代號的後4碼值放入第3、5、7、9 byte中，故交易編號值將比卡號長度多4碼；
	   還原時，則將交易編號的第3、6、9、12 byte值截取出來當端末機代號後4碼來做還原的計算，扣除該4 bytes取得卡號還原值
	*/
	memset(szTxNo, 0x00, sizeof(szTxNo));

	memcpy(&szTxNo[0], &szPAN[0], 2);
	memcpy(&szTxNo[2], &szTID[4], 1);

	memcpy(&szTxNo[3], &szPAN[2], 2);
	memcpy(&szTxNo[5], &szTID[5], 1);

	memcpy(&szTxNo[6], &szPAN[4], 2);
	memcpy(&szTxNo[8], &szTID[6], 1);

	memcpy(&szTxNo[9], &szPAN[6], 2);
	memcpy(&szTxNo[11], &szTID[7], 1);

	j = j - 8; /* 卡號前八碼已填入 */
	memcpy(&szTxNo[12], &szPAN[8], j);

	/* 將Transaction Number 存入srBRec */
	memset(pobTran->srBRec.szTxnNo, 0x00, sizeof(pobTran->srBRec.szTxnNo));
	strcpy(pobTran->srBRec.szTxnNo, szTxNo);

	if (ginDebug == VS_TRUE)
	{
		char	szDebugMsg[100 + 1];

		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "TRANSACTION NUMBER = (%s)", pobTran->srBRec.szTxnNo);
		inLogPrintf(AT, szDebugMsg);
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Get_Transaction_No_From_PAN() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_Transaction_No_From_PAN END!");

	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Get_PAN_From_Transaction_No
Date&Time       :2017/5/18 下午 6:32
Describe        :
*/
int inNCCC_Func_Get_PAN_From_Transaction_No(TRANSACTION_OBJECT *pobTran)
{
	int	i, j, inTempTxNo, inTempKey;
	char	szTemplate[24 + 1];
	char	szKeyNo1[8 + 1], szKeyNo2[8 + 1];
	char	szPAN[20 + 1];

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Get_PAN_From_Transaction_No() START !");
	}

	/* 鍵值一第1碼 */
	memset(szTemplate, 0x00, sizeof(szTemplate));
	memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[2], 1);
	inTempKey = atoi(szTemplate);
	if (inTempKey > 0)
		inTempKey = 10 - inTempKey;
	memset(szKeyNo1, 0x00, sizeof(szKeyNo1));
	sprintf(szKeyNo1, "%d", inTempKey);

	/* 鍵值一第2碼 */
	memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[5], 1);
	inTempKey = atoi(szTemplate);
	if (inTempKey > 0)
		inTempKey = 10 - inTempKey;
	sprintf(&szKeyNo1[1], "%d", inTempKey);

	/* 鍵值一第3碼 */
	memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[8], 1);
	inTempKey = atoi(szTemplate);
	if (inTempKey > 0)
		inTempKey = 10 - inTempKey;
	sprintf(&szKeyNo1[2], "%d", inTempKey);

	/* 鍵值一第4碼 */
	memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[11], 1);
	inTempKey = atoi(szTemplate);
	if (inTempKey > 0)
		inTempKey = 10 - inTempKey;
	sprintf(&szKeyNo1[3], "%d", inTempKey);

	/* 鍵值一第5~8碼 */
	memcpy(&szKeyNo1[4], &pobTran->srBRec.szTxnNo[2], 1);
	memcpy(&szKeyNo1[5], &pobTran->srBRec.szTxnNo[5], 1);
	memcpy(&szKeyNo1[6], &pobTran->srBRec.szTxnNo[8], 1);
	memcpy(&szKeyNo1[7], &pobTran->srBRec.szTxnNo[11], 1);

	/* 鍵值二 */
	memset(szKeyNo2, 0x00, sizeof(szKeyNo2));

	/* 鍵值二第1~8碼 */
	for ( i = 0 ; i < 8 ; i++)
	{
		memcpy(&szTemplate[0], &szKeyNo1[i], 1);
		inTempKey = atoi(szTemplate);
		inTempKey = inTempKey + inTempKey;

		if (inTempKey >= 10)
			inTempKey = inTempKey - 10;

		sprintf(&szKeyNo2[i], "%d", inTempKey);
	}

	/* 交易編號還原卡號 */
	memset(szPAN, 0x00, sizeof(szPAN)); /* 儲存TxNo還原卡號 */
	j = strlen(pobTran->srBRec.szTxnNo); /* 交易編號長度 */

	for (i = 0; i < j ; i++)
	{
		switch(i)
		{
			case 0:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[2], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + 10 - inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[0], "%d", inTempTxNo);

				break;
			case 1:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[4], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[1], "%d", inTempTxNo);

				break;
			case 3:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[6], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + 10 - inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[2], "%d", inTempTxNo);

				break;
			case 4:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[2], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[3], "%d", inTempTxNo);

				break;
			case 6:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[0], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + 10 - inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[4], "%d", inTempTxNo);

				break;
			case 7:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[5], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[5], "%d", inTempTxNo);

				break;
			case 9:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[1], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + 10 - inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[6], "%d", inTempTxNo);

				break;
			case 10:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[1], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[7], "%d", inTempTxNo);

				break;
			case 12:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[4], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + 10 - inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[8], "%d", inTempTxNo);

				break;
			case 13:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[6], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[9], "%d", inTempTxNo);

				break;
			case 14:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[7], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + 10 - inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[10], "%d", inTempTxNo);

				break;
			case 15:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[3], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[11], "%d", inTempTxNo);

				break;
			case 16:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[3], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + 10 - inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[12], "%d", inTempTxNo);

				break;
			case 17:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[7], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[13], "%d", inTempTxNo);

				break;
			case 18:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[5], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + 10 - inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[14], "%d", inTempTxNo);

				break;
			case 19:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[0], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[15], "%d", inTempTxNo);

				break;
			case 20:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[2], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + 10 - inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[16], "%d", inTempTxNo);

				break;
			case 21:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo1[4], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[17], "%d", inTempTxNo);

				break;
			case 22:
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &pobTran->srBRec.szTxnNo[i], 1);
				inTempTxNo = atoi(szTemplate);
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szKeyNo2[6], 1);
				inTempKey = atoi(szTemplate);

				inTempTxNo = inTempTxNo + 10 - inTempKey;

				if (inTempTxNo >= 10)
					inTempTxNo = inTempTxNo - 10;

				sprintf(&szPAN[18], "%d", inTempTxNo);

				break;
			default:
				break;

		} /* end switch */
	} /* end for */

	if (inCARD_Generate_Special_Card(szPAN) != VS_SUCCESS)
	{
		return (VS_ERROR);
	}
	
	memset(pobTran->srBRec.szPAN, 0x00, sizeof(pobTran->srBRec.szPAN));
	strcpy(pobTran->srBRec.szPAN, szPAN);
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Get_PAN_From_Transaction_No() END !");
		inLogPrintf(AT, "----------------------------------------");
	}

	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_CheckSpecialCard_Flow
Date&Time       :2017/5/22 下午 3:00
Describe        :對符合的活動代碼做相關處置
*/
int inNCCC_Func_CheckSpecialCard_Flow(TRANSACTION_OBJECT *pobTran)
{
	int	inTableID = 0;
	char	szFuncEnable[2 + 1] = {0};
	char	szCustomIndicator[3 + 1] = {0};
	char	szEverRichSCDTEnable[1 + 1] = {0};
	SQLITE_ALL_TABLE	srAll;
	
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_CheckSpecialCard_Flow END!");
        
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_CheckSpecialCard_Flow() START !");
	}
	
	if (ginFindRunTime == VS_TRUE)
	{
		inFunc_RecordTime_Append("%d %s", __LINE__, __FUNCTION__);
	}
	
	if (pobTran->uszCheck_OPT_Special_CardBit == VS_TRUE)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "uszCheck_OPT_Special_CardBit:On");
			inLogPrintf(AT, "Skip this process");
		}
                
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_CheckSpecialCard_Flow OPT_Already_Check END!");
                
		return (VS_SUCCESS);
	}
	
	memset(szCustomIndicator, 0x00, sizeof(szCustomIndicator));
	inGetCustomIndicator(szCustomIndicator);
	
	/* CFGT沒開特殊卡別參數檔，跳過不檢核 */
	memset(szFuncEnable, 0x00, sizeof(szFuncEnable));
	inGetSpecialCardRangeEnable(szFuncEnable);//'N'不支援
	if (memcmp(szFuncEnable, "Y", strlen("Y")) != 0)
	{
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_CheckSpecialCard_Flow CFGT_Not_Enable END!");
                
		return (VS_SUCCESS);
	}
	
	/* 活動代碼：00=符合此活動代碼之BIN，於交易時列印免簽名。*/
	if (inNCCC_Func_CheckSpecialCard(pobTran, _CAMPAIGNNUMBER_00_NO_SIGNATURE_) == VS_SUCCESS)
	{
		if (pobTran->srBRec.uszInstallmentBit == VS_TRUE || 
		    pobTran->srBRec.inOrgCode == _REFUND_ || 
		    pobTran->srBRec.inOrgCode == _INST_REFUND_ || 
		    pobTran->srBRec.inOrgCode == _REDEEM_REFUND_ || 
		    pobTran->srBRec.inOrgCode == _CUP_REFUND_ || 
		    pobTran->srBRec.inOrgCode == _CUP_INST_REFUND_ || 
		    pobTran->srBRec.inOrgCode == _CUP_REDEEM_REFUND_ || 
		    pobTran->srBRec.inOrgCode == _FISC_REFUND_ || 
		    pobTran->srBRec.inOrgCode == _HG_REWARD_REFUND_ || 
		    pobTran->srBRec.inOrgCode == _HG_REDEEM_REFUND_ ||
		    pobTran->srBRec.inCode == _TIP_)
		{
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "此交易別要簽名優先程度比活動代碼高：%d", pobTran->srBRec.inCode);
			}
		}
		else
		{
			pobTran->srBRec.uszSpecial00Bit = VS_TRUE;
			pobTran->srBRec.uszNoSignatureBit = VS_TRUE;
		}
	}
	
	/* 活動代碼：01=符合此活動代碼之BIN，於收銀機連線時回傳明碼卡號給收銀機。*/
	if (inNCCC_Func_CheckSpecialCard(pobTran, _CAMPAIGNNUMBER_01_PLAIN_PAN_) == VS_SUCCESS)
	{
		pobTran->srBRec.uszSpecial01Bit = VS_TRUE;
	}
	
	memset(&srAll, 0x00, sizeof(SQLITE_ALL_TABLE));
	inTableID = 0;
	memset(szEverRichSCDTEnable, 0x00, sizeof(szEverRichSCDTEnable));
        /*把srLink的tag、tagValue set到srAll*/
	inNCCC_Func_Table_Link_Duty_Free_Function(&srAll, _LS_READ_, &inTableID, szEverRichSCDTEnable);
        /*  gszReprintDBPath = ./fs_data/DutyFreeReprint.db  */
	inSqlite_Get_Table_ByRecordID_All(gszReprintDBPath, _TABLE_NAME_DUTY_FREE_FUNCTION_, 0, &srAll);
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "szCustomIndicator = %s", szCustomIndicator);
		inLogPrintf(AT, "pobTran->uszECRBit = 0x%02X", pobTran->uszECRBit);
		inLogPrintf(AT, "pobTran->uszCheck_CoBrand_CardBit = 0x%02X", pobTran->uszCheck_CoBrand_CardBit);
		inLogPrintf(AT, "szEverRichSCDTEnable = '%s'", szEverRichSCDTEnable);
	}
	/* (需求單-109327)-vx520客製化需求(昇恆昌客製化) by Russell 2022/5/30 下午 1:30
	 * 客製化075、103 活動代碼：05 檢查聯名卡 */
	if ((!memcmp(szCustomIndicator, _CUSTOMER_INDICATOR_075_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_)	||
	    !memcmp(szCustomIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_))	&&
	     pobTran->uszECRBit == VS_TRUE			&&
	     pobTran->uszCheck_CoBrand_CardBit == VS_TRUE	&&
	     !memcmp(szEverRichSCDTEnable, "Y", 1))
	{
		if (inNCCC_Func_CheckSpecialCard(pobTran, _CAMPAIGNNUMBER_05_EVER_RICH_COMBO_) == VS_SUCCESS)
		{

		}
		else
		{
                        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_CheckSpecialCard_Flow 非昇恆昌聯名卡片");
                        
			/* 非聯名卡片 */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			srDispMsgObj.inMsgType = _ENTER_KEY_MSG_;
			srDispMsgObj.inTimeout = 30;
			strcpy(srDispMsgObj.szErrMsg1, "非聯名卡片");
			strcpy(srDispMsgObj.szErrMsg2, "Not co-branded");
			strcpy(srDispMsgObj.szErrMsg3, "credit card");
			srDispMsgObj.inErrMsg1Line = _LINE_8_4_;
			srDispMsgObj.inErrMsg2Line = _LINE_8_5_;
			srDispMsgObj.inErrMsg3Line = _LINE_8_6_;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inDISP_Msg_BMP(&srDispMsgObj);
			
			pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_NOT_EVERRICH_CO_BRAND_CARD_;
			
			return (VS_ERROR);
		}
		
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_CheckSpecialCard_Flow() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_CheckSpecialCard_Flow END!");
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_CheckSpecialCard
Date&Time       :2017/5/22 下午 1:47
Describe        :return VS_Success代表符合該活動代碼
*/
int inNCCC_Func_CheckSpecialCard(TRANSACTION_OBJECT *pobTran, char* szCampaignNumber)
{
	int		inRetVal = VS_ERROR;
	int		i = 0;
	int		inLowBinLen = 0, inHighBinLen = 0;
	int		inPANLen = 0;
	long		lnCampaignAmount = 0;
	char		szFuncEnable[2 + 1];
	char		szLowBinRange[20 + 1];
	char		szHighBinRange[20 + 1];
	char		szTempCampaignNumber[2 + 1];
	char		szTemplate[12 + 1];
	char		szStartDate[8 + 1], szEndDate[8 + 1];
	char		szNowDate[8 + 1];
	char		szDebugMsg[100 + 1];
	unsigned char	uszInCardBin = VS_FALSE;		/* 這表示在卡號內 */
	RTC_NEXSYS	srRTC;
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_CheckSpecialCard(%s) START !", szCampaignNumber);
	}
	
	
	/* CFGT沒開特殊卡別參數檔 */
	memset(szFuncEnable, 0x00, sizeof(szFuncEnable));
        /* Special_Card_Range_Enable 啟動特殊卡別參數檔功能, 預設值= N, Y=支援，N=不支援 */
	inGetSpecialCardRangeEnable(szFuncEnable); 
	if (memcmp(szFuncEnable, "Y", strlen("Y")) != 0)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "CFGT,SpecialCardRangeEnable:%s", szFuncEnable);
		}
		return (VS_ERROR);
	}
	
	inPANLen = strlen(pobTran->srBRec.szPAN);
        if (inPANLen < 0)
        {
                /* debug */
                if (ginDebug == VS_TRUE)
                {
                        memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
                        sprintf(szDebugMsg, "PANLength: %d < 0", inPANLen);
                        inLogPrintf(AT, szDebugMsg);
                }
		
		/* 顯示卡號錯誤 */
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, _ERR_CARD_NO_);
		srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
		srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
		srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
		strcpy(srDispMsgObj.szErrMsg1, "");
		srDispMsgObj.inErrMsg1Line = 0;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
                inDISP_Msg_BMP(&srDispMsgObj);

                return (VS_ERROR);
        }
	
	for (i = 0 ;; i ++)
	{
		if (inLoadSCDTRec(i) < 0)
			break;
		
		memset(szLowBinRange, 0x00, sizeof(szLowBinRange));
                memset(szHighBinRange, 0x00, sizeof(szHighBinRange));
                inGetSCDTLowBinRange(szLowBinRange);
                inLowBinLen = strlen(szLowBinRange);
                inGetSCDTHighBinRange(szHighBinRange);
                inHighBinLen = strlen(szHighBinRange);
		
		memset(szTempCampaignNumber, 0x00, sizeof(szTempCampaignNumber));
		inGetCampaignNumber(szTempCampaignNumber);/* 活動代碼 */
		/* 如果不是要判別的活動代碼，就跳過，這裡的設計原理一次只確認一種活動代碼(為了模組化) */
		if (memcmp(szTempCampaignNumber, szCampaignNumber, 2) != 0)
		{
			continue;
		}

		/* CUP卡看CardBin為9999999999就好 */
		if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_CUP_, strlen(_CARD_TYPE_CUP_)) == 0)
		{
			/* 判斷卡號 位在哪個Bin Range(如果卡號大於該卡別最低卡號，而且小於最高卡號) */
			if ((memcmp(szLowBinRange, "9999999999", 10) >= 0) &&
			    (memcmp(szHighBinRange, "9999999999", 10) <= 0))
			{
			        uszInCardBin = VS_TRUE;
			        break;
			}
		}
		else
		{
		        if ((memcmp(pobTran->srBRec.szPAN, szLowBinRange, min(inPANLen, inLowBinLen)) >= 0) &&
		            (memcmp(pobTran->srBRec.szPAN, szHighBinRange, min(inPANLen, inHighBinLen)) <= 0))
		        {
				uszInCardBin = VS_TRUE;
				break;
		        }
	        }
	}
	
	/* SCDT內沒有該卡別 */
	if (uszInCardBin != VS_TRUE)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "Not In CardBIN");
		}
		return (VS_ERROR);
	}
	else
	{
		/* 檢查金額 */
		memset(szTemplate, 0x00, sizeof(szTemplate));
		inGetCampaignAmount(szTemplate);
		/* 小數點下兩位不記*/
		szTemplate[10] = 0x00;
		szTemplate[11] = 0x00;
		lnCampaignAmount = atol(szTemplate);
		
		if (pobTran->srBRec.lnTxnAmount <= lnCampaignAmount)
		{		
			/* 取得活動起迄日 */
			/* 活動起日 */
			memset(szStartDate, 0x00, sizeof(szStartDate));
			inGetCampaignStartDate(szStartDate);
			if (ginDebug == VS_TRUE)
			{
				memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
				sprintf(szDebugMsg, "CampaignStartDate = %s", szStartDate);
				inLogPrintf(AT, szDebugMsg);
			}

			/* 活動迄日 */
			memset(szEndDate, 0x00, sizeof(szEndDate));
			inGetCampaignEndDate(szEndDate);
			if (ginDebug == VS_TRUE)
			{
				memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
				sprintf(szDebugMsg, "CampaignEndDate = %s", szEndDate);
				inLogPrintf(AT, szDebugMsg);
			}

			/* 現在日期 */
			memset(&srRTC, 0x00, sizeof(RTC_NEXSYS));
			inFunc_GetSystemDateAndTime(&srRTC);
			memset(szNowDate, 0x00, sizeof(szNowDate));
			sprintf(szNowDate, "20%02d%02d%02d", srRTC.uszYear, srRTC.uszMonth, srRTC.uszDay);
			if (ginDebug == VS_TRUE)
			{
				memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
				sprintf(szDebugMsg, "NowDate = %s", szNowDate);
				inLogPrintf(AT, szDebugMsg);
			}
			
			if (inFunc_SunDay_Sum_Check_In_Range(szNowDate, szStartDate, szEndDate) == VS_SUCCESS)
			{
				inRetVal = VS_SUCCESS;
			}
			else
			{
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "Not In Range");
				}
				inRetVal = VS_ERROR;
			}
		}
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_CheckSpecialCard() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Check_MPAS_Host
Date&Time       :2017/9/13 下午 2:03
Describe        :MPAS不能有DCC和HappyGO，若有，顯示請重下TMS，並將TMS OK設為N
*/
int inNCCC_Func_Check_MPAS_Host()
{
	int	inOrgIndex = 0;
	char	szFESMode[2 + 1];
	char	szHostEnable[2 + 1];
	
	memset(szFESMode, 0x00, sizeof(szFESMode));
	inGetNCCCFESMode(szFESMode);
	
	if (memcmp(szFESMode, _NCCC_04_MPAS_MODE_, strlen(_NCCC_04_MPAS_MODE_)) == 0)
	{
		memset(szHostEnable, 0x00, sizeof(szHostEnable));
		inNCCC_DCC_GetDCC_Enable(inOrgIndex, szHostEnable);
		if (memcmp(szHostEnable, "Y", strlen("Y")) == 0)
		{
			inSetTMSOK("N");
			inSaveEDCRec(0);
			
			/* 顯示 請重下TMS */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, _ERR_REDOWNLOAD_TMS_);
			srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_5_;
			srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
			srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
			strcpy(srDispMsgObj.szErrMsg1, "");
			srDispMsgObj.inErrMsg1Line = 0;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inDISP_Msg_BMP(&srDispMsgObj);
			
			return (VS_ERROR);
		}
		
		memset(szHostEnable, 0x00, sizeof(szHostEnable));
		inHG_GetHG_Enable(inOrgIndex, szHostEnable);
		if (memcmp(szHostEnable, "Y", strlen("Y")) == 0)
		{
			inSetTMSOK("N");
			inSaveEDCRec(0);
			
			/* 顯示 請重下TMS */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, _ERR_REDOWNLOAD_TMS_);
			srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_5_;
			srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
			srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
			strcpy(srDispMsgObj.szErrMsg1, "");
			srDispMsgObj.inErrMsg1Line = 0;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inDISP_Msg_BMP(&srDispMsgObj);
			
			return (VS_ERROR);
		}
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Dial_VoiceLine
Date&Time       :2017/12/6 上午 11:36
Describe        :
*/
int inNCCC_Func_Dial_VoiceLine(unsigned char *uszNumber, unsigned short usLen)
{
	int		inRetVal = VS_SUCCESS;
	int		inChoice = _DisTouch_No_Event_;
	char		szPABXCode[2 + 1];
	unsigned short	usPABXNumberLen = 0;
	unsigned char	uszPABXNumber[20 + 1];
	unsigned char	uszKey = 0;
	
	/* 處理PABX START */
	memset(szPABXCode, 0x00, sizeof(szPABXCode));
	inGetPABXCode(szPABXCode);
	
	memset(uszPABXNumber, 0x00, sizeof(uszPABXNumber));
	memcpy(uszPABXNumber, szPABXCode, strlen(szPABXCode));
	usPABXNumberLen += strlen(szPABXCode);
	
	memcpy(&uszPABXNumber[usPABXNumberLen], uszNumber, usLen);
	usPABXNumberLen += usLen;
	/* 處理PABX END */
	
	/* Initial Modem */
	inModem_Initial();
	inDISP_Wait(200);
	
	/* Flush */
	inModem_Flush_Rx();
	inDISP_Wait(200);
	
	/* 撥號 */
	inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
	inDISP_ChineseFont("撥號中", _FONTSIZE_8X16_, _LINE_8_5_, _DISP_CENTER_);
	inRetVal = inModem_Dial(uszPABXNumber, usPABXNumberLen);
	if (inRetVal != VS_SUCCESS)
	{
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, "");
		srDispMsgObj.inDispPic1YPosition = 0;
		srDispMsgObj.inMsgType = _NO_KEY_MSG_;
		srDispMsgObj.inTimeout = 5;
		strcpy(srDispMsgObj.szErrMsg1, "撥號失敗");
		srDispMsgObj.inErrMsg1Line = _LINE_8_6_;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
		
		inDISP_Msg_BMP(&srDispMsgObj);	/* 撥號失敗 */
	}
	else
	{
		/* 請拿起話筒 */
		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		inDISP_PutGraphic(_MSG_PLEASE_PICK_UP_PHONE_, 0, _COORDINATE_Y_LINE_8_6_);
		inDISP_BEEP(1, 0);
		inDISP_Wait(8000);
		
		/* 請按確認或清除鍵 */
		/* 請拿起話筒畫面Time Out時間由5分鐘調整為15分鐘。 */
		inDISP_PutGraphic(_MSG_ENTER_OR_CANCEL_, 0, _COORDINATE_Y_LINE_8_8_);
		inDISP_Timer_Start(_TIMER_NEXSYS_1_, 900);

		while (1)
		{
			inChoice = inDisTouch_TouchSensor_Click_Slide(_Touch_OX_LINE8_8_);
			uszKey = uszKBD_Key();

			/* Timeout */
			if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
			{
				uszKey = _KEY_TIMEOUT_;
			}

			if (inChoice == _Touch_OX_LINE8_8_CANCEL_BUTTON_	||
			    uszKey == _KEY_CANCEL_			|| 
			    uszKey == _KEY_TIMEOUT_)
			{
				/* 使用者終止交易 */
				inRetVal = VS_USER_CANCEL;
				break;
			}
			else if (inChoice == _Touch_OX_LINE8_8_ENTER_BUTTON_	||
				 uszKey == _KEY_ENTER_)
			{
				break;
			}
			else
			{
				continue;
			}
		}
	}
	
	/* Flush */
	inModem_Flush_Rx();
	inDISP_Wait(200);
	
	/* 掛電話 */
	inModem_Hook_On();
	inDISP_Wait(500);
	
	/* 現在設計不用close */
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Disclaim_Auth
Date&Time       :2017/12/8 下午 1:26
Describe        :請輸入您與銀行聯絡所核准之授權碼，以免遭詐騙被銀行扣款
*/
int inNCCC_Func_Disclaim_Auth(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_SUCCESS;
	int		inChoice = _DisTouch_No_Event_;
	unsigned char	uszKey = 0;
	unsigned char	uszInputBit = VS_FALSE;
	
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Disclaim_Auth START!");
        
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Disclaim_Auth() START !");
	}
	
	/* 如果已收到授權碼，跳過此流程 2019/4/18 下午 4:59 */
	if (pobTran->uszECRBit == VS_TRUE)
	{
		if (strlen(pobTran->srBRec.szAuthCode) > 0)
		{
			if (memcmp(pobTran->srBRec.szAuthCode, "      ", 6) == 0)
			{
				if (pobTran->srBRec.uszCUPTransBit == VS_TRUE)
				{
					uszInputBit = VS_TRUE;
				}
				else
				{
					/* 如果全空白，又不是銀聯交易，視為未輸入 */
					uszInputBit = VS_FALSE;
				}
			}
			else
			{
				uszInputBit = VS_TRUE;
			}
		}
		else
		{
			uszInputBit = VS_FALSE;
		}
	}
	else
	{
		if (strlen(pobTran->srBRec.szAuthCode) > 0)
		{
			uszInputBit = VS_TRUE;
		}
		else
		{
			uszInputBit = VS_FALSE;
		}
	}
	
	if (uszInputBit == VS_TRUE)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "Auth Code Valid :\"%s\"", pobTran->srBRec.szAuthCode);
			inLogPrintf(AT, "inNCCC_Func_Disclaim_Auth() END !");
			inLogPrintf(AT, "----------------------------------------");
		}
		
		return (VS_SUCCESS);
	}
	else
	{
		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		inDISP_PutGraphic(_DISCLAIMER_AUTH_, 0, _COORDINATE_Y_LINE_8_4_);
		/* 請按確認或清除鍵 */
		inDISP_PutGraphic(_MSG_ENTER_OR_CANCEL_, 0, _COORDINATE_Y_LINE_8_8_);
		inDISP_Timer_Start(_TIMER_NEXSYS_1_, _EDC_TIMEOUT_);
		inDISP_Timer_Start_MicroSecond(_TIMER_NEXSYS_2_, 50);

		while (1)
		{
			inChoice = inDisTouch_TouchSensor_Click_Slide(_Touch_OX_LINE8_8_);
			uszKey = uszKBD_Key();

			/* Timeout */
			if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
			{
				uszKey = _KEY_TIMEOUT_;
			}

			if (inTimerGet(_TIMER_NEXSYS_2_) == VS_SUCCESS)
			{
				inDISP_BEEP(1, 0);
				inDISP_Timer_Start_MicroSecond(_TIMER_NEXSYS_2_, 50);
			}

			if (inChoice == _Touch_OX_LINE8_8_CANCEL_BUTTON_	||
			    uszKey == _KEY_CANCEL_				|| 
			    uszKey == _KEY_TIMEOUT_)
			{
				/* 使用者終止交易 */
				inRetVal = VS_USER_CANCEL;
				break;
			}
			else if (inChoice == _Touch_OX_LINE8_8_ENTER_BUTTON_	||
				 uszKey == _KEY_ENTER_)
			{
				break;
			}
			else
			{
				continue;
			}
		}

		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "inNCCC_Func_Disclaim_Auth() END !");
			inLogPrintf(AT, "----------------------------------------");
		}
		
		return (inRetVal);
	}
}

/*
Function        :inNCCC_Func_Display_Review_Settle
Date&Time       :2018/1/19 下午 4:03
Describe        :
*/
int inNCCC_Func_Display_Review_Settle(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_SUCCESS;
	int		inChoice = 0;
	int		inTouchSensorFunc = _Touch_BATCH_END_;
	char		szTemplate1[44 + 1] = {0};
	char		szTemplate2[44 + 1] = {0};
	char		szDispBuffer1[44 + 1] = {0};
	char		szDispBuffer2[44 + 1] = {0};
	long long	llSum = 0;
	unsigned char	uszKey = 0x00;
	ACCUM_TOTAL_REC	srAccumRec = {0};
	
	/* 讀交易資料，並放交易查詢Title */
	memset(&srAccumRec, 0x00, sizeof(ACCUM_TOTAL_REC));
	inACCUM_GetRecord(pobTran, &srAccumRec);
	inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
	inDISP_PutGraphic(_REVIEW_SETTLE_, 0, _COORDINATE_Y_LINE_8_4_);
	
	/* 聯合版本五卡合一，AMEX走NCCC */

	/* 銷售筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.lnTotalSaleCount;

	sprintf(szTemplate1, "%03lld", llSum);	
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 7);

	/* 銷售金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	/* NCCC的要分別加起來 */
	/* 若總金額大於等於9位數，則縮小字體 */
	llSum = srAccumRec.llTotalSaleAmount + srAccumRec.llTotalTipsAmount;
	if (abs(llSum) < 100000000)
	{
		sprintf(szTemplate2, "%01lld", llSum);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01lld", llSum);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}

	/* 退貨筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.lnTotalRefundCount;

	sprintf(szTemplate1, "%03lld", llSum);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 7);
	
	/* 退貨金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.llTotalRefundAmount;
	if (abs(llSum) < 100000000)
	{
		sprintf(szTemplate2, "%01lld", (0 - llSum));
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01lld", (0 - llSum));
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}

	/* 淨額筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.lnTotalCount;

	sprintf(szTemplate1, "%03lld", llSum);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 7);
	
	/* 淨額金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.llTotalAmount;
	if (abs(llSum) < 100000000)
	{
		sprintf(szTemplate2, "%01lld", llSum);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01lld", llSum);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}

	/* 優惠兌換 */
	
	inDISP_Timer_Start(_TIMER_NEXSYS_1_, _EDC_TIMEOUT_);
	
	uszKey = 0x00;
	while (1)
	{
		inChoice = inDisTouch_TouchSensor_Click_Slide(inTouchSensorFunc);
		uszKey = uszKBD_Key();

		/* Timeout */
		if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
		{
			uszKey = _KEY_TIMEOUT_;
		}

		if (uszKey == _KEY_CANCEL_)
		{
			inRetVal = VS_USER_CANCEL;
			break;
		}
		else if (uszKey == _KEY_TIMEOUT_)
		{
			inRetVal = VS_TIMEOUT;
			break;
		}
		else if (inChoice == _BATCH_END_Touch_ENTER_BUTTON_	||
			 uszKey == _KEY_0_)
		{
			inRetVal = VS_SUCCESS;
			break;
		}
	}
	/* 清空Touch資料 */
	inDisTouch_Flush_TouchFile();
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Display_Review_Settle_DCC
Date&Time       :2018/1/19 下午 4:03
Describe        :
*/
int inNCCC_Func_Display_Review_Settle_DCC(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_SUCCESS;
	int		inChoice = 0;
	int		inTouchSensorFunc = _Touch_BATCH_END_;
	char		szTemplate1[44 + 1] = {0};
	char		szTemplate2[44 + 1] = {0};
	char		szDispBuffer1[44 + 1] = {0};
	char		szDispBuffer2[44 + 1] = {0};
	long long	llSum = 0;
	unsigned char	uszKey = 0x00;
	ACCUM_TOTAL_REC	srAccumRec = {0};
	
	/* 讀交易資料，並放交易查詢Title */
	memset(&srAccumRec, 0x00, sizeof(ACCUM_TOTAL_REC));
	inACCUM_GetRecord(pobTran, &srAccumRec);
	inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
	inDISP_PutGraphic(_REVIEW_SETTLE_, 0, _COORDINATE_Y_LINE_8_4_);
	
	/* DCC不支援CUP、DCC目前只支援VISA、MASTERCARD */

	/* 銷售筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	llSum = srAccumRec.lnVisaTotalSaleCount + srAccumRec.lnMasterTotalSaleCount;

	sprintf(szTemplate1, "%03lld", llSum);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 7);
	
	/* 銷售金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	llSum = srAccumRec.llVisaTotalSaleAmount + srAccumRec.llMasterTotalSaleAmount +
		srAccumRec.llVisaTotalTipsAmount + srAccumRec.llMasterTotalTipsAmount;;
	if (abs(llSum) < 100000000)
	{
		sprintf(szTemplate2, "%01lld", llSum);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01lld", llSum);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}

	/* 退貨筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	llSum = srAccumRec.lnVisaTotalRefundCount + srAccumRec.lnMasterTotalRefundCount;

	sprintf(szTemplate1, "%03lld", llSum);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 7);
	
	/* 退貨金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	llSum = srAccumRec.llVisaTotalRefundAmount + srAccumRec.llMasterTotalRefundAmount;
	if (abs(llSum) < 100000000)
	{
		sprintf(szTemplate2, "%01lld", (0 - llSum));
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01lld", (0 - llSum));
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}
	
	/* 淨額筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	llSum = srAccumRec.lnVisaTotalCount + srAccumRec.lnMasterTotalCount;

	sprintf(szTemplate1, "%03lld", llSum);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 7);
	
	/* 淨額金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	llSum = srAccumRec.llVisaTotalAmount + srAccumRec.llMasterTotalAmount;
	if (abs(llSum) < 100000000)
	{
		sprintf(szTemplate2, "%01lld", llSum);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01lld", llSum);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}

	/* 優惠兌換 */
	
	uszKey = 0x00;
	inTouchSensorFunc = _Touch_BATCH_END_;
	inDISP_Timer_Start(_TIMER_NEXSYS_1_, _EDC_TIMEOUT_);
	
	while (1)
	{
		inChoice = inDisTouch_TouchSensor_Click_Slide(inTouchSensorFunc);
		uszKey = uszKBD_Key();

		/* Timeout */
		if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
		{
			uszKey = _KEY_TIMEOUT_;
		}

		if (uszKey == _KEY_CANCEL_)
		{
			inRetVal = VS_USER_CANCEL;
			break;
		}
		else if (uszKey == _KEY_TIMEOUT_)
		{
			inRetVal = VS_TIMEOUT;
			break;
		}
		else if (inChoice == _BATCH_END_Touch_ENTER_BUTTON_	||
			 uszKey == _KEY_0_)
		{
			inRetVal = VS_SUCCESS;
			break;
		}
	}
	/* 清空Touch資料 */
	inDisTouch_Flush_TouchFile();
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Display_Review_Settle_ESC_Reinforce
Date&Time       :2018/6/1 下午 1:39
Describe        :
*/
int inNCCC_Func_Display_Review_Settle_ESC_Reinforce(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_SUCCESS;
	int		inCnt = 0;
	int		inChoice = 0;
	int		inTouchSensorFunc = _Touch_BATCH_END_;
	int		inSaleUploadCnt = 0, inRefundUploadCnt = 0, inSalePaperCnt = 0, inRefundPaperCnt = 0; 
	long		lnSaleUploadAmt = 0, lnRefundUploadAmt = 0, lnSalePaperAmt = 0, lnRefundPaperAmt = 0;
	long		lnAmt = 0;
	char		szTemplate1[44 + 1] = {0};
	char		szTemplate2[44 + 1] = {0};
	char		szDispBuffer1[44 + 1] = {0};
	char		szDispBuffer2[44 + 1] = {0};
	char		szFuncEnable[2 + 1] = {0};
	unsigned char	uszKey = 0x00;
	
	/* ESC沒開直接跳走 */
	memset(szFuncEnable, 0x00, sizeof(szFuncEnable));
	inGetESCMode(szFuncEnable);
	if (memcmp(szFuncEnable, "Y", strlen("Y")) != 0)
	{
		return (VS_SUCCESS);
	}
	
	/* 讀交易資料，並放交易查詢Title */
	/* Sale已上傳 */
	if (inBATCH_Get_ESC_Upload_Count_Flow(pobTran, _TN_BATCH_TABLE_, _ESC_REINFORCE_TXNCODE_SALE_, VS_FALSE, &inSaleUploadCnt, &lnSaleUploadAmt) != VS_SUCCESS)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "ESC COUNT SQLite read fail.");
		}

	}

	/* Refund已上傳 */
	if (inBATCH_Get_ESC_Upload_Count_Flow(pobTran, _TN_BATCH_TABLE_, _ESC_REINFORCE_TXNCODE_REFUND_, VS_FALSE, &inRefundUploadCnt, &lnRefundUploadAmt) != VS_SUCCESS)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "ESC COUNT SQLite read fail.");
		}

	}

	/* Sale出紙本 */
	if (inBATCH_Get_ESC_Upload_Count_Flow(pobTran, _TN_BATCH_TABLE_, _ESC_REINFORCE_TXNCODE_SALE_, VS_TRUE, &inSalePaperCnt, &lnSalePaperAmt) != VS_SUCCESS)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "ESC COUNT SQLite read fail.");
		}

	}

	/* Refund出紙本 */
	if (inBATCH_Get_ESC_Upload_Count_Flow(pobTran, _TN_BATCH_TABLE_, _ESC_REINFORCE_TXNCODE_REFUND_, VS_TRUE, &inRefundPaperCnt, &lnRefundPaperAmt) != VS_SUCCESS)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "ESC COUNT SQLite read fail.");
		}

	}
	
	inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
	inDISP_PutGraphic(_REVIEW_SETTLE_TOTAL_ESC_REINFORCE_, 0, _COORDINATE_Y_LINE_8_4_);
	
	/* 銷售已上傳筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	inCnt = inSaleUploadCnt;
	sprintf(szTemplate1, "%03d", inCnt);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 7);

	/* 銷售已上傳金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	lnAmt = lnSaleUploadAmt;
	if (lnAmt < 100000000)
	{
		sprintf(szTemplate2, "%01ld", lnAmt);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01ld", lnAmt);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}

	/* 銷售未上傳筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	inCnt = inSalePaperCnt;
	sprintf(szTemplate1, "%03d", inCnt);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 7);
	
	/* 銷售未上傳金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	lnAmt = lnSalePaperAmt;
	if (lnAmt < 100000000)
	{
		sprintf(szTemplate2, "%01ld", lnAmt);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01ld", lnAmt);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}
	
	/* 退貨已上傳筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	inCnt = inRefundUploadCnt;
	sprintf(szTemplate1, "%03d", inCnt);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 7);

	/* 退貨已上傳金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	lnAmt = lnRefundUploadAmt;
	if (lnAmt < 100000000)
	{
		sprintf(szTemplate2, "%01ld", lnAmt);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01ld", lnAmt);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}

	/* 退貨未上傳筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	inCnt = inRefundUploadCnt;
	sprintf(szTemplate1, "%03d", inCnt);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_7_, _COLOR_BLACK_,_COLOR_WHITE_, 7);
	
	/* 退貨未上傳金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	lnAmt = lnRefundUploadAmt;
	if (lnAmt < 100000000)
	{
		sprintf(szTemplate2, "%01ld", lnAmt);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_7_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01ld", lnAmt);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_7_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}
	
	uszKey = 0x00;
	inTouchSensorFunc = _Touch_NEWUI_REVIEW_TOTAL_;
	inDISP_Timer_Start(_TIMER_NEXSYS_1_, _EDC_TIMEOUT_);
	
	uszKey = 0x00;
	while (1)
	{
		inChoice = inDisTouch_TouchSensor_Click_Slide(inTouchSensorFunc);
		uszKey = uszKBD_Key();

		/* Timeout */
		if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
		{
			uszKey = _KEY_TIMEOUT_;
		}

		if (uszKey == _KEY_CANCEL_)
		{
			inRetVal = VS_USER_CANCEL;
			break;
		}
		else if (uszKey == _KEY_TIMEOUT_)
		{
			inRetVal = VS_TIMEOUT;
			break;
		}
		else if (uszKey == _KEY_ENTER_)
		{
			inRetVal = VS_SUCCESS;
			break;
		}
	}
	/* 清空Touch資料 */
	inDisTouch_Flush_TouchFile();
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Display_Review
Date&Time       :2018/1/19 下午 4:03
Describe        :
*/
int inNCCC_Func_Display_Review(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_SUCCESS;
	int		inChoice = 0;
	int		inTouchSensorFunc = _Touch_NEWUI_REVIEW_TOTAL_;
	char		szTemplate1[44 + 1] = {0};
	char		szTemplate2[44 + 1] = {0};
	char		szDispBuffer1[44 + 1] = {0};
	char		szDispBuffer2[44 + 1] = {0};
	char		szCustomerIndicator[3 + 1] = {0};
	long long	llSum = 0;
	unsigned char	uszKey = 0x00;
	ACCUM_TOTAL_REC	srAccumRec = {0};
	
	/* 讀交易資料，並放交易查詢Title */
	memset(&srAccumRec, 0x00, sizeof(ACCUM_TOTAL_REC));
	inACCUM_GetRecord(pobTran, &srAccumRec);
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
	if (memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_046_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_) == 0	||
	    memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_047_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_) == 0	||
	    memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_075_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_) == 0	||
	    memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_) == 0)
	{
		inDISP_PutGraphic(_REVIEW_TOTAL_2_, 0, _COORDINATE_Y_LINE_8_4_);
		if (ginHalfLCD == VS_TRUE)
		{
			
		}
		else
		{
			if (guszNoChooseHostBit != VS_TRUE)
			{
				inDISP_PutGraphic(_ICON_BUTTON_LAST_PAGE_, _Distouch_NEWUI_LAST_PAGE_BUTTON_X1_, _Distouch_NEWUI_LAST_PAGE_BUTTON_Y1_);
			}
			inDISP_PutGraphic(_ICON_BUTTON_RETURN_IDLE_, _Distouch_NEWUI_RETURN_IDLE_BUTTON_X1_, _Distouch_NEWUI_RETURN_IDLE_BUTTON_Y1_);
		}
	}
	else
	{
		if (inNCCC_Loyalty_CreditCardFlag(_LOYALTY_REDEEM_) == VS_SUCCESS)
		{
			inDISP_PutGraphic(_REVIEW_TOTAL_, 0, _COORDINATE_Y_LINE_8_4_);
			if (ginHalfLCD == VS_TRUE)
			{

			}
			else
			{
				if (guszNoChooseHostBit != VS_TRUE)
				{
					inDISP_PutGraphic(_ICON_BUTTON_LAST_PAGE_, _Distouch_NEWUI_LAST_PAGE_BUTTON_X1_, _Distouch_NEWUI_LAST_PAGE_BUTTON_Y1_);
				}
				inDISP_PutGraphic(_ICON_BUTTON_RETURN_IDLE_, _Distouch_NEWUI_RETURN_IDLE_BUTTON_X1_, _Distouch_NEWUI_RETURN_IDLE_BUTTON_Y1_);
			}
		}
		else
		{
			inDISP_PutGraphic(_REVIEW_TOTAL_2_, 0, _COORDINATE_Y_LINE_8_4_);
			if (ginHalfLCD == VS_TRUE)
			{

			}
			else
			{
				if (guszNoChooseHostBit != VS_TRUE)
				{
					inDISP_PutGraphic(_ICON_BUTTON_LAST_PAGE_, _Distouch_NEWUI_LAST_PAGE_BUTTON_X1_, _Distouch_NEWUI_LAST_PAGE_BUTTON_Y1_);
				}
				inDISP_PutGraphic(_ICON_BUTTON_RETURN_IDLE_, _Distouch_NEWUI_RETURN_IDLE_BUTTON_X1_, _Distouch_NEWUI_RETURN_IDLE_BUTTON_Y1_);
			}
		}
	}
	
	/* 聯合版本五卡合一，AMEX走NCCC */

	/* 銷售筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.lnTotalSaleCount;

	sprintf(szTemplate1, "%03lld", llSum);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 7);

	/* 銷售金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.llTotalSaleAmount + srAccumRec.llTotalTipsAmount;

        sprintf(szTemplate2, "%01lld", llSum);
        inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
        sprintf(szDispBuffer2, "%s", szTemplate2);
        inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 13);

	/* 退貨筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.lnTotalRefundCount;

	sprintf(szTemplate1, "%03lld", llSum);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 7);
	
	/* 退貨金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.llTotalRefundAmount;
        
        sprintf(szTemplate2, "%01lld", (0 - llSum));
        inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
        sprintf(szDispBuffer2, "%s", szTemplate2);
        inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	
	/* 淨額筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.lnTotalCount;

	sprintf(szTemplate1, "%03lld", llSum);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 7);

	/* 淨額金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.llTotalAmount;

        sprintf(szTemplate2, "%01lld", llSum);
        inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
        sprintf(szDispBuffer2, "%s", szTemplate2);
        inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	
	/* 客製化41預借現金 不顯示優惠兌換 */
	if (memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_046_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_) == 0	||
	    memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_047_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_) == 0	||
	    memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_075_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_) == 0	||
	    memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_) == 0	||
	    memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_041_CASH_, _CUSTOMER_INDICATOR_SIZE_) == 0)
	{
		/* 不顯示 */
	}
	else
	{
		/* 有開優惠兌換功能才顯示 */
		if (inNCCC_Loyalty_CreditCardFlag(_LOYALTY_REDEEM_) == VS_SUCCESS)
		{
			/* 優惠兌換 */
			memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
			memset(szTemplate1, 0x00, sizeof(szTemplate1));

			/* NCCC的要分別加起來 */
			llSum = srAccumRec.lnLoyaltyRedeemTotalCount;

			sprintf(szTemplate2, "%03lld", llSum);
			inFunc_PAD_ASCII(szTemplate2, szTemplate2, ' ', 5, _PADDING_LEFT_);
			sprintf(szDispBuffer1, "%s%s", szTemplate1, szTemplate2);
			inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_7_, _COLOR_BLACK_,_COLOR_WHITE_, 16);
		}
	}
	
	uszKey = 0x00;
	inTouchSensorFunc = _Touch_NEWUI_REVIEW_TOTAL_;
	inDISP_Timer_Start(_TIMER_NEXSYS_1_, _EDC_TIMEOUT_);
	
	while (1)
	{
		inChoice = inDisTouch_TouchSensor_Click_Slide(inTouchSensorFunc);
		uszKey = uszKBD_Key();
		
		/* Timeout */
		if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
		{
			uszKey = _KEY_TIMEOUT_;
		}

		if (uszKey == _KEY_ENTER_)
		{
			inRetVal = VS_SUCCESS;
			break;
		}
		else if (inChoice == _NEWUI_REVIEW_TOTAL_Touch_RETURN_IDLE_BUTTON_	||
			 uszKey == _KEY_CANCEL_)
		{
			inRetVal = VS_ERROR;
			break;
		}
		else if (uszKey == _KEY_TIMEOUT_)
		{
			inRetVal = VS_TIMEOUT;
			break;
		}
		else if (inChoice == _NEWUI_REVIEW_TOTAL_Touch_LAST_PAGE_BUTTON_	||
			 uszKey == _KEY_CLEAR_)
		{
			if (guszNoChooseHostBit != VS_TRUE)
			{
				inRetVal = VS_LAST_PAGE;
				pobTran->srBRec.inHDTIndex = -1;
				break;
			}
		}
	}
	/* 清空Touch資料 */
	inDisTouch_Flush_TouchFile();
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Display_Review_DCC
Date&Time       :2018/1/19 下午 4:03
Describe        :
*/
int inNCCC_Func_Display_Review_DCC(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_SUCCESS;
	int		inChoice = 0;
	int		inTouchSensorFunc = _Touch_NEWUI_REVIEW_TOTAL_;
	char		szTemplate1[44 + 1] = {0};
	char		szTemplate2[44 + 1] = {0};
	char		szDispBuffer1[44 + 1] = {0};
	char		szDispBuffer2[44 + 1] = {0};
	long long	llSum = 0;
	unsigned char	uszKey = 0x00;
	ACCUM_TOTAL_REC	srAccumRec = {0};
	
	/* 讀交易資料，並放交易查詢Title */
	memset(&srAccumRec, 0x00, sizeof(ACCUM_TOTAL_REC));
	inACCUM_GetRecord(pobTran, &srAccumRec);
	inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
	inDISP_PutGraphic(_REVIEW_TOTAL_2_, 0, _COORDINATE_Y_LINE_8_4_);
	if (ginHalfLCD == VS_TRUE)
	{

	}
	else
	{
		if (guszNoChooseHostBit != VS_TRUE)
		{
			inDISP_PutGraphic(_ICON_BUTTON_LAST_PAGE_, _Distouch_NEWUI_LAST_PAGE_BUTTON_X1_, _Distouch_NEWUI_LAST_PAGE_BUTTON_Y1_);
		}
		inDISP_PutGraphic(_ICON_BUTTON_RETURN_IDLE_, _Distouch_NEWUI_RETURN_IDLE_BUTTON_X1_, _Distouch_NEWUI_RETURN_IDLE_BUTTON_Y1_);
	}
	/* DCC不支援CUP、DCC目前只支援VISA、MASTERCARD */

	/* 銷售筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	llSum = srAccumRec.lnVisaTotalSaleCount + srAccumRec.lnMasterTotalSaleCount;

	sprintf(szTemplate1, "%03lld", llSum);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 7);

	/* 銷售金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	llSum = srAccumRec.llVisaTotalSaleAmount + srAccumRec.llMasterTotalSaleAmount +
		srAccumRec.llVisaTotalTipsAmount + srAccumRec.llMasterTotalTipsAmount;
	if (abs(llSum) < 100000000)
	{
		sprintf(szTemplate2, "%01lld", llSum);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01lld", llSum);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}

	/* 退貨筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	llSum = srAccumRec.lnVisaTotalRefundCount + srAccumRec.lnMasterTotalRefundCount;

	sprintf(szTemplate1, "%03lld", llSum);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 7);

	/* 退貨金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	llSum = srAccumRec.llVisaTotalRefundAmount + srAccumRec.llMasterTotalRefundAmount;
	if (abs(llSum) < 100000000)
	{
		sprintf(szTemplate2, "%01lld", (0 - llSum));
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01lld", (0 - llSum));
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}

	/* 淨額筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	llSum = srAccumRec.lnVisaTotalCount + srAccumRec.lnMasterTotalCount;

	sprintf(szTemplate1, "%03lld", llSum);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 7);

	/* 淨額金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	llSum = srAccumRec.llVisaTotalAmount + srAccumRec.llMasterTotalAmount;
	if (abs(llSum) < 100000000)
	{
		sprintf(szTemplate2, "%01lld", llSum);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01lld", llSum);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}

	/* 優惠兌換 */
	
	uszKey = 0x00;
	inTouchSensorFunc = _Touch_NEWUI_REVIEW_TOTAL_;
	inDISP_Timer_Start(_TIMER_NEXSYS_1_, _EDC_TIMEOUT_);
	
	while (1)
	{
		inChoice = inDisTouch_TouchSensor_Click_Slide(inTouchSensorFunc);
		uszKey = uszKBD_Key();
		
		/* Timeout */
		if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
		{
			uszKey = _KEY_TIMEOUT_;
		}

		if (uszKey == _KEY_ENTER_)
		{
			inRetVal = VS_SUCCESS;
			break;
		}
		else if (inChoice == _NEWUI_REVIEW_TOTAL_Touch_RETURN_IDLE_BUTTON_	||
			 uszKey == _KEY_CANCEL_)
		{
			inRetVal = VS_ERROR;
			break;
		}
		else if (uszKey == _KEY_TIMEOUT_)
		{
			inRetVal = VS_TIMEOUT;
			break;
		}
		else if (inChoice == _NEWUI_REVIEW_TOTAL_Touch_LAST_PAGE_BUTTON_	||
			 uszKey == _KEY_CLEAR_)
		{
			if (guszNoChooseHostBit != VS_TRUE)
			{
				inRetVal = VS_LAST_PAGE;
				pobTran->srBRec.inHDTIndex = -1;
				break;
			}
		}
	}
	/* 清空Touch資料 */
	inDisTouch_Flush_TouchFile();
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Display_Review_ESC_Reinforce
Date&Time       :2018/6/1 上午 11:37
Describe        :
*/
int inNCCC_Func_Display_Review_ESC_Reinforce(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_SUCCESS;
	int		inCnt = 0;
	int		inChoice = 0;
	int		inTouchSensorFunc = _Touch_NEWUI_REVIEW_TOTAL_;
	int		inSaleUploadCnt = 0, inRefundUploadCnt = 0, inSalePaperCnt = 0, inRefundPaperCnt = 0; 
	long		lnSaleUploadAmt = 0, lnRefundUploadAmt = 0, lnSalePaperAmt = 0, lnRefundPaperAmt = 0;
	long		lnAmt = 0;
	char		szTemplate1[44 + 1] = {0};
	char		szTemplate2[44 + 1] = {0};
	char		szDispBuffer1[44 + 1] = {0};
	char		szDispBuffer2[44 + 1] = {0};
	char		szFuncEnable[2 + 1] = {0};
	unsigned char	uszKey = 0x00;
	
	/* ESC沒開直接跳走 */
	memset(szFuncEnable, 0x00, sizeof(szFuncEnable));
	inGetESCMode(szFuncEnable);
	if (memcmp(szFuncEnable, "Y", strlen("Y")) != 0)
	{
		return (VS_SUCCESS);
	}
	
	/* 讀交易資料，並放交易查詢Title */
	/* Sale已上傳 */
	if (inBATCH_Get_ESC_Upload_Count_Flow(pobTran, _TN_BATCH_TABLE_, _ESC_REINFORCE_TXNCODE_SALE_, VS_FALSE, &inSaleUploadCnt, &lnSaleUploadAmt) != VS_SUCCESS)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "ESC COUNT SQLite read fail.");
		}

	}

	/* Refund已上傳 */
	if (inBATCH_Get_ESC_Upload_Count_Flow(pobTran, _TN_BATCH_TABLE_, _ESC_REINFORCE_TXNCODE_REFUND_, VS_FALSE, &inRefundUploadCnt, &lnRefundUploadAmt) != VS_SUCCESS)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "ESC COUNT SQLite read fail.");
		}

	}

	/* Sale出紙本 */
	if (inBATCH_Get_ESC_Upload_Count_Flow(pobTran, _TN_BATCH_TABLE_, _ESC_REINFORCE_TXNCODE_SALE_, VS_TRUE, &inSalePaperCnt, &lnSalePaperAmt) != VS_SUCCESS)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "ESC COUNT SQLite read fail.");
		}

	}

	/* Refund出紙本 */
	if (inBATCH_Get_ESC_Upload_Count_Flow(pobTran, _TN_BATCH_TABLE_, _ESC_REINFORCE_TXNCODE_REFUND_, VS_TRUE, &inRefundPaperCnt, &lnRefundPaperAmt) != VS_SUCCESS)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "ESC COUNT SQLite read fail.");
		}

	}
	
	inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
	inDISP_PutGraphic(_REVIEW_TOTAL_ESC_REINFORCE_, 0, _COORDINATE_Y_LINE_8_4_);
	
	/* 銷售已上傳筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	inCnt = inSaleUploadCnt;
	sprintf(szTemplate1, "%03d", inCnt);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 7);

	/* 銷售已上傳金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	lnAmt = lnSaleUploadAmt;
	if (lnAmt < 100000000)
	{
		sprintf(szTemplate2, "%01ld", lnAmt);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01ld", lnAmt);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}

	/* 銷售未上傳筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	inCnt = inSalePaperCnt;
	sprintf(szTemplate1, "%03d", inCnt);
	sprintf(szDispBuffer2, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 7);

	/* 銷售未上傳金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	lnAmt = lnSalePaperAmt;
	if (lnAmt < 100000000)
	{
		sprintf(szTemplate2, "%01ld", lnAmt);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01ld", lnAmt);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}

	/* 退貨已上傳筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	inCnt = inRefundUploadCnt;
	sprintf(szTemplate1, "%03d", inCnt);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 7);
	
	/* 退貨已上傳金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	lnAmt = lnRefundUploadAmt;
	if (lnAmt < 100000000)
	{
		sprintf(szTemplate2, "%01ld", lnAmt);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01ld", lnAmt);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}

	/* 退貨未上傳筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	inCnt = inRefundPaperCnt;
	sprintf(szTemplate1, "%03d", inCnt);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_7_, _COLOR_BLACK_,_COLOR_WHITE_, 7);

	/* 退貨未上傳金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	lnAmt = lnRefundPaperAmt;
	if (lnAmt < 100000000)
	{
		sprintf(szTemplate2, "%01ld", lnAmt);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_7_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01ld", lnAmt);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_7_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}
	
	uszKey = 0x00;
	inTouchSensorFunc = _Touch_NEWUI_REVIEW_TOTAL_;
	inDISP_Timer_Start(_TIMER_NEXSYS_1_, _EDC_TIMEOUT_);
	
	while (1)
	{
		inChoice = inDisTouch_TouchSensor_Click_Slide(inTouchSensorFunc);
		uszKey = uszKBD_Key();
		
		/* Timeout */
		if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
		{
			uszKey = _KEY_TIMEOUT_;
		}

		if (inChoice == _NEWUI_REVIEW_TOTAL_Touch_RETURN_IDLE_BUTTON_	||
		    uszKey == _KEY_ENTER_					|| 
		    uszKey == _KEY_CANCEL_					||
		    uszKey == _KEY_TIMEOUT_)
		{
			inRetVal = VS_SUCCESS;
			break;
		}
		else if (inChoice == _NEWUI_REVIEW_TOTAL_Touch_LAST_PAGE_BUTTON_	||
			 uszKey == _KEY_CLEAR_)
		{
			inRetVal = VS_LAST_PAGE;
			pobTran->srBRec.inHDTIndex = -1;
			break;
		}
	}
	/* 清空Touch資料 */
	inDisTouch_Flush_TouchFile();
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Decide_Display_Idle_Image
Date&Time       :2018/1/23 下午 5:38
Describe        :信用卡:70 * 48 票證:70 * 48
*/
int inNCCC_Func_Decide_Display_Idle_Image()
{
	int		inCreditIndex = 0;
	int		inMobileIndex = 0;
	int		inTicketIndex = 0;
	int		inCreditLine1 = 0;
	int		inCreditLine2 = 0;
	int		inMobileLine1 = 0;	/* 行動支付 */
	int		inTicketLine1 = 0;
	int		inTicketLine2 = 0;
	int		inWaveImageLine1 = 0;	/* 座標值 */
	int		inWaveCalLine = 0;	/* 算在第幾行，而不是座標 */
	int		inLOGONum = 0;
	int		inTempLinePos[5] = {0};
	char		szFESMode[2 + 1] = {0};
	char		szPic[9][100 + 1] = {};
	char		szPic_Mobile[3][100 + 1] = {};
	char		szPic_Ticket[4][100 + 1] = {};
	char		szFunEnable[2 + 1] = {0};
	char		szFunEnable2[2 + 1] = {0};
	char		szTMSOK[2 + 1] = {0};
	char		szCustomerIndicator[3 + 1] = {0};
	char		szDEMOMode[2 + 1] = {0};
	char		szLOGONum[4 + 1] = {0};
	char		szAddPic[100 + 1] = {0};
        unsigned char	uszCardLogoNotDisplayBit = VS_FALSE;
	unsigned char	uszCreditDispWithMobileBit = VS_FALSE;
	
	memset(szFESMode, 0x00, sizeof(szFESMode));
	inGetNCCCFESMode(szFESMode);
	memset(szTMSOK, 0x00, sizeof(szTMSOK));
	inGetTMSOK(szTMSOK);
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	
	inDISP_ClearAll();
	if (ginMachineType == _CASTLE_TYPE_MP200_)
	{
		inDISP_PutGraphic(_MENU_HOST_1099_NEXSYS_BIG_, 0,  _COORDINATE_Y_LINE_16_2_);
	}
	else if (ginMachineType == _CASTLE_TYPE_V3UL_)
	{
		inFunc_Display_LOGO(0,  _COORDINATE_Y_LINE_16_2_);				/* 第一層顯示 LOGO */
	}
	else
	{
		if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_098_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)     ||
                    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_105_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_))  
                {
			inDISP_PutGraphic(_TOUCH_NEWUI_IDLE_MCDONALDS_, 0,  _COORDINATE_Y_LINE_8_1_);
                        /* 客製化098，大大的M，不顯示感應支援卡種 */
                        uszCardLogoNotDisplayBit = VS_TRUE;
		}
		
		inFunc_Display_LOGO(0,  _COORDINATE_Y_LINE_16_2_);				/* 第一層顯示 LOGO */
	}
	
	
	if (memcmp(szTMSOK, "Y", strlen("Y")) == 0 && uszCardLogoNotDisplayBit == VS_FALSE)
	{
		if (ginMachineType == _CASTLE_TYPE_MP200_)
		{
			memset(szPic, 0x00, sizeof(szPic));

			/* 順序為VISA、MASTERCARD、JCB、UNIONPAY、AE、DISCOVER、SMARTPAY */
			/* VISA */
			memset(szFunEnable, 0x00, sizeof(szFunEnable));
			inGetVISAPaywaveEnable(szFunEnable);
			if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
			{
				memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_VISA_BIG_, strlen(_MENU_CARD_LOGO_VISA_BIG_));
				inCreditIndex++;
			}

			/* MASTERCARD */
			memset(szFunEnable, 0x00, sizeof(szFunEnable));
			inGetMCPaypassEnable(szFunEnable);
			if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
			{
				memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_MASTERCARD_BIG_, strlen(_MENU_CARD_LOGO_MASTERCARD_BIG_));
				inCreditIndex++;
			}

			/* JCB */
			memset(szFunEnable, 0x00, sizeof(szFunEnable));
			inGetJCBJspeedyEnable(szFunEnable);
			if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
			{
				memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_JCB_BIG_, strlen(_MENU_CARD_LOGO_JCB_BIG_));
				inCreditIndex++;
			}

			/* UnionPay */
			memset(szFunEnable, 0x00, sizeof(szFunEnable));
			inGetCUPContactlessEnable(szFunEnable);
			memset(szFunEnable2, 0x00, sizeof(szFunEnable2));
			inGetCUPFuncEnable(szFunEnable2);
			if ((memcmp(szFunEnable, "Y", strlen("Y")) == 0) && (memcmp(szFunEnable2, "Y", strlen("Y")) == 0))
			{
				memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_CUP_BIG_, strlen(_MENU_CARD_LOGO_CUP_BIG_));
				inCreditIndex++;
			}

			/* AE */
			memset(szFunEnable, 0x00, sizeof(szFunEnable));
			inGetAMEXContactlessEnable(szFunEnable);
			if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
			{
				memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_AMEX_BIG_, strlen(_MENU_CARD_LOGO_AMEX_BIG_));
				inCreditIndex++;
			}

			/* DISCOVER */
			memset(szFunEnable, 0x00, sizeof(szFunEnable));
			inGetDFS_Contactless_Enable(szFunEnable);
			if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
			{
				/* DINERS */
				memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_DINERS_BIG_, strlen(_MENU_CARD_LOGO_DINERS_BIG_));
				inCreditIndex++;

				/* DISCOVER */
				memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_DISCOVER_BIG_, strlen(_MENU_CARD_LOGO_DISCOVER_BIG_));
				inCreditIndex++;
			}

			/* SMARTPAY */
			memset(szFunEnable, 0x00, sizeof(szFunEnable));
			inGetSmartPayContactlessEnable(szFunEnable);
			memset(szFunEnable2, 0x00, sizeof(szFunEnable2));
			inGetFiscFuncEnable(szFunEnable2);
			if ((memcmp(szFunEnable, "Y", strlen("Y")) == 0) && (memcmp(szFunEnable2, "Y", strlen("Y")) == 0))
			{
				memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_SMARTPAY_BIG_, strlen(_MENU_CARD_LOGO_SMARTPAY_BIG_));
				inCreditIndex++;
			}

//			/* 行動支付業者和電票業者之LOGO順序 */
//			/* ApplePay、GooglePay、SamsungPay、IPASS、ECC、ICASH */
//			/* 目前沒有行動支付業者的開關，直接加三 */
//			memset(szFunEnable, 0x00, sizeof(szFunEnable));
//			inGetContactlessEnable(szFunEnable);
//			if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
//			{
//				/* APPLEPAY */
//				memcpy(&szPic_Ticket[inTicketIndex][0], _MENU_CARD_LOGO_APPLEPAY_BIG_, strlen(_MENU_CARD_LOGO_APPLEPAY_BIG_));
//				inTicketIndex++;
//				/* GOOLEPAY */
//				memcpy(&szPic_Ticket[inTicketIndex][0], _MENU_CARD_LOGO_GOOGLEPAY_BIG_, strlen(_MENU_CARD_LOGO_GOOGLEPAY_BIG_));
//				inTicketIndex++;
//				/* SAMSUNGPAY*/
//				memcpy(&szPic_Ticket[inTicketIndex][0], _MENU_CARD_LOGO_SAMSUNGPAY_BIG_, strlen(_MENU_CARD_LOGO_SAMSUNGPAY_BIG_));
//				inTicketIndex++;
//			}
//
//			/* IPASS */
//			inLoadTDTRec(_TDT_INDEX_00_IPASS_);
//			memset(szFunEnable, 0x00, sizeof(szFunEnable));
//			inGetTicket_HostEnable(szFunEnable);
//			if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
//			{
//				memcpy(&szPic_Ticket[inTicketIndex][0], _MENU_CARD_LOGO_IPASS_BIG_, strlen(_MENU_CARD_LOGO_IPASS_BIG_));
//				inTicketIndex++;
//			}
//
//			/* ECC */
//			inLoadTDTRec(_TDT_INDEX_01_ECC_);
//			memset(szFunEnable, 0x00, sizeof(szFunEnable));
//			inGetTicket_HostEnable(szFunEnable);
//			if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
//			{
//				memcpy(&szPic_Ticket[inTicketIndex][0], _MENU_CARD_LOGO_ECC_BIG_, strlen(_MENU_CARD_LOGO_ECC_BIG_));
//				inTicketIndex++;
//			}
//
//			/* ICASH */
//			inLoadTDTRec(_TDT_INDEX_02_ICASH_);
//			memset(szFunEnable, 0x00, sizeof(szFunEnable));
//			inGetTicket_HostEnable(szFunEnable);
//			if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
//			{
//				memcpy(&szPic_Ticket[inTicketIndex][0], _MENU_CARD_LOGO_ICASH_BIG_, strlen(_MENU_CARD_LOGO_ICASH_BIG_));
//				inTicketIndex++;
//			}
//

			/* 決定圖片放置行數 */
			inCreditLine1 = _COORDINATE_Y_CTLS_LOGO_BIG_Line_1_;
			inCreditLine2 = _COORDINATE_Y_CTLS_LOGO_BIG_Line_2_;
			/* 少於等於5個LOGO時，只有一行 */
			if (inCreditIndex <= 5)
			{
				inTicketLine1 = _COORDINATE_Y_CTLS_LOGO_BIG_Line_2_;
				inTicketLine2 = _COORDINATE_Y_CTLS_LOGO_BIG_Line_3_;
			}
			else
			{
				inTicketLine1 = _COORDINATE_Y_CTLS_LOGO_BIG_Line_3_;
				inTicketLine2 = _COORDINATE_Y_CTLS_LOGO_BIG_Line_4_;
			}

			/* 信用卡只有一張圖 */
			if (inCreditIndex == 1)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inCreditLine1);
				}
			}
			else if (inCreditIndex == 2)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine1);
				}
			}
			else if (inCreditIndex == 3)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_3_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_3_3_, inCreditLine1);
				}
			}
			else if (inCreditIndex == 4)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_4_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine1);
				}

				if (strlen(&szPic[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[3][0], _COORDINATE_X_CTLS_LOGO_4_4_, inCreditLine1);
				}
			}
			else if (inCreditIndex == 5)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_5_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_5_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_5_3_, inCreditLine1);
				}

				if (strlen(&szPic[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[3][0], _COORDINATE_X_CTLS_LOGO_5_4_, inCreditLine1);
				}

				if (strlen(&szPic[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[4][0], _COORDINATE_X_CTLS_LOGO_5_5_, inCreditLine1);
				}

			}
			else if (inCreditIndex == 6)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_3_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_3_3_, inCreditLine1);
				}

				if (strlen(&szPic[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[3][0], _COORDINATE_X_CTLS_LOGO_3_1_, inCreditLine2);
				}

				if (strlen(&szPic[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[4][0], _COORDINATE_X_CTLS_LOGO_3_2_, inCreditLine2);
				}

				if (strlen(&szPic[5][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[5][0], _COORDINATE_X_CTLS_LOGO_3_3_, inCreditLine2);
				}

			}
			else if (inCreditIndex == 7)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_3_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_3_3_, inCreditLine1);
				}

				if (strlen(&szPic[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[3][0], _COORDINATE_X_CTLS_LOGO_4_1_, inCreditLine2);
				}

				if (strlen(&szPic[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[4][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine2);
				}

				if (strlen(&szPic[5][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[5][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine2);
				}

				if (strlen(&szPic[6][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[6][0], _COORDINATE_X_CTLS_LOGO_4_4_, inCreditLine2);
				}
			}
			else if (inCreditIndex == 8)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_4_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine1);
				}

				if (strlen(&szPic[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[3][0], _COORDINATE_X_CTLS_LOGO_4_4_, inCreditLine1);
				}

				if (strlen(&szPic[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[4][0], _COORDINATE_X_CTLS_LOGO_4_1_, inCreditLine2);
				}

				if (strlen(&szPic[5][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[5][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine2);
				}

				if (strlen(&szPic[6][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[6][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine2);
				}
				if (strlen(&szPic[7][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[7][0], _COORDINATE_X_CTLS_LOGO_4_4_, inCreditLine2);
				}
			}

			/* 票證只有一張圖 */
			if (inTicketIndex == 1)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inTicketLine1);
				}
			}
			else if (inTicketIndex == 2)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_4_2_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[1][0], _COORDINATE_X_CTLS_LOGO_4_3_, inTicketLine1);
				}
			}
			else if (inTicketIndex == 3)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[1][0], _COORDINATE_X_CTLS_LOGO_3_2_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[2][0], _COORDINATE_X_CTLS_LOGO_3_3_, inTicketLine1);
				}
			}
			else if (inTicketIndex == 4)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_4_1_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[1][0], _COORDINATE_X_CTLS_LOGO_4_2_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[2][0], _COORDINATE_X_CTLS_LOGO_4_3_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[3][0], _COORDINATE_X_CTLS_LOGO_4_4_, inTicketLine1);
				}
			}
			else if (inTicketIndex == 5)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_5_1_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[1][0], _COORDINATE_X_CTLS_LOGO_5_2_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[2][0], _COORDINATE_X_CTLS_LOGO_5_3_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[3][0], _COORDINATE_X_CTLS_LOGO_5_4_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[4][0], _COORDINATE_X_CTLS_LOGO_5_5_, inTicketLine1);
				}

			}
			else if (inTicketIndex == 6)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[1][0], _COORDINATE_X_CTLS_LOGO_3_2_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[2][0], _COORDINATE_X_CTLS_LOGO_3_3_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[3][0], _COORDINATE_X_CTLS_LOGO_3_1_, inTicketLine2);
				}

				if (strlen(&szPic_Ticket[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[4][0], _COORDINATE_X_CTLS_LOGO_3_2_, inTicketLine2);
				}

				if (strlen(&szPic_Ticket[5][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[5][0], _COORDINATE_X_CTLS_LOGO_3_3_, inTicketLine2);
				}

			}
			else if (inTicketIndex == 7)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[1][0], _COORDINATE_X_CTLS_LOGO_3_2_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[2][0], _COORDINATE_X_CTLS_LOGO_3_3_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[3][0], _COORDINATE_X_CTLS_LOGO_4_1_, inTicketLine2);
				}

				if (strlen(&szPic_Ticket[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[4][0], _COORDINATE_X_CTLS_LOGO_4_2_, inTicketLine2);
				}

				if (strlen(&szPic_Ticket[5][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[5][0], _COORDINATE_X_CTLS_LOGO_4_3_, inTicketLine2);
				}

				if (strlen(&szPic_Ticket[6][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[6][0], _COORDINATE_X_CTLS_LOGO_4_4_, inTicketLine2);
				}
			}
		}
		else if (ginMachineType == _CASTLE_TYPE_V3UL_)
		{
			memset(szPic, 0x00, sizeof(szPic));

			/* 順序為VISA、MASTERCARD、JCB、UNIONPAY、AE、DISCOVER、SMARTPAY */
			/* VISA */
			memset(szFunEnable, 0x00, sizeof(szFunEnable));
			inGetVISAPaywaveEnable(szFunEnable);
			if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
			{
				memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_VISA_BIG_, strlen(_MENU_CARD_LOGO_VISA_BIG_));
				inCreditIndex++;
			}

			/* MASTERCARD */
			memset(szFunEnable, 0x00, sizeof(szFunEnable));
			inGetMCPaypassEnable(szFunEnable);
			if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
			{
				memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_MASTERCARD_BIG_, strlen(_MENU_CARD_LOGO_MASTERCARD_BIG_));
				inCreditIndex++;
			}

			/* JCB */
			memset(szFunEnable, 0x00, sizeof(szFunEnable));
			inGetJCBJspeedyEnable(szFunEnable);
			if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
			{
				memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_JCB_BIG_, strlen(_MENU_CARD_LOGO_JCB_BIG_));
				inCreditIndex++;
			}

			/* UnionPay */
			memset(szFunEnable, 0x00, sizeof(szFunEnable));
			inGetCUPContactlessEnable(szFunEnable);
			memset(szFunEnable2, 0x00, sizeof(szFunEnable2));
			inGetCUPFuncEnable(szFunEnable2);
			if ((memcmp(szFunEnable, "Y", strlen("Y")) == 0) && (memcmp(szFunEnable2, "Y", strlen("Y")) == 0))
			{
				memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_CUP_BIG_, strlen(_MENU_CARD_LOGO_CUP_BIG_));
				inCreditIndex++;
			}

			/* SMARTPAY */
			memset(szFunEnable, 0x00, sizeof(szFunEnable));
			inGetSmartPayContactlessEnable(szFunEnable);
			memset(szFunEnable2, 0x00, sizeof(szFunEnable2));
			inGetFiscFuncEnable(szFunEnable2);
			if ((memcmp(szFunEnable, "Y", strlen("Y")) == 0) && (memcmp(szFunEnable2, "Y", strlen("Y")) == 0))
			{
				memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_SMARTPAY_BIG_, strlen(_MENU_CARD_LOGO_SMARTPAY_BIG_));
				inCreditIndex++;
			}

			/* 決定圖片放置行數 */
			inCreditLine1 = _COORDINATE_Y_CTLS_LOGO_BIG_Line_1_;
			inCreditLine2 = _COORDINATE_Y_CTLS_LOGO_BIG_Line_2_;
			/* 少於等於5個LOGO時，只有一行 */
			if (inCreditIndex <= 5)
			{
				inTicketLine1 = _COORDINATE_Y_CTLS_LOGO_BIG_Line_2_;
				inTicketLine2 = _COORDINATE_Y_CTLS_LOGO_BIG_Line_3_;
			}
			else
			{
				inTicketLine1 = _COORDINATE_Y_CTLS_LOGO_BIG_Line_3_;
				inTicketLine2 = _COORDINATE_Y_CTLS_LOGO_BIG_Line_4_;
			}

			/* 信用卡只有一張圖 */
			if (inCreditIndex == 1)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inCreditLine1);
				}
			}
			else if (inCreditIndex == 2)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine1);
				}
			}
			else if (inCreditIndex == 3)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_3_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_3_3_, inCreditLine1);
				}
			}
			else if (inCreditIndex == 4)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_4_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine1);
				}

				if (strlen(&szPic[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[3][0], _COORDINATE_X_CTLS_LOGO_4_4_, inCreditLine1);
				}
			}
			else if (inCreditIndex == 5)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_5_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_5_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_5_3_, inCreditLine1);
				}

				if (strlen(&szPic[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[3][0], _COORDINATE_X_CTLS_LOGO_5_4_, inCreditLine1);
				}

				if (strlen(&szPic[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[4][0], _COORDINATE_X_CTLS_LOGO_5_5_, inCreditLine1);
				}

			}
			else if (inCreditIndex == 6)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_3_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_3_3_, inCreditLine1);
				}

				if (strlen(&szPic[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[3][0], _COORDINATE_X_CTLS_LOGO_3_1_, inCreditLine2);
				}

				if (strlen(&szPic[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[4][0], _COORDINATE_X_CTLS_LOGO_3_2_, inCreditLine2);
				}

				if (strlen(&szPic[5][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[5][0], _COORDINATE_X_CTLS_LOGO_3_3_, inCreditLine2);
				}

			}
			else if (inCreditIndex == 7)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_3_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_3_3_, inCreditLine1);
				}

				if (strlen(&szPic[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[3][0], _COORDINATE_X_CTLS_LOGO_4_1_, inCreditLine2);
				}

				if (strlen(&szPic[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[4][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine2);
				}

				if (strlen(&szPic[5][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[5][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine2);
				}

				if (strlen(&szPic[6][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[6][0], _COORDINATE_X_CTLS_LOGO_4_4_, inCreditLine2);
				}
			}
			else if (inCreditIndex == 8)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_4_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine1);
				}

				if (strlen(&szPic[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[3][0], _COORDINATE_X_CTLS_LOGO_4_4_, inCreditLine1);
				}

				if (strlen(&szPic[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[4][0], _COORDINATE_X_CTLS_LOGO_4_1_, inCreditLine2);
				}

				if (strlen(&szPic[5][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[5][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine2);
				}

				if (strlen(&szPic[6][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[6][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine2);
				}
				if (strlen(&szPic[7][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[7][0], _COORDINATE_X_CTLS_LOGO_4_4_, inCreditLine2);
				}
			}

			/* 票證只有一張圖 */
			if (inTicketIndex == 1)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inTicketLine1);
				}
			}
			else if (inTicketIndex == 2)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_4_2_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[1][0], _COORDINATE_X_CTLS_LOGO_4_3_, inTicketLine1);
				}
			}
			else if (inTicketIndex == 3)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[1][0], _COORDINATE_X_CTLS_LOGO_3_2_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[2][0], _COORDINATE_X_CTLS_LOGO_3_3_, inTicketLine1);
				}
			}
			else if (inTicketIndex == 4)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_4_1_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[1][0], _COORDINATE_X_CTLS_LOGO_4_2_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[2][0], _COORDINATE_X_CTLS_LOGO_4_3_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[3][0], _COORDINATE_X_CTLS_LOGO_4_4_, inTicketLine1);
				}
			}
			else if (inTicketIndex == 5)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_5_1_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[1][0], _COORDINATE_X_CTLS_LOGO_5_2_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[2][0], _COORDINATE_X_CTLS_LOGO_5_3_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[3][0], _COORDINATE_X_CTLS_LOGO_5_4_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[4][0], _COORDINATE_X_CTLS_LOGO_5_5_, inTicketLine1);
				}

			}
			else if (inTicketIndex == 6)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[1][0], _COORDINATE_X_CTLS_LOGO_3_2_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[2][0], _COORDINATE_X_CTLS_LOGO_3_3_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[3][0], _COORDINATE_X_CTLS_LOGO_3_1_, inTicketLine2);
				}

				if (strlen(&szPic_Ticket[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[4][0], _COORDINATE_X_CTLS_LOGO_3_2_, inTicketLine2);
				}

				if (strlen(&szPic_Ticket[5][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[5][0], _COORDINATE_X_CTLS_LOGO_3_3_, inTicketLine2);
				}

			}
			else if (inTicketIndex == 7)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[1][0], _COORDINATE_X_CTLS_LOGO_3_2_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[2][0], _COORDINATE_X_CTLS_LOGO_3_3_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[3][0], _COORDINATE_X_CTLS_LOGO_4_1_, inTicketLine2);
				}

				if (strlen(&szPic_Ticket[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[4][0], _COORDINATE_X_CTLS_LOGO_4_2_, inTicketLine2);
				}

				if (strlen(&szPic_Ticket[5][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[5][0], _COORDINATE_X_CTLS_LOGO_4_3_, inTicketLine2);
				}

				if (strlen(&szPic_Ticket[6][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[6][0], _COORDINATE_X_CTLS_LOGO_4_4_, inTicketLine2);
				}
			}
		}
		else
		{
			inTempLinePos[0] = _COORDINATE_Y_CTLS_LOGO_Line_1_;
			inTempLinePos[1] = _COORDINATE_Y_CTLS_LOGO_Line_2_;
			inTempLinePos[2] = _COORDINATE_Y_CTLS_LOGO_Line_3_;
			inTempLinePos[3] = _COORDINATE_Y_CTLS_LOGO_Line_4_;
			inTempLinePos[4] = _COORDINATE_Y_CTLS_LOGO_Line_5_;
			
			/* 0n-Us 084和087都不顯示信用卡組織Logo圖，所以和mpas放在一起 */
			if (memcmp(szFESMode, _NCCC_04_MPAS_MODE_, strlen(_NCCC_04_MPAS_MODE_)) == 0				||
			    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_084_ON_US_, _CUSTOMER_INDICATOR_SIZE_)		||
			    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_087_ON_US_NO_ID_, _CUSTOMER_INDICATOR_SIZE_))
			{
				memset(szPic_Mobile, 0x00, sizeof(szPic_Mobile));
				
				/* 行動支付業者和電票業者之LOGO順序 */
				/* ApplePay、GooglePay、SamsungPay、IPASS、ECC、ICASH */
				/* 目前沒有行動支付業者的開關，直接加三 */
				memset(szFunEnable, 0x00, sizeof(szFunEnable));
				inGetContactlessEnable(szFunEnable);
				if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
				{
					/* APPLEPAY */
					memcpy(&szPic_Mobile[inMobileIndex][0], _MENU_CARD_LOGO_APPLEPAY_, strlen(_MENU_CARD_LOGO_APPLEPAY_));
					inMobileIndex++;
					/* GOOLEPAY */
					memcpy(&szPic_Mobile[inMobileIndex][0], _MENU_CARD_LOGO_GOOGLEPAY_, strlen(_MENU_CARD_LOGO_GOOGLEPAY_));
					inMobileIndex++;
					/* SAMSUNGPAY*/
					memcpy(&szPic_Mobile[inMobileIndex][0], _MENU_CARD_LOGO_SAMSUNGPAY_, strlen(_MENU_CARD_LOGO_SAMSUNGPAY_));
					inMobileIndex++;
				}
				
				memset(szPic_Ticket, 0x00, sizeof(szPic_Ticket));

				/* IPASS */
				inLoadTDTRec(_TDT_INDEX_00_IPASS_);
				memset(szFunEnable, 0x00, sizeof(szFunEnable));
				inGetTicket_HostEnable(szFunEnable);
				if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
				{
					memcpy(&szPic_Ticket[inTicketIndex][0], _MENU_CARD_LOGO_IPASS_, strlen(_MENU_CARD_LOGO_IPASS_));
					inTicketIndex++;
				}

				/* ECC */
				inLoadTDTRec(_TDT_INDEX_01_ECC_);
				memset(szFunEnable, 0x00, sizeof(szFunEnable));
				inGetTicket_HostEnable(szFunEnable);
				if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
				{
					memcpy(&szPic_Ticket[inTicketIndex][0], _MENU_CARD_LOGO_ECC_, strlen(_MENU_CARD_LOGO_ECC_));
					inTicketIndex++;
				}

				/* ICASH */
				inLoadTDTRec(_TDT_INDEX_02_ICASH_);
				memset(szFunEnable, 0x00, sizeof(szFunEnable));
				inGetTicket_HostEnable(szFunEnable);
				if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
				{
					memcpy(&szPic_Ticket[inTicketIndex][0], _MENU_CARD_LOGO_ICASH_, strlen(_MENU_CARD_LOGO_ICASH_));
					inTicketIndex++;
				}
				
				/* 決定圖片放置行數 */
				/* 信用卡0個，行動支付第一行 */
				/* 信用卡1~5個，行動支付第二行 */
				/* 信用卡大於5個，行動支付第三行 */
				if (inCreditIndex == 0)
				{
					/* 即使沒信用卡也留空白 */
					inWaveCalLine += 1;
				}
				else if (inCreditIndex <= 5)
				{
					inCreditLine1 = inTempLinePos[inWaveCalLine];
					inWaveCalLine += 1;
				}
				else
				{
					inCreditLine1 = inTempLinePos[inWaveCalLine];
					inCreditLine2 = inTempLinePos[inWaveCalLine + 1];
					inWaveCalLine += 2;
				}
				
				/* 行動支付 */
				if (inMobileIndex == 0)
				{
					inWaveCalLine += 0;
				}
				/* 目前行動支付不超過四個，不會超過一行 */
				else
				{
					inMobileLine1 = inTempLinePos[inWaveCalLine];
					inWaveCalLine += 1;
				}
				
				if (inTicketIndex == 0)
				{
					inWaveCalLine += 0;
				}
				/* 目前票證不超過四個，不會超過一行 */
				else
				{
					inTicketLine1 = inTempLinePos[inWaveCalLine];
					inWaveCalLine += 1;
				}
			}
			else
			{

				memset(szPic, 0x00, sizeof(szPic));

				/* 順序為TWIN、VISA、MASTERCARD、JCB、UNIONPAY、AE、DISCOVER、SMARTPAY */
				/* TWIN */
				memset(szFunEnable, 0x00, sizeof(szFunEnable));
				inGetNCCC_Contactless_Enable(szFunEnable);
				if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
				{
					memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_TWIN_, _MENU_CARD_LOGO_TWIN_LEN_);
					inCreditIndex++;
				}
				
				/* VISA */
				memset(szFunEnable, 0x00, sizeof(szFunEnable));
				inGetVISAPaywaveEnable(szFunEnable);
				if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
				{
					memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_VISA_, strlen(_MENU_CARD_LOGO_VISA_));
					inCreditIndex++;
				}

				/* MASTERCARD */
				memset(szFunEnable, 0x00, sizeof(szFunEnable));
				inGetMCPaypassEnable(szFunEnable);
				if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
				{
					memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_MASTERCARD_, strlen(_MENU_CARD_LOGO_MASTERCARD_));
					inCreditIndex++;
				}

				/* JCB */
				memset(szFunEnable, 0x00, sizeof(szFunEnable));
				inGetJCBJspeedyEnable(szFunEnable);
				if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
				{
					memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_JCB_, strlen(_MENU_CARD_LOGO_JCB_));
					inCreditIndex++;
				}

				/* UnionPay */
				memset(szFunEnable, 0x00, sizeof(szFunEnable));
				inGetCUPContactlessEnable(szFunEnable);
				memset(szFunEnable2, 0x00, sizeof(szFunEnable2));
				inGetCUPFuncEnable(szFunEnable2);
				if ((memcmp(szFunEnable, "Y", strlen("Y")) == 0) && (memcmp(szFunEnable2, "Y", strlen("Y")) == 0))
				{
					memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_CUP_, strlen(_MENU_CARD_LOGO_CUP_));
					inCreditIndex++;
				}

				/* AE */
				memset(szFunEnable, 0x00, sizeof(szFunEnable));
				inGetAMEXContactlessEnable(szFunEnable);
				if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
				{
					memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_AMEX_, strlen(_MENU_CARD_LOGO_AMEX_));
					inCreditIndex++;
				}

				/* DISCOVER */
				memset(szFunEnable, 0x00, sizeof(szFunEnable));
				inGetDFS_Contactless_Enable(szFunEnable);
				if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
				{
					/* DINERS */
					memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_DINERS_, strlen(_MENU_CARD_LOGO_DINERS_));
					inCreditIndex++;

					/* DISCOVER */
					memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_DISCOVER_, strlen(_MENU_CARD_LOGO_DISCOVER_));
					inCreditIndex++;
				}

				/* SMARTPAY */
				memset(szFunEnable, 0x00, sizeof(szFunEnable));
				inGetSmartPayContactlessEnable(szFunEnable);
				memset(szFunEnable2, 0x00, sizeof(szFunEnable2));
				inGetFiscFuncEnable(szFunEnable2);
				if ((memcmp(szFunEnable, "Y", strlen("Y")) == 0) && (memcmp(szFunEnable2, "Y", strlen("Y")) == 0))
				{
					memcpy(&szPic[inCreditIndex][0], _MENU_CARD_LOGO_SMARTPAY_, strlen(_MENU_CARD_LOGO_SMARTPAY_));
					inCreditIndex++;
				}

				/* 行動支付業者和電票業者之LOGO順序 */
				/* ApplePay、GooglePay、SamsungPay、IPASS、ECC、ICASH */
				/* 目前沒有行動支付業者的開關，直接加三 */
				memset(szPic_Mobile, 0x00, sizeof(szPic_Mobile));
				memset(szFunEnable, 0x00, sizeof(szFunEnable));
				inGetContactlessEnable(szFunEnable);
				if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
				{
					/* APPLEPAY */
					memcpy(&szPic_Mobile[inMobileIndex][0], _MENU_CARD_LOGO_APPLEPAY_, strlen(_MENU_CARD_LOGO_APPLEPAY_));
					inMobileIndex++;
					/* GOOLEPAY */
					memcpy(&szPic_Mobile[inMobileIndex][0], _MENU_CARD_LOGO_GOOGLEPAY_, strlen(_MENU_CARD_LOGO_GOOGLEPAY_));
					inMobileIndex++;
					/* SAMSUNGPAY*/
					memcpy(&szPic_Mobile[inMobileIndex][0], _MENU_CARD_LOGO_SAMSUNGPAY_, strlen(_MENU_CARD_LOGO_SAMSUNGPAY_));
					inMobileIndex++;
				}
				
				memset(szPic_Ticket, 0x00, sizeof(szPic_Ticket));

				/* IPASS */
				inLoadTDTRec(_TDT_INDEX_00_IPASS_);
				memset(szFunEnable, 0x00, sizeof(szFunEnable));
				inGetTicket_HostEnable(szFunEnable);
				if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
				{
					memcpy(&szPic_Ticket[inTicketIndex][0], _MENU_CARD_LOGO_IPASS_, strlen(_MENU_CARD_LOGO_IPASS_));
					inTicketIndex++;
				}

				/* ECC */
				inLoadTDTRec(_TDT_INDEX_01_ECC_);
				memset(szFunEnable, 0x00, sizeof(szFunEnable));
				inGetTicket_HostEnable(szFunEnable);
				if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
				{
					memcpy(&szPic_Ticket[inTicketIndex][0], _MENU_CARD_LOGO_ECC_, strlen(_MENU_CARD_LOGO_ECC_));
					inTicketIndex++;
				}

				/* ICASH */
				inLoadTDTRec(_TDT_INDEX_02_ICASH_);
				memset(szFunEnable, 0x00, sizeof(szFunEnable));
				inGetTicket_HostEnable(szFunEnable);
				if (memcmp(szFunEnable, "Y", strlen("Y")) == 0)
				{
					memcpy(&szPic_Ticket[inTicketIndex][0], _MENU_CARD_LOGO_ICASH_, strlen(_MENU_CARD_LOGO_ICASH_));
					inTicketIndex++;
				}

				/* 決定圖片放置行數 */
				/* 信用卡0個，行動支付第一行 */
				/* 信用卡1~5個，行動支付第二行 */
				/* 信用卡大於5個，行動支付第三行 */

				if (inCreditIndex == 0)
				{
					/* 即使沒信用卡也留空白 */
					inWaveCalLine += 1;
				}
				else if (inCreditIndex <= 5)
				{
					inCreditLine1 = inTempLinePos[inWaveCalLine];
					inWaveCalLine += 1;
				}
				else
				{
					inCreditLine1 = inTempLinePos[inWaveCalLine];
					inCreditLine2 = inTempLinePos[inWaveCalLine + 1];
					inWaveCalLine += 2;
				}
				
				/* 行動支付 */
				if (inMobileIndex == 0)
				{
					inWaveCalLine += 0;
				}
				/* 目前行動支付不超過四個，不會超過一行 */
				else
				{
					inMobileLine1 = inTempLinePos[inWaveCalLine];
					inWaveCalLine += 1;
				}
				
				if (inTicketIndex == 0)
				{
					inWaveCalLine += 0;
				}
				/* 目前票證不超過四個，不會超過一行 */
				else
				{
					inTicketLine1 = inTempLinePos[inWaveCalLine];
					inWaveCalLine += 1;
				}
			}/* FESMODE */
			
			/* 信用卡只有一張圖 */
			if (inCreditIndex == 1)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inCreditLine1);
				}
			}
			else if (inCreditIndex == 2)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine1);
				}
			}
			else if (inCreditIndex == 3)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_3_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_3_3_, inCreditLine1);
				}
			}
			else if (inCreditIndex == 4)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_4_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine1);
				}

				if (strlen(&szPic[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[3][0], _COORDINATE_X_CTLS_LOGO_4_4_, inCreditLine1);
				}
			}
			else if (inCreditIndex == 5)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_4_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine1);
				}

				if (strlen(&szPic[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[3][0], _COORDINATE_X_CTLS_LOGO_4_4_, inCreditLine1);
				}
				
				uszCreditDispWithMobileBit = VS_TRUE;
				memset(szAddPic, 0x00, sizeof(szAddPic));
				strcpy(szAddPic, &szPic[4][0]);
			}
			else if (inCreditIndex == 6)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_4_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine1);
				}

				if (strlen(&szPic[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[3][0], _COORDINATE_X_CTLS_LOGO_4_4_, inCreditLine1);
				}

				if (strlen(&szPic[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[4][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine2);
				}

				if (strlen(&szPic[5][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[5][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine2);
				}
			}
			else if (inCreditIndex == 7)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_4_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine1);
				}

				if (strlen(&szPic[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[3][0], _COORDINATE_X_CTLS_LOGO_4_4_, inCreditLine1);
				}

				if (strlen(&szPic[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[4][0], _COORDINATE_X_CTLS_LOGO_3_1_, inCreditLine2);
				}

				if (strlen(&szPic[5][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[5][0], _COORDINATE_X_CTLS_LOGO_3_2_, inCreditLine2);
				}
				
				if (strlen(&szPic[6][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[6][0], _COORDINATE_X_CTLS_LOGO_3_3_, inCreditLine2);
				}
			}
			else if (inCreditIndex == 8)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_4_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine1);
				}

				if (strlen(&szPic[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[3][0], _COORDINATE_X_CTLS_LOGO_4_4_, inCreditLine1);
				}

				if (strlen(&szPic[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[4][0], _COORDINATE_X_CTLS_LOGO_4_1_, inCreditLine2);
				}

				if (strlen(&szPic[5][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[5][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine2);
				}

				if (strlen(&szPic[6][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[6][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine2);
				}
				
				if (strlen(&szPic[7][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[7][0], _COORDINATE_X_CTLS_LOGO_4_4_, inCreditLine2);
				}
			}
			else if (inCreditIndex == 9)
			{
				if (strlen(&szPic[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[0][0], _COORDINATE_X_CTLS_LOGO_4_1_, inCreditLine1);
				}

				if (strlen(&szPic[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[1][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine1);
				}

				if (strlen(&szPic[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[2][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine1);
				}

				if (strlen(&szPic[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[3][0], _COORDINATE_X_CTLS_LOGO_4_4_, inCreditLine1);
				}

				if (strlen(&szPic[4][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[4][0], _COORDINATE_X_CTLS_LOGO_4_1_, inCreditLine2);
				}

				if (strlen(&szPic[5][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[5][0], _COORDINATE_X_CTLS_LOGO_4_2_, inCreditLine2);
				}

				if (strlen(&szPic[6][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[6][0], _COORDINATE_X_CTLS_LOGO_4_3_, inCreditLine2);
				}
				
				if (strlen(&szPic[7][0]) != 0)
				{
					inDISP_PutGraphic(&szPic[7][0], _COORDINATE_X_CTLS_LOGO_4_4_, inCreditLine2);
				}
				uszCreditDispWithMobileBit = VS_TRUE;
				memset(szAddPic, 0x00, sizeof(szAddPic));
				strcpy(szAddPic, &szPic[8][0]);
			}
			
			/* 行動支付同一列，優先放超過的信用卡LOGO，然後才是單獨的票證 */
			if (uszCreditDispWithMobileBit == VS_TRUE)
			{
				if (inMobileIndex == 1)
				{
					if (strlen(&szAddPic[0]) != 0)
					{
						inDISP_PutGraphic(&szAddPic[0], _COORDINATE_X_CTLS_LOGO_4_2_, inMobileLine1);
					}
					
					if (strlen(&szPic_Mobile[0][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[0][0], _COORDINATE_X_CTLS_LOGO_4_3_, inMobileLine1);
					}
				}
				else if (inMobileIndex == 2)
				{
					if (strlen(&szAddPic[0]) != 0)
					{
						inDISP_PutGraphic(&szAddPic[0], _COORDINATE_X_CTLS_LOGO_3_1_, inMobileLine1);
					}
					
					if (strlen(&szPic_Mobile[0][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[0][0], _COORDINATE_X_CTLS_LOGO_3_2_, inMobileLine1);
					}

					if (strlen(&szPic_Mobile[1][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[1][0], _COORDINATE_X_CTLS_LOGO_3_3_, inMobileLine1);
					}
				}
				else if (inMobileIndex == 3)
				{
					if (strlen(&szAddPic[0]) != 0)
					{
						inDISP_PutGraphic(&szAddPic[0], _COORDINATE_X_CTLS_LOGO_4_1_, inMobileLine1);
					}
					
					if (strlen(&szPic_Mobile[0][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[0][0], _COORDINATE_X_CTLS_LOGO_4_2_, inMobileLine1);
					}

					if (strlen(&szPic_Mobile[1][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[1][0], _COORDINATE_X_CTLS_LOGO_4_3_, inMobileLine1);
					}

					if (strlen(&szPic_Mobile[2][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[2][0], _COORDINATE_X_CTLS_LOGO_4_4_, inMobileLine1);
					}
				}
			}
			/* 票證只有一張圖的狀況，要和行動支付同一列*/
			else if (inTicketIndex == 1)
			{
				if (inMobileIndex == 1)
				{
					if (strlen(&szPic_Mobile[0][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[0][0], _COORDINATE_X_CTLS_LOGO_4_2_, inMobileLine1);
					}

					if (strlen(&szPic_Ticket[0][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_4_3_, inMobileLine1);
					}
				}
				else if (inMobileIndex == 2)
				{
					if (strlen(&szPic_Mobile[0][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inMobileLine1);
					}

					if (strlen(&szPic_Mobile[1][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[1][0], _COORDINATE_X_CTLS_LOGO_3_2_, inMobileLine1);
					}

					if (strlen(&szPic_Ticket[0][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_3_3_, inMobileLine1);
					}
				}
				else if (inMobileIndex == 3)
				{
					if (strlen(&szPic_Mobile[0][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[0][0], _COORDINATE_X_CTLS_LOGO_4_1_, inMobileLine1);
					}

					if (strlen(&szPic_Mobile[1][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[1][0], _COORDINATE_X_CTLS_LOGO_4_2_, inMobileLine1);
					}

					if (strlen(&szPic_Mobile[2][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[2][0], _COORDINATE_X_CTLS_LOGO_4_3_, inMobileLine1);
					}
					
					if (strlen(&szPic_Ticket[0][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_4_4_, inMobileLine1);
					}
				}
			}
			else
			{
				if (inMobileIndex == 1)
				{
					if (strlen(&szPic_Mobile[0][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inMobileLine1);
					}
				}
				else if (inMobileIndex == 2)
				{
					if (strlen(&szPic_Mobile[0][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[0][0], _COORDINATE_X_CTLS_LOGO_4_2_, inMobileLine1);
					}

					if (strlen(&szPic_Mobile[1][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[1][0], _COORDINATE_X_CTLS_LOGO_4_3_, inMobileLine1);
					}
				}
				else if (inMobileIndex == 3)
				{
					if (strlen(&szPic_Mobile[0][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inMobileLine1);
					}

					if (strlen(&szPic_Mobile[1][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[1][0], _COORDINATE_X_CTLS_LOGO_3_2_, inMobileLine1);
					}

					if (strlen(&szPic_Mobile[2][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Mobile[2][0], _COORDINATE_X_CTLS_LOGO_3_3_, inMobileLine1);
					}
				}
			}
			
			/* 票證只有一張圖 */
			if (inTicketIndex == 1)
			{
				if (inCreditIndex >= 9)
				{
					if (strlen(&szPic_Ticket[0][0]) != 0)
					{
						inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_3_2_, inTicketLine1);
					}
				}
				else
				{
					/* 只有一張圖且信用卡張數小於9，則票證LOGO在行動支付那一行顯示 */
				}
			}
			else if (inTicketIndex == 2)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_4_2_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[1][0], _COORDINATE_X_CTLS_LOGO_4_3_, inTicketLine1);
				}
			}
			else if (inTicketIndex == 3)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_3_1_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[1][0], _COORDINATE_X_CTLS_LOGO_3_2_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[2][0], _COORDINATE_X_CTLS_LOGO_3_3_, inTicketLine1);
				}
			}
			else if (inTicketIndex == 4)
			{
				if (strlen(&szPic_Ticket[0][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[0][0], _COORDINATE_X_CTLS_LOGO_4_1_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[1][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[1][0], _COORDINATE_X_CTLS_LOGO_4_2_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[2][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[2][0], _COORDINATE_X_CTLS_LOGO_4_3_, inTicketLine1);
				}

				if (strlen(&szPic_Ticket[3][0]) != 0)
				{
					inDISP_PutGraphic(&szPic_Ticket[3][0], _COORDINATE_X_CTLS_LOGO_4_4_, inTicketLine1);
				}
			}
		}/* 分機型 */
		
		if (inWaveCalLine == 4)
		{
			inWaveImageLine1 = _COORDINATE_Y_CTLS_LOGO_Line_5_;
		}
		else
		{
			inWaveImageLine1 = inTempLinePos[inWaveCalLine];
			/* 要置中效果 */
			inWaveImageLine1 = ((inWaveImageLine1 + _COORDINATE_Y_CTLS_LOGO_Line_5_) / 2);
		}
		
		if (ginMachineType == _CASTLE_TYPE_MP200_)
		{
			inDISP_PutGraphic(_TOUCH_NEWUI_IDLE_NO_AMOUNT_, 0,  inWaveImageLine1);
		}
		else if (ginMachineType == _CASTLE_TYPE_V3UL_)
		{
			inDISP_PutGraphic(_TOUCH_NEWUI_IDLE_NO_AMOUNT_, 0,  inWaveImageLine1);
		}
		else
		{
			/* 客製化107、111， 移除請輸入金額的字樣 */
			if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_107_BUMPER_, _CUSTOMER_INDICATOR_SIZE_)         ||
			    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_111_KIOSK_STANDARD_, _CUSTOMER_INDICATOR_SIZE_))
			{
				inDISP_PutGraphic(_TOUCH_NEWUI_IDLE_NO_AMOUNT_, 0,  inWaveImageLine1);
			}
			else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_098_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)     ||
				 !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_105_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_))  
			{
				/* 客製化098，大大的M，不顯示水波紋 */
				
			}
			/* 客製化123， 移除請輸入金額的字樣，開鎖後回復 */
			else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_123_IKEA_, _CUSTOMER_INDICATOR_SIZE_) ||
				 !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_124_EVER_RICH_, _CUSTOMER_INDICATOR_SIZE_))
			{
				if (guszCus123UnlockBit == VS_TRUE)
				{
					inDISP_PutGraphic(_TOUCH_NEWUI_IDLE_AMOUNT_, 0,  inWaveImageLine1);
				}
				else
				{
					inDISP_PutGraphic(_TOUCH_NEWUI_IDLE_NO_AMOUNT_, 0,  inWaveImageLine1);
				}
			}
			else
			{
				inDISP_PutGraphic(_TOUCH_NEWUI_IDLE_AMOUNT_, 0,  inWaveImageLine1);
			}
		}
	}/* TMS是否OK */
	
	/* 切換DEMO版要秀 */
	memset(szDEMOMode, 0x00, sizeof(szDEMOMode));
	inGetDemoMode(szDEMOMode);
	if (memcmp(szDEMOMode, "Y", strlen("Y")) == 0)
	{
		memset(szLOGONum, 0x00, sizeof(szLOGONum));
		inGetLOGONum(szLOGONum);
		inLOGONum = atoi(szLOGONum);
		if (inLOGONum == 901)
		{

		}
		else
		{
			if (ginDCCHostIndex != -1)
				inDISP_ChineseFont("DCC教育訓練模式", _FONTSIZE_16X16_, _LINE_16_14_, _DISP_CENTER_);
			else
				inDISP_ChineseFont("一般教育訓練模式", _FONTSIZE_16X16_, _LINE_16_14_, _DISP_CENTER_);
		}
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Decide_MEG_TRT
Date&Time       :2018/2/9 下午 7:23
Describe        :根據交易別決定TRT
*/
int inNCCC_Func_Decide_MEG_TRT(TRANSACTION_OBJECT *pobTran)
{
	char	szDebug[100 + 1];
	
	if (pobTran->srBRec.uszCUPTransBit == VS_TRUE)
	{
		if (pobTran->inTransactionCode == _CUP_SALE_)
		{
			pobTran->inRunTRTID = _TRT_CUP_SALE_;
		}
		else if (pobTran->inTransactionCode == _CUP_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_CUP_REFUND_;
		}
		else if (pobTran->inTransactionCode == _CUP_PRE_AUTH_)
		{
			pobTran->inRunTRTID = _TRT_CUP_PRE_AUTH_;
		}
		else if (pobTran->inTransactionCode == _CUP_PRE_COMP_)
		{
			pobTran->inRunTRTID = _TRT_CUP_PRE_COMP_;
		}
		else if (pobTran->inTransactionCode == _CUP_INST_SALE_)
		{
			pobTran->inRunTRTID = _TRT_CUP_INST_SALE_;
		}
		else if (pobTran->inTransactionCode == _CUP_INST_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_CUP_INST_REFUND_;
		}
		else if (pobTran->inTransactionCode == _CUP_REDEEM_SALE_)
		{
			pobTran->inRunTRTID = _TRT_CUP_REDEEM_SALE_;
		}
		else if (pobTran->inTransactionCode == _CUP_REDEEM_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_CUP_REDEEM_REFUND_;
		}
		else if (pobTran->inTransactionCode == _CUP_MAIL_ORDER_)
		{
			pobTran->inRunTRTID = _TRT_CUP_MAIL_ORDER_;
		}
		else if (pobTran->inTransactionCode == _CUP_MAIL_ORDER_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_CUP_MAIL_ORDER_REFUND_;
		}
		else if (pobTran->inTransactionCode == _LOYALTY_REDEEM_)
		{
			pobTran->inRunTRTID = _TRT_LOYALTY_REDEEM_;
		}
		else if (pobTran->inTransactionCode == _LOYALTY_REDEEM_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_LOYALTY_REDEEM_REFUND_;
		}
		else if (pobTran->inTransactionCode == _VOID_LOYALTY_REDEEM_)
		{
			pobTran->inRunTRTID = _TRT_VOID_LOYALTY_REDEEM_;
		}
		else
		{
			/* 找不到對應的TRT */
			pobTran->inErrorMsg = _ERROR_CODE_V3_TRT_NOT_FOUND_;

			if (ginDebug == VS_TRUE)
			{
				memset(szDebug, 0x00, sizeof(szDebug));
				sprintf(szDebug, "AID_Select But Cat not Select TRT, inCode: %d", pobTran->inTransactionCode);
				inLogPrintf(AT, szDebug);
			}

			return (VS_ERROR);
		}
	}
	else if (pobTran->srBRec.uszTakaTransBit == VS_TRUE)
	{
		if (pobTran->inTransactionCode == _SALE_)
		{
			pobTran->inRunTRTID = _TRT_SALE_;
		}
		else if (pobTran->inTransactionCode == _REFUND_)
		{
			pobTran->inRunTRTID = _TRT_REFUND_;
		}
		else
		{
			/* 不支援此交易 */
			pobTran->inErrorMsg = _ERROR_CODE_V3_FUNC_NOT_SUPPORT_;

			if (ginDebug == VS_TRUE)
			{
				memset(szDebug, 0x00, sizeof(szDebug));
				sprintf(szDebug, "TAKA NOT SUPPORT");
				inLogPrintf(AT, szDebug);
				memset(szDebug, 0x00, sizeof(szDebug));
				sprintf(szDebug, "AID_Select But Cat not Select TRT, inCode: %d", pobTran->inTransactionCode);
				inLogPrintf(AT, szDebug);
			}

			return (VS_ERROR);
		}
	}
	else
	{
		if (pobTran->inTransactionCode == _SALE_)
		{
			pobTran->inRunTRTID = _TRT_SALE_;
		}
		else if (pobTran->inTransactionCode == _REFUND_)
		{
			pobTran->inRunTRTID = _TRT_REFUND_;
		}
		else if (pobTran->inTransactionCode == _SALE_OFFLINE_)
		{
			pobTran->inRunTRTID = _TRT_SALE_OFFLINE_;
		}
		else if (pobTran->inTransactionCode == _PRE_AUTH_)
		{
			pobTran->inRunTRTID = _TRT_PRE_AUTH_;
		}
		else if (pobTran->inTransactionCode == _PRE_COMP_)
		{
			pobTran->inRunTRTID = _TRT_PRE_COMP_;
		}
		else if (pobTran->inTransactionCode == _INST_SALE_)
		{
			pobTran->inRunTRTID = _TRT_INST_SALE_;
		}
		else if (pobTran->inTransactionCode == _INST_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_INST_REFUND_;
		}
		else if (pobTran->inTransactionCode == _INST_ADJUST_)
		{
			pobTran->inRunTRTID = _TRT_INST_ADJUST_;
		}
		else if (pobTran->inTransactionCode == _REDEEM_SALE_)
		{
			pobTran->inRunTRTID = _TRT_REDEEM_SALE_;
		}
		else if (pobTran->inTransactionCode == _REDEEM_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_REDEEM_REFUND_;
		}
		else if (pobTran->inTransactionCode == _REDEEM_ADJUST_)
		{
			pobTran->inRunTRTID = _TRT_REDEEM_ADJUST_;
		}
		else if (pobTran->inTransactionCode == _MAIL_ORDER_)
		{
			pobTran->inRunTRTID = _TRT_MAIL_ORDER_;
		}
		else if (pobTran->inTransactionCode == _LOYALTY_REDEEM_)
		{
			pobTran->inRunTRTID = _TRT_LOYALTY_REDEEM_;
		}
		else if (pobTran->inTransactionCode == _LOYALTY_REDEEM_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_LOYALTY_REDEEM_REFUND_;
		}
		else if (pobTran->inTransactionCode == _VOID_LOYALTY_REDEEM_)
		{
			pobTran->inRunTRTID = _TRT_VOID_LOYALTY_REDEEM_;
		}
		else if (pobTran->inTransactionCode == _CASH_ADVANCE_)
		{
			pobTran->inRunTRTID = _TRT_CASH_ADVANCE_;
		}
		else if (pobTran->inTransactionCode == _FORCE_CASH_ADVANCE_)
		{
			pobTran->inRunTRTID = _TRT_FORCE_CASH_ADVANCE_;
		}
		else
		{
			/* 找不到對應的TRT */
			pobTran->inErrorMsg = _ERROR_CODE_V3_TRT_NOT_FOUND_;

			if (ginDebug == VS_TRUE)
			{
				memset(szDebug, 0x00, sizeof(szDebug));
				sprintf(szDebug, "AID_Select But Cat not Select TRT, inCode: %d", pobTran->inTransactionCode);
				inLogPrintf(AT, szDebug);
			}

			return (VS_ERROR);
		}
	}
		
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Decide_ICC_TRT
Date&Time       :2018/2/9 下午 7:23
Describe        :根據交易別決定TRT
*/
int inNCCC_Func_Decide_ICC_TRT(TRANSACTION_OBJECT *pobTran)
{
	char	szDebug[100 + 1];
	
	/* 決定TRT */
	if (pobTran->srBRec.uszFiscTransBit == VS_TRUE)
	{
		if (pobTran->inTransactionCode == _FISC_SALE_)
		{
			pobTran->inRunTRTID = _TRT_FISC_SALE_ICC_;
		}
		else if (pobTran->inTransactionCode == _FISC_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_FISC_REFUND_ICC_;
		}
		else
		{
			/* 找不到對應的TRT */
			pobTran->inErrorMsg = _ERROR_CODE_V3_TRT_NOT_FOUND_;

			if (ginDebug == VS_TRUE)
			{
				memset(szDebug, 0x00, sizeof(szDebug));
				sprintf(szDebug, "AID_Select But Cat not Select TRT, inCode: %d", pobTran->inTransactionCode);
				inLogPrintf(AT, szDebug);
			}
			
			return (VS_ERROR);
		}
	}
	else if (pobTran->srBRec.uszCUPTransBit == VS_TRUE)
	{
		if (pobTran->inTransactionCode == _CUP_SALE_)
		{
			pobTran->inRunTRTID = _TRT_CUP_SALE_ICC_;
		}
		else if (pobTran->inTransactionCode == _CUP_PRE_AUTH_)
		{
			pobTran->inRunTRTID = _TRT_CUP_PRE_AUTH_ICC_;
		}
		else if (pobTran->inTransactionCode == _CUP_INST_SALE_)
		{
			pobTran->inRunTRTID = _TRT_CUP_INST_SALE_ICC_;
		}
		else if (pobTran->inTransactionCode == _CUP_REDEEM_SALE_)
		{
			pobTran->inRunTRTID = _TRT_CUP_REDEEM_SALE_ICC_;
		}
		else
		{
			/* 找不到對應的TRT */
			pobTran->inErrorMsg = _ERROR_CODE_V3_TRT_NOT_FOUND_;

			if (ginDebug == VS_TRUE)
			{
				memset(szDebug, 0x00, sizeof(szDebug));
				sprintf(szDebug, "AID_Select But Cat not Select TRT, inCode: %d", pobTran->inTransactionCode);
				inLogPrintf(AT, szDebug);
			}

			return (VS_ERROR);
		}
	}
	else
	{
		if (pobTran->inTransactionCode == _SALE_)
		{
			pobTran->inRunTRTID = _TRT_SALE_ICC_;
		}
		else if (pobTran->inTransactionCode == _REDEEM_SALE_)
		{
			pobTran->inRunTRTID = _TRT_REDEEM_SALE_ICC_;
		}
		else if (pobTran->inTransactionCode == _PRE_AUTH_)
		{
			pobTran->inRunTRTID = _TRT_PRE_AUTH_ICC_;
		}
		else if (pobTran->inTransactionCode == _INST_SALE_)
		{
			pobTran->inRunTRTID = _TRT_INST_SALE_ICC_;
		}
		else if (pobTran->inTransactionCode == _REDEEM_SALE_)
		{
			pobTran->inRunTRTID = _TRT_REDEEM_SALE_ICC_;
		}
		else if (pobTran->inTransactionCode == _CASH_ADVANCE_)
		{
			pobTran->inRunTRTID = _TRT_CASH_ADVANCE_ICC_;
		}
		else if (pobTran->inTransactionCode == _FORCE_CASH_ADVANCE_)
		{
			pobTran->inRunTRTID = _TRT_FORCE_CASH_ADVANCE_;
		}
		else
		{
			/* 找不到對應的TRT */
			pobTran->inErrorMsg = _ERROR_CODE_V3_TRT_NOT_FOUND_;

			if (ginDebug == VS_TRUE)
			{
				memset(szDebug, 0x00, sizeof(szDebug));
				sprintf(szDebug, "AID_Select But Cat not Select TRT, inCode: %d", pobTran->inTransactionCode);
				inLogPrintf(AT, szDebug);
			}

			return (VS_ERROR);
		}
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Decide_TRT
Date&Time       :2017/9/7 下午 5:32
Describe        :根據交易別決定TRT
*/
int inNCCC_Func_Decide_CTLS_TRT(TRANSACTION_OBJECT *pobTran)
{
	char	szDebug[100 + 1];
	
	/* 決定TRT */
	if (pobTran->srBRec.uszFiscTransBit == VS_TRUE)
	{
		if (pobTran->inTransactionCode == _FISC_SALE_)
		{
			pobTran->inRunTRTID = _TRT_FISC_SALE_CTLS_;
		}
		else if (pobTran->inTransactionCode == _FISC_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_FISC_REFUND_CTLS_;
		}
		else
		{
			/* 找不到對應的TRT */
			pobTran->inErrorMsg = _ERROR_CODE_V3_TRT_NOT_FOUND_;

			if (ginDebug == VS_TRUE)
			{
				memset(szDebug, 0x00, sizeof(szDebug));
				sprintf(szDebug, "AID_Select But Cat not Select TRT, inCode: %d", pobTran->inTransactionCode);
				inLogPrintf(AT, szDebug);
			}
			
			return (VS_ERROR);
		}
	}
	else if (pobTran->srBRec.uszCUPTransBit == VS_TRUE)
	{
		if (pobTran->inTransactionCode == _CUP_SALE_)
		{
			pobTran->inRunTRTID = _TRT_CUP_SALE_CTLS_;
		}
		else if (pobTran->inTransactionCode == _CUP_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_CUP_REFUND_CTLS_;
		}
		else if (pobTran->inTransactionCode == _CUP_PRE_AUTH_)
		{
			pobTran->inRunTRTID = _TRT_CUP_PRE_AUTH_CTLS_;
		}
		else if (pobTran->inTransactionCode == _CUP_PRE_COMP_)
		{
			pobTran->inRunTRTID = _TRT_CUP_PRE_COMP_CTLS_;
		}
		else if (pobTran->inTransactionCode == _CUP_INST_SALE_)
		{
			pobTran->inRunTRTID = _TRT_CUP_INST_SALE_CTLS_;
		}
		else if (pobTran->inTransactionCode == _CUP_INST_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_CUP_INST_REFUND_CTLS_;
		}
		else if (pobTran->inTransactionCode == _CUP_REDEEM_SALE_)
		{
			pobTran->inRunTRTID = _TRT_CUP_REDEEM_SALE_CTLS_;
		}
		else if (pobTran->inTransactionCode == _CUP_REDEEM_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_CUP_REDEEM_REFUND_CTLS_;
		}
		else if (pobTran->inTransactionCode == _CUP_MAIL_ORDER_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_CUP_MAIL_ORDER_REFUND_CTLS_;
		}
		else if (pobTran->inTransactionCode == _LOYALTY_REDEEM_)
		{
			pobTran->inRunTRTID = _TRT_LOYALTY_REDEEM_;
		}
		else if (pobTran->inTransactionCode == _LOYALTY_REDEEM_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_LOYALTY_REDEEM_REFUND_;
		}
		else if (pobTran->inTransactionCode == _VOID_LOYALTY_REDEEM_)
		{
			pobTran->inRunTRTID = _TRT_VOID_LOYALTY_REDEEM_;
		}
		else
		{
			/* 找不到對應的TRT */
			pobTran->inErrorMsg = _ERROR_CODE_V3_TRT_NOT_FOUND_;

			if (ginDebug == VS_TRUE)
			{
				memset(szDebug, 0x00, sizeof(szDebug));
				sprintf(szDebug, "AID_Select But Cat not Select TRT, inCode: %d", pobTran->inTransactionCode);
				inLogPrintf(AT, szDebug);
			}

			return (VS_ERROR);
		}
	}
	else
	{
		if (pobTran->inTransactionCode == _SALE_)
		{
			pobTran->inRunTRTID = _TRT_SALE_CTLS_;
		}
		else if (pobTran->inTransactionCode == _REFUND_)
		{
			pobTran->inRunTRTID = _TRT_REFUND_CTLS_;
		}
		else if (pobTran->inTransactionCode == _PRE_AUTH_)
		{
			pobTran->inRunTRTID = _TRT_PRE_AUTH_CTLS_;
		}
		else if (pobTran->inTransactionCode == _PRE_COMP_)
		{
			pobTran->inRunTRTID = _TRT_PRE_COMP_CTLS_;
		}
		else if (pobTran->inTransactionCode == _SALE_OFFLINE_)
		{
			pobTran->inRunTRTID = _TRT_SALE_OFFLINE_CTLS_;
		}
		else if (pobTran->inTransactionCode == _INST_SALE_)
		{
			pobTran->inRunTRTID = _TRT_INST_SALE_CTLS_;
		}
		else if (pobTran->inTransactionCode == _INST_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_INST_REFUND_CTLS_;
		}
		else if (pobTran->inTransactionCode == _INST_ADJUST_)
		{
			pobTran->inRunTRTID = _TRT_INST_ADJUST_CTLS_;
		}
		else if (pobTran->inTransactionCode == _REDEEM_SALE_)
		{
			pobTran->inRunTRTID = _TRT_REDEEM_SALE_CTLS_;
		}
		else if (pobTran->inTransactionCode == _REDEEM_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_REDEEM_REFUND_CTLS_;
		}
		else if (pobTran->inTransactionCode == _REDEEM_ADJUST_)
		{
			pobTran->inRunTRTID = _TRT_REDEEM_ADJUST_CTLS_;
		}
		else if (pobTran->inTransactionCode == _LOYALTY_REDEEM_)
		{
			pobTran->inRunTRTID = _TRT_LOYALTY_REDEEM_;
		}
		else if (pobTran->inTransactionCode == _LOYALTY_REDEEM_REFUND_)
		{
			pobTran->inRunTRTID = _TRT_LOYALTY_REDEEM_REFUND_;
		}
		else if (pobTran->inTransactionCode == _VOID_LOYALTY_REDEEM_)
		{
			pobTran->inRunTRTID = _TRT_VOID_LOYALTY_REDEEM_;
		}
		else if (pobTran->inTransactionCode == _CASH_ADVANCE_)
		{
			pobTran->inRunTRTID = _TRT_CASH_ADVANCE_CTLS_;
		}
		else if (pobTran->inTransactionCode == _FORCE_CASH_ADVANCE_)
		{
			pobTran->inRunTRTID = _TRT_FORCE_CASH_ADVANCE_CTLS_;
		}
		else
		{
			/* 找不到對應的TRT */
			pobTran->inErrorMsg = _ERROR_CODE_V3_TRT_NOT_FOUND_;

			if (ginDebug == VS_TRUE)
			{
				memset(szDebug, 0x00, sizeof(szDebug));
				sprintf(szDebug, "AID_Select But Cat not Select TRT, inCode: %d", pobTran->inTransactionCode);
				inLogPrintf(AT, szDebug);
			}

			return (VS_ERROR);
		}
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Display_Please_LOGON_First
Date&Time       :2018/4/17 下午 4:24
Describe        :提示請先安全結帳
*/
int inNCCC_Func_Display_Please_LOGON_First(TRANSACTION_OBJECT *pobTran)
{
	char	szCustomerIndicator[3 + 1] = {0};
	
	if (pobTran->uszSettleLOGONFailedBit == VS_TRUE)
	{
		memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
		inGetCustomIndicator(szCustomerIndicator);
		/* (需求單-109327)-vx520客製化需求 by Russell 2022/4/13 上午 10:46 */
		/* 安全認證失敗，EDC不在連動結帳流程中提示人工安全認證畫面。 */
		if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_046_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_)	||
		    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_047_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_)	||
		    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_075_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_)	||
		    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_))
		{
			
		}
		else
		{
			inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
			inDISP_ChineseFont("請先安全認證", _FONTSIZE_8X16_, _LINE_8_6_, _DISP_CENTER_);
			inDISP_Wait(2000);
		}
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_BuildAndSendPacket_Flow
Date&Time       :2018/5/25 下午 5:53
Describe        :
*/
int inNCCC_Func_BuildAndSendPacket_Flow(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal= VS_ERROR;
	char	szDebugMsg[100 + 1] = {0};
	char	szTRTFileName[12 + 1] = {0};
	char	szFesMode[2 + 1] = {0};
	char	szCFESMode[2 + 1] = {0};

        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_BuildAndSendPacket_Flow START!");
        
	if (ginFindRunTime == VS_TRUE)
	{
		inFunc_RecordTime_Append("%d %s", __LINE__, __FUNCTION__);
	}
	
	memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
	inGetTRTFileName(szTRTFileName);
	
	memset(szFesMode, 0x00, sizeof(szFesMode));
	inGetNCCCFESMode(szFesMode);//ATS
	memset(szCFESMode, 0x00, sizeof(szCFESMode));
	inGetCloud_MFES(szCFESMode);//'N'

	if (!memcmp(szTRTFileName, _TRT_FILE_NAME_CREDIT_, strlen(_TRT_FILE_NAME_CREDIT_)))
	{
		if (memcmp(szFesMode, _NCCC_03_MFES_MODE_, 2) == 0)
		{
			if (pobTran->srBRec.uszDCCTransBit == VS_TRUE)
			{
				inRetVal = inFLOW_RunFunction(pobTran, _NCCC_DCC_FUNCTION_BUILD_AND_SEND_PACKET_);
			}
			else
			{
				if (memcmp(szCFESMode, "Y", strlen("Y")) == 0)
				{
					inRetVal = inFLOW_RunFunction(pobTran, _NCCC_ATS_FUNCTION_BUILD_AND_SEND_PACKET_);
				}
				else
				{
					inRetVal = inFLOW_RunFunction(pobTran, _NCCC_MFES_FUNCTION_BUILD_AND_SEND_PACKET_);
				}
			}
		}
		else if (memcmp(szFesMode, _NCCC_05_ATS_MODE_, 2) == 0	||
			 memcmp(szFesMode, _NCCC_04_MPAS_MODE_, 2) == 0)
		{
			if (pobTran->srBRec.uszDCCTransBit == VS_TRUE)
			{
				inRetVal = inFLOW_RunFunction(pobTran, _NCCC_DCC_FUNCTION_BUILD_AND_SEND_PACKET_);
			}
			else
			{
                                inRetVal = inFLOW_RunFunction(pobTran, _NCCC_ATS_FUNCTION_BUILD_AND_SEND_PACKET_);
			}
                        
                        /* 客製化098，結帳失敗要Retry */
                        inRetVal = inNCCC_Func_BuildAndSendPacket_Retry_Flow(pobTran, inRetVal);
		}
		else
		{
			if (ginDebug == VS_TRUE)
			{
				memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
				sprintf(szDebugMsg, "inNCCC_Func_BuildAndSendPacket_Flow :無此FES流程 :%s", szFesMode);
				inLogPrintf(AT, szDebugMsg);
			}
			inRetVal = VS_ERROR;
		}
	}
	else if (!memcmp(szTRTFileName, _TRT_FILE_NAME_DCC_, strlen(_TRT_FILE_NAME_DCC_)))
	{
		inRetVal = inFLOW_RunFunction(pobTran, _NCCC_DCC_FUNCTION_BUILD_AND_SEND_PACKET_);
	}
	else if (!memcmp(szTRTFileName, _TRT_FILE_NAME_TAKA_, strlen(_TRT_FILE_NAME_TAKA_)))
	{
		inRetVal = inFLOW_RunFunction(pobTran, _TAKA_FUNCTION_BUILD_AND_SEND_PACKET_);
	}
	else if (!memcmp(szTRTFileName, _TRT_FILE_NAME_EW_, strlen(_TRT_FILE_NAME_EW_)))
	{
		inRetVal = inFLOW_RunFunction(pobTran, _NCCC_EW_FUNCTION_BUILD_AND_SEND_PACKET_);
	}
	else if (!memcmp(szTRTFileName, _TRT_FILE_NAME_TRUST_, strlen(_TRT_FILE_NAME_TRUST_)))
	{
		inRetVal = inFLOW_RunFunction(pobTran, _NCCC_ATS_FUNCTION_BUILD_AND_SEND_PACKET_);
	}
	else
	{
		if (ginDebug == VS_TRUE)
		{
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "inNCCC_Func_BuildAndSendPacket_Flow :無此TRT流程 :%s", szTRTFileName);
			inLogPrintf(AT, szDebugMsg);
		}
	}
	
	/* 只要有進連線流程，不論成功或失敗，INV都加一 */
	if (inRetVal != VS_SUCCESS)
	{
		inFLOW_RunFunction(pobTran, _FUNCTION_UPDATE_INV_);
		inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_CHECK_UPDATE_BATCH_NUM_);
	}
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_BuildAndSendPacket_Flow END!");
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_BuildAndSendPacket_Retry_Flow
Date&Time       :2021/7/2 下午 3:05
Describe        :結帳失敗要Retry
*/
int inNCCC_Func_BuildAndSendPacket_Retry_Flow(TRANSACTION_OBJECT *pobTran, int inRetVal)
{
        int     inSettleRetry = 0;
        char	szCustomerIndicator[3 + 1] = {0};
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_BuildAndSendPacket_Retry_Flow START!");

        memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
        
        if (pobTran->inTransactionCode == _SETTLE_)
	{
                if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_098_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)     ||
                    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_105_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)) 
                {
                        if (inRetVal != VS_SUCCESS)
                        {
                                
                                for (inSettleRetry = 0 ; inSettleRetry < 3 ; inSettleRetry ++)
                                {
                                        if (ginDebug == VS_TRUE)
                                        {
                                                inLogPrintf(AT, "inNCCC_Func_BuildAndSendPacket_Retry_Flow()");
                                        }
                                        
                                        /* 結帳失敗 */
                                        pobTran->inErrorMsg = _ERROR_CODE_V3_SETTLE_RETRY_;
                                        inFunc_Display_Error(pobTran);

                                        if (pobTran->srBRec.uszDCCTransBit == VS_TRUE)
                                        {
                                                inRetVal = inFLOW_RunFunction(pobTran, _NCCC_DCC_FUNCTION_BUILD_AND_SEND_PACKET_);
                                        }
                                        else
                                        {
                                                inRetVal = inFLOW_RunFunction(pobTran, _NCCC_ATS_FUNCTION_BUILD_AND_SEND_PACKET_);
                                        }

                                        /* 只要有進連線流程，不論成功或失敗，INV都加一 */
                                        if (inRetVal != VS_SUCCESS)
                                        {
                                                inFLOW_RunFunction(pobTran, _FUNCTION_UPDATE_INV_);
                                        }
                                        else
                                        {
                                                break;
                                        }
                                }

                                if (inRetVal != VS_SUCCESS)
                                {
                                        pobTran->inErrorMsg = _ERROR_CODE_V3_SETTLE_NOT_SUCCESS_;
                                        inFunc_Display_Error(pobTran);
                                }
                        }
                }
        }
        
        /* 未執行要沿用結果 */
        return (inRetVal);
}

/*
Function        :inNCCC_Func_SetTxnOnlineOffline_Flow
Date&Time       :2018/5/28 上午 11:14
Describe        :
*/
int inNCCC_Func_SetTxnOnlineOffline_Flow(TRANSACTION_OBJECT * pobTran)
{
	int	inRetVal = VS_ERROR;
	char	szDebugMsg[100 + 1] = {0};
	char	szTRTFileName[12 + 1] = {0};
	char	szFesMode[2 + 1] = {0};
	char	szCFESMode[2 + 1] = {0};
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_SetTxnOnlineOffline_Flow START!");
	
	if (ginFindRunTime == VS_TRUE)
	{
		inFunc_RecordTime_Append("%d %s", __LINE__, __FUNCTION__);
	}
	
	memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
	inGetTRTFileName(szTRTFileName);//'CREDITTRT'
	
	memset(szFesMode, 0x00, sizeof(szFesMode));
	inGetNCCCFESMode(szFesMode);//'00'
	memset(szCFESMode, 0x00, sizeof(szCFESMode));
	inGetCloud_MFES(szCFESMode);//'N'
	
	if (!memcmp(szTRTFileName, _TRT_FILE_NAME_CREDIT_, strlen(_TRT_FILE_NAME_CREDIT_)))
	{
		if (memcmp(szFesMode, _NCCC_03_MFES_MODE_, 2) == 0)
		{
			if (pobTran->srBRec.uszDCCTransBit == VS_TRUE)
			{
				inRetVal = inFLOW_RunFunction(pobTran, _NCCC_DCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_);
			}
			else
			{
				/* (需求單 - 107276)自助交易標準做法 by Russell 2019/3/6 上午 10:32 */
				if (memcmp(szCFESMode, "Y", strlen("Y")) == 0)
				{
					inRetVal = inFLOW_RunFunction(pobTran, _NCCC_ATS_FUNCTION_SET_TXN_ONLINE_OFFLINE_);
				}
				else
				{
					inRetVal = inFLOW_RunFunction(pobTran, _NCCC_MFES_FUNCTION_SET_TXN_ONLINE_OFFLINE_);
				}
			}
		}
		else if (memcmp(szFesMode, _NCCC_05_ATS_MODE_, 2) == 0	||
			 memcmp(szFesMode, _NCCC_04_MPAS_MODE_, 2) == 0)
		{
			if (pobTran->srBRec.uszDCCTransBit == VS_TRUE)
			{
				inRetVal = inFLOW_RunFunction(pobTran, _NCCC_DCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_);
			}
			else
			{
				inRetVal = inFLOW_RunFunction(pobTran, _NCCC_ATS_FUNCTION_SET_TXN_ONLINE_OFFLINE_);
			}
		}
		else
		{
			vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_SetTxnOnlineOffline_Flow :無此FES 流程 :%s", szFesMode);
			if (ginDebug == VS_TRUE)
			{
				memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
				sprintf(szDebugMsg, "inNCCC_Func_SetTxnOnlineOffline_Flow :無此FES 流程 :%s", szFesMode);
				inLogPrintf(AT, szDebugMsg);
			}
			inRetVal = VS_ERROR;
		}
		
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_SetTxnOnlineOffline_Flow CREDIT END!");
		return (inRetVal);
	}
	else if (!memcmp(szTRTFileName, _TRT_FILE_NAME_DCC_, strlen(_TRT_FILE_NAME_DCC_)))
	{
		inRetVal = inFLOW_RunFunction(pobTran, _NCCC_DCC_FUNCTION_SET_TXN_ONLINE_OFFLINE_);
		
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_SetTxnOnlineOffline_Flow DCC END!");
		return (inRetVal);
	}
	else if (!memcmp(szTRTFileName, _TRT_FILE_NAME_TAKA_, strlen(_TRT_FILE_NAME_TAKA_)))
	{
		inRetVal = inFLOW_RunFunction(pobTran, _TAKA_FUNCTION_SET_TXN_ONLINE_OFFLINE_);
		
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_SetTxnOnlineOffline_Flow TAKA END!");
		return (inRetVal);
	}
	else if (!memcmp(szTRTFileName, _TRT_FILE_NAME_EW_, strlen(_TRT_FILE_NAME_EW_)))
	{
		inRetVal = inFLOW_RunFunction(pobTran, _NCCC_EW_FUNCTION_SET_TXN_ONLINE_OFFLINE_);
		
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_SetTxnOnlineOffline_Flow EW END!");
		return (inRetVal);
	}
	else if (!memcmp(szTRTFileName, _TRT_FILE_NAME_TRUST_, strlen(_TRT_FILE_NAME_TRUST_)))
	{
		inRetVal = inFLOW_RunFunction(pobTran, _NCCC_ATS_FUNCTION_SET_TXN_ONLINE_OFFLINE_);
		
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_SetTxnOnlineOffline_Flow TRUST END!");
		return (inRetVal);
	}
	else
	{
		vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_SetTxnOnlineOffline_Flow :無此TRT流程 :%s", szTRTFileName);
		if (ginDebug == VS_TRUE)
		{
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "inNCCC_Func_SetTxnOnlineOffline_Flow :無此TRT流程 :%s", szTRTFileName);
			inLogPrintf(AT, szDebugMsg);
		}
		return (VS_ERROR);
	}
	
}

/*
Function        :inNCCC_Func_Card_Inquery_Issuer_Bank
Date&Time       :2018/5/29 上午 10:51
Describe        :詢問卡號流程，行動支付標記及金融機構代碼
*/
int inNCCC_Func_Card_Inquery_Issuer_Bank(TRANSACTION_OBJECT* pobTran)
{
	int	inCode = 0, inTransactionCode = 0, inISOTxnCode = 0;
	char	szFESMode[2 + 1] = {0};
	char	szCFESMode[2 + 1] = {0};
	
	if (pobTran->uszCardInquiryFirstBit != VS_TRUE)
	{
		return (VS_SUCCESS);
	}

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Card_Inquery_Issuer_Bank() START !");
		inLogPrintf(AT, "pobTran->srBRec.inCode = %d", pobTran->srBRec.inCode);
		inLogPrintf(AT, "pobTran->inTransactionCode = %d", pobTran->inTransactionCode);
		inLogPrintf(AT, "pobTran->inISOTxnCode = %d", pobTran->inISOTxnCode);
	}

	inCode = pobTran->srBRec.inCode; /* 設定交易類別 */
	inTransactionCode = pobTran->inTransactionCode; /* 設定交易類別 */
	inISOTxnCode = pobTran->inISOTxnCode; /* 組 ISO 電文 */

	/* 分主機跑不同電文 */
	memset(szFESMode, 0x00, sizeof(szFESMode));
	inGetNCCCFESMode(szFESMode);
	memset(szCFESMode, 0x00, sizeof(szCFESMode));
	inGetCloud_MFES(szCFESMode);
	if (memcmp(szFESMode, _NCCC_03_MFES_MODE_, 2) == 0)
	{
		/* (需求單 - 107276)自助交易標準做法 by Russell 2019/3/5 下午 4:39 */
		if (memcmp(szCFESMode, "Y", strlen("Y")) == 0)
		{
			if (inNCCC_ATS_FuncInquiryIssueBank(pobTran) != VS_SUCCESS)
			{
				return (VS_ERROR);
			}
		}
		else
		{
			if (inNCCC_MFES_FuncInquiryIssueBank(pobTran) != VS_SUCCESS)
			{
				return (VS_ERROR);
			}
		}
	}
	else if (memcmp(szFESMode, _NCCC_05_ATS_MODE_, 2) == 0		||
	         memcmp(szFESMode, _NCCC_04_MPAS_MODE_, 2) == 0)
	{
		if (inNCCC_ATS_FuncInquiryIssueBank(pobTran) != VS_SUCCESS)
		{
			return (VS_ERROR);
		}
	}
	else
	{
		return (VS_ERROR);
	}

	/* 交易的inCode要set回去 */
	pobTran->srBRec.inCode = inCode; /* 設定交易類別 */
	pobTran->inTransactionCode = inTransactionCode; /* 設定交易類別 */
	pobTran->inISOTxnCode = inISOTxnCode; /* 組 ISO 電文 */
	memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
	memset(pobTran->srBRec.szRespCode, 0x00, sizeof(pobTran->srBRec.szRespCode));
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "pobTran->srBRec.inCode = %d", pobTran->srBRec.inCode);
		inLogPrintf(AT, "pobTran->inTransactionCode = %d", pobTran->inTransactionCode);
		inLogPrintf(AT, "pobTran->inISOTxnCode = %d", pobTran->inISOTxnCode);
		inLogPrintf(AT, "inNCCC_Inquery_Issue_Bank()END!!");
		inLogPrintf(AT, "----------------------------------------");
	}

	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Check_Inquiry_Issuer_Amount
Date&Time       :2018/6/1 下午 6:03
Describe        :確認金額
*/
int inNCCC_Func_Check_Inquiry_Issuer_Amount(TRANSACTION_OBJECT *pobTran)
{
	char		szTemplate[30 + 1] = {0};
	unsigned char	uszKey;
	
	/* 不第二段收銀機連線流程不用顯示 */
	if (pobTran->uszCardInquirysSecondBit != VS_TRUE)
	{
		return (VS_SUCCESS);
	}
	else
	{
		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		sprintf(szTemplate, "%ld", pobTran->srBRec.lnTxnAmount);
		inFunc_Amount_Comma(szTemplate, "NT$ ", ' ', _SIGNED_NONE_, 16, _PADDING_LEFT_);
		inDISP_ChineseFont(szTemplate, _FONTSIZE_8X22_, _LINE_8_6_, _DISP_LEFT_);
		inDISP_PutGraphic(_ERR_0_, 0, _COORDINATE_Y_LINE_8_7_);
		
		uszKey = 0x00;
		while (1)
		{
			uszKey = uszKBD_GetKey(_ECR_RS232_GET_CARD_TIMEOUT_);

			if (uszKey == _KEY_CANCEL_ || uszKey == _KEY_TIMEOUT_)
			{
				return (VS_ERROR);
			}
			else if (uszKey == _KEY_0_)
			{
				break;
			}

		}

		return (VS_SUCCESS);
	}
}

/*
Function        :inNCCC_Func_Customer_Setting
Date&Time       :2018/7/23 上午 11:11
Describe        :
*/
int inNCCC_Func_Customer_Setting(TRANSACTION_OBJECT* pobTran)
{
	int	i = 0;
	int	inTableID = 0;
	int	inRetVal = VS_SUCCESS;
	int	inMaxCDTIndex = -1;
	int	inCDTIndex_employee = -1;
	int	inCDTIndex_T_DAYEH = -1;
	int	inCDTIndex_T_T_CARD1 = -1;
	int	inCDTIndex_T_T_CARD2 = -1;
	int	inCDTIndex_T_T_CARD3 = -1;
	int	inCDTIndex_T_T_CARD4 = -1;
	int	inCDTIndex_T_T_CARD5 = -1;
	int	inCDTIndex_T_T_CARD6 = -1;
	int	inHDTIndex = -1;
	char	szTemplate[100 + 1] = {0};
	char	szCustomerIndicator[3 + 1] = {0};
	char	szLastDownloadMode[2 + 1] = {0};
	char	szDutyFree_ReprintPwd[4 + 1] = {0};
	char	szDutyFree_DetailPwd[4 + 1] = {0};
	char	szHostEnable[1 + 1] = {0};
	char	szTakaTID[8 + 1] = {0};
	char	szCloud_MFES[1 + 1] = {0};
	char	szNCCCFesMode[1 + 1] = {0};
	char	szNCCC_HostTelPrimary[15 + 1] = {0};
	char	szNCCC_HostTelSecond[15 + 1] = {0};
	char	szNCCC_ReferralTel[15 + 1] = {0};
	char	szNCCC_HostIPPrimary[15 + 1] = {0};
	char	szNCCC_HostPortNoPrimary[5 + 1] = {0};
	char	szNCCC_HostIPSecond[15 + 1] = {0};
	char	szNCCC_HostPortNoSecond[5 + 1] = {0};
	char	szTAKAHostIndex[2 + 1] = {0};
	char	szTAKACommIndex[2 + 1] = {0};
	char	szTransFunc[20 + 1] = {0};
	unsigned char	uszFileName[30 + 1] = {0};
	unsigned char	uszCFESModeBit = VS_FALSE;
	SQLITE_ALL_TABLE	srAll;
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Customer_Setting() START !");
	}
	
	inLoadCFGTRec(0);
	inGetCustomIndicator(szCustomerIndicator);
	inGetNCCCFESMode(szNCCCFesMode);
	inGetCloud_MFES(szCloud_MFES);
	if (!memcmp(szNCCCFesMode, _NCCC_03_MFES_MODE_, 2) &&
	    !memcmp(szCloud_MFES, "Y", 1))
	{
		uszCFESModeBit = VS_TRUE;
	}
	
	inLoadEDCRec(0);
	inGetLastDownloadMode(szLastDownloadMode);
	
	inLoadCPTRec(0);
	inGetHostTelPrimary(szNCCC_HostTelPrimary);
	inGetHostTelSecond(szNCCC_HostTelSecond);
	inGetReferralTel(szNCCC_ReferralTel);
	inGetHostIPPrimary(szNCCC_HostIPPrimary);
	inGetHostPortNoPrimary(szNCCC_HostPortNoPrimary);
	inGetHostIPSecond(szNCCC_HostIPSecond);
	inGetHostPortNoSecond(szNCCC_HostPortNoSecond);
        
         /* 預設值 */
        switch(ginMachineType)
        {
                case _CASTLE_TYPE_V3P_:
                        inSetECRComPort(_COMPORT_COM1_);
                        break;
                        
                case _CASTLE_TYPE_V3C_:
                default:    
                        inSetECRComPort(_COMPORT_COM2_);
                        break;
        }
        
//	inSetDHCP_Mode("N");  /* 取決前面使用模式，所以不設預設值，使用前置值 */
        inSetECRVersion(_ECR_RS232_VERSION_STANDARD_144_);
	inSetUDP_ECRVersion(_ECR_UDP_VERSION_STANDARD_400_);
        inSetEnterTimeout("030");
        inSetKBDLock("N");
        inSetTMSPacketSize(_TMS_TerminalPacketSize_);
	inSetScreenBrightness(_SCREEN_BRIGHTNESS_MAX_);
	
	if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_113_H_AND_M_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetDHCP_Mode("Y");
		inSetECRVersion(_ECR_RS232_VERSION_STANDARD_400_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_STANDARD_400_);
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_039_CARD_NO_HIDE_F8_B4_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_CARD_NO_HIDE_F8_B4_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_CARD_NO_HIDE_F8_B4_);
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_107_BUMPER_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_BUMPER_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_BUMPER_);
		memset(szTemplate, 0x00, sizeof(szTemplate));
		sprintf(szTemplate, "%03d", _CUSTOMER_107_BUMPER_DISPLAY_TIMEOUT_);
		inSetEnterTimeout(szTemplate);
		inSetKBDLock("Y");
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_111_KIOSK_STANDARD_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_STANDARD_KIOSK_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_STANDARD_KIOSK_);
		memset(szTemplate, 0x00, sizeof(szTemplate));
		sprintf(szTemplate, "%03d", _CUSTOMER_111_KIOSK_STANDARD_DISPLAY_TIMEOUT_);
		inSetEnterTimeout(szTemplate);
		inSetKBDLock("Y");
	}
        else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_098_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_)     ||
                 !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_105_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_))  
	{
                /* 客製化098，ECR Index 7，3秒，不鎖KBD */
		inSetECRVersion(_ECR_RS232_VERSION_MCDONALDS_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_MCDONALDS_);
	}
        else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_034_TK3C_EINVOICE_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_TK3C_EINVOICE_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_TK3C_EINVOICE_);
	}
        else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_055_EINVOICE_, _CUSTOMER_INDICATOR_SIZE_)     ||
                 !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_088_TINTIN_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_STANDARD_400_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_STANDARD_400_);
	}
        else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_002_NICE_PLAZA_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_NICE_PLAZA_);
                inSetTMSPacketSize("0256");
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_003_WELLCOME_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_WELCOME_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_STANDARD_400_);
                inSetTMSPacketSize("0256");
	}
        else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_076_8_DIGITS_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_STANDARD_400_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_STANDARD_400_);
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_090_TAIPEI_101_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_090_TAIPEI_101_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_090_TAIPEI_101_);
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_075_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_)	||
		 !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_STANDARD_400_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_STANDARD_400_);
		
		/* (需求單-109327)-vx520客製化需求(昇恆昌客製化) by Russell 2022/5/20 下午 2:26
		 * 客製化075 TMS上傳筆數 */
		/* 刪除殘存結帳報表 */
		for (i = 0;; i++)
		{
			if (inLoadHDTRec(i) != VS_SUCCESS)
			{
				break;
			}
			memset(szHostEnable, 0x00, sizeof(szHostEnable));
			inGetHostEnable(szHostEnable);
			if (memcmp(szHostEnable, "Y", 1) != 0)
			{
				continue;
			}
			if (inLoadHDPTRec(i) != VS_SUCCESS)
			{
				break;
			}
			memset(uszFileName, 0x00, sizeof(uszFileName));
			inFunc_ComposeFileName(pobTran, (char*)uszFileName, _DUTY_FREE_REPRINT_TOTAL_REPORT_FILE_EXTENSION_, 0);
			/* 刪除 */
			inFILE_Delete(uszFileName);
		}
		/* 重建重印報表和刪除重印明細 */
		inSqlite_Drop_Table(gszReprintDBPath, _TABLE_NAME_REPRINT_TITLE_);
		inSqlite_Create_Table(gszReprintDBPath, _TABLE_NAME_REPRINT_TITLE_, TABLE_REPRINT_TITLE_TAG);
		inSqlite_Drop_Table(gszReprintDBPath, _TABLE_NAME_REPRINT_NCCC_);
		inSqlite_Drop_Table(gszReprintDBPath, _TABLE_NAME_REPRINT_DCC_);

		/* 客製化075重印管理碼 */
		if (inSqlite_Check_Table_Exist(gszReprintDBPath, _TABLE_NAME_DUTY_FREE_PWD_) != VS_SUCCESS)
		{
			inSqlite_Create_Table(gszReprintDBPath, _TABLE_NAME_DUTY_FREE_PWD_, TABLE_DUTY_FREE_PWD_TAG);
			memset(&srAll, 0x00, sizeof(SQLITE_ALL_TABLE));
			inTableID = 0;
			memset(szDutyFree_ReprintPwd, 0x00, sizeof(szDutyFree_ReprintPwd));
			memset(szDutyFree_DetailPwd, 0x00, sizeof(szDutyFree_DetailPwd));
			sprintf(szDutyFree_ReprintPwd, "%s", _DUTY_FREE_REPRINT_PWD_DEFAULT_);
			sprintf(szDutyFree_DetailPwd, "%s", _DUTY_FREE_DETAIL_PWD_DEFAULT_);
			inNCCC_Func_Table_Link_Duty_Free_Pwd(&srAll, _LS_INSERT_, &inTableID, szDutyFree_ReprintPwd, szDutyFree_DetailPwd);
			inSqlite_Insert_Or_Replace_ByRecordID_All(gszReprintDBPath, _TABLE_NAME_DUTY_FREE_PWD_, 0, &srAll);
		}
		
		/* (需求單-109327)-vx520客製化需求(昇恆昌客製化) by Russell 2022/5/30 下午 1:30
		 * 檢核聯名卡活動 */
		if (inSqlite_Check_Table_Exist(gszReprintDBPath, _TABLE_NAME_DUTY_FREE_FUNCTION_) != VS_SUCCESS)
		{
			inSqlite_Create_Table(gszReprintDBPath, _TABLE_NAME_DUTY_FREE_FUNCTION_, TABLE_DUTY_FREE_FUNCTION_TAG);
		}
		
		/* (需求單-109327)-vx520客製化需求(昇恆昌客製化) by Russell 2022/5/30 下午 1:30
		* 客製化075、103不支援優惠兌換。
		 * 因(需求單 - 107367)優惠查核改由ATS判斷需求，須在inNCCC_Loyalty_CreditCardFlag等開關加判斷 */
		inLoadASMCRec(0);
		inSetCreditCardFlag("N");
		inSetBarCodeFlag("N");
		inSetVoidRedeemFlag("N");
		inSaveASMCRec(0);
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_027_CHUNGHWA_TELECOM_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_CHUNGHWA_TELECOM_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_CHUNGHWA_TELECOM_);
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_033_UNIAIR_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_UNIAIR_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_UNIAIR_);
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_053_TAICHUNG_SOGO_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_TAICHUNG_SOGO_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_TAICHUNG_SOGO_);
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_035_MIRAMAR_CINEMAS_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_MIRAMAR_CINEMAS_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_MIRAMAR_CINEMAS_);
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_096_EDA_, _CUSTOMER_INDICATOR_SIZE_)	||
		 !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_097_EDA_, _CUSTOMER_INDICATOR_SIZE_))
	{
		if (inFILE_Check_Exist((unsigned char*)_144_To_400_CHANGED_FILE_NAME_) == VS_SUCCESS)
		{
			inSetECRVersion(_ECR_RS232_VERSION_EDA_400_);
		}
		else
		{
			inSetECRVersion(_ECR_RS232_VERSION_EDA_144_);
		}
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_EDA_400_);
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_079_CINEMARK_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_CINEMARK_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_CINEMARK_);
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_082_IKEA_, _CUSTOMER_INDICATOR_SIZE_) ||
		 !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_123_IKEA_, _CUSTOMER_INDICATOR_SIZE_))
	{
		if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_123_IKEA_, _CUSTOMER_INDICATOR_SIZE_))
		{
			if (inFILE_Check_Exist((unsigned char*)_144_To_400_CHANGED_FILE_NAME_) == VS_SUCCESS)
			{
				inSetECRVersion(_ECR_RS232_VERSION_STANDARD_KIOSK_);
				inSetUDP_ECRVersion(_ECR_UDP_VERSION_STANDARD_KIOSK_);
			}
			else
			{
				inSetECRVersion(_ECR_RS232_VERSION_082_IKEA_);
				inSetUDP_ECRVersion(_ECR_UDP_VERSION_082_IKEA_);
			}
			
			inSetKBDLock("Y");
			inSetScreenBrightness(_SCREEN_BRIGHTNESS_IKEA_IDLE_);
			memset(szTemplate, 0x00, sizeof(szTemplate));
			inGetSignpadBeepInterval(szTemplate);
			if (strlen(szTemplate) <= 0)
			{
				inSetSignpadBeepInterval(_SIGNPAD_BEEP_INTERVAL_CUS_123_DEFAULT_);
			}
		}
		else
		{
			inSetECRVersion(_ECR_RS232_VERSION_082_IKEA_);
			inSetUDP_ECRVersion(_ECR_UDP_VERSION_082_IKEA_);
		}
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_038_BELLAVITA_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_038_BELLAVITA_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_038_BELLAVITA_);
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_042_BDAU1_, _CUSTOMER_INDICATOR_SIZE_))
	{
		/* 關閉銀聯功能 */
		inSetCUPFuncEnable("N");
		/* 關閉HG功能 */
		inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_HG_, &ginHGHostIndex);
		if (ginHGHostIndex > 0)
		{
			inLoadHDTRec(ginHGHostIndex);
			inSetHostEnable("N");
			inSaveHDTRec(ginHGHostIndex);
			if (pobTran->srBRec.inHDTIndex > 0)
			{
				inLoadHDTRec(pobTran->srBRec.inHDTIndex);
			}
		}
	}
	/* 客製化043建設公司，必定要印3聯 */
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_043_BDAU9_, _CUSTOMER_INDICATOR_SIZE_))
	{
		/* 關閉銀聯功能 */
		inSetCUPFuncEnable("N");
		/* 關閉HG功能 */
		inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_HG_, &ginHGHostIndex);
		if (ginHGHostIndex > 0)
		{
			inLoadHDTRec(ginHGHostIndex);
			inSetHostEnable("N");
			inSaveHDTRec(ginHGHostIndex);
			if (pobTran->srBRec.inHDTIndex > 0)
			{
				inLoadHDTRec(pobTran->srBRec.inHDTIndex);
			}
		}
		inSetPrtMode("3");
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_005_FPG_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_005_FPG_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_005_FPG_);
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_041_CASH_, _CUSTOMER_INDICATOR_SIZE_))
	{
		/* 關閉銀聯功能 */
		inSetCUPFuncEnable("N");
		/* 關閉HG功能 */
		inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_HG_, &ginHGHostIndex);
		if (ginHGHostIndex > 0)
		{
			inLoadHDTRec(ginHGHostIndex);
			inSetHostEnable("N");
			inSaveHDTRec(ginHGHostIndex);
			if (pobTran->srBRec.inHDTIndex > 0)
			{
				inLoadHDTRec(pobTran->srBRec.inHDTIndex);
			}
		}
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_026_TAKA_, _CUSTOMER_INDICATOR_SIZE_) ||
		 !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_021_TAKAWEL_, _CUSTOMER_INDICATOR_SIZE_))
	{
		if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_021_TAKAWEL_, _CUSTOMER_INDICATOR_SIZE_))
		{
			inSetECRVersion(_ECR_RS232_VERSION_021_TAKAWEL_);
			inSetUDP_ECRVersion(_ECR_UDP_VERSION_021_TAKAWEL_);
		}
		else
		{
			inSetECRVersion(_ECR_RS232_VERSION_026_TAKA_);
			inSetUDP_ECRVersion(_ECR_UDP_VERSION_026_TAKA_);
		}
		
		/* 加入大高Host */
		inLoadHDTRec(0);
		memset(szTemplate, 0x00, sizeof(szTemplate));
		inGetTerminalID(szTemplate);
		memset(szTakaTID, 0x00, sizeof(szTakaTID));
		sprintf(szTakaTID , "00000%s" , &szTemplate[5]);
		
		for (i = 0; ;i++)
		{
			if (inLoadHDTRec(i) != VS_SUCCESS)
			{
				ginTAKAHostIndex = i;
				memset(szTAKAHostIndex, 0x00, sizeof(szTAKAHostIndex));
				sprintf(szTAKAHostIndex, "%02d", (ginTAKAHostIndex + 1));
				break;
			}
		}
		
		for (i = 0; ;i++)
		{
			if (inLoadCPTRec(i) != VS_SUCCESS)
			{
				ginTAKACommIndex = i;
				memset(szTAKACommIndex, 0x00, sizeof(szTAKACommIndex));
				sprintf(szTAKACommIndex, "%02d", (ginTAKACommIndex + 1));
				break;
			}
		}
		
		inLoadHDTRec(ginTAKAHostIndex);
		inSetHostIndex(szTAKAHostIndex);
		inSetHostEnable("Y");
		inSetHostLabel(_HOST_NAME_TAKA_);
		inSetMerchantID("999999999999999");
		inSetTerminalID(szTakaTID);
		inSetCommunicationIndex(szTAKACommIndex);
		inSetTransFunc("YYYYNNNNNNNNNNNNNNNN");
		inSetManualKeyin("Y");
		inSetCallBankEnable("N");
		inSetTipPercent("030");
		inSaveHDTRec(ginTAKAHostIndex);
		
		/* 同步HDPT */
		inHDPT_Initial_AllRercord(gszParamDBPath, _HDPT_TABLE_NAME_);
		
		/* 加入大高通訊參數 */
		inLoadCPTRec(ginTAKACommIndex);
		inSetCommIndex(szTAKACommIndex);
		inSetTPDU("6002800000");
		inSetNII("280");
		inSetTCPHeadFormat("H");
		inSetCarrierTimeOut("20");
		inSetHostResponseTimeOut("30");
		if (uszCFESModeBit == VS_TRUE)
		{
			inSetHostTelPrimary(szNCCC_HostTelPrimary);
			inSetHostTelSecond(szNCCC_HostTelSecond);
			inSetReferralTel(szNCCC_ReferralTel);
			inSetHostIPPrimary(szNCCC_HostIPPrimary);
			inSetHostPortNoPrimary(szNCCC_HostPortNoPrimary);
			inSetHostIPSecond(szNCCC_HostIPSecond);
			inSetHostPortNoSecond(szNCCC_HostPortNoSecond);
			inSaveCPTRec(ginTAKACommIndex);
		}
		else
		{
			/* 如果xml有資料就沿用，沒有xml就填0 */
			inRetVal = inTAKA_TAKA_Comm_Get_In_Record();
			if (inRetVal != VS_SUCCESS)
			{
				inSaveCPTRec(ginTAKACommIndex);
			}
			else
			{
				inSetHostTelPrimary("0");
				inSetHostTelSecond("0");
				inSetReferralTel("0");
				inSetHostIPPrimary("0.0.0.0");
				inSetHostPortNoPrimary("0");
				inSetHostIPSecond("0.0.0.0");
				inSetHostPortNoSecond("0");
				inSaveCPTRec(ginTAKACommIndex);
			}
		}
		
		/* 加入大高卡別 */
		/* 先找出CDT最大index */
		for (i = 0; ;i++)
		{
			if (inLoadCDTRec(i) != VS_SUCCESS)
			{
				/* CDT index從01開始 */
				inMaxCDTIndex = i - 1;
				break;
			}
		}
		inCDTIndex_employee = inMaxCDTIndex + 1;
		inCDTIndex_T_DAYEH = inMaxCDTIndex + 2;
		inCDTIndex_T_T_CARD1 = inMaxCDTIndex + 3;
		inCDTIndex_T_T_CARD2 = inMaxCDTIndex + 4;
		inCDTIndex_T_T_CARD3 = inMaxCDTIndex + 5;
		inCDTIndex_T_T_CARD4 = inMaxCDTIndex + 6;
		inCDTIndex_T_T_CARD5 = inMaxCDTIndex + 7;
		inCDTIndex_T_T_CARD6 = inMaxCDTIndex + 8;
		/* employee */
		memset(szTemplate, 0x00, sizeof(szTemplate));
		sprintf(szTemplate, "%02d", inCDTIndex_employee + 1);
		inSetCardIndex(szTemplate);
		inSetLowBinRange("000000967");
		inSetHighBinRange("000000967");
		inSetHostCDTIndex(szTAKAHostIndex);
		inSetMinPANLength("09");
		inSetMaxPANLength("19");
		inSetModule10Check("N");
		inSetExpiredDateCheck("Y");
		inSet4DBCEnable("N");
		inSetCardLabel(_CARD_TYPE_TAKA_EMPLOYEE_);
		inSetPrint_Tx_No_Check_No("Y");
		inSaveCDTRec(inCDTIndex_employee);
		/* T_DAYEH */
		memset(szTemplate, 0x00, sizeof(szTemplate));
		sprintf(szTemplate, "%02d", inCDTIndex_T_DAYEH + 1);
		inSetCardIndex(szTemplate);
		inSetLowBinRange("000000965");
		inSetHighBinRange("000000965");
		inSetHostCDTIndex(szTAKAHostIndex);
		inSetMinPANLength("09");
		inSetMaxPANLength("19");
		inSetModule10Check("N");
		inSetExpiredDateCheck("Y");
		inSet4DBCEnable("N");
		inSetCardLabel(_CARD_TYPE_TAKA_T_DAYEH_);
		inSetPrint_Tx_No_Check_No("Y");
		inSaveCDTRec(inCDTIndex_T_DAYEH);
		/* T_CARD1 */
		memset(szTemplate, 0x00, sizeof(szTemplate));
		sprintf(szTemplate, "%02d", inCDTIndex_T_T_CARD1 + 1);
		inSetCardIndex(szTemplate);
		inSetLowBinRange("690");
		inSetHighBinRange("699");
		inSetHostCDTIndex(szTAKAHostIndex);
		inSetMinPANLength("03");
		inSetMaxPANLength("19");
		inSetModule10Check("N");
		inSetExpiredDateCheck("Y");
		inSet4DBCEnable("N");
		inSetCardLabel(_CARD_TYPE_TAKA_T_CARD_);
		inSetPrint_Tx_No_Check_No("Y");
		inSaveCDTRec(inCDTIndex_T_T_CARD1);
		/* T_CARD2 */
		memset(szTemplate, 0x00, sizeof(szTemplate));
		sprintf(szTemplate, "%02d", inCDTIndex_T_T_CARD2 + 1);
		inSetCardIndex(szTemplate);
		inSetLowBinRange("00000001");
		inSetHighBinRange("00000095");
		inSetHostCDTIndex(szTAKAHostIndex);
		inSetMinPANLength("08");
		inSetMaxPANLength("19");
		inSetModule10Check("N");
		inSetExpiredDateCheck("Y");
		inSet4DBCEnable("N");
		inSetCardLabel(_CARD_TYPE_TAKA_T_CARD_);
		inSetPrint_Tx_No_Check_No("Y");
		inSaveCDTRec(inCDTIndex_T_T_CARD2);
		/* T_CARD3 */
		memset(szTemplate, 0x00, sizeof(szTemplate));
		sprintf(szTemplate, "%02d", inCDTIndex_T_T_CARD3 + 1);
		inSetCardIndex(szTemplate);
		inSetLowBinRange("000000960");
		inSetHighBinRange("000000964");
		inSetHostCDTIndex(szTAKAHostIndex);
		inSetMinPANLength("09");
		inSetMaxPANLength("19");
		inSetModule10Check("N");
		inSetExpiredDateCheck("Y");
		inSet4DBCEnable("N");
		inSetCardLabel(_CARD_TYPE_TAKA_T_CARD_);
		inSetPrint_Tx_No_Check_No("Y");
		inSaveCDTRec(inCDTIndex_T_T_CARD3);
		/* T_CARD4 */
		memset(szTemplate, 0x00, sizeof(szTemplate));
		sprintf(szTemplate, "%02d", inCDTIndex_T_T_CARD4 + 1);
		inSetCardIndex(szTemplate);
		inSetLowBinRange("000000966");
		inSetHighBinRange("000000966");
		inSetHostCDTIndex(szTAKAHostIndex);
		inSetMinPANLength("09");
		inSetMaxPANLength("19");
		inSetModule10Check("N");
		inSetExpiredDateCheck("Y");
		inSet4DBCEnable("N");
		inSetCardLabel(_CARD_TYPE_TAKA_T_CARD_);
		inSetPrint_Tx_No_Check_No("Y");
		inSaveCDTRec(inCDTIndex_T_T_CARD4);
		/* T_CARD5 */
		memset(szTemplate, 0x00, sizeof(szTemplate));
		sprintf(szTemplate, "%02d", inCDTIndex_T_T_CARD5 + 1);
		inSetCardIndex(szTemplate);
		inSetLowBinRange("000000968");
		inSetHighBinRange("000000969");
		inSetHostCDTIndex(szTAKAHostIndex);
		inSetMinPANLength("09");
		inSetMaxPANLength("19");
		inSetModule10Check("N");
		inSetExpiredDateCheck("Y");
		inSet4DBCEnable("N");
		inSetCardLabel(_CARD_TYPE_TAKA_T_CARD_);
		inSetPrint_Tx_No_Check_No("Y");
		inSaveCDTRec(inCDTIndex_T_T_CARD5);
		/* T_CARD6 */
		memset(szTemplate, 0x00, sizeof(szTemplate));
		sprintf(szTemplate, "%02d", inCDTIndex_T_T_CARD6 + 1);
		inSetCardIndex(szTemplate);
		inSetLowBinRange("00000097");
		inSetHighBinRange("00000099");
		inSetHostCDTIndex(szTAKAHostIndex);
		inSetMinPANLength("08");
		inSetMaxPANLength("19");
		inSetModule10Check("N");
		inSetExpiredDateCheck("Y");
		inSet4DBCEnable("N");
		inSetCardLabel(_CARD_TYPE_TAKA_T_CARD_);
		inSetPrint_Tx_No_Check_No("Y");
		inSaveCDTRec(inCDTIndex_T_T_CARD6);
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_124_EVER_RICH_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inSetECRVersion(_ECR_RS232_VERSION_STANDARD_KIOSK_);
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_STANDARD_KIOSK_);
		inSetKBDLock("Y");
		inSetScreenBrightness(_SCREEN_BRIGHTNESS_IKEA_IDLE_);
		memset(szTemplate, 0x00, sizeof(szTemplate));
		inGetSignpadBeepInterval(szTemplate);
		if (strlen(szTemplate) <= 0)
		{
			inSetSignpadBeepInterval(_SIGNPAD_BEEP_INTERVAL_CUS_123_DEFAULT_);
		}
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_126_MASTERCARD_FLIGHT_TICKET_, _CUSTOMER_INDICATOR_SIZE_))
	{
		/* (需求單-110175)-端末設備配合實務優化流程需求 
		 * 後續進行TMS後，收銀機長度依照「紀錄值」與「客製化」進行沿用或使用客製化長度。
		 * by Russell 2021/12/20 下午 4:05 */
		if (inFILE_Check_Exist((unsigned char*)_144_To_400_CHANGED_FILE_NAME_) == VS_SUCCESS)
		{
			inSetECRVersion(_ECR_RS232_VERSION_STANDARD_400_);
		}
		else
		{
			inSetECRVersion(_ECR_RS232_VERSION_STANDARD_144_);
		}
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_STANDARD_400_);
		/* 關閉小費開關 */
		inLoadHDTRec(0);
		memset(szTransFunc, 0x00, sizeof(szTransFunc));
		inGetTransFunc(szTransFunc);
		szTransFunc[6] = 'N';
		inSetTransFunc(szTransFunc);
		inSaveHDTRec(0);
		
		inHDTIndex = -1;
		inFunc_Find_Specific_HDTindex(0, _HOST_NAME_DCC_, &inHDTIndex);
		if (inHDTIndex >= 0)
		{
			inLoadHDTRec(inHDTIndex);
			memset(szTransFunc, 0x00, sizeof(szTransFunc));
			inGetTransFunc(szTransFunc);
			szTransFunc[6] = 'N';
			inSetTransFunc(szTransFunc);
			inSaveHDTRec(inHDTIndex);
                        inLoadHDTRec(0);
		}
	}
	else
	{
		/* (需求單-110175)-端末設備配合實務優化流程需求 
		 * 後續進行TMS後，收銀機長度依照「紀錄值」與「客製化」進行沿用或使用客製化長度。
		 * by Russell 2021/12/20 下午 4:05 */
		if (inFILE_Check_Exist((unsigned char*)_144_To_400_CHANGED_FILE_NAME_) == VS_SUCCESS)
		{
			inSetECRVersion(_ECR_RS232_VERSION_STANDARD_400_);
		}
		else
		{
			inSetECRVersion(_ECR_RS232_VERSION_STANDARD_144_);
		}
		inSetUDP_ECRVersion(_ECR_UDP_VERSION_STANDARD_400_);
	}
        
        /* 新豪來信無法修改主機參數檔的名字，要求卡機端hardcode為TRUST */
        inHDTIndex = -1;
        inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_TRUST_WRONG_, &inHDTIndex);
        if (inHDTIndex != -1)
        {
                inLoadHDTRec(inHDTIndex);
                inSetHostLabel(_HOST_NAME_TRUST_);
                inSaveHDTRec(inHDTIndex);
                inLoadHDTRec(pobTran->srBRec.inHDTIndex);
        }
        
	
	if (ginDebug == VS_TRUE)
	{
		memset(szTemplate, 0x00, sizeof(szTemplate));
		inGetECRComPort(szTemplate);
		inLogPrintf(AT, "ECR COMPORT:%s", szTemplate);
		
		memset(szTemplate, 0x00, sizeof(szTemplate));
		inGetECRVersion(szTemplate);
		inLogPrintf(AT, "ECR Version:%s", szTemplate);
		
		memset(szTemplate, 0x00, sizeof(szTemplate));
		inGetUDP_ECRVersion(szTemplate);
		inLogPrintf(AT, "UDP_ECR Version:%s", szTemplate);
		
		memset(szTemplate, 0x00, sizeof(szTemplate));
		inGetEnterTimeout(szTemplate);
		inLogPrintf(AT, "EnterTimeout:%s", szTemplate);
		
		memset(szTemplate, 0x00, sizeof(szTemplate));
		inGetKBDLock(szTemplate);
		inLogPrintf(AT, "KBDLock:%s", szTemplate);
	}
	
	inSaveCFGTRec(0);
	inSaveEDCRec(0);
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Customer_Setting() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Customer_107_Bumper_Echo_Test
Date&Time       :2018/7/25 下午 3:17
Describe        :
*/
int inNCCC_Func_Customer_107_Bumper_Echo_Test(TRANSACTION_OBJECT* pobTran)
{
	int	inRetVal = VS_ERROR;
	int	inHostIndex = -1;
	
	inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_CREDIT_NCCC_, &inHostIndex);
	pobTran->srBRec.inHDTIndex = inHostIndex;
	inLoadHDTRec(pobTran->srBRec.inHDTIndex);
	inLoadHDPTRec(pobTran->srBRec.inHDTIndex);
	
	pobTran->srBRec.uszManualBit = VS_TRUE;
	memset(pobTran->srBRec.szPAN, 0x00, sizeof(pobTran->srBRec.szPAN));
	memcpy(pobTran->srBRec.szPAN, "0000000000000000", 16);
	memset(pobTran->srBRec.szExpDate, 0x00, sizeof(pobTran->srBRec.szExpDate));
	memcpy(pobTran->srBRec.szExpDate, "9912", 4);
	pobTran->uszCardInquiryFirstBit = VS_TRUE;
	/* (需求單 - 107227)邦柏科技自助作業客製化 2018/11/22 上午 11:50 by Russell */
	inRetVal = inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_CARD_INQUERY_ISSUER_BANK_);

	/* 有回應就算成功 */
	if (pobTran->inTransactionResult == _TRAN_RESULT_CANCELLED_	||
	    pobTran->inTransactionResult == _TRAN_RESULT_AUTHORIZED_)
	{
		return (VS_SUCCESS);
	}
	else
	{
		return (VS_ERROR);
	}
}

/*
Function        :inNCCC_Func_AutoSettle_Flow
Date&Time       :2016/6/15 上午 10:29
Describe        :連動結帳流程
*/
int inNCCC_Func_AutoSettle_Flow(TRANSACTION_OBJECT *pobTran)
{
	int		i = 0;
	int		inRetVal = VS_SUCCESS;
	char		szHostName[42 + 1] = {0};
	char		szHostEnable[2 + 1] = {0};
	char		szDebugMsg[100 + 1] = {0};
	char		szTRTFileName[12 + 1] = {0};
	char		szBatchNum[6 + 1] = {0};
	char		szTemplate[10 + 1] = {0};
	unsigned char	uszSettleFailBit = VS_FALSE;
	
	/* ECR結帳立即回傳 */
	if (pobTran->uszECRBit == VS_TRUE)
	{
		if (pobTran->uszDelaySendBit)
		{
			inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_);
		}
		else
		{
			inFLOW_RunFunction(pobTran, _FUNCTION_ECR_SEND_TRANSACTION_RESULT_);
		}
	}
	
	for (i = 0;; ++i)
	{
		/* 先LoadHDT */
		if (inLoadHDTRec(i) == VS_ERROR)
		{
			/* 當找不到第i筆資料會回傳VS_ERROR */
			break;
		}

		/* ESC要跳過 */
		memset(szHostName, 0x00, sizeof(szHostName));
		inGetHostLabel(szHostName);
		if (memcmp(szHostName, _HOST_NAME_ESC_, strlen(_HOST_NAME_ESC_)) == 0)
		{
			continue;
		}
		
		/* HG要跳過 */
		memset(szHostName, 0x00, sizeof(szHostName));
		inGetHostLabel(szHostName);
		if (memcmp(szHostName, _HOST_NAME_HG_, strlen(_HOST_NAME_HG_)) == 0)
		{
			continue;
		}

		/* GET HOST Enable */
		/* 結帳沒開也不跑 */
		memset(szHostEnable, 0x00, sizeof(szHostEnable));
		if (inGetHostEnable(szHostEnable) == VS_ERROR)
		{	
			return (VS_ERROR);
		}
		else
		{
			if (ginDebug == VS_TRUE)
			{
				memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
				sprintf(szDebugMsg, "%d HostEnable: %s", i, szHostEnable);
				inLogPrintf(AT, szDebugMsg);
			}
		}
		
		/* 看結帳開關 */
		
		if (memcmp(szHostEnable, "Y", 1) != 0)
		{
			/* 如果HostEnable != Y，就continue */
			continue;
		}
		else
		{
			pobTran->srBRec.inHDTIndex = i;
		}

		/* 如果主機有開，才loadHDPT */
		if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) == VS_SUCCESS)
		{
			memset(szBatchNum, 0x00, sizeof(szBatchNum));
			inGetBatchNum(szBatchNum);
			pobTran->srBRec.lnBatchNum = atol(szBatchNum);

			/* 在這裡決定跑那一個host的TRT */
			memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
			inGetTRTFileName(szTRTFileName);

			/* 2018/5/8 下午 2:10 DFS需求不再使用大來主機 */
			if (!memcmp(_TRT_FILE_NAME_CREDIT_, szTRTFileName, strlen(_TRT_FILE_NAME_CREDIT_)))
			{
				inRetVal = inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
			}
			else if (!memcmp(_TRT_FILE_NAME_DCC_, szTRTFileName, strlen(_TRT_FILE_NAME_DCC_)))
			{
				inRetVal = inNCCC_DCC_RunTRT(pobTran, pobTran->inRunTRTID);
			}
			else if (!memcmp(_TRT_FILE_NAME_ESVC_, szTRTFileName, strlen(_TRT_FILE_NAME_ESVC_)))
			{
				inRetVal = inNCCC_Ticket_RunTRT(pobTran, pobTran->inRunTRTID);
			}
			else if (!memcmp(_TRT_FILE_NAME_TAKA_, szTRTFileName, strlen(_TRT_FILE_NAME_TAKA_)))
			{
				inRetVal = inTAKA_Func_RunTRT(pobTran, pobTran->inRunTRTID);
			}
                        else if (!memcmp(_TRT_FILE_NAME_TRUST_, szTRTFileName, strlen(_TRT_FILE_NAME_TRUST_)))
                        {
                                inNCCC_Trust_RunTRT(pobTran, pobTran->inRunTRTID);
                        }

			if (inRetVal != VS_SUCCESS)
			{
				inFunc_Display_Error(pobTran);
				
				/* 列印XXXHost結帳失敗 */
				while (inRetVal != VS_SUCCESS)
				{
					uszSettleFailBit = VS_TRUE;
					inRetVal = inCREDIT_PRINT_AutoSettle_Failed_ByBuffer();
				}

			}

		}

	}
	
	/* 連動結帳跑完，把Bit Off，做TMS下載 */
	pobTran->uszAutoSettleBit = VS_FALSE;
	
	/* 如果結帳失敗，就不跑下載 */
	/* 分ISO和FTP，若是ISO，則有結帳失敗就不下，
	   FTP則是不論結帳是否成功，一律執行 */
	memset(szTemplate, 0x00, sizeof(szTemplate));
	inGetTMSDownloadMode(szTemplate);
	if (memcmp(szTemplate, _TMS_DLMODE_FTPS_, strlen(_TMS_DLMODE_FTPS_)) == 0)
	{
		inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_SCHEDULE_INQUIRE_);
		inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
		/* 提示人工安全認證畫面 */
		inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_DISPLAY_PLEASE_LOGON_FIRST_);
		inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
	}
	else
	{
		/* 結帳失敗，不下載 */
		if (uszSettleFailBit == VS_TRUE)
		{

		}
		else
		{
			/* ISO不用詢問 */
			inNCCCTMS_PRINT_ScheduleMessage_Flow(pobTran);
			inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
			inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
		}
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Bumper_Settlement_Flow
Date&Time       :2018/12/9 下午 6:16
Describe        :邦柏結帳流程
*/
int inNCCC_Func_Bumper_Settlement_Flow(TRANSACTION_OBJECT *pobTran)
{
	int			i = 0;
	int			inRetVal = VS_SUCCESS;
	char			szHostName[42 + 1] = {0};
	char			szHostEnable[2 + 1] = {0};
	char			szDebugMsg[100 + 1] = {0};
	char			szTRTFileName[12 + 1] = {0};
	char			szBatchNum[6 + 1] = {0};
	char			szTemplate[20 + 1] = {0};
	unsigned char		uszSettleFailBit = VS_FALSE;
	unsigned char		uszNeedCreditAccumBit = VS_FALSE;
	unsigned char		uszNeedESVCAccumBit = VS_FALSE;
	ACCUM_TOTAL_REC		srAccumRec;
	TICKET_ACCUM_TOTAL_REC	srTicketAccumRec;
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Bumper_Settlement_Flow() START !");
	}
	
	/* 看要結哪個的帳 */
	inLoadHDTRec(pobTran->srBRec.inHDTIndex);
	memset(szTemplate, 0x00, sizeof(szTemplate));
	inGetHostLabel(szTemplate);
	if (pobTran->uszAutoSettleBit == VS_TRUE)
	{
		uszNeedCreditAccumBit = VS_TRUE;
		uszNeedESVCAccumBit = VS_TRUE;
	}
	else if (memcmp(szTemplate, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)) == 0)
	{
		uszNeedCreditAccumBit = VS_TRUE;
	}
	else if (memcmp(szTemplate, _HOST_NAME_ESVC_, strlen(_HOST_NAME_ESVC_)) == 0)
	{
		uszNeedESVCAccumBit = VS_TRUE;
	}
	
	/* 要結信用卡帳 */
	if (uszNeedCreditAccumBit == VS_TRUE)
	{
		inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_CREDIT_NCCC_, &pobTran->srBRec.inHDTIndex);
		/* 如果ECR 主機丟不是NCCC的會出問題，所以這裡多load一次 */
		inLoadHDTRec(pobTran->srBRec.inHDTIndex);
		
		memset(&srAccumRec, 0x00, sizeof(srAccumRec));
		inRetVal = inACCUM_GetRecord(pobTran, &srAccumRec);
		if (inRetVal == VS_SUCCESS	||
		    inRetVal == VS_NO_RECORD)
		{
			/* 零元結帳 */
		}
		else
		{
			return (VS_ERROR);
		}
	}
	
	/* 要節電票帳 */
	if (uszNeedESVCAccumBit == VS_TRUE)
	{
		inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_ESVC_, &pobTran->srBRec.inHDTIndex);
		/* 如果ECR 主機丟不是NCCC的會出問題，所以這裡多load一次 */
		inLoadHDTRec(pobTran->srBRec.inHDTIndex);
		
		memset(&srTicketAccumRec, 0x00, sizeof(srTicketAccumRec));
		inRetVal = inACCUM_GetRecord_ESVC(pobTran, &srTicketAccumRec);
		if (inRetVal == VS_SUCCESS	||
		    inRetVal == VS_NO_RECORD)
		{
			/* 零元結帳 */
		}
		else
		{
			return (VS_ERROR);
		}
	}
	
	/* 先撈帳 */
	/* 【需求單 - 109306】卡人自助交易支援信用卡取消及退貨交易需求 更新收銀機結帳回覆規格(支援正負號)by Russell 2020/10/15 下午 5:27 */
	pobTran->lnNCCC_SettleTotalCount = srAccumRec.lnTotalCount;											/* 信用卡結帳總筆數 *//* 邦柏結帳統計 (START) */
	pobTran->llNCCC_SettleTotalAmount = srAccumRec.llTotalAmount;											/* 信用卡結帳總金額 */
	pobTran->lnECC_SettleTotalCount = srTicketAccumRec.lnEASYCARD_DeductTotalCount + srTicketAccumRec.lnEASYCARD_RefundTotalCount;			/* 悠遊卡結帳總筆數 */
	pobTran->llECC_SettleTotalAmount = srTicketAccumRec.llEASYCARD_DeductTotalAmount - srTicketAccumRec.llEASYCARD_RefundTotalAmount;		/* 悠遊卡結帳總金額 */
	pobTran->lnIPASS_SettleTotalCount = srTicketAccumRec.lnIPASS_DeductTotalCount + srTicketAccumRec.lnIPASS_RefundTotalCount;			/* 一卡通結帳總筆數 */
	pobTran->llIPASS_SettleTotalAmount = srTicketAccumRec.llIPASS_DeductTotalAmount - srTicketAccumRec.llIPASS_RefundTotalAmount;			/* 一卡通結帳總金額 */
	pobTran->lnICASH_SettleTotalCount = srTicketAccumRec.lnICASH_DeductTotalCount + srTicketAccumRec.lnICASH_RefundTotalCount;			/* 愛金卡結帳總筆數 */
	pobTran->llICASH_SettleTotalAmount = srTicketAccumRec.llICASH_DeductTotalAmount - srTicketAccumRec.llICASH_RefundTotalAmount;			/* 愛金卡結帳總金額 */
	
	if (pobTran->uszAutoSettleBit == VS_TRUE)
	{
		for (i = 0;; ++i)
		{
			/* 先LoadHDT */
			if (inLoadHDTRec(i) == VS_ERROR)
			{
				/* 當找不到第i筆資料會回傳VS_ERROR */
				break;
			}

			/* ESC要跳過 */
			memset(szHostName, 0x00, sizeof(szHostName));
			inGetHostLabel(szHostName);
			if (memcmp(szHostName, _HOST_NAME_ESC_, strlen(_HOST_NAME_ESC_)) == 0)
			{
				continue;
			}

			/* HG要跳過 */
			memset(szHostName, 0x00, sizeof(szHostName));
			inGetHostLabel(szHostName);
			if (memcmp(szHostName, _HOST_NAME_HG_, strlen(_HOST_NAME_HG_)) == 0)
			{
				continue;
			}

			/* GET HOST Enable */
			/* 結帳沒開也不跑 */
			memset(szHostEnable, 0x00, sizeof(szHostEnable));
			if (inGetHostEnable(szHostEnable) == VS_ERROR)
			{	
				return (VS_ERROR);
			}
			else
			{
				if (ginDebug == VS_TRUE)
				{
					memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
					sprintf(szDebugMsg, "%d HostEnable: %s", i, szHostEnable);
					inLogPrintf(AT, szDebugMsg);
				}
			}

			/* 看結帳開關 */
			if (memcmp(szHostEnable, "Y", 1) != 0)
			{
				/* 如果HostEnable != Y，就continue */
				continue;
			}
			else
			{
				pobTran->srBRec.inHDTIndex = i;
			}

			/* 如果主機有開，才loadHDPT */
			if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) == VS_SUCCESS)
			{
				memset(szBatchNum, 0x00, sizeof(szBatchNum));
				inGetBatchNum(szBatchNum);
				pobTran->srBRec.lnBatchNum = atol(szBatchNum);

				/* 在這裡決定跑那一個host的TRT */
				memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
				inGetTRTFileName(szTRTFileName);

				/* 2018/5/8 下午 2:10 DFS需求不再使用大來主機 */
				if (!memcmp(_TRT_FILE_NAME_CREDIT_, szTRTFileName, strlen(_TRT_FILE_NAME_CREDIT_)))
				{
					inRetVal = inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
					if (inRetVal == VS_SUCCESS)
					{
						pobTran->uszNCCC_Settle_SuccessBit = VS_TRUE;
					}
				}
				else if (!memcmp(_TRT_FILE_NAME_DCC_, szTRTFileName, strlen(_TRT_FILE_NAME_DCC_)))
				{
					inRetVal = inNCCC_DCC_RunTRT(pobTran, pobTran->inRunTRTID);
				}
				else if (!memcmp(_TRT_FILE_NAME_ESVC_, szTRTFileName, strlen(_TRT_FILE_NAME_ESVC_)))
				{
					inRetVal = inNCCC_Ticket_RunTRT(pobTran, pobTran->inRunTRTID);
					if (inRetVal == VS_SUCCESS)
					{
						pobTran->uszESVC_Settle_SuccessBit = VS_TRUE;
					}
				}
                                else if (!memcmp(_TRT_FILE_NAME_TRUST_, szTRTFileName, strlen(_TRT_FILE_NAME_TRUST_)))
                                {
                                        inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
                                }

				if (inRetVal != VS_SUCCESS)
				{
					uszSettleFailBit = VS_TRUE;
					inFunc_Display_Error(pobTran);
				}
			}
		}
		
		/* ECR結帳回傳 */
		if (pobTran->uszECRBit == VS_TRUE)
		{
			if (uszSettleFailBit == VS_TRUE)
			{
				pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_SELF_TRANS_SETTLE_ERROR_;
				inECR_SendError(pobTran, pobTran->inECRErrorMsg);
			}
			else
			{
				if (pobTran->uszDelaySendBit)
				{
					inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_);
				}
				else
				{
					inFLOW_RunFunction(pobTran, _FUNCTION_ECR_SEND_TRANSACTION_RESULT_);
				}
			}
		}
		
		/* 連動結帳跑完，把Bit Off，做TMS下載 */
		pobTran->uszAutoSettleBit = VS_FALSE;

		/* 如果結帳失敗，就不跑下載 */
		/* 分ISO和FTP，若是ISO，則有結帳失敗就不下，
		   FTP則是不論結帳是否成功，一律執行 */
		memset(szTemplate, 0x00, sizeof(szTemplate));
		inGetTMSDownloadMode(szTemplate);
		if (memcmp(szTemplate, _TMS_DLMODE_FTPS_, strlen(_TMS_DLMODE_FTPS_)) == 0)
		{
			if (inFunc_All_Host_Settle_Check(pobTran, VS_FALSE) == VS_SUCCESS)
			{
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_SCHEDULE_INQUIRE_);
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
				/* 提示人工安全認證畫面 */
				inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_DISPLAY_PLEASE_LOGON_FIRST_);
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
			}
		}
		else
		{
			/* 結帳失敗，不下載 */
			if (uszSettleFailBit == VS_TRUE)
			{

			}
			else
			{
				/* ISO不用詢問 */
				/* 印小白單 */
				inNCCCTMS_PRINT_ScheduleMessage_Flow(pobTran);
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
			}
		}
	}
	/* 單結 */
	else
	{
		if (pobTran->inRunTRTID == 0)
		{
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "TRT ERROR");
			}
			inRetVal = VS_ERROR;
		}
		else
		{
			/* 預防萬一再LoadHDPT一次 */
			if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) != VS_SUCCESS)
			{
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "HDPT ERROR");
				}
				return (VS_ERROR);
			}

			/* 在這裡決定跑那一個host的TRT */
			inGetTRTFileName(szTRTFileName);

			/* ResetTitle */
			inFunc_ResetTitle(pobTran);

			/* 2018/5/8 下午 2:10 DFS需求不再使用大來主機 */
			if (!memcmp(_TRT_FILE_NAME_HG_, szTRTFileName, strlen(_TRT_FILE_NAME_HG_)))
			{
				inRetVal = inHG_RunTRT(pobTran, pobTran->inRunTRTID);
			}
			else if (!memcmp(_TRT_FILE_NAME_CREDIT_, szTRTFileName, strlen(_TRT_FILE_NAME_CREDIT_)))
			{
				inRetVal = inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
				if (inRetVal == VS_SUCCESS)
				{
					pobTran->uszNCCC_Settle_SuccessBit = VS_TRUE;
				}
			}
			else if (!memcmp(_TRT_FILE_NAME_DCC_, szTRTFileName, strlen(_TRT_FILE_NAME_DCC_)))
			{
				inRetVal = inNCCC_DCC_RunTRT(pobTran, pobTran->inRunTRTID);
			}
			else if (!memcmp(_TRT_FILE_NAME_ESVC_, szTRTFileName, strlen(_TRT_FILE_NAME_ESVC_)))
			{
				inRetVal = inNCCC_Ticket_RunTRT(pobTran, pobTran->inRunTRTID);
				if (inRetVal == VS_SUCCESS)
				{
					pobTran->uszESVC_Settle_SuccessBit = VS_TRUE;
				}
			}
                        else if (!memcmp(_TRT_FILE_NAME_TRUST_, szTRTFileName, strlen(_TRT_FILE_NAME_TRUST_)))
                        {
                                inRetVal = inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
                        }
		}

		if (inRetVal != VS_SUCCESS)
		{
			uszSettleFailBit = VS_TRUE;
			/* 要先回傳再顯示錯誤訊息 */
			inFunc_Display_Error(pobTran);
		}
	
		/* ECR結帳回傳 */
		if (pobTran->uszECRBit == VS_TRUE)
		{
			if (uszSettleFailBit == VS_TRUE)
			{
				pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_SELF_TRANS_SETTLE_ERROR_;
				inECR_SendError(pobTran, pobTran->inECRErrorMsg);
			}
			else
			{
				if (pobTran->uszDelaySendBit)
				{
					inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_SEND_ECR_AFTER_PRINT_RECEIPT_);
				}
				else
				{
					inFLOW_RunFunction(pobTran, _FUNCTION_ECR_SEND_TRANSACTION_RESULT_);
				}
			}
		}
		
		if (pobTran->inRunTRTID == _TRT_SETTLE_ ||
		    pobTran->inRunTRTID == _TRT_TICKET_ECC_SETTLE_)
		{
			/* 如果結帳失敗，就不跑下載 */
			/* 分ISO和FTP，若是ISO，則有結帳失敗就不下，
			   FTP則是不論結帳是否成功，一律執行 */
			memset(szTemplate, 0x00, sizeof(szTemplate));
			inGetTMSDownloadMode(szTemplate);
			if (memcmp(szTemplate, _TMS_DLMODE_FTPS_, strlen(_TMS_DLMODE_FTPS_)) == 0)
			{
				inFLOW_RunFunction(pobTran, _FUNCTION_TMS_SCHEDULE_INQUIRE_);
				inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
				/* 提示人工安全認證畫面 */
				inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_DISPLAY_PLEASE_LOGON_FIRST_);
				inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
			}
			else
			{
				/* ISO維持原流程 */
				if (!memcmp(_TRT_FILE_NAME_CREDIT_, szTRTFileName, strlen(_TRT_FILE_NAME_CREDIT_)))
				{
					/* 結帳失敗，不下載 */
					if (uszSettleFailBit == VS_TRUE)
					{

					}
					else
					{
						/* ISO不用詢問 */
						/* 印小白單 */
						inNCCCTMS_PRINT_ScheduleMessage_Flow(pobTran);
						inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
						inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
					}
				}
			}
		}
	}/* 連動或單個Host */
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Bumper_Settlement_Flow() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Mcdonalds_Settlement_Flow
Date&Time       :2018/12/9 下午 6:16
Describe        :麥當勞結帳流程
*/
int inNCCC_Func_Mcdonalds_Settlement_Flow(TRANSACTION_OBJECT *pobTran)
{
	int			i = 0;
	int			inRetVal = VS_SUCCESS;
	char			szHostName[42 + 1] = {0};
	char			szHostEnable[2 + 1] = {0};
	char			szDebugMsg[100 + 1] = {0};
	char			szTRTFileName[12 + 1] = {0};
	char			szBatchNum[6 + 1] = {0};
	char			szTemplate[20 + 1] = {0};
	unsigned char		uszSettleFailBit = VS_FALSE;
	unsigned char		uszNeedCreditAccumBit = VS_FALSE;
	unsigned char		uszNeedESVCAccumBit = VS_FALSE;
	ACCUM_TOTAL_REC		srAccumRec;
	TICKET_ACCUM_TOTAL_REC	srTicketAccumRec;
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Mcdonalds_Settlement_Flow() START !");
	}
	
	/* 看要結哪個的帳 */
	inLoadHDTRec(pobTran->srBRec.inHDTIndex);
	memset(szTemplate, 0x00, sizeof(szTemplate));
	inGetHostLabel(szTemplate);
	if (pobTran->uszAutoSettleBit == VS_TRUE)
	{
		uszNeedCreditAccumBit = VS_TRUE;
		uszNeedESVCAccumBit = VS_TRUE;
	}
	else if (memcmp(szTemplate, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)) == 0)
	{
		uszNeedCreditAccumBit = VS_TRUE;
	}
	else if (memcmp(szTemplate, _HOST_NAME_ESVC_, strlen(_HOST_NAME_ESVC_)) == 0)
	{
		uszNeedESVCAccumBit = VS_TRUE;
	}
	
	/* 要結信用卡帳 */
	if (uszNeedCreditAccumBit == VS_TRUE)
	{
		inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_CREDIT_NCCC_, &pobTran->srBRec.inHDTIndex);
		/* 如果ECR 主機丟不是NCCC的會出問題，所以這裡多load一次 */
		inLoadHDTRec(pobTran->srBRec.inHDTIndex);
		
		memset(&srAccumRec, 0x00, sizeof(srAccumRec));
		inRetVal = inACCUM_GetRecord(pobTran, &srAccumRec);
		if (inRetVal == VS_SUCCESS	||
		    inRetVal == VS_NO_RECORD)
		{
			/* 零元結帳 */
		}
		else
		{
			return (VS_ERROR);
		}
	}
	
	/* 要節電票帳 */
	if (uszNeedESVCAccumBit == VS_TRUE)
	{
		inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_ESVC_, &pobTran->srBRec.inHDTIndex);
		/* 如果ECR 主機丟不是NCCC的會出問題，所以這裡多load一次 */
		inLoadHDTRec(pobTran->srBRec.inHDTIndex);
		
		memset(&srTicketAccumRec, 0x00, sizeof(srTicketAccumRec));
		inRetVal = inACCUM_GetRecord_ESVC(pobTran, &srTicketAccumRec);
		if (inRetVal == VS_SUCCESS	||
		    inRetVal == VS_NO_RECORD)
		{
			/* 零元結帳 */
		}
		else
		{
			return (VS_ERROR);
		}
	}
	
	/* 先撈帳 */
	/* 【需求單 - 109306】卡人自助交易支援信用卡取消及退貨交易需求 更新收銀機結帳回覆規格(支援正負號)by Russell 2020/10/15 下午 5:27 */
	pobTran->lnNCCC_SettleTotalCount = srAccumRec.lnTotalCount;											/* 信用卡結帳總筆數 *//* 邦柏結帳統計 (START) */
	pobTran->llNCCC_SettleTotalAmount = srAccumRec.llTotalAmount;											/* 信用卡結帳總金額 */
	pobTran->lnECC_SettleTotalCount = srTicketAccumRec.lnEASYCARD_DeductTotalCount + srTicketAccumRec.lnEASYCARD_RefundTotalCount;			/* 悠遊卡結帳總筆數 */
	pobTran->llECC_SettleTotalAmount = srTicketAccumRec.llEASYCARD_DeductTotalAmount - srTicketAccumRec.llEASYCARD_RefundTotalAmount;		/* 悠遊卡結帳總金額 */
	pobTran->lnIPASS_SettleTotalCount = srTicketAccumRec.lnIPASS_DeductTotalCount + srTicketAccumRec.lnIPASS_RefundTotalCount;			/* 一卡通結帳總筆數 */
	pobTran->llIPASS_SettleTotalAmount = srTicketAccumRec.llIPASS_DeductTotalAmount - srTicketAccumRec.llIPASS_RefundTotalAmount;			/* 一卡通結帳總金額 */
	pobTran->lnICASH_SettleTotalCount = srTicketAccumRec.lnICASH_DeductTotalCount + srTicketAccumRec.lnICASH_RefundTotalCount;			/* 愛金卡結帳總筆數 */
	pobTran->llICASH_SettleTotalAmount = srTicketAccumRec.llICASH_DeductTotalAmount - srTicketAccumRec.llICASH_RefundTotalAmount;			/* 愛金卡結帳總金額 */
	
	if (pobTran->uszAutoSettleBit == VS_TRUE)
	{
		for (i = 0;; ++i)
		{
			/* 先LoadHDT */
			if (inLoadHDTRec(i) == VS_ERROR)
			{
				/* 當找不到第i筆資料會回傳VS_ERROR */
				break;
			}

			/* ESC要跳過 */
			memset(szHostName, 0x00, sizeof(szHostName));
			inGetHostLabel(szHostName);
			if (memcmp(szHostName, _HOST_NAME_ESC_, strlen(_HOST_NAME_ESC_)) == 0)
			{
				continue;
			}

			/* HG要跳過 */
			memset(szHostName, 0x00, sizeof(szHostName));
			inGetHostLabel(szHostName);
			if (memcmp(szHostName, _HOST_NAME_HG_, strlen(_HOST_NAME_HG_)) == 0)
			{
				continue;
			}

			/* GET HOST Enable */
			/* 結帳沒開也不跑 */
			memset(szHostEnable, 0x00, sizeof(szHostEnable));
			if (inGetHostEnable(szHostEnable) == VS_ERROR)
			{	
				return (VS_ERROR);
			}
			else
			{
				if (ginDebug == VS_TRUE)
				{
					memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
					sprintf(szDebugMsg, "%d HostEnable: %s", i, szHostEnable);
					inLogPrintf(AT, szDebugMsg);
				}
			}

			/* 看結帳開關 */
			if (memcmp(szHostEnable, "Y", 1) != 0)
			{
				/* 如果HostEnable != Y，就continue */
				continue;
			}
			else
			{
				pobTran->srBRec.inHDTIndex = i;
			}

			/* 如果主機有開，才loadHDPT */
			if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) == VS_SUCCESS)
			{
				memset(szBatchNum, 0x00, sizeof(szBatchNum));
				inGetBatchNum(szBatchNum);
				pobTran->srBRec.lnBatchNum = atol(szBatchNum);

				/* 在這裡決定跑那一個host的TRT */
				memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
				inGetTRTFileName(szTRTFileName);

				/* 2018/5/8 下午 2:10 DFS需求不再使用大來主機 */
				if (!memcmp(_TRT_FILE_NAME_CREDIT_, szTRTFileName, strlen(_TRT_FILE_NAME_CREDIT_)))
				{
					inRetVal = inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
					if (inRetVal == VS_SUCCESS)
					{
						pobTran->uszNCCC_Settle_SuccessBit = VS_TRUE;
					}
				}
				else if (!memcmp(_TRT_FILE_NAME_DCC_, szTRTFileName, strlen(_TRT_FILE_NAME_DCC_)))
				{
					inRetVal = inNCCC_DCC_RunTRT(pobTran, pobTran->inRunTRTID);
				}
				else if (!memcmp(_TRT_FILE_NAME_ESVC_, szTRTFileName, strlen(_TRT_FILE_NAME_ESVC_)))
				{
					inRetVal = inNCCC_Ticket_RunTRT(pobTran, pobTran->inRunTRTID);
					if (inRetVal == VS_SUCCESS)
					{
						pobTran->uszESVC_Settle_SuccessBit = VS_TRUE;
					}
				}
                                else if (!memcmp(_TRT_FILE_NAME_TRUST_, szTRTFileName, strlen(_TRT_FILE_NAME_TRUST_)))
                                {
                                        inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
                                }

				if (inRetVal != VS_SUCCESS)
				{
					uszSettleFailBit = VS_TRUE;
					inFunc_Display_Error(pobTran);
                                        
                                        /* 列印XXXHost結帳失敗 */
                                        while (inRetVal != VS_SUCCESS)
                                        {
                                                inRetVal = inCREDIT_PRINT_AutoSettle_Failed_ByBuffer();
                                        }
				}
			}
		}
		
		/* ECR結帳回傳 */
		if (pobTran->uszECRBit == VS_TRUE)
		{
			if (uszSettleFailBit == VS_TRUE)
			{
				pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_SELF_TRANS_SETTLE_ERROR_;
				inECR_SendError(pobTran, pobTran->inECRErrorMsg);
			}
			else
			{
				inFLOW_RunFunction(pobTran, _FUNCTION_ECR_SEND_TRANSACTION_RESULT_);
			}
		}
		
		/* 連動結帳跑完，把Bit Off，做TMS下載 */
		pobTran->uszAutoSettleBit = VS_FALSE;

		/* 如果結帳失敗，就不跑下載 */
		/* 分ISO和FTP，若是ISO，則有結帳失敗就不下，
		   FTP則是不論結帳是否成功，一律執行 */
		memset(szTemplate, 0x00, sizeof(szTemplate));
		inGetTMSDownloadMode(szTemplate);
		if (memcmp(szTemplate, _TMS_DLMODE_FTPS_, strlen(_TMS_DLMODE_FTPS_)) == 0)
		{
			inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_SCHEDULE_INQUIRE_);
			inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
			/* 提示人工安全認證畫面 */
			inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_DISPLAY_PLEASE_LOGON_FIRST_);
			inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
		}
		else
		{
			/* 結帳失敗，不下載 */
			if (uszSettleFailBit == VS_TRUE)
			{

			}
			else
			{
				/* ISO不用詢問 */
				/* 印小白單 */
				inNCCCTMS_PRINT_ScheduleMessage_Flow(pobTran);
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
			}
		}
	}
	/* 單結 */
	else
	{
		if (pobTran->inRunTRTID == 0)
		{
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "TRT ERROR");
			}
			inRetVal = VS_ERROR;
		}
		else
		{
			/* 預防萬一再LoadHDPT一次 */
			if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) != VS_SUCCESS)
			{
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "HDPT ERROR");
				}
				return (VS_ERROR);
			}

			/* 在這裡決定跑那一個host的TRT */
			inGetTRTFileName(szTRTFileName);

			/* ResetTitle */
			inFunc_ResetTitle(pobTran);

			/* 2018/5/8 下午 2:10 DFS需求不再使用大來主機 */
			if (!memcmp(_TRT_FILE_NAME_HG_, szTRTFileName, strlen(_TRT_FILE_NAME_HG_)))
			{
				inRetVal = inHG_RunTRT(pobTran, pobTran->inRunTRTID);
			}
			else if (!memcmp(_TRT_FILE_NAME_CREDIT_, szTRTFileName, strlen(_TRT_FILE_NAME_CREDIT_)))
			{
				inRetVal = inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
				if (inRetVal == VS_SUCCESS)
				{
					pobTran->uszNCCC_Settle_SuccessBit = VS_TRUE;
				}
			}
			else if (!memcmp(_TRT_FILE_NAME_DCC_, szTRTFileName, strlen(_TRT_FILE_NAME_DCC_)))
			{
				inRetVal = inNCCC_DCC_RunTRT(pobTran, pobTran->inRunTRTID);
			}
			else if (!memcmp(_TRT_FILE_NAME_ESVC_, szTRTFileName, strlen(_TRT_FILE_NAME_ESVC_)))
			{
				inRetVal = inNCCC_Ticket_RunTRT(pobTran, pobTran->inRunTRTID);
				if (inRetVal == VS_SUCCESS)
				{
					pobTran->uszESVC_Settle_SuccessBit = VS_TRUE;
				}
			}
                        else if (!memcmp(_TRT_FILE_NAME_TRUST_, szTRTFileName, strlen(_TRT_FILE_NAME_TRUST_)))
                        {
                                inRetVal = inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
                        }
		}

		if (inRetVal != VS_SUCCESS)
		{
			uszSettleFailBit = VS_TRUE;
			/* 要先回傳再顯示錯誤訊息 */
			inFunc_Display_Error(pobTran);
                        
                        /* 列印XXXHost結帳失敗 */
                        while (inRetVal != VS_SUCCESS)
                        {
                                inRetVal = inCREDIT_PRINT_AutoSettle_Failed_ByBuffer();
                        }
		}
		
		/* ECR結帳回傳 */
		if (pobTran->uszECRBit == VS_TRUE)
		{
			if (uszSettleFailBit == VS_TRUE)
			{
				pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_SELF_TRANS_SETTLE_ERROR_;
				inECR_SendError(pobTran, pobTran->inECRErrorMsg);
			}
			else
			{
				inFLOW_RunFunction(pobTran, _FUNCTION_ECR_SEND_TRANSACTION_RESULT_);
			}
		}
		
		if (pobTran->inRunTRTID == _TRT_SETTLE_ ||
		    pobTran->inRunTRTID == _TRT_TICKET_ECC_SETTLE_)
		{
			/* 如果結帳失敗，就不跑下載 */
			/* 分ISO和FTP，若是ISO，則有結帳失敗就不下，
			   FTP則是不論結帳是否成功，一律執行 */
			memset(szTemplate, 0x00, sizeof(szTemplate));
			inGetTMSDownloadMode(szTemplate);
			if (memcmp(szTemplate, _TMS_DLMODE_FTPS_, strlen(_TMS_DLMODE_FTPS_)) == 0)
			{
				if (inFunc_All_Host_Settle_Check(pobTran, VS_FALSE) == VS_SUCCESS)
				{
					inFLOW_RunFunction(pobTran, _FUNCTION_TMS_SCHEDULE_INQUIRE_);
					inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
					/* 提示人工安全認證畫面 */
					inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_DISPLAY_PLEASE_LOGON_FIRST_);
					inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
				}
			}
			else
			{
				/* ISO維持原流程 */
				if (!memcmp(_TRT_FILE_NAME_CREDIT_, szTRTFileName, strlen(_TRT_FILE_NAME_CREDIT_)))
				{
					/* 結帳失敗，不下載 */
					if (uszSettleFailBit == VS_TRUE)
					{

					}
					else
					{
						/* ISO不用詢問 */
						/* 印小白單 */
						inNCCCTMS_PRINT_ScheduleMessage_Flow(pobTran);
						inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
						inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
					}
				}
			}
		}
	}/* 連動或單個Host */
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Mcdonalds_Settlement_Flow() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func__Decide_DispHostRespCodeMsg
Date&Time       :2019/1/31 下午 6:22
Describe        :分顯示錯誤代碼流程
*/
int inNCCC_Func_Decide_DispHostRespCodeMsg(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = {0};
	char	szDebugMsg[100 + 1] = {0};
	char	szTRTFileName[12 + 1] = {0};
	char	szFesMode[2 + 1] = {0};
	char	szCFESMode[2 + 1] = {0};
	
	memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
	inGetTRTFileName(szTRTFileName);
	
	memset(szFesMode, 0x00, sizeof(szFesMode));
	inGetNCCCFESMode(szFesMode);
	memset(szCFESMode, 0x00, sizeof(szCFESMode));
	inGetCloud_MFES(szCFESMode);
	
	if (!memcmp(szTRTFileName, _TRT_FILE_NAME_CREDIT_, strlen(_TRT_FILE_NAME_CREDIT_)))
	{
		if (memcmp(szFesMode, _NCCC_03_MFES_MODE_, 2) == 0)
		{
			if (memcmp(szCFESMode, "Y", strlen("Y")) == 0)
			{
				inRetVal = inNCCC_MFES_DispHostResponseCode(pobTran);
			}
			else
			{
				inRetVal = inNCCC_ATS_DispHostResponseCode(pobTran);
			}
		}
		else if (memcmp(szFesMode, _NCCC_05_ATS_MODE_, 2) == 0	||
			 memcmp(szFesMode, _NCCC_04_MPAS_MODE_, 2) == 0)
		{
			inRetVal = inNCCC_ATS_DispHostResponseCode(pobTran);
		}
		else
		{
			if (ginDebug == VS_TRUE)
			{
				memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
				sprintf(szDebugMsg, "inNCCC_Func_Decide_DispHostRespCodeMsg :無此FES 流程 :%s", szFesMode);
				inLogPrintf(AT, szDebugMsg);
			}
			inRetVal = VS_ERROR;
		}
		
		return (inRetVal);
	}
	else if (!memcmp(szTRTFileName, _TRT_FILE_NAME_DCC_, strlen(_TRT_FILE_NAME_DCC_)))
	{
		inRetVal = inNCCC_DCC_DispHostResponseCode(pobTran);
		
		return (inRetVal);
	}
	else
	{
		if (ginDebug == VS_TRUE)
		{
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "inNCCC_Func_Decide_DispHostRespCodeMsg :無此TRT流程 :%s", szTRTFileName);
			inLogPrintf(AT, szDebugMsg);
		}
		
		return (VS_ERROR);
	}
	
}

/*
Function        :inNCCC_Func_BuildAndSendPacket_Demo_Flow
Date&Time       :2019/1/31 下午 5:41
Describe        :
*/
int inNCCC_Func_BuildAndSendPacket_Demo_Flow(TRANSACTION_OBJECT* pobTran)
{
	int	i = 0;
	int	inHDTIndex = -1;
	int	inOrgTxnCode = -1;
	int	inEWID = -1;
	char	szTemplate[100 + 1] = {0};
	char	szTemplate1[100 + 1] = {0};
	char	szTemplate2[10 + 1] = {0};
	char	szTRTFileName[20 + 1] = {0};
	char	szMessage[30 + 1] = {0};
	char	szFESMode[2 + 1] = {0};
        char	szCustomerIndicator[3 + 1] = {0};
	char	szDebugMsg[100 + 1] = {0};
	unsigned long	ulSec = 0;
        unsigned char   uszMatchLastTXNBit = VS_FALSE;
	RTC_NEXSYS	srRTC = {0};
	
	inFunc_ResetTitle(pobTran);
        
	memset(szFESMode, 0x00, sizeof(szFESMode));
	inGetNCCCFESMode(szFESMode);
        
        memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	
	/* 新增教育訓練模式 收銀機連線回應碼之例外案例 2019/2/1 上午 11:30 */
	if (pobTran->uszECRBit == VS_TRUE)
	{
		/* (需求單-111155)-電子錢包業者收付訊息整合平台需求 by Russell 2023/7/24 下午 6:17 */
		if (pobTran->srEWRec.uszEWTransBit == VS_TRUE)
		{
			inEWID = -1;
			/* (需求單-111155)-電子錢包業者收付訊息整合平台需求 by Russell 2023/2/24 下午 1:52 */
			/* 卡別 */
			if (pobTran->srBRec.inCode == _EW_SALE_)
			{
				if (pobTran->srBRec.szBarCodeData[0] == '3' &&
				   (pobTran->srBRec.szBarCodeData[1] - '1' >= 0 && pobTran->srBRec.szBarCodeData[1] - '1' <= 8))
				{
					strcpy(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_LINEPAY_);
					inEWID = 0;
				}
				else if (!memcmp(&pobTran->srBRec.szBarCodeData[0], "PI", 2))
				{
					strcpy(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_PIAPP_);
					inEWID = 5;
				}
				else if (pobTran->srBRec.szBarCodeData[0] == '9' &&
					 pobTran->srBRec.szBarCodeData[1] == '9')
				{
					strcpy(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_EASYWALLET_);
					inEWID = 1;
				}
				else if (pobTran->srBRec.szBarCodeData[0] == 'I' &&
					 pobTran->srBRec.szBarCodeData[1] == 'C')
				{
					strcpy(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_ICASHPAY_);
					inEWID = 2;
				}
				else if ((pobTran->srBRec.szBarCodeData[0] == 'F' &&
					 pobTran->srBRec.szBarCodeData[1] == 'P')	||
					 (pobTran->srBRec.szBarCodeData[0] == 'F' &&
					 pobTran->srBRec.szBarCodeData[1] == 'F'))
				{
					strcpy(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_PLUSPAY_);
					inEWID = 3;
				}
				else if ((pobTran->srBRec.szBarCodeData[0] == 'P' &&
					(pobTran->srBRec.szBarCodeData[1] - '0' >= 0 && '9' - pobTran->srBRec.szBarCodeData[1] >= 0)))
				{
					strcpy(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_PXPAYPLUS_);
					inEWID = 4;
				}
			}
		
			if (pobTran->srBRec.inCode == _EW_SALE_)
			{
				if (pobTran->srEWRec.lnTxnAmount >= 1 &&
				    pobTran->srEWRec.lnTxnAmount <= 600)
				{
					/* 交易成功*/
				}
				else if (pobTran->srEWRec.lnTxnAmount >= 2001 &&
					 pobTran->srEWRec.lnTxnAmount <= 2600)
				{
					/* 格式錯誤 */
					pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_FORMAT_CHECK_ERROR_;
					memcpy(pobTran->srBRec.szRespCode, "W1", 2);
					
					return (VS_ERROR);
				}
				else if (pobTran->srEWRec.lnTxnAmount >= 3001 &&
					 pobTran->srEWRec.lnTxnAmount <= 3600)
				{
					/* 支付條碼查核錯誤，請重新取得條碼 */
					pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_UNY_BARCODE_DATA_ERROR_;
					memcpy(pobTran->srBRec.szRespCode, "BE", 2);

					return (VS_ERROR);
				}
				else if (pobTran->srEWRec.lnTxnAmount >= 4001 &&
					 pobTran->srEWRec.lnTxnAmount <= 4600)
				{
					/* 電票/電子錢包餘額不足 */
					pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_ESVC_INSUFFICIENT_BALANCE_;
					memcpy(pobTran->srBRec.szRespCode, "W2", 2);

					return (VS_ERROR);
				}
				else if (pobTran->srEWRec.lnTxnAmount >= 5001 &&
					 pobTran->srEWRec.lnTxnAmount <= 5600)
				{
					/* 請聯絡銀行/電子錢包業者 */
					pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_CALLBANK_;
					memcpy(pobTran->srBRec.szRespCode, "01", 2);
					
					return (VS_ERROR);
				}
				else if (pobTran->srEWRec.lnTxnAmount >= 6001 &&
					 pobTran->srEWRec.lnTxnAmount <= 6600)
				{
					/* 交易逾時 */
					pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TIMEOUT_;
					memcpy(pobTran->srBRec.szRespCode, "W3", 2);

					return (VS_ERROR);
				}
				else
				{
					/* 非指定金額 回傳交易失敗 */
					pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_ERROR_;
					/* 顯示05拒絕交易 */
					memset(pobTran->srBRec.szRespCode, 0x00, sizeof(pobTran->srBRec.szRespCode));
					strcpy(pobTran->srBRec.szRespCode, "05");
					inNCCC_Func_Decide_DispHostRespCodeMsg(pobTran); /* 顯示主機回的錯誤訊息 */

					return (VS_ERROR);
				}
			}
			else if (pobTran->srBRec.inCode == _EW_REFUND_)
			{
				if (pobTran->srEWRec.lnTxnAmount >= 1 &&
				    pobTran->srEWRec.lnTxnAmount <= 600)
				{
					/* 交易成功*/
				}
				else if (pobTran->srEWRec.lnTxnAmount >= 2001 &&
					 pobTran->srEWRec.lnTxnAmount <= 2600)
				{
					/* 格式錯誤 */
					pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_FORMAT_CHECK_ERROR_;
					memcpy(pobTran->srBRec.szRespCode, "W1", 2);
					
					return (VS_ERROR);
				}
				else if (pobTran->srEWRec.lnTxnAmount >= 6001 &&
					 pobTran->srEWRec.lnTxnAmount <= 6600)
				{
					/* 請聯絡銀行/電子錢包業者 */
					pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TIMEOUT_;
					memcpy(pobTran->srBRec.szRespCode, "01", 2);
					
					return (VS_ERROR);
				}
				else
				{
					/* 非指定金額 回傳交易失敗 */
					pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_ERROR_;
					/* 顯示05拒絕交易 */
					memset(pobTran->srBRec.szRespCode, 0x00, sizeof(pobTran->srBRec.szRespCode));
					strcpy(pobTran->srBRec.szRespCode, "05");
					inNCCC_Func_Decide_DispHostRespCodeMsg(pobTran); /* 顯示主機回的錯誤訊息 */

					return (VS_ERROR);
				}
				
				for (i = 0; i < 6; i++)
				{
					if (ginDebug == VS_TRUE)
					{
						inLogPrintf(AT, "Card Type:%s", gsrDEMO_EWRec[i].srEWRec.szEW_EWIssuerID);
						inLogPrintf(AT, "Order ID:%s", gsrDEMO_EWRec[i].srEWRec.szEW_OrderId);
					}

					if (ginISODebug == VS_TRUE)
					{
						memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
						sprintf(szDebugMsg, "Card Type:%s", gsrDEMO_EWRec[i].srEWRec.szEW_EWIssuerID);
						inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);

						memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
						sprintf(szDebugMsg, "Order ID:%s", gsrDEMO_EWRec[i].srEWRec.szEW_OrderId);
						inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
					}
				}
				
				for (i = 0; i < 6; i++)
				{
					if (memcmp(gsrDEMO_EWRec[i].srEWRec.szEW_OrderId, pobTran->srEWRec.szEW_OrderId, max(strlen(gsrDEMO_EWRec[i].srEWRec.szEW_OrderId), strlen(pobTran->srEWRec.szEW_OrderId))) == 0)
					{
						if (ginDebug == VS_TRUE)
						{
							inLogPrintf(AT, "OrderID 符合");
						}
						
						inEWID = i;
						break;
					}
				}
				
				/* 對應電子錢包已有資料 */
				if (inEWID != -1)
				{
					if ((gsrDEMO_EWRec[inEWID].srEWRec.lnTxnAmount != pobTran->srEWRec.lnTxnAmount) ||
					    (memcmp(gsrDEMO_EWRec[inEWID].srEWRec.szEW_Decimal, pobTran->srEWRec.szEW_Decimal, max(strlen(gsrDEMO_EWRec[inEWID].srEWRec.szEW_Decimal), strlen(pobTran->srEWRec.szEW_Decimal))) != 0))
					{
						/* 金額不符合，要回傳交易失敗 */
						pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_ERROR_;
						
						if (ginDebug == VS_TRUE)
						{
							inLogPrintf(AT, "金額不符合");
							inLogPrintf(AT, "Rec:'%ld'", gsrDEMO_EWRec[inEWID].srEWRec.lnTxnAmount);
							inLogPrintf(AT, "Input:'%ld'", pobTran->srEWRec.lnTxnAmount);
						}
						
						if (ginISODebug == VS_TRUE)
						{
							char	szDebugMsg[100 + 1] = {0};

							memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
							sprintf(szDebugMsg, "金額不符合");
							inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
							
							memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
							sprintf(szDebugMsg, "Rec:'%ld'", gsrDEMO_EWRec[inEWID].srEWRec.lnTxnAmount);
							inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
							
							memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
							sprintf(szDebugMsg, "Input:'%ld'", pobTran->srEWRec.lnTxnAmount);
							inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
						}
						
						return (VS_ERROR);
					}
					
					if (memcmp(gsrDEMO_EWRec[inEWID].srEWRec.szEW_TransactionId, pobTran->srEWRec.szEW_TransactionId, max(strlen(gsrDEMO_EWRec[inEWID].srEWRec.szEW_TransactionId), strlen(pobTran->srEWRec.szEW_TransactionId))) != 0)
					{
						/*電子錢包業者交易序號，要回傳交易失敗 */
						pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_ERROR_;
						
						if (ginDebug == VS_TRUE)
						{
							inLogPrintf(AT, "電子錢包業者交易序號不符");
							inLogPrintf(AT, "Rec:'%s'", gsrDEMO_EWRec[inEWID].srEWRec.szEW_TransactionId);
							inLogPrintf(AT, "Input:%s''", pobTran->srEWRec.szEW_TransactionId);
						}
						
						if (ginISODebug == VS_TRUE)
						{
							char	szDebugMsg[100 + 1] = {0};

							memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
							sprintf(szDebugMsg, "電子錢包業者交易序號不符");
							inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
							
							memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
							sprintf(szDebugMsg, "Rec:'%s'", gsrDEMO_EWRec[inEWID].srEWRec.szEW_TransactionId);
							inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
							
							memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
							sprintf(szDebugMsg, "Input:%s''", pobTran->srEWRec.szEW_TransactionId);
							inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
						}
						
						return (VS_ERROR);
					}
				}
				else
				{
					/* 沒有上筆紀錄，要回傳交易失敗 */
					pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_ERROR_;

					return (VS_ERROR);
				}
			}
			else if (pobTran->srBRec.inCode == _EW_INQUIRY_)
			{
				for (i = 0; i < 6; i++)
				{
					if (ginDebug == VS_TRUE)
					{
						inLogPrintf(AT, "Card Type:%s", gsrDEMO_EWRec[inEWID].srEWRec.szEW_EWIssuerID);
						inLogPrintf(AT, "Order ID:%s", gsrDEMO_EWRec[inEWID].srEWRec.szEW_OrderId);
						inLogPrintf(AT, "Refund Trade No:%s", gsrDEMO_EWRec[inEWID].srEWRec.szEW_RefundTradeNo);
					}

					if (ginISODebug == VS_TRUE)
					{
						memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
						sprintf(szDebugMsg, "Card Type:%s", gsrDEMO_EWRec[inEWID].srEWRec.szEW_EWIssuerID);
						inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);

						memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
						sprintf(szDebugMsg, "Order ID:%s", gsrDEMO_EWRec[inEWID].srEWRec.szEW_OrderId);
						inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
						
						memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
						sprintf(szDebugMsg, "Refund Trade No:%s", gsrDEMO_EWRec[inEWID].srEWRec.szEW_RefundTradeNo);
						inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
					}
				}
				
				for (i = 0; i < 6; i++)
				{
					/* 錢包業者為全支付及iCASH Pay時,發動退貨交易查詢時需改帶退貨訂單編號→ */
					if (!memcmp(gsrDEMO_EWRec[inEWID].srEWRec.szEW_EWIssuerID, _EW_ISSUERID_ICASHPAY_, max(strlen(gsrDEMO_EWRec[inEWID].srEWRec.szEW_EWIssuerID), strlen(_EW_ISSUERID_ICASHPAY_))) ||
					    !memcmp(gsrDEMO_EWRec[inEWID].srEWRec.szEW_EWIssuerID, _EW_ISSUERID_PXPAYPLUS_, max(strlen(gsrDEMO_EWRec[inEWID].srEWRec.szEW_EWIssuerID), strlen(_EW_ISSUERID_PXPAYPLUS_))))
					{
						if (gsrDEMO_EWRec[inEWID].incode == _EW_REFUND_)
						{
							if (memcmp(gsrDEMO_EWRec[inEWID].srEWRec.szEW_RefundTradeNo, pobTran->srEWRec.szEW_OrderId, max(strlen(gsrDEMO_EWRec[inEWID].srEWRec.szEW_RefundTradeNo), strlen(pobTran->srEWRec.szEW_OrderId))) == 0)
							{
								inEWID = i;
								break;
							}
						}
						else
						{
							if (memcmp(gsrDEMO_EWRec[inEWID].srEWRec.szEW_OrderId, pobTran->srEWRec.szEW_OrderId, max(strlen(gsrDEMO_EWRec[inEWID].srEWRec.szEW_OrderId), strlen(pobTran->srEWRec.szEW_OrderId))) == 0)
							{
								inEWID = i;
								break;
							}
						}
					}
					else
					{
						if (memcmp(gsrDEMO_EWRec[inEWID].srEWRec.szEW_OrderId, pobTran->srEWRec.szEW_OrderId, max(strlen(gsrDEMO_EWRec[inEWID].srEWRec.szEW_OrderId), strlen(pobTran->srEWRec.szEW_OrderId))) == 0)
						{
							inEWID = i;
							break;
						}
					}
				}
				
				/* 對應電子錢包已有資料 */
				if (inEWID != -1)
				{
					
				}
				else
				{
					/* 沒有上筆紀錄，要回傳交易失敗 */
					pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_ERROR_;

					return (VS_ERROR);
				}
			}
			else
			{
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "無此交易別：電子錢包(%d)", pobTran->srBRec.inCode);
				}
			}
		}
		else
		{
			if (pobTran->srBRec.lnTxnAmount == 111)
			{
				/* 金額 111 回傳交易失敗 */
				pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_ERROR_;
				pobTran->inErrorMsg = _ERROR_CODE_V3_TXN_FAIL_;

				return (VS_ERROR);
			}
			else if (pobTran->srBRec.lnTxnAmount == 222 &&
				(pobTran->srBRec.inCode == _SALE_ || pobTran->srBRec.inCode == _CASH_ADVANCE_) &&
				memcmp(szFESMode, _NCCC_04_MPAS_MODE_, strlen(_NCCC_04_MPAS_MODE_)) != 0)
			{
				/* 金額 222 回傳call bank */
				/* 信用卡一般交易金額$222 
				   	備註：「小額特店」不適用 */
				pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_CALLBANK_;
				pobTran->inErrorMsg = _ERROR_CODE_V3_TXN_CALL_BANK_;

				return (VS_ERROR);
			}
			else if (pobTran->srBRec.lnTxnAmount == 333)
			{
				/* 金額 333 回傳Timeout */
				pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TIMEOUT_;
				pobTran->inErrorMsg = _ERROR_CODE_V3_TXN_TIMEOUT_;

				return (VS_ERROR);
			}
			else if (pobTran->srBRec.lnTxnAmount == 555)
			{
				/* 金額 555 回傳通訊失敗 */
				pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_COMM_ERROR_;
				pobTran->inErrorMsg = _ERROR_CODE_V3_COMM_;
				return (VS_ERROR);
			}
			else if (pobTran->srBRec.lnTxnAmount == 999 &&
				memcmp(szFESMode, _NCCC_04_MPAS_MODE_, strlen(_NCCC_04_MPAS_MODE_)) == 0)
			{
				/* 金額 999 回傳非參加機構卡片 */
				memset(pobTran->srBRec.szMPASAuthCode, 0x00, sizeof(pobTran->srBRec.szMPASAuthCode));
				memcpy(&pobTran->srBRec.szMPASAuthCode[0], "REJB01", 6);
				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				memcpy(&pobTran->srBRec.szAuthCode[0], "REJB01", 6);

				pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_NOT_MEMBER_CARD_;
				pobTran->inErrorMsg = _ERROR_CODE_V3_TXN_NOT_MEMBER_CARD_;

				return (VS_ERROR);
			}
		}
	}
	
	memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
	inGetTRTFileName(szTRTFileName);
	
	pobTran->srBRec.lnRedemptionPointsBalance = gulDemoRedemptionPointsBalance;

	/* DCC退貨用 */
	if (pobTran->inTransactionCode == _REFUND_ && pobTran->srBRec.uszDCCTransBit == VS_TRUE)
	{
		/* DCC退貨Hardcode用840 */
		
		/* 切換到DCC Host */
		inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_DCC_, &inHDTIndex);
		if (inHDTIndex == -1)
		{
			return (VS_ERROR);
		}
		else
		{
			pobTran->srBRec.inHDTIndex = inHDTIndex;
		}
		inLoadHDTRec(pobTran->srBRec.inHDTIndex);
		inLoadHDPTRec(pobTran->srBRec.inHDTIndex);

		inOrgTxnCode = pobTran->srBRec.inCode;

		/* 步驟 1 Get System Trans Number */
		if (inNCCC_DCC_GetSTAN(pobTran) == VS_ERROR)
			return (VS_ERROR);
		
		inNCCC_Func_DEMO_Get_DCC_F59_DATA(pobTran);
		
		/* Response Code */
		memcpy(&pobTran->srBRec.szRespCode[0], "00", 2);
		pobTran->srBRec.szRespCode[2] = 0x00;
		
		/* Set STAN */
		inNCCC_DCC_SetSTAN(pobTran);

		for (i = 0; i < 2; i++)
		{
			inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
			inDISP_PutGraphic(_SEND_, 0, _COORDINATE_Y_LINE_8_7_);/* 傳送中... */
		}

		for (i = 0; i < 1; i++)
		{
			inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
			inDISP_PutGraphic(_PROCESS_, 0, _COORDINATE_Y_LINE_8_7_);/* 處理中... */
		}

		for (i = 0; i < 1; i++)
		{
			inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
			inDISP_PutGraphic(_RECEIVE_, 0, _COORDINATE_Y_LINE_8_7_);/* 接收中... */
		}	

		for (i = 0; i < 1; i++)
		{
			inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
			inDISP_PutGraphic(_PROCESS_, 0, _COORDINATE_Y_LINE_8_7_);/* 處理中... */
		}
	}
	else if (pobTran->srEWRec.uszEWTransBit == VS_TRUE)
	{
		for (i = 0; i < 4; i ++)
		{
			inDISP_Clear_Line(_LINE_8_6_, _LINE_8_6_);
			inDISP_Wait(200);
			memset(szMessage, 0x00, sizeof(szMessage));
			strcpy(szMessage, "!教育訓練模式!"); /* !教育訓練模式! */
			inDISP_ChineseFont(szMessage, _FONTSIZE_8X16_,  _LINE_8_6_, _DISP_LEFT_);
			inDISP_Wait(300);
		}
		
		if (pobTran->inTransactionCode == _EW_SALE_)
		{
			/* 錢包業者交易序號 */
			memset(pobTran->srEWRec.szEW_TransactionId, 0x00, sizeof(pobTran->srEWRec.szEW_TransactionId));
			memset(szTemplate, 0x00, sizeof(szTemplate));
			sprintf(szTemplate, "%s%011lu", pobTran->srBRec.szDate, CTOS_TickGet());
			inFunc_PAD_ASCII(pobTran->srEWRec.szEW_TransactionId, szTemplate, ' ', 64, _PADDING_RIGHT_);
			
			/* 錢包業者特店代號 */
			memset(pobTran->srEWRec.szEW_ChannelId, 0x00, sizeof(pobTran->srEWRec.szEW_ChannelId));
			inFunc_PAD_ASCII(pobTran->srEWRec.szEW_ChannelId, "1655811608", ' ', 50, _PADDING_RIGHT_);
			
			/* 消費者支付工具 */
			memset(pobTran->srEWRec.szEW_PayMethod, 0x00, sizeof(pobTran->srEWRec.szEW_PayMethod));
			inFunc_PAD_ASCII(pobTran->srEWRec.szEW_PayMethod, _EW_PAY_METHOD_CREDIT_CARD_, ' ', 1, _PADDING_RIGHT_);
			
			/* 電子發票HASH值 */
			memset(pobTran->srEWRec.szEW_EinvoiceHASH, 0x00, sizeof(pobTran->srEWRec.szEW_EinvoiceHASH));
			inFunc_PAD_ASCII(pobTran->srEWRec.szEW_EinvoiceHASH, "/RRJFVKQ1", ' ', 50, _PADDING_RIGHT_);
			
			/* 折抵金額 */
			memset(pobTran->srEWRec.szEW_DiscountAmt, 0x00, sizeof(pobTran->srEWRec.szEW_DiscountAmt));
			if (!memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_EASYWALLET_, _EW_ISSUERID_LEN_)		||
			    !memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_ICASHPAY_, _EW_ISSUERID_LEN_)	||
			    !memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_PLUSPAY_, _EW_ISSUERID_LEN_)		||
			    !memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_PXPAYPLUS_, _EW_ISSUERID_LEN_)	||
			    !memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_PIAPP_, _EW_ISSUERID_LEN_))
			{
				inFunc_PAD_ASCII(pobTran->srEWRec.szEW_DiscountAmt, "", '0', 10, _PADDING_LEFT_);
			}
			
			/* 錢包業者交易日期時間 2023-08-18T10:07:16Z */
			memset(pobTran->srEWRec.szEW_PaymentDate, 0x00, sizeof(pobTran->srEWRec.szEW_PaymentDate));
			memset(szTemplate, 0x00, sizeof(szTemplate));
			memset(szTemplate1, 0x00, sizeof(szTemplate1));
			memset(&srRTC, 0x00, sizeof(srRTC));
			ulSec = CTOS_TickGet();
			sprintf(szTemplate1, "%lu", ulSec);
			inFuncGetUnixTimeToLocalTime(&srRTC, szTemplate1, 8, 0);
			sprintf(szTemplate, "20%02d-%02d-%02dT%02d:%02d:%02dZ", srRTC.uszYear, srRTC.uszMonth, srRTC.uszDay, srRTC.uszHour, srRTC.uszMinute, srRTC.uszSecond);
			inFunc_PAD_ASCII(pobTran->srEWRec.szEW_PaymentDate, szTemplate, ' ', 24, _PADDING_RIGHT_);
			
			/* 信用卡卡號 */
			if (!memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_EASYWALLET_, _EW_ISSUERID_LEN_)	&&
			    !memcmp(pobTran->srEWRec.szEW_PayMethod, "1", 1))
			{
				strcpy(pobTran->srEWRec.szEW_MaskCreditCardNo, "493817******0003");
			}
			else if (!memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_PXPAYPLUS_, _EW_ISSUERID_LEN_))
			{
				if (!memcmp(pobTran->srEWRec.szEW_PayMethod, _EW_PAY_METHOD_ACCOUNT_LINK_, 1))
				{
					strcpy(pobTran->srEWRec.szEW_MaskCreditCardNo, "*****12345");
				}
				else if (!memcmp(pobTran->srEWRec.szEW_PayMethod, _EW_PAY_METHOD_CREDIT_CARD_, 1))
				{
					strcpy(pobTran->srEWRec.szEW_MaskCreditCardNo, "493817******0003");
				}
				else if (!memcmp(pobTran->srEWRec.szEW_PayMethod, _EW_PAY_METHOD_BALANCE_, 1))
				{
					strcpy(pobTran->srEWRec.szEW_MaskCreditCardNo, "********1234");
				}
			}
			
			/* 付款交易編號 */
			if (!memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_EASYWALLET_, _EW_ISSUERID_LEN_))
			{
				strcpy(pobTran->srEWRec.szEW_PaymentNo, "EZ_PAYMENT_NO");
			}
			
			/* 是否為重複付款請求 */
			if (!memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_EASYWALLET_, _EW_ISSUERID_LEN_))
			{
				strcpy(pobTran->srEWRec.szEW_IsDuplicatedPaymentRequest, "N");
			}
			
			/* 聯名卡代碼 */
			if (!memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_EASYWALLET_, _EW_ISSUERID_LEN_))
			{
				strcpy(pobTran->srEWRec.szEW_CobrandedCode, "EZCOBRANDNO");
			}
			
			/* 門市代碼 */
			if (!memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_PIAPP_, _EW_ISSUERID_LEN_))
			{
				strcpy(pobTran->srEWRec.szEW_Store_no, "PI_STORE_NO");
			}
				
			memcpy(&gsrDEMO_EWRec[inEWID].srEWRec, &pobTran->srEWRec, sizeof(EW_REC));
			gsrDEMO_EWRec[inEWID].incode = pobTran->srBRec.inCode;
			gsrDEMO_EWRec[inEWID].lnBatchNum = pobTran->srBRec.lnBatchNum;
			gsrDEMO_EWRec[inEWID].lnInvNum = pobTran->srBRec.lnOrgInvNum;
			
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "Card Type:%s", gsrDEMO_EWRec[inEWID].srEWRec.szEW_EWIssuerID);
				inLogPrintf(AT, "Order ID:%s", gsrDEMO_EWRec[inEWID].srEWRec.szEW_OrderId);
			}
			
			if (ginISODebug == VS_TRUE)
			{
				char	szDebugMsg[100 + 1] = {0};

				memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
				sprintf(szDebugMsg, "Card Type:%s", gsrDEMO_EWRec[inEWID].srEWRec.szEW_EWIssuerID);
				inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
				
				memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
				sprintf(szDebugMsg, "Order ID:%s", gsrDEMO_EWRec[inEWID].srEWRec.szEW_OrderId);
				inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
			}
		}
		else if (pobTran->inTransactionCode == _EW_REFUND_)
		{
			/* 卡別 */
			memset(pobTran->srEWRec.szEW_EWIssuerID, 0x00, sizeof(pobTran->srEWRec.szEW_EWIssuerID));
			strcpy(pobTran->srEWRec.szEW_EWIssuerID, gsrDEMO_EWRec[inEWID].srEWRec.szEW_EWIssuerID);
			
			/* 錢包業者交易序號 */
			memset(pobTran->srEWRec.szEW_TransactionId, 0x00, sizeof(pobTran->srEWRec.szEW_TransactionId));
			memset(szTemplate, 0x00, sizeof(szTemplate));
			sprintf(szTemplate, "%s%011lu", pobTran->srBRec.szDate, CTOS_TickGet());
			inFunc_PAD_ASCII(pobTran->srEWRec.szEW_TransactionId, szTemplate, ' ', 64, _PADDING_RIGHT_);
			
			/* 錢包業者特店代號 */
			memset(pobTran->srEWRec.szEW_ChannelId, 0x00, sizeof(pobTran->srEWRec.szEW_ChannelId));
			inFunc_PAD_ASCII(pobTran->srEWRec.szEW_ChannelId, "1655811608", ' ', 50, _PADDING_RIGHT_);
			
			/* 錢包業者交易日期時間 2023-08-18T10:07:16Z */
			memset(pobTran->srEWRec.szEW_PaymentDate, 0x00, sizeof(pobTran->srEWRec.szEW_PaymentDate));
			memset(szTemplate, 0x00, sizeof(szTemplate));
			memset(szTemplate1, 0x00, sizeof(szTemplate1));
			memset(&srRTC, 0x00, sizeof(srRTC));
			ulSec = CTOS_TickGet();
			sprintf(szTemplate1, "%lu", ulSec);
			inFuncGetUnixTimeToLocalTime(&srRTC, szTemplate1, 8, 0);
			sprintf(szTemplate, "20%02d-%02d-%02dT%02d:%02d:%02dZ", srRTC.uszYear, srRTC.uszMonth, srRTC.uszDay, srRTC.uszHour, srRTC.uszMinute, srRTC.uszSecond);
			inFunc_PAD_ASCII(pobTran->srEWRec.szEW_PaymentDate, szTemplate, ' ', 24, _PADDING_RIGHT_);
			
			/* 折抵金額 */
			memset(pobTran->srEWRec.szEW_DiscountAmt, 0x00, sizeof(pobTran->srEWRec.szEW_DiscountAmt));
			if (!memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_ICASHPAY_, _EW_ISSUERID_LEN_)	||
			    !memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_PLUSPAY_, _EW_ISSUERID_LEN_)		||
			    !memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_PXPAYPLUS_, _EW_ISSUERID_LEN_)	||
			    !memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_PIAPP_, _EW_ISSUERID_LEN_))
			{
				inFunc_PAD_ASCII(pobTran->srEWRec.szEW_DiscountAmt, "", '0', 10, _PADDING_LEFT_);
			}
			
			/* 門市代碼 */
			if (!memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_PIAPP_, _EW_ISSUERID_LEN_))
			{
				strcpy(pobTran->srEWRec.szEW_Store_no, "PI_STORE_NO");
			}
			
			memcpy(&gsrDEMO_EWRec[inEWID].srEWRec, &pobTran->srEWRec, sizeof(EW_REC));
			gsrDEMO_EWRec[inEWID].incode = pobTran->srBRec.inCode;
			gsrDEMO_EWRec[inEWID].lnBatchNum = pobTran->srBRec.lnBatchNum;
			gsrDEMO_EWRec[inEWID].lnInvNum = pobTran->srBRec.lnOrgInvNum;
			
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "Card Type:%s", gsrDEMO_EWRec[inEWID].srEWRec.szEW_EWIssuerID);
				inLogPrintf(AT, "Order ID:%s", gsrDEMO_EWRec[inEWID].srEWRec.szEW_OrderId);
			}
			
			if (ginISODebug == VS_TRUE)
			{
				char	szDebugMsg[100 + 1] = {0};

				memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
				sprintf(szDebugMsg, "Card Type:%s", gsrDEMO_EWRec[inEWID].srEWRec.szEW_EWIssuerID);
				inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
				
				memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
				sprintf(szDebugMsg, "Order ID:%s", gsrDEMO_EWRec[inEWID].srEWRec.szEW_OrderId);
				inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
			}
		}
		else if (pobTran->inTransactionCode == _EW_INQUIRY_)
		{
			memcpy(&pobTran->srEWRec, &gsrDEMO_EWRec[inEWID].srEWRec, sizeof(gsrDEMO_EWRec[inEWID].srEWRec));
			pobTran->srBRec.lnBatchNum = gsrDEMO_EWRec[inEWID].lnBatchNum;
			pobTran->srBRec.lnOrgInvNum = gsrDEMO_EWRec[inEWID].lnInvNum;
			
			/* 信用卡卡號 */
			if (!memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_EASYWALLET_, _EW_ISSUERID_LEN_))
			{
				if (gsrDEMO_EWRec[inEWID].incode == _EW_REFUND_)
				{
					strcpy(pobTran->srEWRec.szEW_MaskCreditCardNo, "493817******0003");
				}
			}
			else if (!memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_ICASHPAY_, _EW_ISSUERID_LEN_))
			{
				strcpy(pobTran->srEWRec.szEW_MaskCreditCardNo, "493817******0003");
			}
			else if (!memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_PXPAYPLUS_, _EW_ISSUERID_LEN_))
			{
				if (gsrDEMO_EWRec[inEWID].incode == _EW_REFUND_)
				{
					strcpy(pobTran->srEWRec.szEW_MaskCreditCardNo, "493817******0003");
				}
			}
			
			/* 消費者支付工具 */
			if (gsrDEMO_EWRec[inEWID].incode == _EW_REFUND_)
			{
				memset(pobTran->srEWRec.szEW_PayMethod, 0x00, sizeof(pobTran->srEWRec.szEW_PayMethod));
				inFunc_PAD_ASCII(pobTran->srEWRec.szEW_PayMethod, _EW_PAY_METHOD_CREDIT_CARD_, ' ', 1, _PADDING_RIGHT_);
			}
			
			/* 訂單狀態 */
			if (gsrDEMO_EWRec[inEWID].incode == _EW_SALE_)
			{
				memset(pobTran->srEWRec.szEW_TransactionType, 0x00, sizeof(pobTran->srEWRec.szEW_TransactionType));
				inFunc_PAD_ASCII(pobTran->srEWRec.szEW_TransactionType, "01", ' ', 2, _PADDING_RIGHT_);
			}
			else if (gsrDEMO_EWRec[inEWID].incode == _EW_REFUND_)
			{
				memset(pobTran->srEWRec.szEW_TransactionType, 0x00, sizeof(pobTran->srEWRec.szEW_TransactionType));
				inFunc_PAD_ASCII(pobTran->srEWRec.szEW_TransactionType, "02", ' ', 2, _PADDING_RIGHT_);
			}
			
			/* 聯名卡代碼 */
			if (gsrDEMO_EWRec[inEWID].incode == _EW_REFUND_)
			{
				if (!memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_EASYWALLET_, _EW_ISSUERID_LEN_))
				{
					strcpy(pobTran->srEWRec.szEW_CobrandedCode, "EZCOBRANDNO");
				}
			}
			
			/* 載具類型 */
			if (!memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_LINEPAY_, _EW_ISSUERID_LEN_))
			{
				strcpy(pobTran->srEWRec.szEW_EinvoiceCarrierType, "LINE12");
			}
			else if (!memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_EASYWALLET_, _EW_ISSUERID_LEN_))
			{
				strcpy(pobTran->srEWRec.szEW_EinvoiceCarrierType, "EZ1234");
			}
			
			/* 折抵金額/退還折抵金額 */
			if (gsrDEMO_EWRec[inEWID].incode == _EW_REFUND_)
			{
				if (!memcmp(pobTran->srEWRec.szEW_EWIssuerID, _EW_ISSUERID_EASYWALLET_, _EW_ISSUERID_LEN_))
				{
					inFunc_PAD_ASCII(pobTran->srEWRec.szEW_DiscountAmt, "", '0', 10, _PADDING_LEFT_);
				}
			}
		}
		
		/* 主機回應碼 */
		strcpy(pobTran->srBRec.szRespCode, "00");
	}
        else if (pobTran->srTrustRec.uszTrustTransBit == VS_TRUE)
	{
                inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		inDISP_PutGraphic(_SEND_, 0, _COORDINATE_Y_LINE_8_7_);/* 傳送中... */

		for (i = 0; i < 4; i ++)
		{
			inDISP_Clear_Line(_LINE_8_6_, _LINE_8_6_);
			inDISP_Wait(200);
			memset(szMessage, 0x00, sizeof(szMessage));
			strcpy(szMessage, "!教育訓練模式!"); /* !教育訓練模式! */
			inDISP_ChineseFont(szMessage, _FONTSIZE_8X16_,  _LINE_8_6_, _DISP_LEFT_);
			inDISP_Wait(300);
		}
                
		/* 主機回覆中文說明（big5） */
		if (pobTran->srTrustRec.inCode == _TRUST_SALE_)
		{
			if (pobTran->srTrustRec.lnTxnAmount >= 0 && pobTran->srTrustRec.lnTxnAmount <= 2000)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "同意交易");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "S000");	
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 2001 && pobTran->srTrustRec.lnTxnAmount <= 2500)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "不同意交易");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "F000");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 2501 && pobTran->srTrustRec.lnTxnAmount <= 3000)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "帳戶餘額不足");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "F001");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 3001 && pobTran->srTrustRec.lnTxnAmount <= 3500)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "帳戶額度不足");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "F002");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 3501 && pobTran->srTrustRec.lnTxnAmount <= 4000)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "非信託受益人");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "F003");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 4001 && pobTran->srTrustRec.lnTxnAmount <= 4500)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "非給付項目");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "F004");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 4501 && pobTran->srTrustRec.lnTxnAmount <= 5000)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "F005");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 6001 && pobTran->srTrustRec.lnTxnAmount <= 6500)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "F102");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 6501 && pobTran->srTrustRec.lnTxnAmount <= 6600)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9571");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 6601 && pobTran->srTrustRec.lnTxnAmount <= 6700)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9572");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 6701 && pobTran->srTrustRec.lnTxnAmount <= 6800)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9573");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 6801 && pobTran->srTrustRec.lnTxnAmount <= 6900)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9574");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 6901 && pobTran->srTrustRec.lnTxnAmount <= 7000)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9575");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 7001 && pobTran->srTrustRec.lnTxnAmount <= 7100)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9576");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 7101 && pobTran->srTrustRec.lnTxnAmount <= 7200)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9577");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 7201 && pobTran->srTrustRec.lnTxnAmount <= 7300)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9578");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 7301 && pobTran->srTrustRec.lnTxnAmount <= 7400)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9579");
			}
			else
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "F102");
			}
		}
		else if (pobTran->srTrustRec.inCode == _TRUST_VOID_)
		{
			if (!memcmp(&pobTran->srBRec.szCUP_TD[0], gsrDEMO_TRUSTRec.szOrgDate, 4)	&&
			    !memcmp(pobTran->srTrustRec.szTrustInstitutionCode, gsrDEMO_TRUSTRec.srTRUSTRec.szTrustInstitutionCode, 7)	&&
			    !memcmp(pobTran->srTrustRec.szTrustRRN, gsrDEMO_TRUSTRec.srTRUSTRec.szTrustRRN, 11)				&&
			    pobTran->srTrustRec.lnTxnAmount == gsrDEMO_TRUSTRec.srTRUSTRec.lnTxnAmount)
                        {
                                uszMatchLastTXNBit = VS_TRUE;
                        }
                        else
                        {
                                if (memcmp(&pobTran->srBRec.szCUP_TD[0], gsrDEMO_TRUSTRec.szOrgDate, 4))
                                {
                                        if (ginDebug == VS_TRUE)
                                        {
                                                inLogPrintf(AT, "Org date Not Match(%s), (%s)", pobTran->srBRec.szCUP_TD, gsrDEMO_TRUSTRec.szOrgDate);
                                        }
                                }
                                if (memcmp(pobTran->srTrustRec.szTrustInstitutionCode, gsrDEMO_TRUSTRec.srTRUSTRec.szTrustInstitutionCode, 7))
                                {
                                        if (ginDebug == VS_TRUE)
                                        {
                                                inLogPrintf(AT, "TrustInstitutionCode Not Match(%s), (%s)", pobTran->srTrustRec.szTrustInstitutionCode, gsrDEMO_TRUSTRec.srTRUSTRec.szTrustInstitutionCode);
                                        }
                                }
                                if (memcmp(pobTran->srTrustRec.szTrustRRN, gsrDEMO_TRUSTRec.srTRUSTRec.szTrustRRN, 11))
                                {
                                        if (ginDebug == VS_TRUE)
                                        {
                                                inLogPrintf(AT, "TrustRRN Not Match(%s), (%s)", pobTran->srTrustRec.szTrustRRN, gsrDEMO_TRUSTRec.srTRUSTRec.szTrustRRN);
                                        }
                                }
                                if (pobTran->srTrustRec.lnTxnAmount != gsrDEMO_TRUSTRec.srTRUSTRec.lnTxnAmount)
                                {
                                        if (ginDebug == VS_TRUE)
                                        {
                                                inLogPrintf(AT, "lnTxnAmount Not Match(%ld), (%ld)", pobTran->srTrustRec.lnTxnAmount, gsrDEMO_TRUSTRec.srTRUSTRec.lnTxnAmount);
                                        }
                                }
                        }
                                
                        if (uszMatchLastTXNBit == VS_TRUE)
			{
				/* 888元取消時，*/
				if (pobTran->srTrustRec.lnTxnAmount == 888)
				{
					memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
					sprintf(pobTran->szHostResponseMessageUTF8, "查無平台序號");

					memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
					sprintf(pobTran->srBRec.szAuthCode, "F101");
				}
				else
				{
					if (gsrDEMO_TRUSTRec.srTRUSTRec.inCode == _TRUST_SALE_)
					{
						memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
						sprintf(pobTran->szHostResponseMessageUTF8, "同意取消交易");

						memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
						sprintf(pobTran->srBRec.szAuthCode, "S000");
						
						/* 回傳銷帳編號 */
						memset(pobTran->srTrustRec.szReconciliationNo, 0x00, sizeof(pobTran->srTrustRec.szReconciliationNo));
						sprintf(pobTran->srTrustRec.szReconciliationNo, "%s", gsrDEMO_TRUSTRec.srTRUSTRec.szReconciliationNo);
					}
					else
					{
						memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
						sprintf(pobTran->szHostResponseMessageUTF8, "不同意取消交易");

						memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
						sprintf(pobTran->srBRec.szAuthCode, "F100");
					}
				}
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 2001 && pobTran->srTrustRec.lnTxnAmount <= 2500)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "不同意交易");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "F000");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 2501 && pobTran->srTrustRec.lnTxnAmount <= 3000)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "帳戶餘額不足");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "F001");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 3001 && pobTran->srTrustRec.lnTxnAmount <= 3500)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "帳戶額度不足");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "F002");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 3501 && pobTran->srTrustRec.lnTxnAmount <= 4000)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "非信託受益人");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "F003");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 4001 && pobTran->srTrustRec.lnTxnAmount <= 4500)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "非給付項目");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "F004");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 4501 && pobTran->srTrustRec.lnTxnAmount <= 5000)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "F005");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 6001 && pobTran->srTrustRec.lnTxnAmount <= 6500)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "F102");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 6501 && pobTran->srTrustRec.lnTxnAmount <= 6600)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9571");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 6601 && pobTran->srTrustRec.lnTxnAmount <= 6700)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9572");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 6701 && pobTran->srTrustRec.lnTxnAmount <= 6800)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9573");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 6801 && pobTran->srTrustRec.lnTxnAmount <= 6900)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9574");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 6901 && pobTran->srTrustRec.lnTxnAmount <= 7000)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9575");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 7001 && pobTran->srTrustRec.lnTxnAmount <= 7100)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9576");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 7101 && pobTran->srTrustRec.lnTxnAmount <= 7200)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9577");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 7201 && pobTran->srTrustRec.lnTxnAmount <= 7300)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9578");
			}
			else if (pobTran->srTrustRec.lnTxnAmount >= 7301 && pobTran->srTrustRec.lnTxnAmount <= 7400)
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "9579");
			}
			else
			{
				memset(pobTran->szHostResponseMessageUTF8, 0x00, sizeof(pobTran->szHostResponseMessageUTF8));
				sprintf(pobTran->szHostResponseMessageUTF8, "請洽信託銀行");

				memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
				sprintf(pobTran->srBRec.szAuthCode, "F102");
			}
		}
		
		/* 交換平台交易序號 */
		memset(pobTran->srTrustRec.szExchangeTxSerialNumber, 0x00, sizeof(pobTran->srTrustRec.szExchangeTxSerialNumber));
		sprintf(pobTran->srTrustRec.szExchangeTxSerialNumber, "12345678901234567890123456789012");
		inFunc_PAD_ASCII(pobTran->srTrustRec.szExchangeTxSerialNumber, &pobTran->srTrustRec.szExchangeTxSerialNumber[0], ' ', 32, _PADDING_RIGHT_);
		
		/* 遮掩後的受益人ID */
		if (strlen(pobTran->szIDNumber) == 0)
		{
			/* ECR不輸入受益人ID hardcode */
			snprintf(pobTran->szIDNumber, sizeof(pobTran->szIDNumber), "A1234567890");
		}
		memset(pobTran->srTrustRec.szMaskedBeneficiaryId, 0x00, sizeof(pobTran->srTrustRec.szMaskedBeneficiaryId));
		memcpy(pobTran->srTrustRec.szMaskedBeneficiaryId, pobTran->szIDNumber, strlen(pobTran->szIDNumber) - 4);
		strcat(pobTran->srTrustRec.szMaskedBeneficiaryId, "****");
		
		/* 轉換回Big5 */
		inFunc_UTF8toBig5(pobTran->szHostResponseMessageBIG5, pobTran->szHostResponseMessageUTF8);
		
		if (!memcmp(pobTran->srBRec.szAuthCode, "S000", 4))
		{
			memcpy(&gsrDEMO_TRUSTRec.srTRUSTRec, &pobTran->srTrustRec, sizeof(TRUST_REC));
			memcpy(&gsrDEMO_TRUSTRec.szOrgDate, &pobTran->srBRec.szOrgDate[4], 4);
		}
		else
		{
			inNCCC_ATS_DispHostResponseCode_Trust(pobTran);
			return (VS_ERROR);
		}
	}
	else
	{
		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		inDISP_PutGraphic(_SEND_, 0, _COORDINATE_Y_LINE_8_7_);/* 傳送中... */

		for (i = 0; i < 4; i ++)
		{
			inDISP_Clear_Line(_LINE_8_6_, _LINE_8_6_);
			inDISP_Wait(200);
			memset(szMessage, 0x00, sizeof(szMessage));
			strcpy(szMessage, "!教育訓練模式!"); /* !教育訓練模式! */
			inDISP_ChineseFont(szMessage, _FONTSIZE_8X16_,  _LINE_8_6_, _DISP_LEFT_);
			inDISP_Wait(300);
		}
		
		/* 授權碼 = Batch Number + Invoice Number */
		if (pobTran->inTransactionCode == _SALE_)
		{
			if ((!memcmp(pobTran->srBRec.szAuthCode, "VLP", 3) && pobTran->srBRec.uszContactlessBit == VS_TRUE) ||
			    (!memcmp(pobTran->srBRec.szAuthCode, "JCB", 3) && pobTran->srBRec.uszContactlessBit == VS_TRUE) ||
			    (!memcmp(pobTran->srBRec.szAuthCode, "Y1", 2) && pobTran->srBRec.inChipStatus == _EMV_CARD_))
			{

			}
			else if ((pobTran->srBRec.uszCUPTransBit == VS_TRUE || pobTran->srBRec.uszFiscTransBit == VS_TRUE) &&
				 (pobTran->srBRec.lnTxnAmount <= 50))
			{
				/* 教育訓練版需求要點_V1_10 新增空白授權碼 add by LingHsiung 2018/9/21 下午 05:51:57 */
				/* 新增就銀聯卡及SMART PAY之相關交易，於交易金額$50(含)以下，成功交易、但無授權碼之交易 */
				strcpy(pobTran->srBRec.szAuthCode, "      ");
			}
			else
			{
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memset(szTemplate1, 0x00, sizeof(szTemplate1));
				memset(szTemplate2, 0x00, sizeof(szTemplate2));

				inGetBatchNum(szTemplate1);
				inGetInvoiceNum(szTemplate2);

				sprintf(szTemplate, "%03d%03d", atoi(szTemplate1), atoi(szTemplate2));
				strcpy(pobTran->srBRec.szAuthCode, szTemplate);
			}
		}
		else
		{
			if (strlen(pobTran->srBRec.szAuthCode) <= 0)
			{
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memset(szTemplate1, 0x00, sizeof(szTemplate1));
				memset(szTemplate2, 0x00, sizeof(szTemplate2));

				inGetBatchNum(szTemplate1);
				inGetInvoiceNum(szTemplate2);

				sprintf(szTemplate, "%03d%03d", atoi(szTemplate1), atoi(szTemplate2));
				strcpy(pobTran->srBRec.szAuthCode, szTemplate);
			}

			if ((pobTran->srBRec.uszCUPTransBit == VS_TRUE || pobTran->srBRec.uszFiscTransBit == VS_TRUE) &&
			    (pobTran->srBRec.lnTxnAmount <= 50))
			{
				/* 教育訓練版需求要點_V1_10 新增空白授權碼 add by LingHsiung 2018/9/21 下午 05:51:57 */
				/* 新增就銀聯卡及SMART PAY之相關交易，於交易金額$50(含)以下，成功交易、但無授權碼之交易 */
				strcpy(pobTran->srBRec.szAuthCode, "      ");
			}
		}

		/* 主機回應碼 */
		strcpy(pobTran->srBRec.szRespCode, "00");

		if (pobTran->srBRec.uszFiscTransBit == VS_TRUE)
		{
			if (pobTran->srBRec.inCode == _FISC_SALE_)
				sprintf(pobTran->srBRec.szFiscRRN, "123456789012");
		}

		if (pobTran->srBRec.uszInstallmentBit == VS_TRUE)
		{
			if (strlen(pobTran->srBRec.szAuthCode) <= 0)
			{
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memset(szTemplate1, 0x00, sizeof(szTemplate1));
				memset(szTemplate2, 0x00, sizeof(szTemplate2));

				inGetBatchNum(szTemplate1);
				inGetInvoiceNum(szTemplate2);

				sprintf(szTemplate, "%03d%03d", atoi(szTemplate1), atoi(szTemplate2));
				strcpy(pobTran->srBRec.szAuthCode, szTemplate);
			}

			if (pobTran->srBRec.lnInstallmentPeriod == 0)
			{
				/* 聯合分期付款_頭期款 */
				pobTran->srBRec.lnInstallmentDownPayment = pobTran->srBRec.lnTxnAmount;
				pobTran->srBRec.lnInstallmentPayment = 0L; /* 聯合分期付款_每期款 */
			}
			else if(pobTran->srBRec.lnInstallmentPeriod == 3 || pobTran->srBRec.lnInstallmentPeriod == 6 ||
				pobTran->srBRec.lnInstallmentPeriod == 9)
			{
				/* 聯合分期付款_頭期款 */
				pobTran->srBRec.lnInstallmentDownPayment = (pobTran->srBRec.lnTxnAmount / pobTran->srBRec.lnInstallmentPeriod);
				/* 聯合分期付款_每期款 */
				pobTran->srBRec.lnInstallmentPayment = pobTran->srBRec.lnInstallmentDownPayment;
				/* 餘數加到首期 */
				pobTran->srBRec.lnInstallmentDownPayment += (pobTran->srBRec.lnTxnAmount % pobTran->srBRec.lnInstallmentPeriod);
			}
			else
			{
				memset(pobTran->srBRec.szRespCode, 0x00, sizeof(pobTran->srBRec.szRespCode));
				strcpy(pobTran->srBRec.szRespCode, "XB");
				inNCCC_Func_Decide_DispHostRespCodeMsg(pobTran); /* 顯示主機回的錯誤訊息 */

				return (VS_ERROR);
			}

			pobTran->srBRec.lnInstallmentFormalityFee = 0L; /* 聯合分期付款_手續費 */

		}
		else if (pobTran->srBRec.uszRedeemBit == VS_TRUE)
		{
			if (strlen(pobTran->srBRec.szAuthCode) <= 0)
			{
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memset(szTemplate1, 0x00, sizeof(szTemplate1));
				memset(szTemplate2, 0x00, sizeof(szTemplate2));

				inGetBatchNum(szTemplate1);
				inGetInvoiceNum(szTemplate2);

				sprintf(szTemplate, "%03d%03d", atoi(szTemplate1), atoi(szTemplate2));
				strcpy(pobTran->srBRec.szAuthCode, szTemplate);
			}

			if (pobTran->srBRec.uszVOIDBit == VS_FALSE)
			{
				/* 紅利退貨(店給客) */
				if (pobTran->srBRec.inCode == _REDEEM_REFUND_)
				{
					pobTran->srBRec.lnRedemptionPointsBalance = gulDemoRedemptionPointsBalance = (gulDemoRedemptionPointsBalance + pobTran->srBRec.lnRedemptionPoints);

					if (gulDemoRedemptionPointsBalance > 100000)
					{
						pobTran->srBRec.lnRedemptionPointsBalance = gulDemoRedemptionPointsBalance = 100000;
					}
				}
				else
				{
					/* 聯合紅利扣抵_預計扣抵紅利點數 */
					pobTran->srBRec.lnRedemptionPoints = ((pobTran->srBRec.lnTxnAmount / 100) * 100);

					/* 剩餘點數大於扣抵點數 */
					if (gulDemoRedemptionPointsBalance > pobTran->srBRec.lnRedemptionPoints)
					{
						/* 聯合紅利扣抵_實際支付金額 */
						pobTran->srBRec.lnRedemptionPaidCreditAmount = (pobTran->srBRec.lnTxnAmount - (pobTran->srBRec.lnRedemptionPoints / 10));
						/* 聯合紅利扣抵_剩餘紅利點數 */
						pobTran->srBRec.lnRedemptionPointsBalance = gulDemoRedemptionPointsBalance = (gulDemoRedemptionPointsBalance - pobTran->srBRec.lnRedemptionPoints);
					}
					else
					{
						/* 聯合紅利扣抵_扣抵點數 (最多只能扣原本的剩餘點數) */
						pobTran->srBRec.lnRedemptionPoints = gulDemoRedemptionPointsBalance;
						/* 聯合紅利扣抵_實際支付金額 */
						pobTran->srBRec.lnRedemptionPaidCreditAmount = (pobTran->srBRec.lnTxnAmount - (pobTran->srBRec.lnRedemptionPoints / 10));
						/* 聯合紅利扣抵_剩餘紅利點數 */
						pobTran->srBRec.lnRedemptionPointsBalance = gulDemoRedemptionPointsBalance = 0;
					}
				}
			}
			else
			{
				/* 紅利扣抵(原為客給店)				    紅利調帳 */
				if (pobTran->srBRec.inOrgCode == _REDEEM_SALE_ || pobTran->srBRec.inOrgCode == _REDEEM_ADJUST_)
				{
					/* 聯合紅利扣抵_剩餘點數 */
					pobTran->srBRec.lnRedemptionPointsBalance = gulDemoRedemptionPointsBalance = (gulDemoRedemptionPointsBalance + pobTran->srBRec.lnRedemptionPoints);

					if (gulDemoRedemptionPointsBalance > 100000)
						pobTran->srBRec.lnRedemptionPointsBalance = gulDemoRedemptionPointsBalance = 100000;
				}

				/* 紅利退貨(原為店給客) */
				if (pobTran->srBRec.inOrgCode == _REDEEM_REFUND_)
				{
					/* 聯合紅利扣抵_預計扣抵紅利點數 */
					pobTran->srBRec.lnRedemptionPoints = ((pobTran->srBRec.lnTxnAmount / 100) * 100);

					/* 剩餘點數大於扣抵點數 */
					if (gulDemoRedemptionPointsBalance > pobTran->srBRec.lnRedemptionPoints)
					{
						/* 聯合紅利扣抵_實際支付金額 */
						pobTran->srBRec.lnRedemptionPaidCreditAmount = (pobTran->srBRec.lnTxnAmount - (pobTran->srBRec.lnRedemptionPoints / 10));
						/* 聯合紅利扣抵_剩餘紅利點數 */
						pobTran->srBRec.lnRedemptionPointsBalance = gulDemoRedemptionPointsBalance = (gulDemoRedemptionPointsBalance - pobTran->srBRec.lnRedemptionPoints);
					}
					else
					{
						/* 聯合紅利扣抵_扣抵點數 (最多只能扣原本的剩餘點數) */
						pobTran->srBRec.lnRedemptionPoints = gulDemoRedemptionPointsBalance;
						/* 聯合紅利扣抵_實際支付金額 */
						pobTran->srBRec.lnRedemptionPaidCreditAmount = (pobTran->srBRec.lnTxnAmount - (pobTran->srBRec.lnRedemptionPoints / 10));
						/* 聯合紅利扣抵_剩餘紅利點數 */
						pobTran->srBRec.lnRedemptionPointsBalance = gulDemoRedemptionPointsBalance = 0;
					}
				}
			}
		}
                
                /* 【需求單-113260】MasterCard機票交易需求 by Russell 2025/3/3 上午 11:55 */
                if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_126_MASTERCARD_FLIGHT_TICKET_, _CUSTOMER_INDICATOR_SIZE_))
                {
                        if (pobTran->srBRec.szFlightTicketTransBit[0] == _FLIGHT_TICKET_TRANS_YES_)
                        {
                                if ((inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0523, 3, _CHECK_VALIDATION_MODE_1_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0523) == 3) ||
				    (inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0523, 4, _CHECK_VALIDATION_MODE_1_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0523) == 4) ||
				    (inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0523, 5, _CHECK_VALIDATION_MODE_1_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0523) == 5))
                                {
					
				}
				else
				{
					memset(pobTran->srBRec.szRespCode, 0x00, sizeof(pobTran->srBRec.szRespCode));
                                        strcpy(pobTran->srBRec.szRespCode, "05");
                                        sprintf(pobTran->srBRec.szAuthCode, "%s", "REJIDF");
                                        inNCCC_Func_Decide_DispHostRespCodeMsg(pobTran); /* 顯示主機回的錯誤訊息 */
					vdUtility_SYSFIN_LogMessage(AT, "REJIDF,(%s)", pobTran->srBRec.szFlightTicketPDS0523);
					if (ginDebug == VS_TRUE)
					{
						inLogPrintf(AT, "REJIDF,(%s)", pobTran->srBRec.szFlightTicketPDS0523);
					}

                                        return (VS_ERROR);
				}
				
				if ((inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0524, 3, _CHECK_VALIDATION_MODE_1_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0524) == 3)  ||
				    (inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0524, 4, _CHECK_VALIDATION_MODE_1_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0524) == 4)  ||
				    (inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0524, 5, _CHECK_VALIDATION_MODE_1_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0524) == 5))
				{
					
				}
				else
				{
					memset(pobTran->srBRec.szRespCode, 0x00, sizeof(pobTran->srBRec.szRespCode));
                                        strcpy(pobTran->srBRec.szRespCode, "05");
                                        sprintf(pobTran->srBRec.szAuthCode, "%s", "REJIDF");
                                        inNCCC_Func_Decide_DispHostRespCodeMsg(pobTran); /* 顯示主機回的錯誤訊息 */
					vdUtility_SYSFIN_LogMessage(AT, "REJIDF,(%s)", pobTran->srBRec.szFlightTicketPDS0524);
					if (ginDebug == VS_TRUE)
					{
						inLogPrintf(AT, "REJIDF,(%s)", pobTran->srBRec.szFlightTicketPDS0524);
					}

                                        return (VS_ERROR);
				}
                                
                                
                                if ((inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0530, 3, _CHECK_VALIDATION_MODE_2_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0530) == 3) ||
				    (inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0530, 4, _CHECK_VALIDATION_MODE_2_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0530) == 4) ||
				    (inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0530, 5, _CHECK_VALIDATION_MODE_2_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0530) == 5))
				{
					
				}
				else
                                {
                                        memset(pobTran->srBRec.szRespCode, 0x00, sizeof(pobTran->srBRec.szRespCode));
                                        strcpy(pobTran->srBRec.szRespCode, "05");
                                        sprintf(pobTran->srBRec.szAuthCode, "%s", "REJIDV");
                                        inNCCC_Func_Decide_DispHostRespCodeMsg(pobTran); /* 顯示主機回的錯誤訊息 */

                                        return (VS_ERROR);
                                }
                        }
			else if (pobTran->srBRec.szFlightTicketTransBit[0] == _FLIGHT_TICKET_TRANS_NOT_)
			{
                                if ((inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0523, 3, _CHECK_VALIDATION_MODE_1_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0523) == 3) ||
				    (inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0523, 4, _CHECK_VALIDATION_MODE_1_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0523) == 4) ||
				    (inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0523, 5, _CHECK_VALIDATION_MODE_1_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0523) == 5) ||
				   !memcmp(pobTran->srBRec.szFlightTicketPDS0523, _FLIGHT_TICKET_PDS0523_SOUVENIR_, max(strlen(pobTran->srBRec.szFlightTicketPDS0523), strlen(_FLIGHT_TICKET_PDS0523_SOUVENIR_))))
                                {
					
				}
				else
				{
					memset(pobTran->srBRec.szRespCode, 0x00, sizeof(pobTran->srBRec.szRespCode));
                                        strcpy(pobTran->srBRec.szRespCode, "05");
                                        sprintf(pobTran->srBRec.szAuthCode, "%s", "REJIDF");
                                        inNCCC_Func_Decide_DispHostRespCodeMsg(pobTran); /* 顯示主機回的錯誤訊息 */
					vdUtility_SYSFIN_LogMessage(AT, "REJIDF,(%s)", pobTran->srBRec.szFlightTicketPDS0523);
					if (ginDebug == VS_TRUE)
					{
						inLogPrintf(AT, "REJIDF,(%s)", pobTran->srBRec.szFlightTicketPDS0523);
					}

                                        return (VS_ERROR);
				}
				
				if ((inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0524, 3, _CHECK_VALIDATION_MODE_1_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0524) == 3) ||
				    (inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0524, 4, _CHECK_VALIDATION_MODE_1_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0524) == 3) ||
				    (inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0524, 5, _CHECK_VALIDATION_MODE_1_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0524) == 3) ||
				   !memcmp(pobTran->srBRec.szFlightTicketPDS0524, _FLIGHT_TICKET_PDS0523_SOUVENIR_, max(strlen(pobTran->srBRec.szFlightTicketPDS0524), strlen(_FLIGHT_TICKET_PDS0523_SOUVENIR_))))
				{
					
				}
				else
				{
					memset(pobTran->srBRec.szRespCode, 0x00, sizeof(pobTran->srBRec.szRespCode));
                                        strcpy(pobTran->srBRec.szRespCode, "05");
                                        sprintf(pobTran->srBRec.szAuthCode, "%s", "REJIDF");
                                        inNCCC_Func_Decide_DispHostRespCodeMsg(pobTran); /* 顯示主機回的錯誤訊息 */
					vdUtility_SYSFIN_LogMessage(AT, "REJIDF,(%s)", pobTran->srBRec.szFlightTicketPDS0524);
					if (ginDebug == VS_TRUE)
					{
						inLogPrintf(AT, "REJIDF,(%s)", pobTran->srBRec.szFlightTicketPDS0524);
					}

                                        return (VS_ERROR);
				}
                                
                                if (!memcmp(pobTran->srBRec.szFlightTicketPDS0524, _FLIGHT_TICKET_PDS0523_SOUVENIR_, max(strlen(pobTran->srBRec.szFlightTicketPDS0524), strlen(_FLIGHT_TICKET_PDS0523_SOUVENIR_))))
				{
					if (strlen(pobTran->srBRec.szFlightTicketPDS0530) == 0)
					{
						
					}
				}
				else
				{
					if ((inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0530, 3, _CHECK_VALIDATION_MODE_2_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0530) == 3) ||
					    (inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0530, 4, _CHECK_VALIDATION_MODE_2_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0530) == 4) ||
					    (inFunc_Check_Validation(pobTran->srBRec.szFlightTicketPDS0530, 5, _CHECK_VALIDATION_MODE_2_) == VS_TRUE && strlen(pobTran->srBRec.szFlightTicketPDS0530) == 5))
					{

					}
					else
					{
						memset(pobTran->srBRec.szRespCode, 0x00, sizeof(pobTran->srBRec.szRespCode));
						strcpy(pobTran->srBRec.szRespCode, "05");
						sprintf(pobTran->srBRec.szAuthCode, "%s", "REJIDV");
						inNCCC_Func_Decide_DispHostRespCodeMsg(pobTran); /* 顯示主機回的錯誤訊息 */

						return (VS_ERROR);
					}
				}
                        }
                        
                        if (pobTran->srBRec.szFlightTicketTransBit[0] == _FLIGHT_TICKET_TRANS_YES_)
                        {
                                if (!memcmp(pobTran->srBRec.szFlightTicketPDS0523, pobTran->srBRec.szFlightTicketPDS0524, max(strlen(pobTran->srBRec.szFlightTicketPDS0523), strlen(pobTran->srBRec.szFlightTicketPDS0524))))
                                {
                                        memset(pobTran->srBRec.szRespCode, 0x00, sizeof(pobTran->srBRec.szRespCode));
                                        strcpy(pobTran->srBRec.szRespCode, "05");
                                        sprintf(pobTran->srBRec.szAuthCode, "%s", "REJIDR");
                                        inNCCC_Func_Decide_DispHostRespCodeMsg(pobTran); /* 顯示主機回的錯誤訊息 */

                                        return (VS_ERROR);
                                }
                        }
                }

		/* VEPS */
		/* DCC沒有NQ */
		if (pobTran->srBRec.uszDCCTransBit == VS_FALSE)
		{
			if (pobTran->srBRec.inCode == _SALE_)
			{
				if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_VISA_, strlen(_CARD_TYPE_VISA_)) == 0 && 
				    pobTran->srBRec.lnTxnAmount <= 800)
				{
					pobTran->srBRec.uszVEPS_SignatureBit = VS_TRUE;
				}
				else if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_MASTERCARD_, strlen(_CARD_TYPE_MASTERCARD_)) == 0 && 
					 pobTran->srBRec.lnTxnAmount <= 1500)
				{
					pobTran->srBRec.uszVEPS_SignatureBit = VS_TRUE;
				}
				else if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_JCB_, strlen(_CARD_TYPE_JCB_)) == 0 && 
					 pobTran->srBRec.lnTxnAmount <= 700)
				{
					pobTran->srBRec.uszVEPS_SignatureBit = VS_TRUE;
				}
				else if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_AMEX_, strlen(_CARD_TYPE_AMEX_)) == 0 && 
					 pobTran->srBRec.lnTxnAmount <= 3000)
				{
					pobTran->srBRec.uszVEPS_SignatureBit = VS_TRUE;
				}
			}
			else if (pobTran->srBRec.inCode == _CUP_SALE_)
			{
				if (pobTran->srBRec.lnTxnAmount <= 800)
				{
					pobTran->srBRec.uszVEPS_SignatureBit = VS_TRUE;
				}
			}
			
			/* 符合快速支付，免簽名 */
			if (pobTran->srBRec.uszVEPS_SignatureBit == VS_TRUE)
			{
				pobTran->srBRec.uszNoSignatureBit = VS_TRUE;
			}
		}
	}

	/* MPAS小額交易	1. 程式HARD CODE：小額限額 $1000(含)以上印出簽單 */
	if (memcmp(szFESMode, _NCCC_04_MPAS_MODE_, strlen(_NCCC_04_MPAS_MODE_)) == 0)
	{
                /* 客製化098為1000，客製化105為1500 */
                if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_098_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_))  
                {
                        if (pobTran->srBRec.lnTxnAmount <= 1000)
                        {
                                pobTran->srBRec.uszMPASTransBit = VS_TRUE;
                                pobTran->srTRec.uszMPASTransBit = VS_TRUE;
                        } 
                }
                else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_105_MCDONALDS_, _CUSTOMER_INDICATOR_SIZE_))  
                {
                        if (pobTran->srBRec.lnTxnAmount <= 1500)
                        {
                                pobTran->srBRec.uszMPASTransBit = VS_TRUE;
                                pobTran->srTRec.uszMPASTransBit = VS_TRUE;
                        }
                }
                else
                {
                        if (pobTran->srBRec.lnTxnAmount < 1000)
                        {
                                pobTran->srBRec.uszMPASTransBit = VS_TRUE;
                                pobTran->srTRec.uszMPASTransBit = VS_TRUE;
                        }
                }    
		
		if (pobTran->srBRec.uszMPASTransBit == VS_TRUE)
		{
			pobTran->srBRec.uszVEPS_SignatureBit = VS_TRUE;
		}
		
		if (pobTran->srBRec.uszVEPS_SignatureBit == VS_TRUE)
		{
			pobTran->srBRec.uszNoSignatureBit = VS_TRUE;
		}
		
		pobTran->srBRec.uszMPASReprintBit = VS_TRUE;
		pobTran->srTRec.uszMPASReprintBit = VS_TRUE;
	}
	
	/* 顯示優惠類別 */
	if (pobTran->srBRec.lnTxnAmount >= 5000 && (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_VISA_, strlen(_CARD_TYPE_VISA_)) == 0) &&
	    inNCCC_Loyalty_ASM_Flag() == VS_SUCCESS)
	{
		memset(pobTran->srBRec.szAwardNum, 0x00, sizeof(pobTran->srBRec.szAwardNum));
		memcpy(pobTran->srBRec.szAwardNum, "1", 1);
		pobTran->srBRec.uszRewardL1Bit = VS_TRUE;
		pobTran->srBRec.uszRewardL2Bit = VS_TRUE;
	}

	/* 金融機構代碼 */
	if (pobTran->srBRec.inCode == _PRE_AUTH_           || pobTran->srBRec.inCode == _CUP_PRE_AUTH_		||
	    pobTran->srBRec.inCode == _CUP_PRE_AUTH_VOID_  || pobTran->srBRec.inCode == _SALE_			||
	    pobTran->srBRec.inCode == _INST_SALE_          || pobTran->srBRec.inCode == _REDEEM_SALE_		||
	    pobTran->srBRec.inCode == _MAIL_ORDER_         || pobTran->srBRec.inCode == _CUP_SALE_		||
	    pobTran->srBRec.inCode == _CUP_MAIL_ORDER_     || pobTran->srBRec.inCode == _CASH_ADVANCE_		||
	    pobTran->srBRec.inCode == _REFUND_             || pobTran->srBRec.inCode == _REDEEM_REFUND_		||
	    pobTran->srBRec.inCode == _INST_REFUND_        || pobTran->srBRec.inCode == _CUP_REFUND_		||
	    pobTran->srBRec.inCode == _PRE_COMP_           || pobTran->srBRec.inCode == _SALE_OFFLINE_		||
	    pobTran->srBRec.inCode == _CUP_PRE_COMP_       || pobTran->srBRec.inCode == _VOID_			||
	    pobTran->srBRec.inCode == _CUP_VOID_           || pobTran->srBRec.inCode == _CUP_PRE_COMP_VOID_	||
	    pobTran->srBRec.inCode == _REDEEM_ADJUST_      || pobTran->srBRec.inCode == _INST_ADJUST_		||
	    pobTran->srBRec.inCode == _FORCE_CASH_ADVANCE_ || pobTran->srBRec.inCode == _CUP_MAIL_ORDER_REFUND_)
	{
		memset(pobTran->srBRec.szMCP_BANKID, 0x00, sizeof(pobTran->srBRec.szMCP_BANKID));

		if (pobTran->srBRec.uszContactlessBit == VS_TRUE && pobTran->srBRec.lnTxnAmount == 5000)
		{
			pobTran->srBRec.uszMobilePayBit = VS_TRUE;
			memcpy(&pobTran->srBRec.szMCP_BANKID[0], "T", 1);

			if (pobTran->srBRec.uszMobilePayBit == VS_TRUE && pobTran->srBRec.uszInstallmentBit != VS_TRUE)
			{
				pobTran->srBRec.uszVEPS_SignatureBit = VS_TRUE;
			}
			
			if (pobTran->srBRec.uszVEPS_SignatureBit == VS_TRUE)
			{
				pobTran->srBRec.uszNoSignatureBit = VS_TRUE;
			}
		}
		else
		{
			memcpy(&pobTran->srBRec.szMCP_BANKID[0], " ", 1);
		}

		if (pobTran->srBRec.lnTxnAmount == 1000)
			memcpy(&pobTran->srBRec.szMCP_BANKID[1], "822", 3);
		else if (pobTran->srBRec.lnTxnAmount == 2000)
			memcpy(&pobTran->srBRec.szMCP_BANKID[1], "012", 3);
		else if (pobTran->srBRec.lnTxnAmount == 3000)
			memcpy(&pobTran->srBRec.szMCP_BANKID[1], "013", 3);
		else if (pobTran->srBRec.lnTxnAmount == 4000)
			memcpy(&pobTran->srBRec.szMCP_BANKID[1], "999", 3);
		else if (pobTran->srBRec.lnTxnAmount == 5000)
			memcpy(&pobTran->srBRec.szMCP_BANKID[1], "808", 3);
		else
			memcpy(&pobTran->srBRec.szMCP_BANKID[1], "   ", 3);
	}
	
	/* 教育訓練版收銀機連線E模式 欄位37新增回覆內容 */
	if (pobTran->srBRec.inCode == _PRE_AUTH_           || pobTran->srBRec.inCode == _CUP_PRE_AUTH_		||
	    pobTran->srBRec.inCode == _CUP_PRE_AUTH_VOID_  || pobTran->srBRec.inCode == _SALE_			||
	    pobTran->srBRec.inCode == _INST_SALE_          || pobTran->srBRec.inCode == _REDEEM_SALE_		||
	    pobTran->srBRec.inCode == _MAIL_ORDER_         || pobTran->srBRec.inCode == _CUP_SALE_		||
	    pobTran->srBRec.inCode == _CUP_MAIL_ORDER_     || pobTran->srBRec.inCode == _CASH_ADVANCE_		||
	    pobTran->srBRec.inCode == _REFUND_             || pobTran->srBRec.inCode == _REDEEM_REFUND_		||
	    pobTran->srBRec.inCode == _INST_REFUND_        || pobTran->srBRec.inCode == _CUP_REFUND_		||
	    pobTran->srBRec.inCode == _PRE_COMP_           || pobTran->srBRec.inCode == _SALE_OFFLINE_		||
	    pobTran->srBRec.inCode == _CUP_PRE_COMP_       || pobTran->srBRec.inCode == _VOID_			||
	    pobTran->srBRec.inCode == _CUP_VOID_           || pobTran->srBRec.inCode == _CUP_PRE_COMP_VOID_	||
	    pobTran->srBRec.inCode == _REDEEM_ADJUST_      || pobTran->srBRec.inCode == _INST_ADJUST_		||
	    pobTran->srBRec.inCode == _FORCE_CASH_ADVANCE_ || pobTran->srBRec.inCode == _CUP_MAIL_ORDER_REFUND_)
	{
		memset(szTemplate1, 0x00, sizeof(szTemplate1));
		memcpy(szTemplate1, &pobTran->srBRec.szMCP_BANKID[1], 3);
		
		if (memcmp(szTemplate1, "   ", 3) == 0)
		{
			/* 無事發生 */
		}
		else
		{
			memset(szTemplate, 0x00, sizeof(szTemplate));
			sprintf(szTemplate, "B00%s", szTemplate1);
			memset(pobTran->srBRec.szEIVI_BANKID, 0x00, sizeof(pobTran->srBRec.szEIVI_BANKID)); 
			memcpy(&pobTran->srBRec.szEIVI_BANKID[0], szTemplate, 6);
		}
	}

	/* "65"開頭的卡片當作UCARD add by LingHsiung 2018/9/25 下午 01:09:03 */
	/* 預設BIN RANGE 65054100~65054125為TWIN卡(國內自有品牌卡片，實際BIN RANGE請依TMS下載為主)。
	 * 收銀機連線部分，請比照標準400bytes收銀機連線做法，感應卡別為T、卡別放01。 */
	memset(szTemplate, 0x00, sizeof(szTemplate));
	memcpy(szTemplate, &pobTran->srBRec.szPAN[0], 8);
	if (atoi(szTemplate) >=  65054100 &&
	    atoi(szTemplate) <=  65054125 &&
	    pobTran->srBRec.uszCUPTransBit != VS_TRUE &&
	    pobTran->srBRec.uszFiscTransBit != VS_TRUE)
	{
		pobTran->srBRec.uszUCARDTransBit = VS_TRUE;
		memcpy(&pobTran->srBRec.szMCP_BANKID[4], "U05UCARD", 8);
	}
	
	/* 一般信用卡感應交易	1.	程式HARD CODE：$3000以下簽單印免簽名。 */
	if (pobTran->srBRec.uszContactlessBit == VS_TRUE &&
	    (pobTran->srBRec.inCode == _SALE_ || pobTran->srBRec.inCode == _CUP_SALE_))
	{
		if (pobTran->srBRec.lnTxnAmount <= 3000)
		{
			pobTran->srBRec.uszNoSignatureBit = VS_TRUE;
		}
	}

	/* 端末機教育訓練版需求要點 V1_18 (20211001) */
	if (pobTran->srBRec.uszUnyTransBit == VS_TRUE)
	{
		if ((pobTran->srBRec.lnTxnAmount % 10) >= 0	&&
		    (pobTran->srBRec.lnTxnAmount % 10) <= 5)
		{
			memset(pobTran->srBRec.szCardLabel, 0x00, sizeof(pobTran->srBRec.szCardLabel));
			strcpy(pobTran->srBRec.szCardLabel, _CARD_TYPE_VISA_);
		}
		else if ((pobTran->srBRec.lnTxnAmount % 10) >= 6	&&
		         (pobTran->srBRec.lnTxnAmount % 10) <= 9)
		{
			memset(pobTran->srBRec.szCardLabel, 0x00, sizeof(pobTran->srBRec.szCardLabel));
			strcpy(pobTran->srBRec.szCardLabel, _CARD_TYPE_MASTERCARD_);
		}
		
		/* UNY 實體掃碼交易碼（由 ATS 編製唯一值回覆）。（註1) */
		if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_VISA_, strlen(pobTran->srBRec.szCardLabel)) == 0)
		{
			memcpy(pobTran->srBRec.szUnyTransCode, "UN2021093014104938  ", 20);
		}
		else if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_MASTERCARD_, strlen(pobTran->srBRec.szCardLabel)) == 0)
		{
			memcpy(pobTran->srBRec.szUnyTransCode, "UN2021093014105430  ", 20);
		}
		

		/* 遮掩交易卡號資料，回覆前6 後 4 ，中間以 A 字進行遮掩，左靠右補空白。 */
		if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_VISA_, strlen(pobTran->srBRec.szCardLabel)) == 0)
		{
			memcpy(pobTran->srBRec.szUnyMaskedCardNo, "493817AAAAAA0003    ", 20);
		}
		else if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_MASTERCARD_, strlen(pobTran->srBRec.szCardLabel)) == 0)
		{
			memcpy(pobTran->srBRec.szUnyMaskedCardNo, "543045AAAAAA0009    ", 20);
		}
		
		for (i = 0; i < strlen(pobTran->srBRec.szUnyMaskedCardNo); i++)
		{
			if (pobTran->srBRec.szUnyMaskedCardNo[i] == 'A')
			{
				pobTran->srBRec.szPAN[i] = '*';
			}
			else
			{
				pobTran->srBRec.szPAN[i] = pobTran->srBRec.szUnyMaskedCardNo[i];
			}
		}
		inFunc_DiscardSpace(pobTran->srBRec.szPAN);

		/* 簽單檢查碼 */
		if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_VISA_, strlen(pobTran->srBRec.szCardLabel)) == 0)
		{
			memcpy(pobTran->srBRec.szCheckNO, "49553", 5);
		}
		else if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_MASTERCARD_, strlen(pobTran->srBRec.szCardLabel)) == 0)
		{
			memcpy(pobTran->srBRec.szCheckNO, "85917", 5);
		}

		/* 電子發票HASH 值 */
		if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_VISA_, strlen(pobTran->srBRec.szCardLabel)) == 0)
		{
			memcpy(pobTran->srBRec.szEInvoiceHASH, "7UY4FBNXXZBS+EA8TCSLZXNHWSSNZKTLE0S6EEGOHP0=", 44);
		}
		else if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_MASTERCARD_, strlen(pobTran->srBRec.szCardLabel)) == 0)
		{
			memcpy(pobTran->srBRec.szEInvoiceHASH, "ZKKB/VBLWND01IS2FHTKYA/1K6RCOLYDRFUWRR3RK9E=", 44);
		}

		/* 卡別名稱長度。 */
		if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_VISA_, strlen(pobTran->srBRec.szCardLabel)) == 0)
		{
			memcpy(pobTran->srBRec.szUnyCardLabelLen, "04", 2);
		}
		else if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_MASTERCARD_, strlen(pobTran->srBRec.szCardLabel)) == 0)
		{
			memcpy(pobTran->srBRec.szUnyCardLabelLen, "10", 2);
		}

		/* 卡別名稱。 */
		if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_VISA_, strlen(pobTran->srBRec.szCardLabel)) == 0)
		{
			memcpy(pobTran->srBRec.szUnyCardLabel, "VISA", atoi(pobTran->srBRec.szUnyCardLabelLen));
		}
		else if (memcmp(pobTran->srBRec.szCardLabel, _CARD_TYPE_MASTERCARD_, strlen(pobTran->srBRec.szCardLabel)) == 0)
		{
			memcpy(pobTran->srBRec.szUnyCardLabel, "MASTERCARD", atoi(pobTran->srBRec.szUnyCardLabelLen));
		}
	}
		
	/* 簽名flag關 分期交易及fallback一律要簽名 DCC也要簽名 */
	/* 依照mail要簽名交易 徐聖鎧(Shengkai Hsu) <shengkai.hsu@nccc.com.tw> 2019/12/3 (週二) 上午 11:58 */
	if (pobTran->srBRec.uszUnyTransBit == VS_TRUE)
	{
		/* uny交易優先度高於分期退貨，所以不用簽名 */
		pobTran->srBRec.uszNoSignatureBit = VS_TRUE;
	}
	else if (pobTran->srBRec.uszInstallmentBit == VS_TRUE	|| 
	     pobTran->srBRec.uszDCCTransBit == VS_TRUE		||
	     pobTran->srBRec.inCode == _TIP_			||
	     pobTran->srBRec.inCode == _REFUND_			||
	     pobTran->srBRec.inCode == _REDEEM_REFUND_		||
	     pobTran->srBRec.inCode == _INST_REFUND_		||
	     pobTran->srBRec.inCode == _CUP_REFUND_)
	{
		pobTran->srBRec.uszVEPS_SignatureBit = VS_FALSE;
		pobTran->srBRec.uszNoSignatureBit = VS_FALSE;
		pobTran->srBRec.uszMPASTransBit = VS_FALSE;
	}
	
	return (VS_SUCCESS);
}
 
/*
Function        :inNCCC_Func_DEMO_Get_DCC_F59_DATA
Date&Time       :2019/10/8 上午 10:16
Describe        :
*/
int inNCCC_Func_DEMO_Get_DCC_F59_DATA(TRANSACTION_OBJECT *pobTran)
{
	int	inERV = 0;
	int	inERMU = 0;
	int	inFCMU = 0;
	int	inTenPower = 0;
	char	szTenPower[8 + 1] = {0};
	long	lnFCA = 0;
        
	/* F_59的值 */
	/* 之後用DDM的資料，現在先hard code */
	/* (需求單-110175)-端末設備配合實務優化流程需求 
	 * 教育訓練版，DCC交易畫面和簽單之Currency Conversion Fee由3% 調整為4%。
	 * by Russell 2021/12/20 下午 4:05 */
        /* pobTran->srBRec.szDCC_FCN 幣別可參考inNCCC_DCC_CHECK ，以下為DCC設定交易的外幣、匯率等*/
	if (!memcmp(pobTran->srBRec.szDCC_FCN, "392", 3))
	{// Tusin_076
                memcpy(pobTran->srBRec.szDCC_FCAC, _CURRENCY_JPY_ENG_NAME_, _CURRENCY_JPY_ENG_NAME_LEN_);
		memcpy(pobTran->srBRec.szDCC_FCNFR, "392", 3);
		memcpy(pobTran->srBRec.szDCC_FCMU, "0", 1);
		
		memcpy(pobTran->srBRec.szDCC_ERMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_ERV, "000040863", 9);

		memcpy(pobTran->srBRec.szDCC_IRMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_IRV, "000244720", 9);
		memcpy(pobTran->srBRec.szDCC_IRDU, "2", 1);
	}
	else if (!memcmp(pobTran->srBRec.szDCC_FCN, "344", 3))
	{
		memcpy(pobTran->srBRec.szDCC_FCAC, _CURRENCY_HKD_ENG_NAME_, _CURRENCY_HKD_ENG_NAME_LEN_);
		memcpy(pobTran->srBRec.szDCC_FCNFR, "344", 3);
		memcpy(pobTran->srBRec.szDCC_FCMU, "2", 1);

		memcpy(pobTran->srBRec.szDCC_ERMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_ERV, "000002640", 9);

		memcpy(pobTran->srBRec.szDCC_IRMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_IRV, "000037878", 9);
		memcpy(pobTran->srBRec.szDCC_IRDU, "0", 1);
	}
	else if (!memcmp(pobTran->srBRec.szDCC_FCN, "978", 3))
	{
		memcpy(pobTran->srBRec.szDCC_FCAC, _CURRENCY_EUR_ENG_NAME_, _CURRENCY_EUR_ENG_NAME_LEN_);
		memcpy(pobTran->srBRec.szDCC_FCNFR, "978", 3);
		memcpy(pobTran->srBRec.szDCC_FCMU, "2", 1);

		memcpy(pobTran->srBRec.szDCC_ERMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_ERV, "000000305", 9);

		memcpy(pobTran->srBRec.szDCC_IRMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_IRV, "000327868", 9);
		memcpy(pobTran->srBRec.szDCC_IRDU, "0", 1);
	}
	else if (!memcmp(pobTran->srBRec.szDCC_FCN, "410", 3))
	{
		memcpy(pobTran->srBRec.szDCC_FCAC, _CURRENCY_KRW_ENG_NAME_, _CURRENCY_KRW_ENG_NAME_LEN_);
		memcpy(pobTran->srBRec.szDCC_FCNFR, "410", 3);
		memcpy(pobTran->srBRec.szDCC_FCMU, "0", 1);

		memcpy(pobTran->srBRec.szDCC_ERMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_ERV, "000368781", 9);

		memcpy(pobTran->srBRec.szDCC_IRMU, "2", 1);
		memcpy(pobTran->srBRec.szDCC_IRV, "000027116", 9);
		memcpy(pobTran->srBRec.szDCC_IRDU, "2", 1);
	}
	else if (!memcmp(pobTran->srBRec.szDCC_FCN, "458", 3))
	{
		memcpy(pobTran->srBRec.szDCC_FCAC, _CURRENCY_MYR_ENG_NAME_, _CURRENCY_MYR_ENG_NAME_LEN_);
		memcpy(pobTran->srBRec.szDCC_FCNFR, "458", 3);
		memcpy(pobTran->srBRec.szDCC_FCMU, "2", 1);

		memcpy(pobTran->srBRec.szDCC_ERMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_ERV, "000001223", 9);

		memcpy(pobTran->srBRec.szDCC_IRMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_IRV, "000081766", 9);
		memcpy(pobTran->srBRec.szDCC_IRDU, "0", 1);
	}
	else if (!memcmp(pobTran->srBRec.szDCC_FCN, "702", 3))
	{
		memcpy(pobTran->srBRec.szDCC_FCAC, _CURRENCY_SGD_ENG_NAME_, _CURRENCY_SGD_ENG_NAME_LEN_);
		memcpy(pobTran->srBRec.szDCC_FCNFR, "702", 3);
		memcpy(pobTran->srBRec.szDCC_FCMU, "2", 1);

		memcpy(pobTran->srBRec.szDCC_ERMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_ERV, "000000447", 9);

		memcpy(pobTran->srBRec.szDCC_IRMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_IRV, "000223713", 9);
		memcpy(pobTran->srBRec.szDCC_IRDU, "0", 1);
	}
	else if (!memcmp(pobTran->srBRec.szDCC_FCN, "764", 3))
	{
		memcpy(pobTran->srBRec.szDCC_FCAC, _CURRENCY_THB_ENG_NAME_, _CURRENCY_THB_ENG_NAME_LEN_);
		memcpy(pobTran->srBRec.szDCC_FCNFR, "764", 3);
		memcpy(pobTran->srBRec.szDCC_FCMU, "2", 1);

		memcpy(pobTran->srBRec.szDCC_ERMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_ERV, "000011493", 9);

		memcpy(pobTran->srBRec.szDCC_IRMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_IRV, "000008700", 9);
		memcpy(pobTran->srBRec.szDCC_IRDU, "0", 1);
	}
	else if (!memcmp(pobTran->srBRec.szDCC_FCN, "036", 3))
	{
		memcpy(pobTran->srBRec.szDCC_FCAC, _CURRENCY_AUD_ENG_NAME_, _CURRENCY_AUD_ENG_NAME_LEN_);
		memcpy(pobTran->srBRec.szDCC_FCNFR, "036", 3);
		memcpy(pobTran->srBRec.szDCC_FCMU, "2", 1);

		memcpy(pobTran->srBRec.szDCC_ERMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_ERV, "000000436", 9);

		memcpy(pobTran->srBRec.szDCC_IRMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_IRV, "000229357", 9);
		memcpy(pobTran->srBRec.szDCC_IRDU, "0", 1);
	}
	else if (!memcmp(pobTran->srBRec.szDCC_FCN, "124", 3))
	{
		memcpy(pobTran->srBRec.szDCC_FCAC, _CURRENCY_CAD_ENG_NAME_, _CURRENCY_CAD_ENG_NAME_LEN_);
		memcpy(pobTran->srBRec.szDCC_FCNFR, "124", 3);
		memcpy(pobTran->srBRec.szDCC_FCMU, "2", 1);

		memcpy(pobTran->srBRec.szDCC_ERMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_ERV, "000000429", 9);

		memcpy(pobTran->srBRec.szDCC_IRMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_IRV, "000233100", 9);
		memcpy(pobTran->srBRec.szDCC_IRDU, "0", 1);
	}
	else
	{
		memcpy(pobTran->srBRec.szDCC_FCN, "840", 3);
		memcpy(pobTran->srBRec.szDCC_FCAC, _CURRENCY_USD_ENG_NAME_, _CURRENCY_USD_ENG_NAME_LEN_);
		memcpy(pobTran->srBRec.szDCC_FCNFR, "840", 3);
		memcpy(pobTran->srBRec.szDCC_FCMU, "2", 1);

		memcpy(pobTran->srBRec.szDCC_ERMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_ERV, "000000341", 9);

		memcpy(pobTran->srBRec.szDCC_IRMU, "4", 1);
		memcpy(pobTran->srBRec.szDCC_IRV, "000293255", 9);
		memcpy(pobTran->srBRec.szDCC_IRDU, "0", 1);
	}
        
        // 重複的移到這，預設else是美金
        memcpy(pobTran->srBRec.szDCC_AC, "8800", 4);
        
        memcpy(pobTran->srBRec.szDCC_MPV, "4.000000", 9);
        memcpy(pobTran->srBRec.szDCC_MPDP, "0", 1);

        memcpy(pobTran->srBRec.szDCC_CVCN, "901", 3);
        memcpy(pobTran->srBRec.szDCC_CVCA, "000000000000", 12);
        memcpy(pobTran->srBRec.szDCC_CVCMU, "0", 1);

        inERMU = atoi(pobTran->srBRec.szDCC_ERMU);
        inFCMU = atoi(pobTran->srBRec.szDCC_FCMU);
        inERV = atoi(pobTran->srBRec.szDCC_ERV);
        /*計算外幣金額*/
        if ((inERMU - inFCMU) != 0)
        {
                strcpy(szTenPower, "1");
                inFunc_PAD_ASCII(szTenPower, szTenPower, '0', ((inERMU - inFCMU) + 1), _PADDING_RIGHT_);
                inTenPower = atoi(szTenPower);
                lnFCA = (long)(((long long)pobTran->srBRec.lnTxnAmount * inERV) / inTenPower);
        }
        else
        {
                lnFCA = (long)((long long)pobTran->srBRec.lnTxnAmount * inERV);
        }

        sprintf(pobTran->srBRec.szDCC_FCA, "%012ld", lnFCA);
	
	return (VS_SUCCESS);
}


/*
Function        :inNCCC_Func_Set_Terminal_Password
Date&Time       :2019/2/19 下午 4:19
Describe        :
*/
int inNCCC_Func_Set_Terminal_Password(void)
{
	int	inRetVal = VS_SUCCESS;
	char	szPMPasswoord[8 + 1] = {0};
	char	szFunKeyPasswoord[8 + 1] = {0};
	
	inLoadEDCRec(0);
	
	/* Set PM Enter Password */
	memset(szPMPasswoord, 0x00, sizeof(szPMPasswoord));
	inGetPMPassword(szPMPasswoord);
	if (strlen(szPMPasswoord) > 0)
	{
		inCastlePWD_Set_PMEnterPassword((unsigned char*)szPMPasswoord, 1);
	}
	
	/* Set FunKey Password */
	memset(szFunKeyPasswoord, 0x00, sizeof(szFunKeyPasswoord));
	inGetFunKeyPassword(szFunKeyPasswoord);
	if (strlen(szFunKeyPasswoord) > 0)
	{
		inCastlePWD_Set_FunKeyPassword((unsigned char*)szFunKeyPasswoord, 1);
	}
	
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_CFES_Poka_Yoke_Setting
Date&Time       :2019/3/6 下午 5:43
Describe        :CFES防呆機制
*/
int inNCCC_Func_CFES_Poka_Yoke_Setting(void)
{
	int	inRetVal = VS_SUCCESS;
	char	szFESMode[2 + 1] = {0};
	char	szCFESMode[2 + 1] = {0};
	char	szEncryptMode[2 + 1] = {0};
	
	/* (需求單 - 107276)自助交易標準做法 MFES雲端化 by Russell 2019/3/6 上午 10:32 */
	/* 吳升文(Angus Wu) <angus.wu@nccc.com.tw> 2018-01-31 (週三) 下午 03:55
		未來雲端MFES的參數應該是
		(FES_MODE=MFES) && (雲端MFES=Y)

		既有MFES的參數應該是
		(FES_MODE=MFES) && (雲端MFES=N)

		端末機只有設定為(FES_MODE=MFES)時，才需要參考(雲端MFES)的參數值即可。
		若(FES_MODE=ATS || MPAS )端末機就可以不管 (雲端MFES)的參數。

		端末機只有設定為(FES_MODE=ATS || MPAS)時，才需要參考(I-FES_Mode)的參數值即可
	 */
	inLoadCFGTRec(0);
	
	memset(szFESMode, 0x00, sizeof(szFESMode));
	inGetNCCCFESMode(szFESMode);
	memset(szCFESMode, 0x00, sizeof(szCFESMode));
	inGetCloud_MFES(szCFESMode);
	memset(szEncryptMode, 0x00, sizeof(szEncryptMode));
	inGetEncryptMode(szEncryptMode);
	
	if (memcmp(szFESMode, _NCCC_03_MFES_MODE_, strlen(_NCCC_03_MFES_MODE_)) == 0)
	{
		if (memcmp(szCFESMode, "Y", strlen("Y")) == 0)
		{
			inSetI_FES_Mode("N");
			/* 吳升文(Angus Wu) <angus.wu@nccc.com.tw> 2018-02-02 (週五) 下午 05:17
				EDC判斷Cloud MFES = Y，且設定為「2=軟體加密」時，要自行轉為不加密。如果是t-SAM加密就不要轉。 */
			if (memcmp(szEncryptMode, _NCCC_ENCRYPTION_SOFTWARE_, strlen(_NCCC_ENCRYPTION_SOFTWARE_)) == 0)
			{
				inSetEncryptMode(_NCCC_ENCRYPTION_NONE_);
			}
		}
		else
		{
			inSetI_FES_Mode("N");
			inSetCloud_MFES("N");
		}
	}
	else
	{
		/* 其他不會開的直接設成false 避免異常 */
		inSetCloud_MFES("N");
	}
	
	inSaveCFGTRec(0);
	
	if (memcmp(szFESMode, _NCCC_03_MFES_MODE_, strlen(_NCCC_03_MFES_MODE_)) == 0)
	{
		if (memcmp(szCFESMode, "Y", strlen("Y")) == 0)
		{
			/* 【需求】Cloud MFES的TMS IP及SFTP IP，EDC自行設定成跟NCCC HOST IP一樣。 此功能移除，避免和TMSIP.txt衝突 */
			inLoadTMSFTPRec(0);
			inSetFTPPortNum(_SFTP_DEFAULT_PORT_);
			inSaveTMSFTPRec(0);
		}
		else
		{
			inLoadTMSFTPRec(0);
			/* 寫入預設值 */
			inSetFTPID(_FTP_DEFAULT_USER_);
			inSetFTPPW(_FTP_DEFAULT_PASSWORD_);
			inSetFTPPortNum(_FTP_DEFAULT_PORT_);
			inSaveTMSFTPRec(0);
		}
	}
	else
	{
		inLoadTMSFTPRec(0);
		/* 寫入預設值 */
		inSetFTPID(_FTP_DEFAULT_USER_);
		inSetFTPPW(_FTP_DEFAULT_PASSWORD_);
		inSetFTPPortNum(_FTP_DEFAULT_PORT_);
		inSaveTMSFTPRec(0);
	}
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Check_TMS_Setting_Compatible
Date&Time       :2019/3/7 下午 3:03
Describe        :
*/
int inNCCC_Func_Check_TMS_Setting_Compatible(TRANSACTION_OBJECT* pobTran)
{
	int	i = 0;
	int	inHostCnt = 0;
	char	szFESMode[2 + 1] = {0};
	char	szContactlessReaderMode[2 + 1] = {0};
	char	szCustomerIndicator[3 + 1] = {0};
	char	szFuncEnable[2 + 1] = {0};
	char	szCloudMFES[1 + 1] = {0};
	char	szDCCHostEnable[1 + 1] = {0};
	char	szTxnFunc[20 + 1] = {0};
	char	szHGHostEnable[1 + 1] = {0};
	
	memset(szFESMode, 0x00, sizeof(szFESMode));
	inGetNCCCFESMode(szFESMode);
		
	memset(szCloudMFES, 0x00, sizeof(szCloudMFES));
	inGetCloud_MFES(szCloudMFES);
		
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	
	memset(szDCCHostEnable, 0x00, sizeof(szDCCHostEnable));
	inNCCC_DCC_GetDCC_Enable(pobTran->srBRec.inHDTIndex, szDCCHostEnable);
	
	memset(szTxnFunc, 0x00, sizeof(szTxnFunc));
	inGetTransFunc(szTxnFunc);
	
	memset(szHGHostEnable, 0x00, sizeof(szHGHostEnable));
	inHG_GetHG_Enable(pobTran->srBRec.inHDTIndex, szHGHostEnable);
	
	for (i = 0 ;; i ++)
	{
		/* 主機參數檔 */
		if (inLoadHDTRec(i) < 0)
			break;

		memset(szFuncEnable, 0x00, sizeof(szFuncEnable));
		inGetHostEnable(szFuncEnable);
		if (memcmp(szFuncEnable, "Y", 1) != 0)
			continue;

		inHostCnt ++;
	}
	
	/* 修正未過卡前，會判定到其他host的問題 */
	if (pobTran->srBRec.inHDTIndex < 0)
	{
		inLoadHDTRec(0);
	}
	else
	{
		inLoadHDTRec(pobTran->srBRec.inHDTIndex);
	}
	
	/* 檢核機型是否支援內建感應 add by LingHsiung 2019/10/8 下午 5:24 */
	if ((memcmp(szContactlessReaderMode, _CTLS_MODE_1_INTERNAL_, strlen(_CTLS_MODE_1_INTERNAL_)) == 0) &&
	     ginContactlessSupport != VS_TRUE)
	{
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, "");
		srDispMsgObj.inDispPic1YPosition = 0;
		srDispMsgObj.inMsgType = _0_KEY_MSG_;
		srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
		strcpy(srDispMsgObj.szErrMsg1, "此機器不支援");
		srDispMsgObj.inErrMsg1Line = _LINE_8_4_;
		srDispMsgObj.inErrMsg1FontSize = _FONTSIZE_8X22_;
		strcpy(srDispMsgObj.szErrMsg2, "內建感應功能");
		srDispMsgObj.inErrMsg2Line = _LINE_8_5_;
		srDispMsgObj.inErrMsg2FontSize = _FONTSIZE_8X22_;
		strcpy(srDispMsgObj.szErrMsg3, "請重新參數下載 ");
		srDispMsgObj.inErrMsg3Line = _LINE_8_6_;
		srDispMsgObj.inErrMsg3FontSize = _FONTSIZE_8X22_;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
		inDISP_Msg_BMP(&srDispMsgObj);
		
		return (VS_ERROR);
	}

	/* 沒觸控功能要擋內建簽名板 */
	if (ginTouchEnable != VS_TRUE)
	{
		char	szSignPadMode[2 + 1] = {0};

		memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
		inGetCustomIndicator(szCustomerIndicator);
		memset(szSignPadMode , 0x00, sizeof(szSignPadMode));
		inGetSignPadMode(szSignPadMode);

		if (memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_107_BUMPER_, _CUSTOMER_INDICATOR_SIZE_)         &&
		    memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_111_KIOSK_STANDARD_, _CUSTOMER_INDICATOR_SIZE_) &&
		    (memcmp(szSignPadMode, _SIGNPAD_MODE_1_INTERNAL_, strlen(_SIGNPAD_MODE_1_INTERNAL_)) == 0))
		{
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, "");
			srDispMsgObj.inDispPic1YPosition = 0;
			srDispMsgObj.inMsgType = _0_KEY_MSG_;
			srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
			strcpy(srDispMsgObj.szErrMsg1, "此機器不支援");
			srDispMsgObj.inErrMsg1Line = _LINE_8_4_;
			srDispMsgObj.inErrMsg1FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg2, "內建電子簽名板");
			srDispMsgObj.inErrMsg2Line = _LINE_8_5_;
			srDispMsgObj.inErrMsg2FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg3, "請重新參數下載 ");
			srDispMsgObj.inErrMsg3Line = _LINE_8_6_;
			srDispMsgObj.inErrMsg3FontSize = _FONTSIZE_8X22_;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inDISP_Msg_BMP(&srDispMsgObj);

			return (VS_ERROR);
		}
	}

	/* 因為現在沒有外接感應，若下載為外接感應顯示"請重新下載參數" */
	/* 子毅說只會賣聯合有感應的機型 因為沒開感應的流程未開發 0跟2都擋下 */
	memset(szContactlessReaderMode, 0x00, sizeof(szContactlessReaderMode));
	inGetContactlessReaderMode(szContactlessReaderMode);
	if ((memcmp(szContactlessReaderMode, _CTLS_MODE_0_NO_, strlen(_CTLS_MODE_0_NO_)) == 0) ||
	    (memcmp(szContactlessReaderMode, _CTLS_MODE_2_EXTERNAL_, strlen(_CTLS_MODE_2_EXTERNAL_)) == 0))
	{
		DISPLAY_OBJECT	srDispMsgObj;
		memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
		strcpy(srDispMsgObj.szDispPic1Name, "");
		srDispMsgObj.inDispPic1YPosition = 0;
		srDispMsgObj.inMsgType = _0_KEY_MSG_;
		srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
		strcpy(srDispMsgObj.szErrMsg1, "須開啟");
		srDispMsgObj.inErrMsg1Line = _LINE_8_4_;
		srDispMsgObj.inErrMsg1FontSize = _FONTSIZE_8X22_;
		strcpy(srDispMsgObj.szErrMsg2, "內建感應功能");
		srDispMsgObj.inErrMsg2Line = _LINE_8_5_;
		srDispMsgObj.inErrMsg2FontSize = _FONTSIZE_8X22_;
		strcpy(srDispMsgObj.szErrMsg3, "請重新參數下載 ");
		srDispMsgObj.inErrMsg3Line = _LINE_8_6_;
		srDispMsgObj.inErrMsg3FontSize = _FONTSIZE_8X22_;
		srDispMsgObj.inBeepTimes = 1;
		srDispMsgObj.inBeepInterval = 0;
		inDISP_Msg_BMP(&srDispMsgObj);

		return (VS_ERROR);
	}
	
	/* 檢核是否有撥接功能 */
	/* 沒撥接功能要擋撥接備援且參數不能設定為撥接 */
	if (ginMachineType == _CASTLE_TYPE_V3P_)
	{
		char	szDialBackupEnable[2 + 1] = {0};
		char	szCommMode[2 + 1] = {0};

		memset(szDialBackupEnable, 0x00, sizeof(szDialBackupEnable));
		inGetDialBackupEnable(szDialBackupEnable);
		memset(szCommMode, 0x00, sizeof(szCommMode));
		inGetCommMode(szCommMode);

		if ((memcmp(szDialBackupEnable, "Y", 1) == 0)	||
		     memcmp(szCommMode, _COMM_MODEM_MODE_, strlen(_COMM_MODEM_MODE_)) == 0)
		{
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, "");
			srDispMsgObj.inDispPic1YPosition = 0;
			srDispMsgObj.inMsgType = _0_KEY_MSG_;
			srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
			strcpy(srDispMsgObj.szErrMsg1, "此機器不支援");
			srDispMsgObj.inErrMsg1Line = _LINE_8_4_;
			srDispMsgObj.inErrMsg1FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg2, "撥接功能");
			srDispMsgObj.inErrMsg2Line = _LINE_8_5_;
			srDispMsgObj.inErrMsg2FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg3, "請重新參數下載 ");
			srDispMsgObj.inErrMsg3Line = _LINE_8_6_;
			srDispMsgObj.inErrMsg3FontSize = _FONTSIZE_8X22_;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inDISP_Msg_BMP(&srDispMsgObj);

			return (VS_ERROR);
		}
	}
	
	/* 移除MPAS擋ESC條件 by Russell 2019/4/9 下午 1:33 */
	
	/* (需求單 - 107276)自助交易標準做法 客製化111如切到M-FES，請顯示不支援此客製化（但不能檔CFES） by Russell 2019/1/21 下午 2:02 */
	if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_111_KIOSK_STANDARD_, _CUSTOMER_INDICATOR_SIZE_) ||
	    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_123_IKEA_, _CUSTOMER_INDICATOR_SIZE_)		||
	    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_124_EVER_RICH_, _CUSTOMER_INDICATOR_SIZE_))
	{
		/* 是MFES但不是CFES */
		if (memcmp(szFESMode, _NCCC_03_MFES_MODE_, strlen(_NCCC_03_MFES_MODE_)) == 0)
		{
			if (memcmp(szCloudMFES, "Y", strlen("Y")) == 0)
			{
				/* CFES不能擋 */
			}
			else
			{
				DISPLAY_OBJECT	srDispMsgObj;
				memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
				strcpy(srDispMsgObj.szDispPic1Name, "");
				srDispMsgObj.inDispPic1YPosition = 0;
				srDispMsgObj.inMsgType = _0_KEY_MSG_;
				srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
				sprintf(srDispMsgObj.szErrMsg1, "MFES (%s)", szFESMode);
				srDispMsgObj.inErrMsg1Line = _LINE_8_4_;
				srDispMsgObj.inErrMsg1FontSize = _FONTSIZE_8X22_;
				strcpy(srDispMsgObj.szErrMsg2, "此客製化不支援此FES");
				srDispMsgObj.inErrMsg2Line = _LINE_8_5_;
				srDispMsgObj.inErrMsg2FontSize = _FONTSIZE_8X22_;
				strcpy(srDispMsgObj.szErrMsg3, "請重新參數下載 ");
				srDispMsgObj.inErrMsg3Line = _LINE_8_6_;
				srDispMsgObj.inErrMsg3FontSize = _FONTSIZE_8X22_;
				srDispMsgObj.inBeepTimes = 1;
				srDispMsgObj.inBeepInterval = 0;
				inDISP_Msg_BMP(&srDispMsgObj);
			
				return (VS_ERROR);
			}
		}
	}
	
	/* 042、043不支援DCC */
	if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_042_BDAU1_, _CUSTOMER_INDICATOR_SIZE_)	||
	    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_043_BDAU9_, _CUSTOMER_INDICATOR_SIZE_))
	{
		if (memcmp(szDCCHostEnable, "Y", 1) == 0)
		{
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, "");
			srDispMsgObj.inDispPic1YPosition = 0;
			srDispMsgObj.inMsgType = _0_KEY_MSG_;
			srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
			sprintf(srDispMsgObj.szErrMsg1, "%s", "此客製化");
			srDispMsgObj.inErrMsg1Line = _LINE_8_4_;
			srDispMsgObj.inErrMsg1FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg2, "不支援DCC");
			srDispMsgObj.inErrMsg2Line = _LINE_8_5_;
			srDispMsgObj.inErrMsg2FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg3, "請重新下載參數");
			srDispMsgObj.inErrMsg3Line = _LINE_8_6_;
			srDispMsgObj.inErrMsg3FontSize = _FONTSIZE_8X22_;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inDISP_Msg_BMP(&srDispMsgObj);
			
			return (VS_ERROR);
		}
		
		if (inHostCnt > 1)
		{
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, "");
			srDispMsgObj.inDispPic1YPosition = 0;
			srDispMsgObj.inMsgType = _0_KEY_MSG_;
			srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
			sprintf(srDispMsgObj.szErrMsg1, "%s", "超過一個Host");
			srDispMsgObj.inErrMsg1Line = _LINE_8_4_;
			srDispMsgObj.inErrMsg1FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg2, "參數下載有誤");
			srDispMsgObj.inErrMsg2Line = _LINE_8_5_;
			srDispMsgObj.inErrMsg2FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg3, "請重新下載參數");
			srDispMsgObj.inErrMsg3Line = _LINE_8_6_;
			srDispMsgObj.inErrMsg3FontSize = _FONTSIZE_8X22_;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inDISP_Msg_BMP(&srDispMsgObj);
			
			return (VS_ERROR);
		}
		
		if (!memcmp(szFESMode, _NCCC_05_ATS_MODE_, 2) && szTxnFunc[4] == '2')
		{
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, "");
			srDispMsgObj.inDispPic1YPosition = 0;
			srDispMsgObj.inMsgType = _0_KEY_MSG_;
			srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
			sprintf(srDispMsgObj.szErrMsg1, "%s", "此客製化不支援");
			srDispMsgObj.inErrMsg1Line = _LINE_8_4_;
			srDispMsgObj.inErrMsg1FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg2, "離線交易補登");
			srDispMsgObj.inErrMsg2Line = _LINE_8_5_;
			srDispMsgObj.inErrMsg2FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg3, "請重新下載參數");
			srDispMsgObj.inErrMsg3Line = _LINE_8_6_;
			srDispMsgObj.inErrMsg3FontSize = _FONTSIZE_8X22_;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inDISP_Msg_BMP(&srDispMsgObj);
			
			return (VS_ERROR);
		}
	}
	
	/* 005不支援DCC */
	if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_005_FPG_, _CUSTOMER_INDICATOR_SIZE_))
	{
		if (memcmp(szDCCHostEnable, "Y", 1) == 0)
		{
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, "");
			srDispMsgObj.inDispPic1YPosition = 0;
			srDispMsgObj.inMsgType = _0_KEY_MSG_;
			srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
			sprintf(srDispMsgObj.szErrMsg1, "%s", "此客製化");
			srDispMsgObj.inErrMsg1Line = _LINE_8_4_;
			srDispMsgObj.inErrMsg1FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg2, "不支援DCC");
			srDispMsgObj.inErrMsg2Line = _LINE_8_5_;
			srDispMsgObj.inErrMsg2FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg3, "請重新下載參數");
			srDispMsgObj.inErrMsg3Line = _LINE_8_6_;
			srDispMsgObj.inErrMsg3FontSize = _FONTSIZE_8X22_;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inDISP_Msg_BMP(&srDispMsgObj);
			
			return (VS_ERROR);
		}
	}
	
	/* 041不支援DCC */
	if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_041_CASH_, _CUSTOMER_INDICATOR_SIZE_))
	{
		if (memcmp(szDCCHostEnable, "Y", 1) == 0)
		{
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, "");
			srDispMsgObj.inDispPic1YPosition = 0;
			srDispMsgObj.inMsgType = _0_KEY_MSG_;
			srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
			sprintf(srDispMsgObj.szErrMsg1, "%s", "此客製化");
			srDispMsgObj.inErrMsg1Line = _LINE_8_4_;
			srDispMsgObj.inErrMsg1FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg2, "不支援DCC");
			srDispMsgObj.inErrMsg2Line = _LINE_8_5_;
			srDispMsgObj.inErrMsg2FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg3, "請重新下載參數");
			srDispMsgObj.inErrMsg3Line = _LINE_8_6_;
			srDispMsgObj.inErrMsg3FontSize = _FONTSIZE_8X22_;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inDISP_Msg_BMP(&srDispMsgObj);
			
			return (VS_ERROR);
		}
		
		if (inHostCnt > 1)
		{
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, "");
			srDispMsgObj.inDispPic1YPosition = 0;
			srDispMsgObj.inMsgType = _0_KEY_MSG_;
			srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
			sprintf(srDispMsgObj.szErrMsg1, "%s", "超過一個Host");
			srDispMsgObj.inErrMsg1Line = _LINE_8_4_;
			srDispMsgObj.inErrMsg1FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg2, "參數下載有誤");
			srDispMsgObj.inErrMsg2Line = _LINE_8_5_;
			srDispMsgObj.inErrMsg2FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg3, "請重新下載參數");
			srDispMsgObj.inErrMsg3Line = _LINE_8_6_;
			srDispMsgObj.inErrMsg3FontSize = _FONTSIZE_8X22_;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inDISP_Msg_BMP(&srDispMsgObj);
			
			return (VS_ERROR);
		}
	}
        
        /* 客製化126不能支援HG */
	/* 客製化126不支援小費 */
        if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_126_MASTERCARD_FLIGHT_TICKET_, _CUSTOMER_INDICATOR_SIZE_))
	{
		if (memcmp(szHGHostEnable, "Y", 1) == 0)
		{
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, "");
			srDispMsgObj.inDispPic1YPosition = 0;
			srDispMsgObj.inMsgType = _0_KEY_MSG_;
			srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
			sprintf(srDispMsgObj.szErrMsg1, "%s", "此客製化");
			srDispMsgObj.inErrMsg1Line = _LINE_8_4_;
			srDispMsgObj.inErrMsg1FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg2, "不支援HG");
			srDispMsgObj.inErrMsg2Line = _LINE_8_5_;
			srDispMsgObj.inErrMsg2FontSize = _FONTSIZE_8X22_;
			strcpy(srDispMsgObj.szErrMsg3, "請重新下載參數");
			srDispMsgObj.inErrMsg3Line = _LINE_8_6_;
			srDispMsgObj.inErrMsg3FontSize = _FONTSIZE_8X22_;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inDISP_Msg_BMP(&srDispMsgObj);
			
			return (VS_ERROR);
		}
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_ESC_FuncProcess
Date&Time       :2019/4/8 下午 5:06
Describe        :暫存ESC紀錄，避免直接斷電沒紀錄到
*/
int inNCCC_Func_ESC_FuncProcess(TRANSACTION_OBJECT* pobTran)
{
	int	inRetVal = VS_ERROR;
	char	szESCMode[2 + 1] = {0};
	
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_ESC_FuncProcess START!");
        
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_ESC_FuncProcess() START !");
	}
	
	if (ginFindRunTime == VS_TRUE)
	{
		inFunc_RecordTime_Append("%d %s", __LINE__, __FUNCTION__);
	}
	
	/* 先確認ESC功能有沒有開 */
	memset(szESCMode, 0x00, sizeof(szESCMode));
	inGetESCMode(szESCMode);
	if (memcmp(&szESCMode[0], "Y", 1) != 0)
	{
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_ESC_FuncProcess ESC_Not_Open_Pass END!");
		/* 沒開，就不跑ESC流程 */
		return (VS_SUCCESS);
	}
	
	if (ginFindRunTime == VS_TRUE)
	{
		inFunc_RecordTime_Append("%d %s", __LINE__, __FUNCTION__);
	}
	
	/* ESC暫存檔 */
	pobTran->uszFileNameNoNeedHostBit = VS_TRUE;
	pobTran->uszFileNameNoNeedNumBit = VS_TRUE;
	inSqlite_Drop_Table_Flow(pobTran, _TN_BATCH_TABLE_ESC_TEMP_);
	pobTran->uszFileNameNoNeedHostBit = VS_FALSE;
	pobTran->uszFileNameNoNeedNumBit = VS_FALSE;
	
	if (ginFindRunTime == VS_TRUE)
	{
		inFunc_RecordTime_Append("%d %s", __LINE__, __FUNCTION__);
	}
	
	/* ESC暫存檔 */
	pobTran->uszFileNameNoNeedHostBit = VS_TRUE;
	pobTran->uszFileNameNoNeedNumBit = VS_TRUE;
	inRetVal = inBATCH_Create_BatchTable_Flow(pobTran, _TN_BATCH_TABLE_ESC_TEMP_);
	pobTran->uszFileNameNoNeedHostBit = VS_FALSE;
	pobTran->uszFileNameNoNeedNumBit = VS_FALSE;
	if (inRetVal != VS_SUCCESS)
	{
		vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_ESC_FuncProcess _TN_BATCH_TABLE_ESC_TEMP_create_fail");
		inUtility_StoreTraceLog_OneStep("inNCCC_Func_ESC_FuncProcess Create Table Fail");
		
		inFunc_EDCLock(AT);
		return (inRetVal);
	}
	
	if (ginFindRunTime == VS_TRUE)
	{
		inFunc_RecordTime_Append("%d %s", __LINE__, __FUNCTION__);
	}
	
	/* ESC暫存檔 */
	pobTran->uszFileNameNoNeedHostBit = VS_TRUE;
	pobTran->uszFileNameNoNeedNumBit = VS_TRUE;
	inRetVal = inBATCH_Insert_All_Flow(pobTran, _TN_BATCH_TABLE_ESC_TEMP_);
	pobTran->uszFileNameNoNeedHostBit = VS_FALSE;
	pobTran->uszFileNameNoNeedNumBit = VS_FALSE;
	if (inRetVal != VS_SUCCESS)
	{
		vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_ESC_FuncProcess _TN_BATCH_TABLE_ESC_TEMP_insert_fail");
		inUtility_StoreTraceLog_OneStep("inNCCC_Func_ESC_FuncProcess Insert Record Fail");
		
		inFunc_EDCLock(AT);
		return (inRetVal);
	}
	
	/* 還是要調用一次sync，否則有機率丟失 */
	sync();
	
	if (ginFindRunTime == VS_TRUE)
	{
		inFunc_RecordTime_Append("%d %s", __LINE__, __FUNCTION__);
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_ESC_FuncProcess() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_ESC_FuncProcess END!");
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Demo_TMS_Setting
Date&Time       :2019/7/2 上午 9:56
Describe        :
*/
int inNCCC_Func_Demo_TMS_Setting(TRANSACTION_OBJECT* pobTran)
{
	int	i;
	int	inDCC_HostIndex = -1;
	char	szDemoMode[2 + 1] = {0};
	char    szTemplate[42 + 1];
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Demo_TMS_Setting() START !");
	}
	
	inLoadEDCRec(0);
	memset(szDemoMode, 0x00, sizeof(szDemoMode));
	inGetDemoMode(szDemoMode);
	
	if (memcmp(szDemoMode, "Y", strlen("Y")) == 0)
	{
		inLoadCFGTRec(0);
		inSetEncryptMode(_NCCC_ENCRYPTION_NONE_);
		inSaveCFGTRec(0);
		
		/* DEMO有開DCC HOST的話DCCInit設為0 */
		if (inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_DCC_, &inDCC_HostIndex) == VS_SUCCESS)
		{
			inSetDCCInit("0");
			inSaveEDCRec(0);
		}
		
		for (i = 0 ;; i ++)
		{
			if (inLoadHDTRec(i) < 0)	/* 主機參數檔【HostDef.txt】 */
				break;
		
			/* 設定端末機代號 */
			memset(szTemplate, 0x00, sizeof(szTemplate));
			strcpy(szTemplate, "13999999");
			inSetTerminalID(szTemplate);
		
			/* 設定商店代號 */
			memset(szTemplate, 0x00, sizeof(szTemplate));
			strcpy(szTemplate, "6601999999");
			inSetMerchantID(szTemplate);
			
			inSaveHDTRec(i);
		}
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Demo_TMS_Setting() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_CL_Power_Off
Date&Time       :2019/8/2 上午 10:07
Describe        :此流程一過完卡就關天線，避免沒關天線導致影響到簽名板
*/
int inNCCC_Func_CL_Power_Off(TRANSACTION_OBJECT* pobTran)
{
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_CL_Power_Off START!");
        
	/* 電票不能關天線 */
	if (pobTran->srTRec.uszESVCTransBit == VS_TRUE)
	{
		
	}
	else
	{
		inCTLS_Power_Off();
	}
	
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_CL_Power_Off END!");
        
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Test_ESC_Poka_yoke
Date&Time       :2019/8/6 下午 5:23
Describe        :
*/
int inNCCC_Func_Test_ESC_Poka_yoke(void)
{
	int		inRetVal = VS_ERROR;
	char		szTemplate[50 + 1] = {0};
	DISPLAY_OBJECT	srDispObj = {0};
	
	inDISP_ClearAll();
	inDISP_ChineseFont("請輸入測試金額", _FONTSIZE_8X16_, _LINE_8_2_, _DISP_CENTER_);
	
	memset(&srDispObj, 0x00, sizeof(srDispObj));
	srDispObj.inY = _LINE_8_7_;
	srDispObj.inR_L = _DISP_RIGHT_;
	srDispObj.inMaxLen = inFunc_Check_Digit();		/* 不可超過9，long變數最多放9位 */
	srDispObj.inColor = _COLOR_RED_;
	strcpy(srDispObj.szPromptMsg, "NT$ ");

	inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);

	/* 進入畫面時先顯示金額為0 */
	memset(szTemplate, 0x00, sizeof(szTemplate));
	strcpy(szTemplate, "NT$ 0");
	inDISP_EnglishFont_Color(szTemplate, _FONTSIZE_8X16_, srDispObj.inY, srDispObj.inColor, _DISP_RIGHT_);

	memset(srDispObj.szOutput, 0x00, sizeof(srDispObj.szOutput));
	srDispObj.inOutputLen = 0;
	inRetVal = inDISP_Enter8x16_GetAmount(&srDispObj);
	
	if (inRetVal == VS_TIMEOUT || inRetVal == VS_USER_CANCEL)
	{
			
	}
	else
	{
		glnESC_PokaYoke_TestAmt = atol(srDispObj.szOutput);
		inRetVal = VS_SUCCESS;
	}
	
	inLogPrintf(AT, "Amt: %010ld", glnESC_PokaYoke_TestAmt);
	inDISP_ClearAll();
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_AutoPrintTotalReport_Flow
Date&Time       :2019/9/3 下午 4:08
Describe        :印總額流程
*/
int inNCCC_Func_AutoPrintTotalReport_Flow(TRANSACTION_OBJECT *pobTran)
{
	int		i = 0;
	char		szHostName[42 + 1] = {0};
	char		szHostEnable[2 + 1] = {0};
	char		szDebugMsg[100 + 1] = {0};
	char		szBatchNum[6 + 1] = {0};
	
	vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_AutoPrintTotalReport_Flow START!");
	
	if (pobTran->uszECRBit == VS_TRUE)
	{
		for (i = 0;; ++i)
		{
			/* 先LoadHDT */
			if (inLoadHDTRec(i) == VS_ERROR)
			{
				/* 當找不到第i筆資料會回傳VS_ERROR */
				break;
			}

			/* ESC要跳過 */
			memset(szHostName, 0x00, sizeof(szHostName));
			inGetHostLabel(szHostName);
			if (memcmp(szHostName, _HOST_NAME_ESC_, strlen(_HOST_NAME_ESC_)) == 0)
			{
				continue;
			}

			/* GET HOST Enable */
			/* 結帳沒開也不跑 */
			memset(szHostEnable, 0x00, sizeof(szHostEnable));
			if (inGetHostEnable(szHostEnable) == VS_ERROR)
			{	
				return (VS_ERROR);
			}
			else
			{
				if (ginDebug == VS_TRUE)
				{
					memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
					sprintf(szDebugMsg, "%d HostEnable: %s", i, szHostEnable);
					inLogPrintf(AT, szDebugMsg);
				}
			}

			/* 看結帳開關 */
			if (memcmp(szHostEnable, "Y", 1) != 0)
			{
				/* 如果HostEnable != Y，就continue */
				continue;
			}
			else
			{
				pobTran->srBRec.inHDTIndex = i;
			}

			/* 如果主機有開，才loadHDPT */
			if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) == VS_SUCCESS)
			{
				memset(szBatchNum, 0x00, sizeof(szBatchNum));
				inGetBatchNum(szBatchNum);
				pobTran->srBRec.lnBatchNum = atol(szBatchNum);

				pobTran->uszPrePrintBit = VS_TRUE;
				inFLOW_RunFunction(pobTran, _FUNCTION_PRINT_TOTAL_REPORT_BY_BUFFER_);
				pobTran->uszPrePrintBit = VS_FALSE;
			}

		}
	}
	else
	{
		inFLOW_RunFunction(pobTran, _FUNCTION_PRINT_TOTAL_REPORT_BY_BUFFER_);
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_AutoPrintDetailReport_Flow
Date&Time       :2019/9/3 下午 4:08
Describe        :印明細流程
*/
int inNCCC_Func_AutoPrintDetailReport_Flow(TRANSACTION_OBJECT *pobTran)
{
	int		i = 0;
	char		szHostName[42 + 1] = {0};
	char		szHostEnable[2 + 1] = {0};
	char		szDebugMsg[100 + 1] = {0};
	char		szBatchNum[6 + 1] = {0};
	
	vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_AutoPrintDetailReport_Flow START!");
	
	if (pobTran->uszECRBit == VS_TRUE)
	{
		for (i = 0;; ++i)
		{
			/* 先LoadHDT */
			if (inLoadHDTRec(i) == VS_ERROR)
			{
				/* 當找不到第i筆資料會回傳VS_ERROR */
				break;
			}

			/* ESC要跳過 */
			memset(szHostName, 0x00, sizeof(szHostName));
			inGetHostLabel(szHostName);
			if (memcmp(szHostName, _HOST_NAME_ESC_, strlen(_HOST_NAME_ESC_)) == 0)
			{
				continue;
			}

			/* GET HOST Enable */
			/* 結帳沒開也不跑 */
			memset(szHostEnable, 0x00, sizeof(szHostEnable));
			if (inGetHostEnable(szHostEnable) == VS_ERROR)
			{	
				return (VS_ERROR);
			}
			else
			{
				if (ginDebug == VS_TRUE)
				{
					memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
					sprintf(szDebugMsg, "%d HostEnable: %s", i, szHostEnable);
					inLogPrintf(AT, szDebugMsg);
				}
			}

			/* 看結帳開關 */

			if (memcmp(szHostEnable, "Y", 1) != 0)
			{
				/* 如果HostEnable != Y，就continue */
				continue;
			}
			else
			{
				pobTran->srBRec.inHDTIndex = i;
			}

			/* 如果主機有開，才loadHDPT */
			if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) == VS_SUCCESS)
			{
				memset(szBatchNum, 0x00, sizeof(szBatchNum));
				inGetBatchNum(szBatchNum);
				pobTran->srBRec.lnBatchNum = atol(szBatchNum);

				inFLOW_RunFunction(pobTran, _FUNCTION_PRINT_DETAIL_REPORT_BY_BUFFER_);
			}

		}
	}
	else
	{
		inFLOW_RunFunction(pobTran, _FUNCTION_PRINT_DETAIL_REPORT_BY_BUFFER_);
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Check_Txn_Function_When_ECR
Date&Time       :2020/1/21 下午 2:29
Describe        :NCCC版本，ECR交易要在過卡前檢查開關
*/
int inNCCC_Func_Check_Txn_Function_When_ECR(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = VS_SUCCESS;
	
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Txn_Function_When_ECR START!");
        
	if (pobTran->uszECRBit == VS_TRUE)
	{
		if (pobTran->srTRec.uszESVCTransBit == VS_TRUE)
		{
			/* 不檢查，基本上不會走這邊，且票證開關各票證獨立，要過卡才知道 */
		}
		else if (pobTran->srBRec.lnHGTransactionType != 0)
		{
			inRetVal = inFLOW_RunFunction(pobTran, _HG_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_);
		}
		else
		{
			inRetVal = inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_CHECK_TRANS_FUNCTION_FLOW_);
		}
	}
	
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Txn_Function_When_ECR END!");
        
	return (inRetVal);
}

/*
Function        :inNCCC_Func_IDNumber_Encrypt
Date&Time       :2020/3/18 下午 5:46
Describe        :個資法 ID Number須加密
*/
int inNCCC_Func_IDNumber_Encrypt(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_ERROR;
        int             inCnt = 0;
	char		szTemplate[48 + 1] = {0};
	char		szEncrypt[48 + 1] = {0};
	char		szField37[8 + 1] = {0}, szField41[4 + 1] = {0};
	char		szDebugMsg[100 + 1] = {0};
	unsigned char	uszSlot = 0;

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_IDNumber_Encrypt() START !");
	}

        if (pobTran->srTrustRec.uszTrustTransBit == VS_TRUE)
        {
                /* 抓tSAM Slot */
                inRetVal = inNCCC_tSAM_Decide_tSAM_Slot(&uszSlot);
                if (inRetVal != VS_SUCCESS)
                {
                        if (ginDebug == VS_TRUE)
                        {
                                memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
                                sprintf(szDebugMsg, "inNCCC_tSAM_Decide_tSAM_Slot Failed");
                                inLogPrintf(AT, szDebugMsg);
                        }
                }

                /* 組 Field_37 */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                memcpy(szTemplate, pobTran->srTrustRec.szTrustRRN, 11);
                inFunc_PAD_ASCII(szTemplate, szTemplate, 'F', 16, _PADDING_RIGHT_); /* 補【F】 */
                memset(szField37, 0x00, sizeof(szField37));
                inFunc_ASCII_to_BCD((unsigned char*)szField37, szTemplate, 8);
                /* 組 Field_41 */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                inGetTerminalID(szTemplate);
                memset(szField41, 0x00, sizeof(szField41));
                inFunc_ASCII_to_BCD((unsigned char*)szField41, szTemplate, 4);
                /* Field_59 */
                memset(gusztSAMCheckSum_59, 0x00, sizeof(gusztSAMCheckSum_59));
                memset(szEncrypt, 0x00, sizeof(szEncrypt));

                /* tSAM加密 */
                inCnt = 0;
                memset(szEncrypt, '\x20', 24);
                memcpy(&szEncrypt[inCnt], pobTran->szIDNumber, strlen(pobTran->szIDNumber));
                inCnt += 10;
                memcpy(&szEncrypt[inCnt], pobTran->szPatientId, strlen(pobTran->szPatientId));
                inCnt += 10;
                memcpy(&szEncrypt[inCnt], pobTran->szTrustVerificationCode, strlen(pobTran->szTrustVerificationCode));
                inCnt += 3;
                inCnt += 1;
                inRetVal = inNCCC_tSAM_Encrypt(uszSlot,
                                               48,
                                               szEncrypt,
                                               (unsigned char*)&szField37,
                                               (unsigned char*)&szField41,
                                               &gusztSAMKeyIndex,
                                               gusztSAMCheckSum_59);
                if (inRetVal == VS_ERROR)
                {
                        if (ginDebug == VS_TRUE)
                        {
                                inLogPrintf(AT, "IDNumber_TSAM_Encrypt()_ERROR!");
                        }
                        return (VS_ERROR);
                }

                memset(pobTran->szIDNumber_tSAM, 0x00, sizeof(pobTran->szIDNumber_tSAM));
                memcpy(&pobTran->szIDNumber_tSAM[0], szEncrypt, 24);
        }
        else
        {
                if (strlen(pobTran->szIDNumber) > 0)
                {
                        /* 抓tSAM Slot */
                        inRetVal = inNCCC_tSAM_Decide_tSAM_Slot(&uszSlot);
                        if (inRetVal != VS_SUCCESS)
                        {
                                if (ginDebug == VS_TRUE)
                                {
                                        memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
                                        sprintf(szDebugMsg, "inNCCC_tSAM_Decide_tSAM_Slot Failed");
                                        inLogPrintf(AT, szDebugMsg);
                                }
                        }

                        /* 組 Field_37 */
                        memset(szTemplate, 0x00, sizeof(szTemplate));
                        memcpy(szTemplate, pobTran->srBRec.szRefNo, 11);
                        inFunc_PAD_ASCII(szTemplate, szTemplate, 'F', 16, _PADDING_RIGHT_); /* 補【F】 */
                        memset(szField37, 0x00, sizeof(szField37));
                        inFunc_ASCII_to_BCD((unsigned char*)szField37, szTemplate, 8);
                        /* 組 Field_41 */
                        memset(szTemplate, 0x00, sizeof(szTemplate));
                        inGetTerminalID(szTemplate);
                        memset(szField41, 0x00, sizeof(szField41));
                        inFunc_ASCII_to_BCD((unsigned char*)szField41, szTemplate, 4);
                        /* Field_59 */
                        memset(gusztSAMCheckSum_59, 0x00, sizeof(gusztSAMCheckSum_59));
                        memset(szEncrypt, 0x00, sizeof(szEncrypt));

                        /* 統一編號8碼 or 身分證字號10碼 */
                        if (strlen(pobTran->szIDNumber) == 8)
                        {
                                /* tSAM加密 */
                                memcpy(szEncrypt, pobTran->szIDNumber, 8);
                                inRetVal = inNCCC_tSAM_Encrypt(uszSlot,
                                                               8,
                                                               szEncrypt,
                                                               (unsigned char*)&szField37,
                                                               (unsigned char*)&szField41,
                                                               &gusztSAMKeyIndex,
                                                               gusztSAMCheckSum_59);

                                if (inRetVal == VS_ERROR)
                                {
                                        if (ginDebug == VS_TRUE)
                                        {
                                                inLogPrintf(AT, "IDNumber_TSAM_Encrypt()_ERROR!");
                                        }
                                        return (VS_ERROR);
                                }

                                memset(pobTran->szIDNumber_tSAM, 0x00, sizeof(pobTran->szIDNumber_tSAM));
                                memcpy(&pobTran->szIDNumber_tSAM[0], szEncrypt, 8);
                        }
                        else if (strlen(pobTran->szIDNumber) == 10)
                        {
                                /* 身分證字號只對後八碼加密 */
                                memset(szTemplate, 0x00, sizeof(szTemplate));
                                memcpy(&szTemplate[0], &pobTran->szIDNumber[2], 8);

                                /* tSAM加密 */
                                memcpy(szEncrypt, szTemplate, 8);
                                inRetVal = inNCCC_tSAM_Encrypt(uszSlot,
                                                               8,
                                                               szEncrypt,
                                                               (unsigned char*)&szField37,
                                                               (unsigned char*)&szField41,
                                                               &gusztSAMKeyIndex,
                                                               gusztSAMCheckSum_59);

                                if (inRetVal == VS_ERROR)
                                {
                                        if (ginDebug == VS_TRUE)
                                        {
                                                inLogPrintf(AT, "IDNumber_TSAM_Encrypt()_ERROR!");
                                        }
                                        return (VS_ERROR);
                                }

                                memset(pobTran->szIDNumber_tSAM, 0x00, sizeof(pobTran->szIDNumber_tSAM));
                                memcpy(&pobTran->szIDNumber_tSAM[0], &pobTran->szIDNumber[0], 2);
                                memcpy(&pobTran->szIDNumber_tSAM[2], szEncrypt, 8);
                        }
                }
        }

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_IDNumber_Encrypt() END !");
		inLogPrintf(AT, "----------------------------------------");
	}

	return (VS_SUCCESS);
}


/*
Function        :inCREDIT_Func_Get_PayItem
Date&Time       :2020/3/17 下午 5:42
Describe        :取得on-us繳費平台DATA 身分證字號 & 繳費項目
 *		【需求單 - 104014】發卡機構on-us繳費平台需求 +【需求單 - 104152】發卡機構on-us繳費平台 Payitem Code
*/
int inNCCC_Func_Get_PayItem(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_ERROR, i = 0;
	int		inEnterKeyMapSize = 0;
	char		szCustomerIndicator[3 + 1] = {0};
	char		szTRTFileName[12 + 1] = {0};
	char		szPayItemFuncEnable[2 + 1] = {0};
	char		szPayItemIndex[2 + 1] = {0};
	char		szEnterKeyMap[2 + 1] = {0};
	char		szPayItemKeyMap[2 + 1] = {0};
	char		szPayItemCode[6 + 1] = {0};
	char		szPayItemScript[40 + 1] = {0};
	char		szTemplate[64 + 1] = {0};
	char		szDispMsg[_DISP_MSG_SIZE_ + 1] = {0};
	unsigned char	uszEntryAgainBit = VS_FALSE;	/* 是否重新輸入 */
	unsigned char	uszKey = 0x00;
	DISPLAY_OBJECT  srDispObj = {0};
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_PayItem START!");
        
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Get_PayItem(PayItemCode = %s) START !", pobTran->srBRec.szPayItemCode);
	}
	
	/* 兩段式收銀機連線 第一段不輸入 */
	/* 這邊因為有兩個輸入項，所以分別拆開跳走的判斷 */
        if (pobTran->uszECRBit == VS_TRUE)
	{
		/* 因為這邊有 */
		/* 兩段式收銀機連線 第一段不輸入 這邊只擋會出現在OPT的 */
		if (pobTran->uszCardInquiryFirstBit == VS_TRUE)
		{
                        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_PayItem InquiryFirst_Pass END!");
			return (VS_SUCCESS);
		}
	}

	/* 2015-09-08 (週二) 下午 05:47 黃國展(Joe Huang) 回覆
	   繳費平台流程先輸入ID(如身分證),如果繳費項目只有一個就不要顯示(輸入繳費項目) */

	/* 輸入身分證字號或外僑居留證或統一編號 客製化084 */
	/* 客製化參數判斷 on-us客製化087不輸入ID */
	/* 吳升文回覆 剛剛確認客製化參數 084 只有 SALE要詢問ID 2015-10-29 (週四) 下午 02:00 */
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
	
	inGetCustomIndicator(szCustomerIndicator);
	inGetTRTFileName(szTRTFileName);
	
	/* 客製化084，且非DCC或HG流程，非sale，則不輸入ID */
	if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_084_ON_US_, _CUSTOMER_INDICATOR_SIZE_)                     &&
	    (memcmp(szTRTFileName, _TRT_FILE_NAME_DCC_, _TRT_FILE_NAME_DCC_LEN_) != 0)					&& 
	    (memcmp(szTRTFileName, _TRT_FILE_NAME_HG_, _TRT_FILE_NAME_HG_LEN_) != 0)					&& 
	    ((pobTran->srBRec.inCode == _SALE_)										|| 
	    (pobTran->srBRec.inCode == _CUP_SALE_)))
	{
		if ((strlen(pobTran->szIDNumber) > 0) || (strlen(pobTran->szIDNumber_tSAM) > 0))
		{
			/* 黃國展 2015-11-13 (週五) 上午 09:21
			   請按照游溪指示做,只是是在感應流程*/
			/* 在啟動感應前已輸入ID 所以跳過輸入流程 */
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "ID Number Exist");
			}
		}
		else
		{
			if (inNCCC_Func_Get_IDNumber(pobTran) != VS_SUCCESS)
			{
				vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_PayItem inNCCC_Func_Get_IDNumber failed");
				return (VS_ERROR);
			}
		}
	}
	else
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "Enter ID Number Ignore");
		}
	}

	/* 2015-09-25 (週五) 下午 01:39 吳升文(Angus Wu) 回覆
	   Pay_Item_Enable 跟客製化參數脫鉤，所以客製化參數000 也可以開啟Pay_Item_Enable */
	/* 吳升文回覆 2015-10-29 (週四) 下午 12:06
	   NU 是取決有輸入Payitem才送。若Config的Payitem Enable為關閉，不須輸入Pay item 則不用NU。 */
	/* 釐清規格 以PayItemEnable開關為準 Modify by LingHsiung 2015-10-29 下午 05:25:36 */
	/* 取得繳費項目payitem code */
	memset(szPayItemFuncEnable, 0x00, sizeof(szPayItemFuncEnable));
	inGetPayItemEnable(szPayItemFuncEnable);/* 開啟繳費項目功能，預設值= N。(此功能需參考PayItem.txt) */
	if (memcmp(szPayItemFuncEnable, "Y", 1) == 0)
	{
		/* ECR flag on 有送payitem 不需人工輸入payitem */
		if (pobTran->uszECRBit == VS_TRUE)
		{
			if (strlen(pobTran->srBRec.szPayItemCode) > 0)
			{
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "PayItem ECR Give");
				}
                                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_PayItem ECR_PayItemCode_Len > 0 END!");
				return (VS_SUCCESS);
			}
		}
		else
		{
			/* 黃國展 2015-11-13 (週五) 上午 09:21
			   請按照游溪指示做,只是是在感應流程*/
			/* 在啟動感應前已輸入PayItem 所以跳過輸入流程 */
			if (strlen(pobTran->srBRec.szPayItemCode) > 0)
			{
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "PayItem exist");
				}
                                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_PayItem PayItemCode_Len > 0 END!");
				return (VS_SUCCESS);
			}
		}

		/* 只有一組Payitem 不需要再輸入繳費項目直接用該組payitem */
		for (i = 0 ;; i++)
		{
			if (inLoadPITRec(i) < 0)
			{
				/* 只有一組參數檔 */
				if (i == 1)
				{
					inLoadPITRec(0);
					memset(pobTran->srBRec.szPayItemCode, 0x00, sizeof(pobTran->srBRec.szPayItemCode));
					inGetPayItemCode(pobTran->srBRec.szPayItemCode);

	    				if (strlen(pobTran->srBRec.szPayItemCode) > 0)
	    				{
                                                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_PayItem Only1PayItemCode END!");
	    					return (VS_SUCCESS);
	    				}
	    				else
	    				{
						vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_PayItem strlen(pobTran->srBRec.szPayItemCode) <= 0");
						/* Pay_Item_Code是空的 錯誤提示畫面 */
						DISPLAY_OBJECT	srDispMsgObj;
						memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
						strcpy(srDispMsgObj.szDispPic1Name, "");
						srDispMsgObj.inDispPic1YPosition = 0;
						srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
						srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
						memset(szPayItemIndex, 0x00, sizeof(szPayItemIndex));
						inGetPayItemIndex(szPayItemIndex);
						sprintf(srDispMsgObj.szErrMsg1, "ERROR INDEX_%02d", (atoi(szPayItemIndex) + 1));
						srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
						strcpy(srDispMsgObj.szErrMsg2, "NO PAYITEM CODE");
						srDispMsgObj.inErrMsg2Line = _LINE_8_6_;
						srDispMsgObj.inBeepTimes = 1;
						srDispMsgObj.inBeepInterval = 0;

						inDISP_Msg_BMP(&srDispMsgObj);    					

						/* 操作錯誤 & 交易流程有誤 */
						pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
						return (VS_ERROR);
	    				}
				}
				else
					break;
			}
		}

		/* 選擇繳費項目 */
		while (1)
		{
			/* 2015-09-08 (週二) 下午 05:47 黃國展(Joe Huang) 回覆 先使用大寫英文字母 ENTER PAYITEM */
			inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
			/* 請輸入繳費項目 */
			inDISP_ChineseFont("Enter payitem", _FONTSIZE_8X22_, _LINE_8_5_, _DISP_LEFT_);
			inDISP_ChineseFont("請輸入繳費項目?", _FONTSIZE_8X22_, _LINE_8_6_, _DISP_LEFT_);

			memset(szEnterKeyMap, 0x00, sizeof(szEnterKeyMap));
			memset(&srDispObj, 0x00, sizeof(DISPLAY_OBJECT));
			uszEntryAgainBit = VS_FALSE;

			srDispObj.inY = _LINE_8_7_;
			srDispObj.inR_L = _DISP_RIGHT_;
			srDispObj.inMaxLen = 2;
			srDispObj.inCanNotBypass = VS_TRUE;
			srDispObj.inColor = _COLOR_RED_;
			/* 2015-09-08 (週二) 下午 05:47 黃國展(Joe Huang) 回覆 Key_Map固定使用數字 */
			inRetVal = inDISP_Enter8x16(&srDispObj);
			memcpy(szEnterKeyMap, srDispObj.szOutput, srDispObj.inOutputLen);
			inEnterKeyMapSize = srDispObj.inOutputLen;

			if (inRetVal == VS_TIMEOUT || inRetVal == VS_USER_CANCEL)
			{
				vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_OPT_PayItem Timeout_Or_UserCancel(%d) END!", inRetVal);
				return (inRetVal);
			}
			else if (inEnterKeyMapSize == 2)
			{
				/* 這邊檢查是否有該繳費項目index */
				/* 有該筆繳費項目 取得繳費項目代碼填入szPayItemCode */
				for (i = 0 ;; i ++)
				{
					if (inLoadPITRec(i) < 0) /* 繳費項目參數檔 */
					{
						uszEntryAgainBit = VS_TRUE;
						break;
					}

					memset(szPayItemKeyMap, 0x00, sizeof(szPayItemKeyMap));
					inGetPayItemKeyMap(szPayItemKeyMap);
					if (memcmp(szEnterKeyMap, szPayItemKeyMap, 2) == 0)
					{
						/* 有找到KeyMap 將相對應的繳費項目代碼存到srBRec.szPayItemCode */
						inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
						memset(pobTran->srBRec.szPayItemCode, 0x00, sizeof(pobTran->srBRec.szPayItemCode));
						inGetPayItemCode(pobTran->srBRec.szPayItemCode);

		    				if (strlen(pobTran->srBRec.szPayItemCode) > 0)
		    				{
		    					/* PayItemCode的判斷 有值繼續往下確認 */
		    				}
		    				else
		    				{
							vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_PayItem strlen(pobTran->srBRec.szPayItemCode) <= 0");
		    					/* Pay_Item_Code是空的 錯誤提示畫面 */
							DISPLAY_OBJECT	srDispMsgObj;
							memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
							strcpy(srDispMsgObj.szDispPic1Name, "");
							srDispMsgObj.inDispPic1YPosition = 0;
							srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
							srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
							memset(szPayItemIndex, 0x00, sizeof(szPayItemIndex));
							inGetPayItemIndex(szPayItemIndex);
							sprintf(srDispMsgObj.szErrMsg1, "ERROR INDEX_%02d", (atoi(szPayItemIndex) + 1));
							srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
							strcpy(srDispMsgObj.szErrMsg2, "NO PAYITEM CODE");
							srDispMsgObj.inErrMsg2Line = _LINE_8_6_;
							srDispMsgObj.inBeepTimes = 1;
							srDispMsgObj.inBeepInterval = 0;

							inDISP_Msg_BMP(&srDispMsgObj);    					

							/* 操作錯誤 & 交易流程有誤 */
							pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
							return (VS_ERROR);
		    				}

						/* 2015-09-09 (週三) 下午 05:29 黃國展(Joe Huang) 回覆
						   繳費項目說明目前規劃是大小英文與數字與可印符號*/
						/* 確認繳費項目代碼和項目說明的UI畫面 */
						memset(szTemplate, 0x00, sizeof(szTemplate));
						memset(szPayItemCode, 0x00, sizeof(szPayItemCode));
						memset(szPayItemScript, 0x00, sizeof(szPayItemScript));
						inGetPayItemCode(szPayItemCode);
						inGetPayItemScript(szPayItemScript);
						sprintf(szTemplate, "(%s %s)", szPayItemCode, szPayItemScript);
						
						/* PayItemScript小於22個字元一行顯示 */
						if (strlen(szTemplate) < 22)
						{
							memset(szDispMsg, 0x00, sizeof(szDispMsg));
							strcpy(szDispMsg, szTemplate);
							inDISP_ChineseFont(szDispMsg, _FONTSIZE_8X22_, _LINE_8_4_, _DISP_LEFT_);
							inDISP_PutGraphic(_ERR_0_, 0, _COORDINATE_Y_LINE_8_7_);
							uszKey = 0x00;
							while (1)
							{
								uszKey = uszKBD_GetKey(_EDC_TIMEOUT_);
								if (uszKey == _KEY_TIMEOUT_)
								{
									inRetVal = VS_TIMEOUT;
									break;
								}
								else if (uszKey == _KEY_CANCEL_)
								{
									inRetVal = VS_USER_CANCEL;
									break;
								}
								else if (uszKey == _KEY_0_)
								{
									inRetVal = VS_SUCCESS;
									break;
								}
							}
							
						}
						else
						{
							/* 一行20個字分三行 */
							memset(szDispMsg, 0x00, sizeof(szDispMsg));
							memcpy(szDispMsg, &szTemplate[0], 20);
							inDISP_ChineseFont(szDispMsg, _FONTSIZE_8X22_, _LINE_8_4_, _DISP_LEFT_);
							memset(szDispMsg, 0x00, sizeof(szDispMsg));
							memcpy(szDispMsg, &szTemplate[20], 20);
							inDISP_ChineseFont(szDispMsg, _FONTSIZE_8X22_, _LINE_8_5_, _DISP_LEFT_);
							memset(szDispMsg, 0x00, sizeof(szDispMsg));
							memcpy(szDispMsg, &szTemplate[40], 20);
							inDISP_ChineseFont(szDispMsg, _FONTSIZE_8X22_, _LINE_8_6_, _DISP_LEFT_);
							inDISP_PutGraphic(_ERR_0_, 0, _COORDINATE_Y_LINE_8_7_);
							uszKey = 0x00;
							while (1)
							{
								uszKey = uszKBD_GetKey(_EDC_TIMEOUT_);
								if (uszKey == _KEY_TIMEOUT_)
								{
									inRetVal = VS_TIMEOUT;
									break;
								}
								else if (uszKey == _KEY_CANCEL_)
								{
									inRetVal = VS_USER_CANCEL;
									break;
								}
								else if (uszKey == _KEY_0_)
								{
									inRetVal = VS_SUCCESS;
									break;
								}
							}
						}

						if (inRetVal != VS_SUCCESS)
						{
							vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_OPT_PayItem PayItemScript Timeout_Or_UserCancel(%d) END!", inRetVal);
							return (inRetVal);
						}

						break;
					}
					else
					{
						uszEntryAgainBit = VS_FALSE;
					}
				} /* End for (...) */

				/* 無輸入的繳費項目代碼 重新輸入 */
				if (uszEntryAgainBit == VS_TRUE)
				{
					/* Display Warning Message */
					DISPLAY_OBJECT	srDispMsgObj;
					memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
					strcpy(srDispMsgObj.szDispPic1Name, "");
					srDispMsgObj.inDispPic1YPosition = 0;
					srDispMsgObj.inMsgType = _NO_KEY_MSG_;
					srDispMsgObj.inTimeout = 0;
					strcpy(srDispMsgObj.szErrMsg1, "無此繳費項目");
					srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
					strcpy(srDispMsgObj.szErrMsg2, "請重新輸入");
					srDispMsgObj.inErrMsg2Line = _LINE_8_6_;
					srDispMsgObj.inBeepTimes = 3;
					srDispMsgObj.inBeepInterval = 1000;
					inDISP_Msg_BMP(&srDispMsgObj);

					continue;
				}
				else
				{
					break;
				}
			}
			else
			{
				continue;
			}
		}/* while */
	}
	else
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "PayItemFuncEnable OFF");
		}
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_PayItem PayItemFuncEnable END!");
		return (VS_SUCCESS);
	}

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Get_PayItem(PayItemCode = %s) END !", pobTran->srBRec.szPayItemCode);
		inLogPrintf(AT, "----------------------------------------");
	}
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_PayItem END!");
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Get_OPT_PayItem
Date&Time       :2020/3/17 下午 5:42
Describe        :取得on-us繳費平台DATA 身分證字號 & 繳費項目
 *		【需求單 - 104014】發卡機構on-us繳費平台需求 +【需求單 - 104152】發卡機構on-us繳費平台 Payitem Code
*/
int inNCCC_Func_Get_OPT_PayItem(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_ERROR, i = 0;
	int		inEnterKeyMapSize = 0;
	char		szCustomerIndicator[3 + 1] = {0};
	char		szTRTFileName[12 + 1] = {0};
	char		szPayItemFuncEnable[2 + 1] = {0};
	char		szPayItemIndex[2 + 1] = {0};
	char		szEnterKeyMap[2 + 1] = {0};
	char		szPayItemKeyMap[2 + 1] = {0};
	char		szPayItemCode[6 + 1] = {0};
	char		szPayItemScript[40 + 1] = {0};
	char		szTemplate[64 + 1] = {0};
	char		szDispMsg[_DISP_MSG_SIZE_ + 1] = {0};
	unsigned char	uszEntryAgainBit = VS_FALSE;	/* 是否重新輸入 */
	unsigned char	uszKey = 0x00;
	DISPLAY_OBJECT  srDispObj = {0};

        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_OPT_PayItem START!");
        
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Get_OPT_PayItem(PayItemCode = %s) START !", pobTran->srBRec.szPayItemCode);
	}
	
	/* 兩段式收銀機連線 第一段不輸入 */
	/* 這邊因為有兩個輸入項，所以分別拆開跳走的判斷 */
        if (pobTran->uszECRBit == VS_TRUE)
	{
		/* 因為這邊有 */
		/* 兩段式收銀機連線 第一段不輸入 這邊只擋會出現在OPT的 */
		if (pobTran->uszCardInquiryFirstBit == VS_TRUE)
		{
			return (VS_SUCCESS);
		}
	}

	/* 2015-09-08 (週二) 下午 05:47 黃國展(Joe Huang) 回覆
	   繳費平台流程先輸入ID(如身分證),如果繳費項目只有一個就不要顯示(輸入繳費項目) */

	/* 輸入身分證字號或外僑居留證或統一編號 客製化084 */
	/* 客製化參數判斷 on-us客製化087不輸入ID */
	/* 吳升文回覆 剛剛確認客製化參數 084 只有 SALE要詢問ID 2015-10-29 (週四) 下午 02:00 */
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
	
	inGetCustomIndicator(szCustomerIndicator);
	inGetTRTFileName(szTRTFileName);
	
	/* 客製化084，且非DCC或HG流程，非sale，則不輸入ID */
	if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_084_ON_US_, _CUSTOMER_INDICATOR_SIZE_)                     &&
	    (memcmp(szTRTFileName, _TRT_FILE_NAME_DCC_, _TRT_FILE_NAME_DCC_LEN_) != 0)					&& 
	    (memcmp(szTRTFileName, _TRT_FILE_NAME_HG_, _TRT_FILE_NAME_HG_LEN_) != 0)					&& 
	    ((pobTran->srBRec.inCode == _SALE_)										|| 
	    (pobTran->srBRec.inCode == _CUP_SALE_)))
	{
		if ((strlen(pobTran->szIDNumber) > 0) || (strlen(pobTran->szIDNumber_tSAM) > 0))
		{
			/* 黃國展 2015-11-13 (週五) 上午 09:21
			   請按照游溪指示做,只是是在感應流程*/
			/* 在啟動感應前已輸入ID 所以跳過輸入流程 */
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "ID Number Exist");
			}
		}
		else
		{       //顯示提示訊息輸入統編或是身分證號碼，並簡單判斷輸入長度或是資料是否正確
			if (inNCCC_Func_Get_IDNumber(pobTran) != VS_SUCCESS)
			{
				vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_OPT_PayItem inNCCC_Func_Get_IDNumber Failed");
				return (VS_ERROR);
			}
		}
	}
	else
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "Enter ID Number Ignore");
		}
	}

	/* 2015-09-25 (週五) 下午 01:39 吳升文(Angus Wu) 回覆
	   Pay_Item_Enable 跟客製化參數脫鉤，所以客製化參數000 也可以開啟Pay_Item_Enable */
	/* 吳升文回覆 2015-10-29 (週四) 下午 12:06
	   NU 是取決有輸入Payitem才送。若Config的Payitem Enable為關閉，不須輸入Pay item 則不用NU。 */
	/* 釐清規格 以PayItemEnable開關為準 Modify by LingHsiung 2015-10-29 下午 05:25:36 */
	/* 取得繳費項目payitem code */
	memset(szPayItemFuncEnable, 0x00, sizeof(szPayItemFuncEnable));
	inGetPayItemEnable(szPayItemFuncEnable); //預設為'N'
        //繳費項目功能已開啟情況下
	if (memcmp(szPayItemFuncEnable, "Y", 1) == 0)
	{
            /*Begin 判斷是否存在"繳費項目代碼" */
		/* ECR flag on 有送payitem 不需人工輸入payitem */
		if (pobTran->uszECRBit == VS_TRUE)
		{
			if (strlen(pobTran->srBRec.szPayItemCode) > 0)
			{
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "PayItem ECR Give");
				}
				return (VS_SUCCESS);
			}
		}
		else
		{
			/* 黃國展 2015-11-13 (週五) 上午 09:21
			   請按照游溪指示做,只是是在感應流程*/
			/* 在啟動感應前已輸入PayItem 所以跳過輸入流程 */
			if (strlen(pobTran->srBRec.szPayItemCode) > 0)
			{
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "PayItem exist");
				}
				return (VS_SUCCESS);
			}
		}

		/* 只有一組Payitem 不需要再輸入繳費項目直接用該組payitem */
		for (i = 0 ;; i++)
		{
			if (inLoadPITRec(i) < 0)
			{
				/* 只有一組參數檔 */
				if (i == 1)
				{
					inLoadPITRec(0);
					memset(pobTran->srBRec.szPayItemCode, 0x00, sizeof(pobTran->srBRec.szPayItemCode));
					inGetPayItemCode(pobTran->srBRec.szPayItemCode);

	    				if (strlen(pobTran->srBRec.szPayItemCode) > 0)
	    				{
	    					return (VS_SUCCESS);
	    				}
	    				else
	    				{
						vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_PayItem strlen(pobTran->srBRec.szPayItemCode) <= 0");
						/* Pay_Item_Code是空的 錯誤提示畫面 */
						DISPLAY_OBJECT	srDispMsgObj;
						memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
						strcpy(srDispMsgObj.szDispPic1Name, "");
						srDispMsgObj.inDispPic1YPosition = 0;
						srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
						srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
						memset(szPayItemIndex, 0x00, sizeof(szPayItemIndex));
						inGetPayItemIndex(szPayItemIndex);
						sprintf(srDispMsgObj.szErrMsg1, "ERROR INDEX_%02d", (atoi(szPayItemIndex) + 1));
						srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
						strcpy(srDispMsgObj.szErrMsg2, "NO PAYITEM CODE");
						srDispMsgObj.inErrMsg2Line = _LINE_8_6_;
						srDispMsgObj.inBeepTimes = 1;
						srDispMsgObj.inBeepInterval = 0;

						inDISP_Msg_BMP(&srDispMsgObj);    					

						/* 操作錯誤 & 交易流程有誤 */
						pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
						return (VS_ERROR);
	    				}
				}
				else
					break;
			}
		}
                /*End*/
		/* 選擇繳費項目 */
                /*輸入兩碼當作Hot Key，1oad file完 判斷是否有對應的繳費項目代碼*/
		while (1)
		{
			/* 2015-09-08 (週二) 下午 05:47 黃國展(Joe Huang) 回覆 先使用大寫英文字母 ENTER PAYITEM */
			inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
			/* 請輸入繳費項目 */
			inDISP_ChineseFont("Enter payitem", _FONTSIZE_8X22_, _LINE_8_5_, _DISP_LEFT_);
			inDISP_ChineseFont("請輸入繳費項目?", _FONTSIZE_8X22_, _LINE_8_6_, _DISP_LEFT_);

			memset(szEnterKeyMap, 0x00, sizeof(szEnterKeyMap));
			memset(&srDispObj, 0x00, sizeof(DISPLAY_OBJECT));
			uszEntryAgainBit = VS_FALSE;

			srDispObj.inY = _LINE_8_7_;
			srDispObj.inR_L = _DISP_RIGHT_;
			srDispObj.inMaxLen = 10;
			srDispObj.inCanNotBypass = VS_TRUE;
			srDispObj.inColor = _COLOR_RED_;
			/* 2015-09-08 (週二) 下午 05:47 黃國展(Joe Huang) 回覆 Key_Map固定使用數字 */
			inRetVal = inDISP_Enter8x16(&srDispObj);
			memcpy(szEnterKeyMap, srDispObj.szOutput, srDispObj.inOutputLen);
			inEnterKeyMapSize = srDispObj.inOutputLen;

			if (inRetVal == VS_TIMEOUT || inRetVal == VS_USER_CANCEL)
			{
				vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_OPT_PayItem Timeout_Or_UserCancel(%d) END!", inRetVal);
				return (inRetVal);
			}
			else if (inEnterKeyMapSize == 2)
			{
				/* 這邊檢查是否有該繳費項目index */
				/* 有該筆繳費項目 取得繳費項目代碼填入szPayItemCode */
				for (i = 0 ;; i ++)
				{
					if (inLoadPITRec(i) < 0) /* 繳費項目參數檔 */
					{
						uszEntryAgainBit = VS_TRUE;
						break;
					}

					memset(szPayItemKeyMap, 0x00, sizeof(szPayItemKeyMap));
					inGetPayItemKeyMap(szPayItemKeyMap);
					if (memcmp(szEnterKeyMap, szPayItemKeyMap, 2) == 0)
					{
						/* 有找到KeyMap 將相對應的繳費項目代碼存到srBRec.szPayItemCode */
						inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
						memset(pobTran->srBRec.szPayItemCode, 0x00, sizeof(pobTran->srBRec.szPayItemCode));
						inGetPayItemCode(pobTran->srBRec.szPayItemCode);

		    				if (strlen(pobTran->srBRec.szPayItemCode) > 0)
		    				{
		    					/* PayItemCode的判斷 有值繼續往下確認 */
		    				}
		    				else
		    				{
							vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_OPT_PayItem NO PAYITEM CODE");
		    					/* Pay_Item_Code是空的 錯誤提示畫面 */
							DISPLAY_OBJECT	srDispMsgObj;
							memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
							strcpy(srDispMsgObj.szDispPic1Name, "");
							srDispMsgObj.inDispPic1YPosition = 0;
							srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
							srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
							memset(szPayItemIndex, 0x00, sizeof(szPayItemIndex));
							inGetPayItemIndex(szPayItemIndex);
							sprintf(srDispMsgObj.szErrMsg1, "ERROR INDEX_%02d", (atoi(szPayItemIndex) + 1));
							srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
							strcpy(srDispMsgObj.szErrMsg2, "NO PAYITEM CODE");
							srDispMsgObj.inErrMsg2Line = _LINE_8_6_;
							srDispMsgObj.inBeepTimes = 1;
							srDispMsgObj.inBeepInterval = 0;

							inDISP_Msg_BMP(&srDispMsgObj);    					

							/* 操作錯誤 & 交易流程有誤 */
							pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_;
							return (VS_ERROR);
		    				}

						/* 2015-09-09 (週三) 下午 05:29 黃國展(Joe Huang) 回覆
						   繳費項目說明目前規劃是大小英文與數字與可印符號*/
						/* 確認繳費項目代碼和項目說明的UI畫面 */
						memset(szTemplate, 0x00, sizeof(szTemplate));
						memset(szPayItemCode, 0x00, sizeof(szPayItemCode));
						memset(szPayItemScript, 0x00, sizeof(szPayItemScript));
						inGetPayItemCode(szPayItemCode);
						inGetPayItemScript(szPayItemScript);
						sprintf(szTemplate, "(%s %s)", szPayItemCode, szPayItemScript);
						
						/* PayItemScript小於22個字元一行顯示 */
						if (strlen(szTemplate) < 22)
						{
							memset(szDispMsg, 0x00, sizeof(szDispMsg));
							strcpy(szDispMsg, szTemplate);
							inDISP_ChineseFont(szDispMsg, _FONTSIZE_8X22_, _LINE_8_4_, _DISP_LEFT_);
							inDISP_PutGraphic(_ERR_0_, 0, _COORDINATE_Y_LINE_8_7_);
							uszKey = 0x00;
							while (1)
							{
								uszKey = uszKBD_GetKey(_EDC_TIMEOUT_);
								if (uszKey == _KEY_TIMEOUT_)
								{
									inRetVal = VS_TIMEOUT;
									break;
								}
								else if (uszKey == _KEY_CANCEL_)
								{
									inRetVal = VS_USER_CANCEL;
									break;
								}
								else if (uszKey == _KEY_0_)
								{
									inRetVal = VS_SUCCESS;
									break;
								}
							}
							
						}
						else
						{
							/* 一行20個字分三行 */
							memset(szDispMsg, 0x00, sizeof(szDispMsg));
							memcpy(szDispMsg, &szTemplate[0], 20);
							inDISP_ChineseFont(szDispMsg, _FONTSIZE_8X22_, _LINE_8_4_, _DISP_LEFT_);
							memset(szDispMsg, 0x00, sizeof(szDispMsg));
							memcpy(szDispMsg, &szTemplate[20], 20);
							inDISP_ChineseFont(szDispMsg, _FONTSIZE_8X22_, _LINE_8_5_, _DISP_LEFT_);
							memset(szDispMsg, 0x00, sizeof(szDispMsg));
							memcpy(szDispMsg, &szTemplate[40], 20);
							inDISP_ChineseFont(szDispMsg, _FONTSIZE_8X22_, _LINE_8_6_, _DISP_LEFT_);
							inDISP_PutGraphic(_ERR_0_, 0, _COORDINATE_Y_LINE_8_7_);
							uszKey = 0x00;
							while (1)
							{
								uszKey = uszKBD_GetKey(_EDC_TIMEOUT_);
								if (uszKey == _KEY_TIMEOUT_)
								{
									inRetVal = VS_TIMEOUT;
									break;
								}
								else if (uszKey == _KEY_CANCEL_)
								{
									inRetVal = VS_USER_CANCEL;
									break;
								}
								else if (uszKey == _KEY_0_)
								{
									inRetVal = VS_SUCCESS;
									break;
								}
							}
						}

						if (inRetVal != VS_SUCCESS)
						{
							vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_OPT_PayItem PayItemScript Timeout_Or_UserCancel(%d) END!", inRetVal);
							return (inRetVal);
						}

						break;
					}
					else
					{
						uszEntryAgainBit = VS_FALSE;
					}
				} /* End for (...) */

				/* 無輸入的繳費項目代碼 重新輸入 */
				if (uszEntryAgainBit == VS_TRUE)
				{
					/* Display Warning Message */
					DISPLAY_OBJECT	srDispMsgObj;
					memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
					strcpy(srDispMsgObj.szDispPic1Name, "");
					srDispMsgObj.inDispPic1YPosition = 0;
					srDispMsgObj.inMsgType = _NO_KEY_MSG_;
					srDispMsgObj.inTimeout = 0;
					strcpy(srDispMsgObj.szErrMsg1, "無此繳費項目");
					srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
					strcpy(srDispMsgObj.szErrMsg2, "請重新輸入");
					srDispMsgObj.inErrMsg2Line = _LINE_8_6_;
					srDispMsgObj.inBeepTimes = 3;
					srDispMsgObj.inBeepInterval = 1000;
					inDISP_Msg_BMP(&srDispMsgObj);

					continue;
				}
				else
				{
					break;
				}
			}
			else
			{
				continue;
			}
		}/* while */
	}
	else
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "PayItemFuncEnable OFF");
		}
		return (VS_SUCCESS);
	}

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Get_OPT_PayItem(PayItemCode = %s) END !", pobTran->srBRec.szPayItemCode);
		inLogPrintf(AT, "----------------------------------------");
	}
	
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_OPT_PayItem END!");
        
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Get_IDNumber
Date&Time       :2020/3/16 下午 5:40
Describe        :取得身分證字號或外僑居留證或統一編號
 *		【需求單 - 104014】發卡機構on-us繳費平台需求 +【需求單 - 104152】發卡機構on-us繳費平台 Payitem Code
*/
int inNCCC_Func_Get_IDNumber(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_ERROR, i = 0;
	int		inIDNumbersize = 10;
	char		szIDNumber[10 + 1] = {0};
	char		szDispMsg[_DISP_MSG_SIZE_ + 1] = {0};
	unsigned char	uszEntryAgainBit = VS_FALSE;	/* 是否重新輸入 */
	DISPLAY_OBJECT  srDispObj = {0};

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Get_IDNumber() START !");
	}

	while (1)
	{
		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		/* 請輸入ID或統編 */
		inDISP_ChineseFont("請輸入ID或統編", _FONTSIZE_8X16_, _LINE_8_6_, _DISP_CENTER_);

		uszEntryAgainBit = VS_FALSE;
		memset(szIDNumber, 0x00, sizeof(szIDNumber));
		memset(szDispMsg, 0x00, sizeof(szDispMsg));
		memset(&srDispObj, 0x00, sizeof(DISPLAY_OBJECT));

		srDispObj.inY = _LINE_8_7_;
		srDispObj.inR_L = _DISP_RIGHT_;
		srDispObj.inMaxLen = 10;
		srDispObj.inCanNotBypass = VS_TRUE;
		srDispObj.inColor = _COLOR_RED_;
		/* 林游溪 Friday, November 06, 2015 5:29 PM
		   輸入身分證字號或統編時，目前是以*顯示正確應要以明碼顯示 */
		inRetVal = inDISP_Enter8x16_Character_Mask(&srDispObj);
		memcpy(szIDNumber, srDispObj.szOutput, srDispObj.inOutputLen);
		inIDNumbersize = srDispObj.inOutputLen;
		
		/* Timeout 或取消的狀況 */
		if (inRetVal == VS_TIMEOUT || inRetVal == VS_USER_CANCEL)
		{
			vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Get_IDNumber Timeout_Or_UserCancel(%d) END!", inRetVal);
			return (inRetVal);
		}
		/* 統一編號8碼 身分證字號10碼 */
		else if (inIDNumbersize == 8)
		{
			/* 統一編號8碼 檢查全部為數字格式 */
			for (i = 0; i < 8 ; i++)
			{
				if (szIDNumber[i] < '0' || szIDNumber[i] > '9')
				{
					uszEntryAgainBit = VS_TRUE;
				}
			}

			if (uszEntryAgainBit == VS_TRUE)
			{
				DISPLAY_OBJECT	srDispMsgObj;
				memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
				strcpy(srDispMsgObj.szDispPic1Name, "");
				srDispMsgObj.inDispPic1YPosition = 0;
				srDispMsgObj.inMsgType = _NO_KEY_MSG_;
				srDispMsgObj.inTimeout = 0;
				strcpy(srDispMsgObj.szErrMsg1, "輸入格式有誤");
				srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
				strcpy(srDispMsgObj.szErrMsg2, "請重新輸入");
				srDispMsgObj.inErrMsg2Line = _LINE_8_6_;
				srDispMsgObj.inBeepTimes = 3;
				srDispMsgObj.inBeepInterval = 1000;

				inDISP_Msg_BMP(&srDispMsgObj);
				continue;
			}
			else
			{
				/* 將鍵盤輸入的統一編號存在srBRec.szIDNumber */
				memset(pobTran->szIDNumber, 0x00, sizeof(pobTran->szIDNumber));
				memcpy(&pobTran->szIDNumber[0], &szIDNumber[0], inIDNumbersize);
				break;
			}
		}
		/* 統一編號8碼 身分證字號10碼 */
		else if (inIDNumbersize == 10)
		{
			/* 身分證字號第一碼必須為大寫英文字母 誤輸小寫自動轉為大寫 */
			if ((szIDNumber[0] >= 'a') && (szIDNumber[0] <= 'z'))
			{
				szIDNumber[0] = szIDNumber[0] - 0x20;
			}
			else if ((szIDNumber[0] >= 'A') && (szIDNumber[0] <= 'Z'))
			{
				/* 第一碼大寫英文字母 */
			}
			else
			{
				uszEntryAgainBit = VS_TRUE;
			}
			/* 第二碼為A~Z or 0~9 */
			if ((szIDNumber[1] >= 'a') && (szIDNumber[1] <= 'z'))
			{
				/* 誤輸小寫自動轉為大寫 */
				szIDNumber[1] = szIDNumber[1] - 0x20;
			}
			else if ((szIDNumber[1] >= 'A') && (szIDNumber[1] <= 'Z'))
			{
			}
			else if ((szIDNumber[1] >= '0') && (szIDNumber[1] <= '9'))
			{
			}
			else
			{
				uszEntryAgainBit = VS_TRUE;
			}

			/* 檢查後8碼須為0 ~ 9之數字 */
			for (i = 2; i < 10 ; i++)
			{
				if (szIDNumber[i] < 0x30 || szIDNumber[i] > 0x39)
				{
					uszEntryAgainBit = VS_TRUE;
				}
			}

			if (uszEntryAgainBit == VS_TRUE)
			{
				DISPLAY_OBJECT	srDispMsgObj;
				memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
				strcpy(srDispMsgObj.szDispPic1Name, "");
				srDispMsgObj.inDispPic1YPosition = 0;
				srDispMsgObj.inMsgType = _NO_KEY_MSG_;
				srDispMsgObj.inTimeout = 0;
				strcpy(srDispMsgObj.szErrMsg1, "輸入格式有誤");
				srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
				strcpy(srDispMsgObj.szErrMsg2, "請重新輸入");
				srDispMsgObj.inErrMsg2Line = _LINE_8_6_;
				srDispMsgObj.inBeepTimes = 3;
				srDispMsgObj.inBeepInterval = 1000;

				inDISP_Msg_BMP(&srDispMsgObj);
				continue;
			}
			else
			{
				/* 將鍵盤輸入的ID存在srBRec.szIDNumber */
				memset(pobTran->szIDNumber, 0x00, sizeof(pobTran->szIDNumber));
				memcpy(&pobTran->szIDNumber[0], &szIDNumber[0], inIDNumbersize);
				break;
			}
		}
		/* 小於8碼或等於9碼不合法 */
		else
		{
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, "");
			srDispMsgObj.inDispPic1YPosition = 0;
			srDispMsgObj.inMsgType = _NO_KEY_MSG_;
			srDispMsgObj.inTimeout = 0;
			strcpy(srDispMsgObj.szErrMsg1, "輸入格式有誤");
			srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
			strcpy(srDispMsgObj.szErrMsg2, "請重新輸入");
			srDispMsgObj.inErrMsg2Line = _LINE_8_6_;
			srDispMsgObj.inBeepTimes = 3;
			srDispMsgObj.inBeepInterval = 1000;
			
			inDISP_Msg_BMP(&srDispMsgObj);
			
			continue;
		}
	}

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Get_IDNumber() END !");
		inLogPrintf(AT, "----------------------------------------");
	}

	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_ResponseCode_Transform
Date&Time       :2020/4/17 下午 3:36
Describe        :將回應碼轉換回文字
 *		
*/
int inNCCC_Func_ResponseCode_Transform(int inResponseCode, char* szMsg)
{
	switch(inResponseCode)
	{
		case 1:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 2:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 3:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 4:
			sprintf(szMsg, "%s", "請沒收卡片");
			break;
		case 5:
			sprintf(szMsg, "%s", "拒絕交易");
			break;
		case 6:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 7:
			sprintf(szMsg, "%s", "請沒收卡片");
			break;
		case 8:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 9:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 10:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 11:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 12:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 13:
			sprintf(szMsg, "%s", "交易金額超限");
			break;
		case 14:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 15:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 16:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 17:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 18:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 19:
			sprintf(szMsg, "%s", "請重新交易");
			break;
		case 20:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 21:
			sprintf(szMsg, "%s", "請重新交易");
			break;
		case 22:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 23:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 24:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 25:
			sprintf(szMsg, "%s", "無原交易紀錄");
			break;
		case 26:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 27:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 28:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 29:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 30:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 31:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 32:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 33:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 34:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 35:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 36:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 37:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 38:
			sprintf(szMsg, "%s", "密碼錯超過次數");
			break;
		case 39:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 40:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 41:
			sprintf(szMsg, "%s", "遺失卡");
			break;
		case 42:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 43:
			sprintf(szMsg, "%s", "請沒收卡片");
			break;
		case 44:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 45:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 46:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 47:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 48:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 49:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 50:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 51:
			sprintf(szMsg, "%s", "餘額不足");
			break;
		case 52:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 53:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 54:
			sprintf(szMsg, "%s", "卡片已過期");
			break;
		case 55:
			sprintf(szMsg, "%s", "密碼錯誤請重試");
			break;
		case 56:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 57:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 58:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 59:
			sprintf(szMsg, "%s", "帳號錯誤");
			break;
		case 60:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 61:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 62:
			sprintf(szMsg, "%s", "請重新交易");
			break;
		case 63:
			sprintf(szMsg, "%s", "主機密碼錯誤");
			break;
		case 64:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 65:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 66:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 67:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 68:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 69:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 70:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 71:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 72:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 73:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 74:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 75:
			sprintf(szMsg, "%s", "密碼超過次數");
			break;
		case 76:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 77:
			sprintf(szMsg, "%s", "金額錯誤");
			break;
		case 78:
			sprintf(szMsg, "%s", "交易不存在");
			break;
		case 79:
			sprintf(szMsg, "%s", "批次已開啟");
			break;
		case 80:
			sprintf(szMsg, "%s", "批號錯誤");
			break;
		case 81:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 82:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 83:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 84:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 85:
			sprintf(szMsg, "%s", "批號不存在");
			break;
		case 86:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 87:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 88:
			sprintf(szMsg, "%s", "商店代號錯誤");
			break;
		case 89:
			sprintf(szMsg, "%s", "端末機代號錯誤");
			break;
		case 90:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 91:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 92:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 93:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 94:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 95:
			sprintf(szMsg, "%s", "批次上傳");
			break;
		case 96:
			sprintf(szMsg, "%s", "主機系統錯誤");
			break;
		case 97:
			sprintf(szMsg, "%s", "請聯絡發卡銀行");
			break;
		case 98:
			sprintf(szMsg, "%s", "不可連續刷卡");
			break;
		case 99:
			sprintf(szMsg, "%s", "密碼資料區塊錯誤");
			break;
		default:
			sprintf(szMsg, "%s", "拒絕交易");			/* 拒絕交易 */
			break;
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Init_tSAM_Data
Date&Time       :2020/9/3 下午 4:42
Describe        :初始化tSAM加密用資料
 *		
*/
int inNCCC_Func_Init_tSAM_Data(void)
{
	guszField_35 = VS_FALSE;
	guszField_55 = VS_FALSE;
	guszField_56 = VS_FALSE;
	gusztSAMKeyIndex = 0x00;
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Switch_Special_Situation
Date&Time       :2020/12/18 下午 5:50
Describe        :
*/
int inNCCC_Func_Switch_Special_Situation(void)
{
	int		inRetVal;
        char		szTemplate[64 + 1];
        DISPLAY_OBJECT  srDispObj;
        
        /* Debug */
	inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
        memset(szTemplate, 0x00, sizeof(szTemplate));
        
        if ((ginSpecialSituation & _SPECIAL_SITUATION_ESVC_ADVICE_RESPONSE_19_) == _SPECIAL_SITUATION_ESVC_ADVICE_RESPONSE_19_)
                strcpy(szTemplate, "ESVC Advice回19 開關 : ON");
        else
                strcpy(szTemplate, "ESVC Advice回19 開關 : OFF");
 
        inDISP_ChineseFont(szTemplate, _FONTSIZE_8X22_, _LINE_8_5_, _DISP_LEFT_);
        inDISP_ChineseFont("1 = ON , 0 = OFF", _FONTSIZE_8X22_, _LINE_8_6_, _DISP_LEFT_);

        while (1)
        {
                memset(&srDispObj, 0x00, sizeof(DISPLAY_OBJECT));
                srDispObj.inMaxLen = 1;
                srDispObj.inY = _LINE_8_7_;
                srDispObj.inR_L = _DISP_RIGHT_;
		srDispObj.inColor = _COLOR_RED_;

		memset(srDispObj.szOutput, 0x00, sizeof(srDispObj.szOutput));
		srDispObj.inOutputLen = 0;
	
                inRetVal = inDISP_Enter8x16(&srDispObj);

                if (inRetVal == VS_TIMEOUT || inRetVal == VS_USER_CANCEL)
                        return (VS_ERROR);

                if (strlen(srDispObj.szOutput) > 0)
                {
                        if (srDispObj.szOutput[0] == '0')
                        {
				ginSpecialSituation &= ~_SPECIAL_SITUATION_ESVC_ADVICE_RESPONSE_19_;
								
                                break;
                        }
                        else if (srDispObj.szOutput[0] == '1')
                        {
                                ginSpecialSituation |= _SPECIAL_SITUATION_ESVC_ADVICE_RESPONSE_19_;
				
                                break;
                        }
                        else
                        {
                                inDISP_Clear_Line(_LINE_8_7_, _LINE_8_8_);
                                continue;
                        }
                }
                else
                {
                        break;
                }
        }
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_DCC_Download_Settle
Date&Time       :2021/8/25 下午 3:28
Describe        :結帳後補DCC下載
*/
int inNCCC_Func_DCC_Download_Settle(TRANSACTION_OBJECT *pobTran)
{
	int	inTransactionCode = 0;		/* 雖然流程已修正過，但為了避免以後用到這隻踩到地雷，還是做還原TransactionCode的動作 */
	char	szDCCSettleDownload[2 + 1] = {0};
        char    szTemplate[16 + 1] = {0};

        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_DCC_Download_Settle START!");
        
	/* 還原inTransactionCode*/
	inTransactionCode = pobTran->inTransactionCode;
	
	/* DCC排程下載但失敗時改在結帳後下載，只有在單一結帳DCC時才跑 */
	memset(szTemplate, 0x00, sizeof(szTemplate));
	inGetTRTFileName(szTemplate);
	if (pobTran->uszAutoSettleBit != VS_TRUE && memcmp(szTemplate, _TRT_FILE_NAME_DCC_, strlen(_TRT_FILE_NAME_DCC_)) == 0)
	{
		/* 如果szDCCSettleDownload On起來的話，若TMS更新需重開機此Bit在更新後重置 */
		memset(szDCCSettleDownload, 0x00, sizeof(szDCCSettleDownload));
		inGetDCCSettleDownload(szDCCSettleDownload);
		if (memcmp(szDCCSettleDownload, "1", 1) == 0)
		{
			inNCCC_DCC_AutoDownload(pobTran);
			/* 不論是否成功，都把DCCSettleDownload狀態重置 */
			inSetDCCSettleDownload("0");
			inSaveEDCRec(0);
		}
	}

	/* 還原inTransactionCode*/
	pobTran->inTransactionCode = inTransactionCode;
        
        /* 標記為已做過 */
        if (pobTran->inRunTRTID == _TRT_SETTLE_)
        {
                inNCCC_Func_Settlement_XML_Edit(_SETTLENMENT_RECOVER_XML_TAG_NCCC_FUNCTION_DCC_SETTLE_DOWNLOAD_, "Y");
        }

	if (ginDebug == VS_TRUE)
		inLogPrintf(AT, "inNCCCTMS_Schedule_Download_Check() END!");    

	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Uny_GenMAC
Date&Time       :2021/9/3 下午 5:25
Describe        :Uny掃碼交易使用
*/
int inNCCC_Func_Uny_GenMAC(TRANSACTION_OBJECT *pobTran, char *szF_03, char *szF_04, char *szF_11, char *szF_35, char *szF_41, char *szF_63)
{
	int 	inMACLen = 0;
	int 	inRetVal = VS_SUCCESS;
	char	szDebugMsg[128 + 1] = {0}, szDataBuf[128 + 1] = {0};
	char	szAscii[16 + 1] = {0};

	/* 處理中‧‧‧‧‧ */
	if (pobTran->srEWRec.uszEWTransBit == VS_TRUE)
	{
		/* 不顯示字樣 */
	}
	else
	{
		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		inDISP_PutGraphic(_PROCESS_, 0, _COORDINATE_Y_LINE_8_7_); 
	}

        /*
                1. ISO8583 F_03 (Processing Code）前 2 碼。
		2. ISO8583 F 04_Data （交易金額)
			例： NT 187 則 DATA 為 「 00000001 8700 」共 12 碼。
		3. ISO8583 F_11 STAN ）後 2 碼。
		4. ISO85 83 F_35 Data （交易條碼）共 18 碼。
		5. ISO85 83 F_41 TID 8 碼。
		註：UNY 實體掃碼交易 退貨 (Refund)無 F 35 欄位，
		  故退貨時無需使用該欄位 資料進行 MA C 驗算。
        */
	
	memset(szDataBuf, 0x00, sizeof(szDataBuf));
	/* Process Code前兩碼 2 碼 (BCD to ASCII) */
	strcat(szDataBuf, szF_03);
	/* ISO8583 F_04 Data */
	strcat(szDataBuf, szF_04);
	/* ISO8583 F_11(STAN)後2碼(BCD to ASCII) */
	strcat(szDataBuf, szF_11);
	/* ISO8583 F_35 Data */
	if (pobTran->srBRec.inCode == _EW_REFUND_		||
	    pobTran->srBRec.inCode == _EW_INQUIRY_		||
	   (pobTran->srBRec.uszUnyTransBit == VS_TRUE	&& 
	   (pobTran->srBRec.inOrgCode == _REFUND_		|| 
	    pobTran->srBRec.inOrgCode == _INST_REFUND_		||
	    pobTran->srBRec.inOrgCode == _REDEEM_REFUND_)))
	{
		
	}
	else
	{
		strcat(szDataBuf, szF_35);
	}
	/* Terminal ID */
	strcat(szDataBuf, szF_41);

	if (ginDebug == VS_TRUE)
	{
		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "F03: %s", szF_03);
		inLogPrintf(AT, szDebugMsg);
		
		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "F04: %s", szF_04);
		inLogPrintf(AT, szDebugMsg);
		
		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "F11: %s", szF_11);
		inLogPrintf(AT, szDebugMsg);

		if (pobTran->srBRec.inCode == _EW_REFUND_ ||
		    pobTran->srBRec.inCode == _EW_INQUIRY_)
		{

		}
		else
		{
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "F35: %s", szF_35);
			inLogPrintf(AT, szDebugMsg);
		}
		
		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "F41: %s", szF_41);
		inLogPrintf(AT, szDebugMsg);
	}    
        
	inMACLen = strlen(szDataBuf);

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "==========================================");
		
		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "GenMAC Length [%d]", inMACLen);
		inLogPrintf(AT, szDebugMsg);
		
		memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		sprintf(szDebugMsg, "GenMAC Data [%s]", szDataBuf);
		inLogPrintf(AT, szDebugMsg);
		
		inLogPrintf(AT, "==========================================");
	}

	inRetVal = inNCCC_TMK_CalculateMac(szDataBuf, pobTran->szMAC_HEX);
		
	if (ginDebug == VS_TRUE)
	{
                memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
		memset(szAscii, 0x00, sizeof(szAscii));
		inFunc_BCD_to_ASCII(szAscii, (unsigned char*)pobTran->szMAC_HEX, 8);
        	sprintf(szDebugMsg, "MAC RESULT [%d][%s]", strlen(pobTran->szMAC_HEX), szAscii);
                inLogPrintf(AT, szDebugMsg);
        }

        if (inRetVal != VS_SUCCESS)
	        return (VS_ERROR);
	else
		return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Check_Card_Label_Is_Already_Have
Date&Time       :2021/9/7 上午 11:45
Describe        :三種結果:
 *		1.既有卡片找到 回傳VS_True inCDTXIndex = -1
 *		2.已存新卡別   回傳VS_True inCDTXIndex >= 0
 *		3.未知卡別   回傳VS_False inCDTXIndex >= 0
*/
int inNCCC_Func_Check_Card_Label_Is_Already_Have(char* szCardLabel, int* inCDTXIndex)
{
	int		inCardLabelLen = 0;
	int		inUnknownCardLen = 0;
	char		szUnknownCardLabel[20 + 1];
	unsigned char	uszCheckCardLabel = VS_FALSE;
	
	
	*inCDTXIndex = -1;
	inCardLabelLen = strlen(szCardLabel);
	
	/* 先比對卡別名稱 */
	if (!memcmp(_CARD_TYPE_SMARTPAY_, &szCardLabel[0], inCardLabelLen) &&
	    strlen(_CARD_TYPE_SMARTPAY_) == inCardLabelLen)
	{
		/* 有比對到可以存卡別 */
		uszCheckCardLabel = VS_TRUE;
	}
	else if (!memcmp(_CARD_TYPE_VISA_, &szCardLabel[0], inCardLabelLen) &&
		strlen(_CARD_TYPE_VISA_) == inCardLabelLen)
	{
		/* 有比對到可以存卡別 */
		uszCheckCardLabel = VS_TRUE;
	}
	else if (!memcmp(_CARD_TYPE_MASTERCARD_, &szCardLabel[0], inCardLabelLen) &&
		strlen(_CARD_TYPE_MASTERCARD_) == inCardLabelLen)
	{
		/* 有比對到可以存卡別 */
		uszCheckCardLabel = VS_TRUE;
	}
	else if (!memcmp(_CARD_TYPE_JCB_, &szCardLabel[0], inCardLabelLen) &&
		strlen(_CARD_TYPE_JCB_) == inCardLabelLen)
	{
		/* 有比對到可以存卡別 */
		uszCheckCardLabel = VS_TRUE;

	}
	else if (!memcmp(_CARD_TYPE_AMEX_, &szCardLabel[0], inCardLabelLen) &&
		strlen(_CARD_TYPE_AMEX_) == inCardLabelLen)
	{
		/* 有比對到可以存卡別 */
		uszCheckCardLabel = VS_TRUE;
	}
	else if (!memcmp(_CARD_TYPE_CUP_, &szCardLabel[0], inCardLabelLen) &&
		strlen(_CARD_TYPE_CUP_) == inCardLabelLen)
	{
		/* 有比對到可以存卡別 */
		uszCheckCardLabel = VS_TRUE;
	}
	else if (!memcmp(_CARD_TYPE_DINERS_, &szCardLabel[0], inCardLabelLen) &&
		strlen(_CARD_TYPE_DINERS_) == inCardLabelLen)
	{
		/* 有比對到可以存卡別 */
		uszCheckCardLabel = VS_TRUE;
	}
	else if (!memcmp(_CARD_TYPE_TWIN_CARD_, &szCardLabel[0], inCardLabelLen) &&
		strlen(_CARD_TYPE_TWIN_CARD_) == inCardLabelLen)
	{
		/* 有比對到可以存卡別 */
		uszCheckCardLabel = VS_TRUE;
	}
	else
	{
		/* 例外狀況判斷 */
		for (*inCDTXIndex = 0; *inCDTXIndex < 10; (*inCDTXIndex)++)
		{
			inLoadCDTXRec(*inCDTXIndex);
			memset(szUnknownCardLabel, 0x00, sizeof(szUnknownCardLabel));
			inGetUnknownCardLabel(szUnknownCardLabel);
			inUnknownCardLen = strlen(szUnknownCardLabel);

			if (!memcmp(szUnknownCardLabel, "                    ", 20))
			{
				/* 沒有找到 */
				uszCheckCardLabel = VS_FALSE;
				break;
			}
			else
			{
				/* 不是空白預設值就比對卡別 */
				if (!memcmp(&szUnknownCardLabel[0], &szCardLabel[0], inCardLabelLen) &&
				    inUnknownCardLen == inCardLabelLen)
				{
					uszCheckCardLabel = VS_TRUE;
					break;
				}
			}
		}
	}
	
	if (uszCheckCardLabel == VS_TRUE)
	{
		return (VS_TRUE);
	}
	else
	{
		return (VS_FALSE);
	}
}

/*
Function	:inNCCC_Func_Check_Uny_Format
Date&Time	:2021/9/27 下午 3:28
Describe        :確認格式是否為Uny格式
*/
int inNCCC_Func_Check_Uny_Format(char* szString)
{
	int	i = 0;
	
	for (i = 0; i < 18; i++)
	{
		if (i == 0 && szString[i] == 'U')
		{
			
		}
		else if (i == 1 && szString[i] == 'n')
		{
			
		}
		else if (i >= 2 && i <= 17)
		{
			if ((szString[i] - '0') >= 0 &&
			    (szString[i] - '0') <= 9)
			{
				
			}
			else
			{
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "szString[%d] == %c illegal", i, szString[i]);
				}
				return (VS_FALSE);
			}
		}
		else
		{
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "szString[%d] == %c illegal", i, szString[i]);
			}
			return (VS_FALSE);
		}
	}
	
	return	(VS_TRUE);
}

/*
Function	:inNCCC_Func_Disp_EchoTest
Date&Time	:2022/3/2 下午 5:16
Describe        :顯示echo test連線成功
*/
int inNCCC_Func_Disp_EchoTest(void)
{
	DISPLAY_OBJECT	srDispMsgObj;
	memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
	strcpy(srDispMsgObj.szDispPic1Name, "");
	srDispMsgObj.inDispPic1YPosition = 0;
	srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
	srDispMsgObj.inTimeout = 3;
	strcpy(srDispMsgObj.szErrMsg1, "連線成功");
	srDispMsgObj.inErrMsg1Line = _LINE_8_5_;

	inDISP_Msg_BMP(&srDispMsgObj);
	
	return (VS_SUCCESS);
}
/*
Function	:inNCCC_Func_Send_ECR_After_Print_Receipt
Date&Time	:2022/3/24 下午 3:31
Describe        :在印簽單後才回傳ECR
*/
int inNCCC_Func_Send_ECR_After_Print_Receipt(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = VS_SUCCESS;
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Send_ECR_After_Print_Receipt START!");
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Send_ECR_After_Print_Receipt() START !");
		inLogPrintf(AT, "Bit ECR(0x%02X) DelaySend(0x%02X)", pobTran->uszECRBit, pobTran->uszDelaySendBit);
	}

	/* 不是ECR連線就跳走 */
        if (pobTran->uszECRBit == VS_TRUE)
        {
                if (pobTran->uszDelaySendBit) 
                {
			/* 原本流程，單純Delay */
			pobTran->uszDelaySendBit = VS_FALSE;
			inRetVal = inECR_Send_Transaction_Result(pobTran);
			if (inRetVal != VS_SUCCESS)
			{
				vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Send_ECR_After_Print_Receipt inECR_Send_Transaction_Result fail");
			}
                }
        }
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Send_ECR_After_Print_Receipt() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Send_ECR_After_Print_Receipt END!");
	
	return (VS_SUCCESS);
}

/*
Function	:inNCCC_Func_Receive_EI_Flow
Date&Time	:2022/3/24 下午 3:31
Describe        :流程中最後收電子發票的地方
*/
int inNCCC_Func_Receive_EI_Flow(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = VS_SUCCESS;
	char	szCustomerIndicator[3 + 1] = {0};
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Receive_EI_Flow START!");
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Receive_EI_Flow() START !");
		inLogPrintf(AT, "Bit ECR(0x%02X)", pobTran->uszECRBit);
	}
	
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "Customer Indicator(%s)", szCustomerIndicator);
	}
	
	/* 不是ECR連線就跳走 */
        if (pobTran->uszECRBit == VS_TRUE)
        {
		 /* 電子發票部分 */
		if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_034_TK3C_EINVOICE_, _CUSTOMER_INDICATOR_SIZE_) ||
		    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_055_EINVOICE_, _CUSTOMER_INDICATOR_SIZE_)      ||
		    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_088_TINTIN_, _CUSTOMER_INDICATOR_SIZE_))	
		{
			/* 晶片卡 + 一般交易、紅利、分期、預先授權、銀聯一般、銀聯預先
			 * 金融卡 + 金融一般
			 * HG過卡方式 信用卡、HGI、CUP + 紅利積點、點數扣抵、加價購 
			 */
			if (	(pobTran->srBRec.inChipStatus == _EMV_CARD_ && 
				(pobTran->inTransactionCode == _SALE_		||
				pobTran->inTransactionCode == _INST_SALE_	||
				pobTran->inTransactionCode == _REDEEM_SALE_	||
				pobTran->inTransactionCode == _PRE_AUTH_	||
				pobTran->inTransactionCode == _CUP_SALE_	||
				pobTran->inTransactionCode == _CUP_PRE_AUTH_	||
				(pobTran->inTransactionCode == _SALE_OFFLINE_	&&
				pobTran->srBRec.uszReferralBit == VS_TRUE)))	||
				(pobTran->srBRec.uszFiscTransBit == VS_TRUE	&&
				pobTran->inTransactionCode == _FISC_SALE_)	||
				((pobTran->srBRec.lnHGPaymentType == _HG_PAY_CREDIT_		||
				pobTran->srBRec.lnHGPaymentType == _HG_PAY_CREDIT_INSIDE_	||
				pobTran->srBRec.lnHGPaymentType == _HG_PAY_CUP_)		&&
				(pobTran->srBRec.lnHGTransactionType == _HG_REWARD_		||
				pobTran->srBRec.lnHGTransactionType == _HG_ONLINE_REDEEM_	||
				pobTran->srBRec.lnHGTransactionType == _HG_POINT_CERTAIN_))				)
			{
				/* 只有正向交易晶片卡要在交易流程中接收發票 */
				inDISP_ClearAll();
				inFunc_Display_LOGO( 0,  _COORDINATE_Y_LINE_16_2_);	
				inDISP_PutGraphic(_MENU_EI_TITLE_, 0,  _COORDINATE_Y_LINE_8_3_);
				inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
				inDISP_PutGraphic(_ECR_RECEIVE_, 0,  _COORDINATE_Y_LINE_8_6_);

				/* 失敗還是要繼續TRT */
				pobTran->uszIsTradeBit = VS_TRUE;
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_ECR_RECEIVE_TRANSACTION_REQUEST_);
				if (inRetVal == VS_TIMEOUT)
				{
					inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
					inDISP_ChineseFont_Color("接受資料逾時", _FONTSIZE_8X16_, _LINE_8_6_, _COLOR_BLACK_, _DISP_CENTER_);
					inDISP_Wait(2000);
				}
			}
		}
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Receive_EI_Flow() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Receive_EI_Flow END!");
        
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Check_Card_Still_Exist_Flow
Date&Time       :2017/11/6 上午 10:40
Describe        :
*/
int inNCCC_Func_Check_Card_Still_Exist_Flow(TRANSACTION_OBJECT *pobTran, int inIsError)
{
	int	inRetVal = VS_SUCCESS;
	
	/* 晶片卡 */
	inRetVal = inEMV_CheckRemoveCard(pobTran, inIsError);
	
	/* 感應卡 */
	inRetVal = inCTLS_CheckRemoveCard(pobTran, inIsError);
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Dutyfree_Settlement_Flow
Date&Time       :2022/5/12 下午 4:58
Describe        :昇恆昌結帳流程
 *		046:各主機總額報表→各主機明細報表→各主機結帳報表
 *		047:(總額報表→明細報表→結帳報表)→換下一個主機重複以上迴圈
 *		075、103：各主機結帳報表→重印總表→各主機重印明細
*/
int inNCCC_Func_Dutyfree_Settlement_Flow(TRANSACTION_OBJECT *pobTran)
{
	int		i = 0;
	int		inRetVal = VS_SUCCESS;
	int		inOrgHDTIndex = 0;
	int		inHG_HDTIndex = -1;
	char		szHostName[42 + 1] = {0};
	char		szHostEnable[2 + 1] = {0};
	char		szDebugMsg[100 + 1] = {0};
	char		szTRTFileName[12 + 1] = {0};
	char		szBatchNum[6 + 1] = {0};
	char		szTemplate[10 + 1] = {0};
	char		szCustomerIndicator[3 + 1] = {0};
	char		szSettleEnable[1 + 1] = {0};
	char		szNCCC_Settle_BatchNum[6 + 1] = {0};
	char		szDCC_Settle_BatchNum[6 + 1] = {0};
	char		szTrnas[1 + 1] = {0};
	unsigned char	uszSettleFailBit = VS_FALSE;		/* 代表至少有一個Host失敗 */
	unsigned char	uszSettleSuccessBit = VS_FALSE;		/* 代表至少有一個Host成功 */
	unsigned char	uszCheckAccum_OK_Bit = VS_FALSE;
	DUTYFREE_REPRINT_TITLE	srReprintTitle;
	SQLITE_ALL_TABLE	srALL;
	RTC_NEXSYS	srRTC;
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Dutyfree_Settlement_Flow() START !");
	}
	
	inOrgHDTIndex = pobTran->srBRec.inHDTIndex;
	
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_HG_, &inHG_HDTIndex);
	if (inFunc_All_Host_Settle_Check(pobTran, VS_FALSE) == VS_SUCCESS)
	{
		uszCheckAccum_OK_Bit = VS_TRUE;
	}
	
	if (pobTran->uszAutoSettleBit == VS_TRUE)
	{
		/* ECR結帳立即回傳 */
		if (pobTran->uszECRBit == VS_TRUE)
		{
			inFLOW_RunFunction(pobTran, _FUNCTION_ECR_SEND_TRANSACTION_RESULT_);
		}
	
		/* (需求單-109327)-vx520客製化需求 by Russell 2022/4/18 上午 10:44
		 * 昇恆昌客製化，連動結帳簽單列印規則：各主機總額報表→各主機明細報表→各主機結帳報表
		 * 這邊處理總額和明細，結帳報表交由下面原流程處理 */
		if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_046_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_))
		{
			/* 總額報表 */
			for (i = 0;; ++i)
			{
				/* 先LoadHDT */
				if (inLoadHDTRec(i) == VS_ERROR)
				{
					/* 當找不到第i筆資料會回傳VS_ERROR */
					break;
				}

				/* ESC要跳過 */
				/* HG要跳過，直接跟在NCCC後面 */
				memset(szHostName, 0x00, sizeof(szHostName));
				inGetHostLabel(szHostName);
				if (memcmp(szHostName, _HOST_NAME_ESC_, strlen(_HOST_NAME_ESC_)) == 0	||
				    memcmp(szHostName, _HOST_NAME_HG_, strlen(_HOST_NAME_HG_)) == 0	||
				    memcmp(szHostName, _HOST_NAME_EW_, strlen(_HOST_NAME_EW_)) == 0)
				{
					continue;
				}

				/* GET HOST Enable */
				/* 結帳沒開也不跑 */
				memset(szHostEnable, 0x00, sizeof(szHostEnable));
				if (inGetHostEnable(szHostEnable) == VS_ERROR)
				{	
					return (VS_ERROR);
				}
				else
				{
					if (ginDebug == VS_TRUE)
					{
						memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
						sprintf(szDebugMsg, "%d HostEnable: %s", i, szHostEnable);
						inLogPrintf(AT, szDebugMsg);
					}
				}

				/* 看結帳開關 */
				if (memcmp(szHostEnable, "Y", 1) != 0)
				{
					/* 如果HostEnable != Y，就continue */
					continue;
				}
				else
				{
					pobTran->srBRec.inHDTIndex = i;
				}

				/* 如果主機有開，才loadHDPT */
				if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) == VS_SUCCESS)
				{
					memset(szBatchNum, 0x00, sizeof(szBatchNum));
					inGetBatchNum(szBatchNum);
					pobTran->srBRec.lnBatchNum = atol(szBatchNum);
					pobTran->uszPrePrintBit = VS_TRUE;
					inFLOW_RunFunction(pobTran, _FUNCTION_PRINT_TOTAL_REPORT_BY_BUFFER_);
					pobTran->uszPrePrintBit = VS_FALSE;
				}
				
				/* 如果是NCCC，後面接HG */
				if (memcmp(szHostName, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)) == 0)
				{
					inLoadHDTRec(inHG_HDTIndex);
					
					/* GET HOST Enable */
					/* 結帳沒開也不跑 */
					memset(szHostEnable, 0x00, sizeof(szHostEnable));
					if (inGetHostEnable(szHostEnable) == VS_ERROR)
					{	
						return (VS_ERROR);
					}
					else
					{
						if (ginDebug == VS_TRUE)
						{
							memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
							sprintf(szDebugMsg, "%d HostEnable: %s", i, szHostEnable);
							inLogPrintf(AT, szDebugMsg);
						}
					}

					/* 看結帳開關 */
					if (memcmp(szHostEnable, "Y", 1) != 0)
					{
						/* 如果HostEnable != Y，就continue */
						continue;
					}
					else
					{
						pobTran->srBRec.inHDTIndex = inHG_HDTIndex;
					}

					/* 如果主機有開，才loadHDPT */
					if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) == VS_SUCCESS)
					{
						memset(szBatchNum, 0x00, sizeof(szBatchNum));
						inGetBatchNum(szBatchNum);
						pobTran->srBRec.lnBatchNum = atol(szBatchNum);
						pobTran->uszPrePrintBit = VS_TRUE;
						inFLOW_RunFunction(pobTran, _FUNCTION_PRINT_TOTAL_REPORT_BY_BUFFER_);
						pobTran->uszPrePrintBit = VS_FALSE;
					}
				}
			}

			/* 結帳報表 */
			for (i = 0;; ++i)
			{
				/* 先LoadHDT */
				if (inLoadHDTRec(i) == VS_ERROR)
				{
					/* 當找不到第i筆資料會回傳VS_ERROR */
					break;
				}

				/* ESC要跳過 */
				/* HG已在下面和NCCC跑過，不必再跑 */
				memset(szHostName, 0x00, sizeof(szHostName));
				inGetHostLabel(szHostName);
				inFunc_DiscardSpace(szHostName);
				if (memcmp(szHostName, _HOST_NAME_ESC_, strlen(_HOST_NAME_ESC_)) == 0	||
				    memcmp(szHostName, _HOST_NAME_HG_, strlen(_HOST_NAME_HG_)) == 0	||
				    memcmp(szHostName, _HOST_NAME_EW_, strlen(_HOST_NAME_EW_)) == 0)
				{
					continue;
				}

				/* GET HOST Enable */
				/* 結帳沒開也不跑 */
				memset(szHostEnable, 0x00, sizeof(szHostEnable));
				if (inGetHostEnable(szHostEnable) == VS_ERROR)
				{	
					return (VS_ERROR);
				}
				else
				{
					if (ginDebug == VS_TRUE)
					{
						memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
						sprintf(szDebugMsg, "%d HostEnable: %s", i, szHostEnable);
						inLogPrintf(AT, szDebugMsg);
					}
				}

				/* 看結帳開關 */
				if (memcmp(szHostEnable, "Y", 1) != 0)
				{
					/* 如果HostEnable != Y，就continue */
					continue;
				}
				else
				{
					pobTran->srBRec.inHDTIndex = i;
				}

				/* 如果主機有開，才loadHDPT */
				if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) == VS_SUCCESS)
				{
					memset(szBatchNum, 0x00, sizeof(szBatchNum));
					inGetBatchNum(szBatchNum);
					pobTran->srBRec.lnBatchNum = atol(szBatchNum);
					pobTran->uszPrePrintBit = VS_TRUE;
					inFLOW_RunFunction(pobTran, _FUNCTION_PRINT_DETAIL_REPORT_BY_BUFFER_);
					pobTran->uszPrePrintBit = VS_FALSE;
				}
				
				/* 如果是NCCC，後面接HG */
				if (memcmp(szHostName, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)) == 0)
				{
					inLoadHDTRec(inHG_HDTIndex);
					
					/* GET HOST Enable */
					/* 結帳沒開也不跑 */
					memset(szHostEnable, 0x00, sizeof(szHostEnable));
					if (inGetHostEnable(szHostEnable) == VS_ERROR)
					{	
						return (VS_ERROR);
					}
					else
					{
						if (ginDebug == VS_TRUE)
						{
							memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
							sprintf(szDebugMsg, "%d HostEnable: %s", i, szHostEnable);
							inLogPrintf(AT, szDebugMsg);
						}
					}

					/* 看結帳開關 */
					if (memcmp(szHostEnable, "Y", 1) != 0)
					{
						/* 如果HostEnable != Y，就continue */
						continue;
					}
					else
					{
						pobTran->srBRec.inHDTIndex = inHG_HDTIndex;
					}

					/* 如果主機有開，才loadHDPT */
					if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) == VS_SUCCESS)
					{
						memset(szBatchNum, 0x00, sizeof(szBatchNum));
						inGetBatchNum(szBatchNum);
						pobTran->srBRec.lnBatchNum = atol(szBatchNum);
						pobTran->uszPrePrintBit = VS_TRUE;
						inFLOW_RunFunction(pobTran, _FUNCTION_PRINT_DETAIL_REPORT_BY_BUFFER_);
						pobTran->uszPrePrintBit = VS_FALSE;
					}
				}
			}
		}

		for (i = 0;; ++i)
		{
			/* 先LoadHDT */
			if (inLoadHDTRec(i) == VS_ERROR)
			{
				/* 當找不到第i筆資料會回傳VS_ERROR */
				break;
			}

			/* 部份Host須跳過 */
			memset(szHostName, 0x00, sizeof(szHostName));
			inGetHostLabel(szHostName);
			inFunc_DiscardSpace(szHostName);
			
			/* ESC要跳過 */
			if (memcmp(szHostName, _HOST_NAME_ESC_, strlen(_HOST_NAME_ESC_)) == 0)
			{
				continue;
			}

			/* HG要跳過 */
			if (memcmp(szHostName, _HOST_NAME_HG_, strlen(_HOST_NAME_HG_)) == 0)
			{
				continue;
			}
			
			/* EW要跳過 */
			if (memcmp(szHostName, _HOST_NAME_EW_, strlen(_HOST_NAME_EW_)) == 0)
			{
				continue;
			}
			
			/* GET HOST Enable */
			/* 結帳沒開也不跑 */
			memset(szHostEnable, 0x00, sizeof(szHostEnable));
			if (inGetHostEnable(szHostEnable) == VS_ERROR)
			{	
				return (VS_ERROR);
			}
			else
			{
				if (ginDebug == VS_TRUE)
				{
					memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
					sprintf(szDebugMsg, "%d HostEnable: %s", i, szHostEnable);
					inLogPrintf(AT, szDebugMsg);
				}
			}

			/* 看結帳開關 */

			if (memcmp(szHostEnable, "Y", 1) != 0)
			{
				/* 如果HostEnable != Y，就continue */
				continue;
			}
			else
			{
				pobTran->srBRec.inHDTIndex = i;
			}
			
			/* 確認該Host單結是否沒有帳務 */
			szTrnas[0] = 0x00;
			inACCUM_Check_Transaction_Count(pobTran, szHostName, szTrnas);
			
			/* 如果主機有開，才loadHDPT */
			if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) == VS_SUCCESS)
			{
				memset(szBatchNum, 0x00, sizeof(szBatchNum));
				inGetBatchNum(szBatchNum);
				pobTran->srBRec.lnBatchNum = atol(szBatchNum);

				/* 在這裡決定跑那一個host的TRT */
				memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
				inGetTRTFileName(szTRTFileName);

				/* 2018/5/8 下午 2:10 DFS需求不再使用大來主機 */
				if (!memcmp(_TRT_FILE_NAME_CREDIT_, szTRTFileName, strlen(_TRT_FILE_NAME_CREDIT_)))
				{
					/* 客製化075、103使用 */
					memset(szNCCC_Settle_BatchNum, 0x00, sizeof(szNCCC_Settle_BatchNum));
					sprintf(szNCCC_Settle_BatchNum, szBatchNum);
					
					inRetVal = inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
				}
				else if (!memcmp(_TRT_FILE_NAME_DCC_, szTRTFileName, strlen(_TRT_FILE_NAME_DCC_)))
				{
					/* 客製化075、103使用 */
					memset(szDCC_Settle_BatchNum, 0x00, sizeof(szDCC_Settle_BatchNum));
					sprintf(szDCC_Settle_BatchNum, szBatchNum);
					
					inRetVal = inNCCC_DCC_RunTRT(pobTran, pobTran->inRunTRTID);
				}
				else if (!memcmp(_TRT_FILE_NAME_ESVC_, szTRTFileName, strlen(_TRT_FILE_NAME_ESVC_)))
				{
					inRetVal = inNCCC_Ticket_RunTRT(pobTran, pobTran->inRunTRTID);
				}
                                else if (!memcmp(_TRT_FILE_NAME_TRUST_, szTRTFileName, strlen(_TRT_FILE_NAME_TRUST_)))
                                {
                                        /* ii.	如遇連動結帳失敗不可影響信用卡交易 */
                                        inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
                                }

				if (inRetVal != VS_SUCCESS)
				{
					inFunc_Display_Error(pobTran);

					/* 列印XXXHost結帳失敗 */
					do
					{
						uszSettleFailBit = VS_TRUE;
						inRetVal = inCREDIT_PRINT_AutoSettle_Failed_ByBuffer();
					}while(inRetVal != VS_SUCCESS);

				}
				else
				{
					uszSettleSuccessBit = VS_TRUE;
					/* 昇恆昌客製化075，這裡結帳成功存重印的BatchNum */
					if  (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_075_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_)	||
					     !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_))
					{
						/* 只有NCCC和DCC要存 */
						memset(szHostName, 0x00, sizeof(szHostName));
						inGetHostLabel(szHostName);
						if (memcmp(szHostName, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)) == 0)
						{
							memset(&srALL, 0x00, sizeof(SQLITE_ALL_TABLE));
							memset(&srReprintTitle, 0x00, sizeof(DUTYFREE_REPRINT_TITLE));
							inBatch_Table_Link_Reprint_Title(&srReprintTitle, &srALL, _LS_READ_);
							inSqlite_Get_Table_ByRecordID_All(gszReprintDBPath, _TABLE_NAME_REPRINT_TITLE_, 0, &srALL);
							
							memset(srReprintTitle.szNCCCReprintBatchNum, 0x00, sizeof(srReprintTitle.szNCCCReprintBatchNum));
							sprintf(srReprintTitle.szNCCCReprintBatchNum, szNCCC_Settle_BatchNum);
							memset(srReprintTitle.szNCCCReprintTitleDateTime, 0x00, sizeof(srReprintTitle.szNCCCReprintTitleDateTime));
							memset(&srRTC, 0x00, sizeof(RTC_NEXSYS));
							inFunc_GetSystemDateAndTime(&srRTC);
							sprintf(srReprintTitle.szNCCCReprintTitleDateTime, "20%02d/%02d/%02d %02d:%02d", srRTC.uszYear, srRTC.uszMonth, srRTC.uszDay, srRTC.uszHour, srRTC.uszMinute);
							memset(srReprintTitle.szSettleReprintNCCCEnable, 0x00, sizeof(srReprintTitle.szSettleReprintNCCCEnable));
							sprintf(srReprintTitle.szSettleReprintNCCCEnable, "Y");
							if (uszCheckAccum_OK_Bit == VS_TRUE)
							{
								memset(srReprintTitle.szTMSUpdateSuccessNum, 0x00, sizeof(srReprintTitle.szTMSUpdateSuccessNum));
								sprintf(srReprintTitle.szTMSUpdateSuccessNum, "000");
								memset(srReprintTitle.szTMSUpdateFailNum, 0x00, sizeof(srReprintTitle.szTMSUpdateFailNum));
								sprintf(srReprintTitle.szTMSUpdateFailNum, "000");
							}
							
							memset(&srALL, 0x00, sizeof(SQLITE_ALL_TABLE));
							inBatch_Table_Link_Reprint_Title(&srReprintTitle, &srALL, _LS_UPDATE_);
							inSqlite_Insert_Or_Replace_ByRecordID_All(gszReprintDBPath, _TABLE_NAME_REPRINT_TITLE_, 0, &srALL);
							
							if (szTrnas[0] == 'N')
							{
								inSqlite_Drop_Table(gszReprintDBPath, _TABLE_NAME_REPRINT_NCCC_);
							}
						}
						else if	(memcmp(szHostName, _HOST_NAME_DCC_, strlen(_HOST_NAME_DCC_)) == 0)
						{
							memset(&srALL, 0x00, sizeof(SQLITE_ALL_TABLE));
							memset(&srReprintTitle, 0x00, sizeof(DUTYFREE_REPRINT_TITLE));
							inBatch_Table_Link_Reprint_Title(&srReprintTitle, &srALL, _LS_READ_);
							inSqlite_Get_Table_ByRecordID_All(gszReprintDBPath, _TABLE_NAME_REPRINT_TITLE_, 0, &srALL);
							
							memset(srReprintTitle.szDCCReprintBatchNum, 0x00, sizeof(srReprintTitle.szDCCReprintBatchNum));
							sprintf(srReprintTitle.szDCCReprintBatchNum, szDCC_Settle_BatchNum);
							memset(srReprintTitle.szDCCReprintTitleDateTime, 0x00, sizeof(srReprintTitle.szDCCReprintTitleDateTime));
							memset(&srRTC, 0x00, sizeof(RTC_NEXSYS));
							inFunc_GetSystemDateAndTime(&srRTC);
							sprintf(srReprintTitle.szDCCReprintTitleDateTime, "20%02d/%02d/%02d %02d:%02d", srRTC.uszYear, srRTC.uszMonth, srRTC.uszDay, srRTC.uszHour, srRTC.uszMinute);
							memset(srReprintTitle.szSettleReprintDCCEnable, 0x00, sizeof(srReprintTitle.szSettleReprintDCCEnable));
							sprintf(srReprintTitle.szSettleReprintDCCEnable, "Y");
							if (uszCheckAccum_OK_Bit == VS_TRUE)
							{
								memset(srReprintTitle.szTMSUpdateSuccessNum, 0x00, sizeof(srReprintTitle.szTMSUpdateSuccessNum));
								sprintf(srReprintTitle.szTMSUpdateSuccessNum, "000");
								memset(srReprintTitle.szTMSUpdateFailNum, 0x00, sizeof(srReprintTitle.szTMSUpdateFailNum));
								sprintf(srReprintTitle.szTMSUpdateFailNum, "000");
							}
							
							memset(&srALL, 0x00, sizeof(SQLITE_ALL_TABLE));
							inBatch_Table_Link_Reprint_Title(&srReprintTitle, &srALL, _LS_UPDATE_);
							inSqlite_Insert_Or_Replace_ByRecordID_All(gszReprintDBPath, _TABLE_NAME_REPRINT_TITLE_, 0, &srALL);
							
							if (szTrnas[0] == 'N')
							{
								inSqlite_Drop_Table(gszReprintDBPath, _TABLE_NAME_REPRINT_DCC_);
							}
						}
						else
						{
							break;
						}
					}
				}

			}

		}

		/* 只少要有一個Host成功 */
		if  ((!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_075_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_)	||
		      !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_))	&&
		      uszSettleSuccessBit == VS_TRUE)
		{
			/* 先印總表 */
			inCREDIT_PRINT_Dutyfree_DetailReport_Title_ByBuffer(pobTran, VS_FALSE);
			
			/* 按順序列印重印明細 */
			for (i = 0;; ++i)
			{
				/* 先LoadHDT */
				if (inLoadHDTRec(i) == VS_ERROR)
				{
					/* 當找不到第i筆資料會回傳VS_ERROR */
					break;
				}

				/* 只有NCCC和DCC要印 */
				memset(szHostName, 0x00, sizeof(szHostName));
				inGetHostLabel(szHostName);
				if (memcmp(szHostName, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)) == 0	||
				    memcmp(szHostName, _HOST_NAME_DCC_, strlen(_HOST_NAME_DCC_)) == 0)
				{
					
				}
				else
				{
					continue;
				}

				/* GET HOST Enable */
				/* 結帳沒開Host也不跑 */
				memset(szHostEnable, 0x00, sizeof(szHostEnable));
				if (inGetHostEnable(szHostEnable) == VS_ERROR)
				{	
					return (VS_ERROR);
				}
				else
				{
					if (ginDebug == VS_TRUE)
					{
						memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
						sprintf(szDebugMsg, "%d HostEnable: %s", i, szHostEnable);
						inLogPrintf(AT, szDebugMsg);
					}
				}

				/* 看Host開關 */
				if (memcmp(szHostEnable, "Y", 1) != 0)
				{
					/* 如果HostEnable != Y，就continue */
					continue;
				}
				else
				{
					pobTran->srBRec.inHDTIndex = i;
				}
				
				inLoadHDPTRec(pobTran->srBRec.inHDTIndex);
				
				/* 看是否結帳成功 */
				memset(szSettleEnable, 0x00, sizeof(szSettleEnable));
				inGetMustSettleBit(szSettleEnable);
				if (memcmp(szSettleEnable, "Y", 1) == 0)
				{
					continue;
				}

				if (memcmp(szHostName, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)) == 0)
				{
					inCREDIT_PRINT_Dutyfree_NCCC_DetailReport_ByBuffer(pobTran);
				}
				else if (memcmp(szHostName, _HOST_NAME_DCC_, strlen(_HOST_NAME_DCC_)) == 0)
				{
					inCREDIT_PRINT_Dutyfree_NCCC_DetailReport_ByBuffer(pobTran);
				}
			}
			
		}
		
		/* 印小白單 */
		inNCCCTMS_PRINT_ScheduleMessage_Flow(pobTran);
		
		/* 只少要有一個Host成功 */
		if  ((!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_075_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_)	||
		      !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_))	&&
		      uszSettleSuccessBit == VS_TRUE)
		{
			/* 要確認當前批次已無帳，才能重印(沒有結帳失敗) */
			if (uszSettleFailBit != VS_TRUE)
			{
				inNCCC_Func_Everrich_Reprint_Settle_Report(pobTran);
			}
		}
		
		/* 連動結帳跑完，把Bit Off，做TMS下載 */
		pobTran->uszAutoSettleBit = VS_FALSE;

		/* 如果結帳失敗，就不跑下載 */
		/* 分ISO和FTP，若是ISO，則有結帳失敗就不下，
		   FTP則是不論結帳是否成功，一律執行 */
		memset(szTemplate, 0x00, sizeof(szTemplate));
		inGetTMSDownloadMode(szTemplate);
		if (memcmp(szTemplate, _TMS_DLMODE_FTPS_, strlen(_TMS_DLMODE_FTPS_)) == 0)
		{
			inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_SCHEDULE_INQUIRE_);
			inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
			/* 提示人工安全認證畫面 */
			inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_DISPLAY_PLEASE_LOGON_FIRST_);
			inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
		}
		else
		{
			/* 結帳失敗，不下載 */
			if (uszSettleFailBit == VS_TRUE)
			{

			}
			else
			{
				/* ISO不用詢問 */
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
			}
		}
	}
	/* 單結 */
	else
	{
		if (pobTran->inRunTRTID == 0)
		{
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "TRT ERROR");
			}
			inRetVal = VS_ERROR;
		}
		else
		{
			/* 確認該Host單結是否沒有帳務 */
			memset(szHostName, 0x00, sizeof(szHostName));
			inGetHostLabel(szHostName);
			inFunc_DiscardSpace(szHostName);
			szTrnas[0] = 0x00;
			inACCUM_Check_Transaction_Count(pobTran, szHostName, szTrnas);
			
			/* 預防萬一再LoadHDPT一次 */
			if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) != VS_SUCCESS)
			{
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "HDPT ERROR");
				}
				return (VS_ERROR);
			}
			
			memset(szBatchNum, 0x00, sizeof(szBatchNum));
			inGetBatchNum(szBatchNum);

			/* 在這裡決定跑那一個host的TRT */
			inGetTRTFileName(szTRTFileName);

			/* ResetTitle */
			inFunc_ResetTitle(pobTran);

			/* 2018/5/8 下午 2:10 DFS需求不再使用大來主機 */
			if (!memcmp(_TRT_FILE_NAME_HG_, szTRTFileName, strlen(_TRT_FILE_NAME_HG_)))
			{
				inRetVal = inHG_RunTRT(pobTran, pobTran->inRunTRTID);
			}
			else if (!memcmp(_TRT_FILE_NAME_CREDIT_, szTRTFileName, strlen(_TRT_FILE_NAME_CREDIT_)))
			{
				/* 客製化075、103使用 */
				memset(szNCCC_Settle_BatchNum, 0x00, sizeof(szNCCC_Settle_BatchNum));
				sprintf(szNCCC_Settle_BatchNum, szBatchNum);
					
				inRetVal = inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
				if (inRetVal == VS_SUCCESS)
				{
					pobTran->uszNCCC_Settle_SuccessBit = VS_TRUE;
				}
			}
			else if (!memcmp(_TRT_FILE_NAME_DCC_, szTRTFileName, strlen(_TRT_FILE_NAME_DCC_)))
			{
				/* 客製化075、103使用 */
				memset(szDCC_Settle_BatchNum, 0x00, sizeof(szDCC_Settle_BatchNum));
				sprintf(szDCC_Settle_BatchNum, szBatchNum);
					
				inRetVal = inNCCC_DCC_RunTRT(pobTran, pobTran->inRunTRTID);
			}
			else if (!memcmp(_TRT_FILE_NAME_ESVC_, szTRTFileName, strlen(_TRT_FILE_NAME_ESVC_)))
			{
				inRetVal = inNCCC_Ticket_RunTRT(pobTran, pobTran->inRunTRTID);
				if (inRetVal == VS_SUCCESS)
				{
					pobTran->uszESVC_Settle_SuccessBit = VS_TRUE;
				}
			}
                        else if (!memcmp(_TRT_FILE_NAME_TRUST_, szTRTFileName, strlen(_TRT_FILE_NAME_TRUST_)))
                        {
                                inRetVal = inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
                        }
		}

		if (inRetVal != VS_SUCCESS)
		{
			uszSettleFailBit = VS_TRUE;
			/* 要先回傳再顯示錯誤訊息 */
			inFunc_Display_Error(pobTran);
                        
                        /* 列印XXXHost結帳失敗 */
                        while (inRetVal != VS_SUCCESS)
                        {
                                inRetVal = inCREDIT_PRINT_AutoSettle_Failed_ByBuffer();
                        }
		}
		else
		{
			uszSettleSuccessBit = VS_TRUE;
			/* 昇恆昌客製化075，這裡存重印的BatchNum */
			if  (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_075_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_)	||
			     !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_))
			{
				/* 只有NCCC和DCC要存 */
				memset(szHostName, 0x00, sizeof(szHostName));
				inGetHostLabel(szHostName);
				if (memcmp(szHostName, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)) == 0)
				{
					memset(&srALL, 0x00, sizeof(SQLITE_ALL_TABLE));
					memset(&srReprintTitle, 0x00, sizeof(DUTYFREE_REPRINT_TITLE));
					inBatch_Table_Link_Reprint_Title(&srReprintTitle, &srALL, _LS_READ_);
					inSqlite_Get_Table_ByRecordID_All(gszReprintDBPath, _TABLE_NAME_REPRINT_TITLE_, 0, &srALL);
					
					memset(srReprintTitle.szNCCCReprintBatchNum, 0x00, sizeof(srReprintTitle.szNCCCReprintBatchNum));
					sprintf(srReprintTitle.szNCCCReprintBatchNum, szNCCC_Settle_BatchNum);
					memset(srReprintTitle.szNCCCReprintTitleDateTime, 0x00, sizeof(srReprintTitle.szNCCCReprintTitleDateTime));
					memset(&srRTC, 0x00, sizeof(RTC_NEXSYS));
					inFunc_GetSystemDateAndTime(&srRTC);
					sprintf(srReprintTitle.szNCCCReprintTitleDateTime, "20%02d/%02d/%02d %02d:%02d", srRTC.uszYear, srRTC.uszMonth, srRTC.uszDay, srRTC.uszHour, srRTC.uszMinute);
					memset(srReprintTitle.szSettleReprintNCCCEnable, 0x00, sizeof(srReprintTitle.szSettleReprintNCCCEnable));
					sprintf(srReprintTitle.szSettleReprintNCCCEnable, "Y");
					if (uszCheckAccum_OK_Bit == VS_TRUE)
					{
						memset(srReprintTitle.szTMSUpdateSuccessNum, 0x00, sizeof(srReprintTitle.szTMSUpdateSuccessNum));
						sprintf(srReprintTitle.szTMSUpdateSuccessNum, "000");
						memset(srReprintTitle.szTMSUpdateFailNum, 0x00, sizeof(srReprintTitle.szTMSUpdateFailNum));
						sprintf(srReprintTitle.szTMSUpdateFailNum, "000");
					}
					
					memset(&srALL, 0x00, sizeof(SQLITE_ALL_TABLE));
					inBatch_Table_Link_Reprint_Title(&srReprintTitle, &srALL, _LS_UPDATE_);
					inSqlite_Insert_Or_Replace_ByRecordID_All(gszReprintDBPath, _TABLE_NAME_REPRINT_TITLE_, 0, &srALL);
					
					if (szTrnas[0] == 'N')
					{
						inSqlite_Drop_Table(gszReprintDBPath, _TABLE_NAME_REPRINT_NCCC_);
					}
				}
				else if	(memcmp(szHostName, _HOST_NAME_DCC_, strlen(_HOST_NAME_DCC_)) == 0)
				{
					memset(&srALL, 0x00, sizeof(SQLITE_ALL_TABLE));
					memset(&srReprintTitle, 0x00, sizeof(DUTYFREE_REPRINT_TITLE));
					inBatch_Table_Link_Reprint_Title(&srReprintTitle, &srALL, _LS_READ_);
					inSqlite_Get_Table_ByRecordID_All(gszReprintDBPath, _TABLE_NAME_REPRINT_TITLE_, 0, &srALL);
					
					memset(srReprintTitle.szDCCReprintBatchNum, 0x00, sizeof(srReprintTitle.szDCCReprintBatchNum));
					sprintf(srReprintTitle.szDCCReprintBatchNum, szDCC_Settle_BatchNum);
					memset(srReprintTitle.szDCCReprintTitleDateTime, 0x00, sizeof(srReprintTitle.szDCCReprintTitleDateTime));
					memset(&srRTC, 0x00, sizeof(RTC_NEXSYS));
					inFunc_GetSystemDateAndTime(&srRTC);
					sprintf(srReprintTitle.szDCCReprintTitleDateTime, "20%02d/%02d/%02d %02d:%02d", srRTC.uszYear, srRTC.uszMonth, srRTC.uszDay, srRTC.uszHour, srRTC.uszMinute);
					memset(srReprintTitle.szSettleReprintDCCEnable, 0x00, sizeof(srReprintTitle.szSettleReprintDCCEnable));
					sprintf(srReprintTitle.szSettleReprintDCCEnable, "Y");
					if (uszCheckAccum_OK_Bit == VS_TRUE)
					{
						memset(srReprintTitle.szTMSUpdateSuccessNum, 0x00, sizeof(srReprintTitle.szTMSUpdateSuccessNum));
						sprintf(srReprintTitle.szTMSUpdateSuccessNum, "000");
						memset(srReprintTitle.szTMSUpdateFailNum, 0x00, sizeof(srReprintTitle.szTMSUpdateFailNum));
						sprintf(srReprintTitle.szTMSUpdateFailNum, "000");
					}
					
					memset(&srALL, 0x00, sizeof(SQLITE_ALL_TABLE));
					inBatch_Table_Link_Reprint_Title(&srReprintTitle, &srALL, _LS_UPDATE_);
					inSqlite_Insert_Or_Replace_ByRecordID_All(gszReprintDBPath, _TABLE_NAME_REPRINT_TITLE_, 0, &srALL);
					
					if (szTrnas[0] == 'N')
					{
						inSqlite_Drop_Table(gszReprintDBPath, _TABLE_NAME_REPRINT_DCC_);
					}
				}
				else
				{
					
				}
			}
		}

		/* (需求單-109327)-vx520客製化需求(昇恆昌客製化) by Russell 2022/5/16 下午 4:13
		 *  重印總表和重印明細，若結帳失敗不印 */
		if  ((!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_075_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_)	||
		     !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_))	&&
		     uszSettleSuccessBit == VS_TRUE)
		{
			/* 先印總表 */
			inCREDIT_PRINT_Dutyfree_DetailReport_Title_ByBuffer(pobTran, VS_FALSE);

			do
			{
				/* 只有NCCC和DCC要印 */
				memset(szHostName, 0x00, sizeof(szHostName));
				inGetHostLabel(szHostName);
				if (memcmp(szHostName, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)) == 0	||
				    memcmp(szHostName, _HOST_NAME_DCC_, strlen(_HOST_NAME_DCC_)) == 0)
				{

				}
				else
				{
					break;
				}

				if (memcmp(szHostName, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)) == 0)
				{
					inCREDIT_PRINT_Dutyfree_NCCC_DetailReport_ByBuffer(pobTran);
				}
				else if (memcmp(szHostName, _HOST_NAME_DCC_, strlen(_HOST_NAME_DCC_)) == 0)
				{
					inCREDIT_PRINT_Dutyfree_NCCC_DetailReport_ByBuffer(pobTran);
				}
				break;
			}while(1);
		}
		
		/* 印小白單 */
		inNCCCTMS_PRINT_ScheduleMessage_Flow(pobTran);
			
		/* 只少要有一個Host成功 */
		if  ((!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_075_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_)	||
		      !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_))	&&
		      uszSettleSuccessBit == VS_TRUE)
		{
			/* 檢查是否為NCCC或DCC Host */
			/* 是否已全結帳 */
			if (inFunc_All_Host_Settle_Check(pobTran, VS_FALSE) == VS_SUCCESS)
			{
				uszCheckAccum_OK_Bit = VS_TRUE;
			}
			/* 還原Index */
			pobTran->srBRec.inHDTIndex = inOrgHDTIndex;
			inLoadHDTRec(pobTran->srBRec.inHDTIndex);
			inLoadHDPTRec(pobTran->srBRec.inHDTIndex);
			/* 沒有任何一個有帳，才可以進行這個流程 */
			if (uszCheckAccum_OK_Bit != VS_FALSE)
			{
				/* 只有NCCC和DCC才可以出現這個流程 */
				memset(szHostName, 0x00, sizeof(szHostName));
				inGetHostLabel(szHostName);
				if (memcmp(szHostName, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)) == 0	||
				    memcmp(szHostName, _HOST_NAME_DCC_, strlen(_HOST_NAME_DCC_)) == 0)
				{
					inNCCC_Func_Everrich_Reprint_Settle_Report(pobTran);
				}
			}
		}
	
		
		/* ECR結帳回傳 */
		if (pobTran->uszECRBit == VS_TRUE)
		{
			if (uszSettleFailBit == VS_TRUE)
			{
				pobTran->inECRErrorMsg = _ECR_RESPONSE_CODE_SELF_TRANS_SETTLE_ERROR_;
				inECR_SendError(pobTran, pobTran->inECRErrorMsg);
			}
			else
			{
				inFLOW_RunFunction(pobTran, _FUNCTION_ECR_SEND_TRANSACTION_RESULT_);
			}
		}
		
		if (pobTran->inRunTRTID == _TRT_SETTLE_ ||
		    pobTran->inRunTRTID == _TRT_TICKET_ECC_SETTLE_)
		{
			/* 如果結帳失敗，就不跑下載 */
			/* 分ISO和FTP，若是ISO，則有結帳失敗就不下，
			   FTP則是不論結帳是否成功，一律執行 */
			memset(szTemplate, 0x00, sizeof(szTemplate));
			inGetTMSDownloadMode(szTemplate);
			if (memcmp(szTemplate, _TMS_DLMODE_FTPS_, strlen(_TMS_DLMODE_FTPS_)) == 0)
			{
				if (inFunc_All_Host_Settle_Check(pobTran, VS_FALSE) == VS_SUCCESS)
				{
					inFLOW_RunFunction(pobTran, _FUNCTION_TMS_SCHEDULE_INQUIRE_);
					inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
					/* 提示人工安全認證畫面 */
					inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_DISPLAY_PLEASE_LOGON_FIRST_);
					inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
				}
			}
			else
			{
				/* ISO維持原流程 */
				if (!memcmp(_TRT_FILE_NAME_CREDIT_, szTRTFileName, strlen(_TRT_FILE_NAME_CREDIT_)))
				{
					/* 結帳失敗，不下載 */
					if (uszSettleFailBit == VS_TRUE)
					{

					}
					else
					{
						/* ISO不用詢問 */
						inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
						inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
					}
				}
			}
		}
	}/* 連動或單個Host */
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Dutyfree_Settlement_Flow() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Dutyfree_Reprint
Date&Time       :2022/5/23 下午 6:15
Describe        :昇恆昌075重印
*/
int inNCCC_Func_Dutyfree_Reprint(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = VS_SUCCESS;
	int	i = 0;
	char	szHostName[8 + 1] = {0};
	char	szHostEnable[1 + 1] = {0};
	char	szSettleEnable[1 + 1] = {0};
	char	szFileNameNCCC[20 + 1] = {0};
	char	szFileNameDCC[20 + 1] = {0};
	char	szFileNameESVC[20 + 1] = {0};
	unsigned char	uszBuffer1[PB_CANVAS_X_SIZE * 8 * _BUFFER_MAX_LINE_];
	unsigned char	uszFileName[30 + 1] = {0};
	DUTYFREE_REPRINT_TITLE	srReprintTitle;
	SQLITE_ALL_TABLE	srALL;
	BufferHandle		srBhandle1;
	
	memset(&srReprintTitle, 0x00, sizeof(DUTYFREE_REPRINT_TITLE));
	memset(&srALL, 0x00, sizeof(SQLITE_ALL_TABLE));
	inBatch_Table_Link_Reprint_Title(&srReprintTitle, &srALL, _LS_READ_);
	inSqlite_Get_Table_ByRecordID_All(gszReprintDBPath, _TABLE_NAME_REPRINT_TITLE_, 0, &srALL);
	
	/*檢查主機未結帳 */
	for (i = 0;; ++i)
	{
		/* 先LoadHDT */
		if (inLoadHDTRec(i) == VS_ERROR)
		{
			/* 當找不到第i筆資料會回傳VS_ERROR */
			break;
		}

		/* ESC要跳過 */
		/* HG要跳過 */
		memset(szHostName, 0x00, sizeof(szHostName));
		inGetHostLabel(szHostName);
		inFunc_DiscardSpace(szHostName);
		if (memcmp(szHostName, _HOST_NAME_ESC_, strlen(_HOST_NAME_ESC_)) == 0	||
		    memcmp(szHostName, _HOST_NAME_HG_, strlen(_HOST_NAME_HG_)) == 0)
		{
			continue;
		}

		/* GET HOST Enable */
		/* 結帳沒開也不跑 */
		memset(szHostEnable, 0x00, sizeof(szHostEnable));
		inGetHostEnable(szHostEnable);

		/* 看結帳開關 */
		if (memcmp(szHostEnable, "Y", 1) != 0)
		{
			/* 如果HostEnable != Y，就continue */
			continue;
		}
		else
		{
			pobTran->srBRec.inHDTIndex = i;
		}
		inLoadHDPTRec(pobTran->srBRec.inHDTIndex);

		/* 看是否結帳成功 */
		memset(szSettleEnable, 0x00, sizeof(szSettleEnable));
		inGetMustSettleBit(szSettleEnable);
		if (memcmp(szSettleEnable, "Y", 1) == 0)
		{
			/* 表示要結帳 */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, _ERR_MUST_SETTLE_);
			srDispMsgObj.inDispPic1YPosition = _COORDINATE_Y_LINE_8_6_;
			srDispMsgObj.inMsgType = _CLEAR_KEY_MSG_;
			srDispMsgObj.inTimeout = _EDC_TIMEOUT_;
			strcpy(srDispMsgObj.szErrMsg1, szHostName);
			srDispMsgObj.inErrMsg1Line = _LINE_8_5_;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inDISP_Msg_BMP(&srDispMsgObj);

			return (VS_ERROR);
		}
	}
	
	/*檢查是否有做過結帳(是否有交易) */
	for (i = 0;; ++i)
	{
		/* 先LoadHDT */
		if (inLoadHDTRec(i) == VS_ERROR)
		{
			/* 當找不到第i筆資料會回傳VS_ERROR */
			break;
		}

		/* ESC要跳過 */
		/* HG要跳過 */
		/* 電票跳過，不檢核 */
		memset(szHostName, 0x00, sizeof(szHostName));
		inGetHostLabel(szHostName);
		if (memcmp(szHostName, _HOST_NAME_ESC_, strlen(_HOST_NAME_ESC_)) == 0	||
		    memcmp(szHostName, _HOST_NAME_HG_, strlen(_HOST_NAME_HG_)) == 0	||
		    memcmp(szHostName, _HOST_NAME_ESVC_, strlen(_HOST_NAME_ESVC_)) == 0)
		{
			continue;
		}

		/* GET HOST Enable */
		/* 結帳沒開也不跑 */
		memset(szHostEnable, 0x00, sizeof(szHostEnable));
		inGetHostEnable(szHostEnable);

		/* 看結帳開關 */
		if (memcmp(szHostEnable, "Y", 1) != 0)
		{
			/* 如果HostEnable != Y，就continue */
			continue;
		}
		else
		{
			pobTran->srBRec.inHDTIndex = i;
		}
		inLoadHDPTRec(pobTran->srBRec.inHDTIndex);
		
		if (!memcmp(szHostName, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)))
		{
			/* 檢查是否可重印 */
			if (memcmp(srReprintTitle.szSettleReprintNCCCEnable, "Y", 1) != 0)
			{
				inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
				/* 顯示無交易紀錄 */
				DISPLAY_OBJECT	srDispMsgObj;
				memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
				strcpy(srDispMsgObj.szDispPic1Name, "");
				srDispMsgObj.inDispPic1YPosition = 0;
				srDispMsgObj.inMsgType = _NO_KEY_MSG_;
				srDispMsgObj.inTimeout = 2;
				strcpy(srDispMsgObj.szErrMsg1, "無原交易紀錄");
				srDispMsgObj.inErrMsg1Line = _LINE_8_6_;
				srDispMsgObj.inBeepTimes = 1;
				srDispMsgObj.inBeepInterval = 0;
				inDISP_Msg_BMP(&srDispMsgObj);

				return (inRetVal);
			}
		}
		else if (!memcmp(szHostName, _HOST_NAME_DCC_, strlen(_HOST_NAME_DCC_)))
		{
			/* 檢查是否可重印 */
			if (memcmp(srReprintTitle.szSettleReprintDCCEnable, "Y", 1) != 0)
			{
				inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
				/* 顯示無交易紀錄 */
				DISPLAY_OBJECT	srDispMsgObj;
				memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
				strcpy(srDispMsgObj.szDispPic1Name, "");
				srDispMsgObj.inDispPic1YPosition = 0;
				srDispMsgObj.inMsgType = _NO_KEY_MSG_;
				srDispMsgObj.inTimeout = 2;
				strcpy(srDispMsgObj.szErrMsg1, "無原交易紀錄");
				srDispMsgObj.inErrMsg1Line = _LINE_8_6_;
				srDispMsgObj.inBeepTimes = 1;
				srDispMsgObj.inBeepInterval = 0;
				inDISP_Msg_BMP(&srDispMsgObj);

				return (inRetVal);
			}
		}
	}

	/* 先重印結帳報表 */
	for (i = 0;; ++i)
	{
		/* 先LoadHDT */
		if (inLoadHDTRec(i) == VS_ERROR)
		{
			/* 當找不到第i筆資料會回傳VS_ERROR */
			break;
		}

		/* ESC要跳過 */
		/* HG要跳過 */
		memset(szHostName, 0x00, sizeof(szHostName));
		inGetHostLabel(szHostName);
		if (memcmp(szHostName, _HOST_NAME_ESC_, strlen(_HOST_NAME_ESC_)) == 0	||
		    memcmp(szHostName, _HOST_NAME_HG_, strlen(_HOST_NAME_HG_)) == 0)
		{
			continue;
		}

		/* GET HOST Enable */
		/* 結帳沒開也不跑 */
		memset(szHostEnable, 0x00, sizeof(szHostEnable));
		inGetHostEnable(szHostEnable);

		/* 看結帳開關 */
		if (memcmp(szHostEnable, "Y", 1) != 0)
		{
			/* 如果HostEnable != Y，就continue */
			continue;
		}
		else
		{
			pobTran->srBRec.inHDTIndex = i;
		}
		inLoadHDPTRec(pobTran->srBRec.inHDTIndex);

		/* 看是否結帳成功 */
		memset(szSettleEnable, 0x00, sizeof(szSettleEnable));
		inGetMustSettleBit(szSettleEnable);
		if (memcmp(szSettleEnable, "Y", 1) == 0)
		{
			continue;
		}

		memset(uszFileName, 0x00, sizeof(uszFileName));
		inFunc_ComposeFileName(pobTran, (char*)uszFileName, _DUTY_FREE_REPRINT_TOTAL_REPORT_FILE_EXTENSION_, 0);
		if (inFILE_Check_Exist(uszFileName) == VS_SUCCESS)
		{
			inCREDIT_PRINT_Dutyfree_Reprint_Cavas_File_ByBuffer(uszFileName);
		}
		else
		{
			memset(szFileNameNCCC, 0x00, sizeof(szFileNameNCCC));
			sprintf(szFileNameNCCC, "%s%s", _HOST_NAME_CREDIT_NCCC_, _DUTY_FREE_REPRINT_TOTAL_REPORT_FILE_EXTENSION_);
			memset(szFileNameDCC, 0x00, sizeof(szFileNameDCC));
			sprintf(szFileNameDCC, "%s%s", _HOST_NAME_DCC_, _DUTY_FREE_REPRINT_TOTAL_REPORT_FILE_EXTENSION_);
			memset(szFileNameESVC, 0x00, sizeof(szFileNameESVC));
			sprintf(szFileNameESVC, "%s%s", _HOST_NAME_ESVC_, _DUTY_FREE_REPRINT_TOTAL_REPORT_FILE_EXTENSION_);
			
			if (!memcmp(uszFileName, szFileNameNCCC, strlen(szFileNameNCCC)))
			{
				memset(uszBuffer1, 0x00, sizeof(uszBuffer1));
				memset(&srBhandle1, 0x00, sizeof(BufferHandle));
				pobTran->uszEverRich_Settle_RepeintBit = VS_TRUE;
				pobTran->uszEverRich_NoDataBit = VS_TRUE;
				inCREDIT_PRINT_Dutyfree_Reprint_Report_NCCC_First(pobTran, uszBuffer1, &srBhandle1.inYcurrent);
				pobTran->uszEverRich_Settle_RepeintBit = VS_FALSE;
				pobTran->uszEverRich_NoDataBit = VS_FALSE;
				inPRINT_Buffer_OutPut(uszBuffer1, &srBhandle1);
			}
			else if (!memcmp(uszFileName, szFileNameDCC, strlen(szFileNameDCC)))
			{
				memset(uszBuffer1, 0x00, sizeof(uszBuffer1));
				memset(&srBhandle1, 0x00, sizeof(BufferHandle));
				pobTran->uszEverRich_Settle_RepeintBit = VS_TRUE;
				pobTran->uszEverRich_NoDataBit = VS_TRUE;
				inCREDIT_PRINT_Dutyfree_Reprint_Report_DCC_First(pobTran, uszBuffer1, &srBhandle1.inYcurrent);
				pobTran->uszEverRich_Settle_RepeintBit = VS_FALSE;
				pobTran->uszEverRich_NoDataBit = VS_FALSE;
				inPRINT_Buffer_OutPut(uszBuffer1, &srBhandle1);
			}
			else if (!memcmp(uszFileName, szFileNameESVC, strlen(szFileNameESVC)))
			{
				memset(uszBuffer1, 0x00, sizeof(uszBuffer1));
				memset(&srBhandle1, 0x00, sizeof(BufferHandle));
				pobTran->uszEverRich_Settle_RepeintBit = VS_TRUE;
				pobTran->uszEverRich_NoDataBit = VS_TRUE;
				inCREDIT_PRINT_Dutyfree_Reprint_Report_ESVC_First(pobTran, uszBuffer1, &srBhandle1.inYcurrent);
				pobTran->uszEverRich_Settle_RepeintBit = VS_FALSE;
				pobTran->uszEverRich_NoDataBit = VS_FALSE;
				inPRINT_Buffer_OutPut(uszBuffer1, &srBhandle1);
			}
		}
	}
	
	/* 先印總表 */
	inCREDIT_PRINT_Dutyfree_DetailReport_Title_ByBuffer(pobTran, VS_TRUE);

	/* 按順序列印重印明細 */
	/* 結帳報表 */
	for (i = 0;; ++i)
	{
		/* 先LoadHDT */
		if (inLoadHDTRec(i) == VS_ERROR)
		{
			/* 當找不到第i筆資料會回傳VS_ERROR */
			break;
		}

		/* 只有NCCC和DCC要印 */
		memset(szHostName, 0x00, sizeof(szHostName));
		inGetHostLabel(szHostName);
		if (memcmp(szHostName, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)) == 0	||
		    memcmp(szHostName, _HOST_NAME_DCC_, strlen(_HOST_NAME_DCC_)) == 0)
		{

		}
		else
		{
			continue;
		}

		/* GET HOST Enable */
		/* 結帳沒開Host也不跑 */
		memset(szHostEnable, 0x00, sizeof(szHostEnable));
		if (inGetHostEnable(szHostEnable) == VS_ERROR)
		{	
			return (VS_ERROR);
		}

		/* 看Host開關 */
		if (memcmp(szHostEnable, "Y", 1) != 0)
		{
			/* 如果HostEnable != Y，就continue */
			continue;
		}
		else
		{
			pobTran->srBRec.inHDTIndex = i;
		}

		inLoadHDPTRec(pobTran->srBRec.inHDTIndex);

		if (memcmp(szHostName, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)) == 0)
		{
			inCREDIT_PRINT_Dutyfree_NCCC_DetailReport_ByBuffer(pobTran);
		}
		else if (memcmp(szHostName, _HOST_NAME_DCC_, strlen(_HOST_NAME_DCC_)) == 0)
		{
			inCREDIT_PRINT_Dutyfree_NCCC_DetailReport_ByBuffer(pobTran);
		}
	}
	
	/* 如果有TMS通知，要印 */
	memset(uszFileName, 0x00, sizeof(uszFileName));
	sprintf((char*)uszFileName, "%s%s", _DUTY_FREE_REPRINT_TMS_NOTIFY_FILE_NAME_, _DUTY_FREE_REPRINT_TOTAL_REPORT_FILE_EXTENSION_);
	inCREDIT_PRINT_Dutyfree_Reprint_Cavas_File_ByBuffer(uszFileName);
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Everrich_Reprint_Settle_Report
Date&Time       :2022/6/13 下午 6:10
Describe        :
*/
int inNCCC_Func_Everrich_Reprint_Settle_Report(TRANSACTION_OBJECT* pobTran)
{
	int	i = 0;
	int	inRetVal = VS_SUCCESS;
	int	inOrgHDTIndex = -1;
	char	szKey = 0x00;
	char	szHostName[8 + 1] = {0};
	char	szSettleEnable[1 + 1] = {0};
	char	szHostEnable[1 + 1] = {0};
	char	szDebugMsg[100 + 1] = {0};
	char	szFileNameNCCC[20 + 1] = {0};
	char	szFileNameDCC[20 + 1] = {0};
	char	szFileNameESVC[20 + 1] = {0};
	unsigned char	uszBuffer1[PB_CANVAS_X_SIZE * 8 * _BUFFER_MAX_LINE_];
	unsigned char	uszFileName[30 + 1] = {0};
	BufferHandle		srBhandle1;
	
	inOrgHDTIndex = pobTran->srBRec.inHDTIndex;
	
	/* 要確認當前批次已無帳，才能重印(沒有結帳失敗) */
	/* 是否須重印結帳單 */
	/* 是按0,否按清除 */
	inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
	inDISP_ChineseFont("是否須重印結帳單", _FONTSIZE_8X16_, _LINE_8_5_, _PRINT_CENTER_);
	inDISP_ChineseFont("是按0，否按清除", _FONTSIZE_8X16_, _LINE_8_6_, _PRINT_CENTER_);

	/* 清鍵盤Buffer */
	inFlushKBDBuffer();
	inDISP_Timer_Start(_TIMER_NEXSYS_1_, 30);
	while (1)
	{
		szKey = uszKBD_Key();

		if (inTimerGet(_TIMER_NEXSYS_2_) == VS_SUCCESS)
		{
			inDISP_BEEP(1, 0);
			inTimerStart(_TIMER_NEXSYS_2_, 1);
		}

		/* Timeout */
		if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
		{
			szKey = _KEY_TIMEOUT_;
		}

		/* 是按0 */
		if (szKey == _KEY_0_)
		{
			inRetVal = VS_SUCCESS;
			break;
		}
		else if (szKey == _KEY_CANCEL_)
		{
			inRetVal = VS_USER_CANCEL;
			break;
		}
		else if (szKey == _KEY_TIMEOUT_)
		{
			inRetVal = VS_TIMEOUT;
			break;
		}
	}

	if (inRetVal == VS_SUCCESS)
	{
		/* 先重印結帳報表 */
		for (i = 0;; ++i)
		{
			/* 先LoadHDT */
			if (inLoadHDTRec(i) == VS_ERROR)
			{
				/* 當找不到第i筆資料會回傳VS_ERROR */
				break;
			}

			/* ESC要跳過 */
			/* HG要跳過 */
			memset(szHostName, 0x00, sizeof(szHostName));
			inGetHostLabel(szHostName);
			if (memcmp(szHostName, _HOST_NAME_ESC_, strlen(_HOST_NAME_ESC_)) == 0	||
			    memcmp(szHostName, _HOST_NAME_HG_, strlen(_HOST_NAME_HG_)) == 0)
			{
				continue;
			}

			/* GET HOST Enable */
			/* 結帳沒開也不跑 */
			memset(szHostEnable, 0x00, sizeof(szHostEnable));
			inGetHostEnable(szHostEnable);

			/* 看結帳開關 */
			if (memcmp(szHostEnable, "Y", 1) != 0)
			{
				/* 如果HostEnable != Y，就continue */
				continue;
			}
			else
			{
				pobTran->srBRec.inHDTIndex = i;
			}
			inLoadHDPTRec(pobTran->srBRec.inHDTIndex);

			/* 看是否結帳成功 */
			memset(szSettleEnable, 0x00, sizeof(szSettleEnable));
			inGetMustSettleBit(szSettleEnable);
			if (memcmp(szSettleEnable, "Y", 1) == 0)
			{
				continue;
			}

			memset(uszFileName, 0x00, sizeof(uszFileName));
			inFunc_ComposeFileName(pobTran, (char*)uszFileName, _DUTY_FREE_REPRINT_TOTAL_REPORT_FILE_EXTENSION_, 0);
			if (inFILE_Check_Exist(uszFileName) == VS_SUCCESS)
			{
				inCREDIT_PRINT_Dutyfree_Reprint_Cavas_File_ByBuffer(uszFileName);
			}
			else
			{
				memset(szFileNameNCCC, 0x00, sizeof(szFileNameNCCC));
				sprintf(szFileNameNCCC, "%s%s", _FILE_NAME_CREDIT_NCCC_, _DUTY_FREE_REPRINT_TOTAL_REPORT_FILE_EXTENSION_);
				memset(szFileNameDCC, 0x00, sizeof(szFileNameDCC));
				sprintf(szFileNameDCC, "%s%s", _FILE_NAME_DCC_, _DUTY_FREE_REPRINT_TOTAL_REPORT_FILE_EXTENSION_);
				memset(szFileNameESVC, 0x00, sizeof(szFileNameESVC));
				sprintf(szFileNameESVC, "%s%s", _FILE_NAME_ESVC_, _DUTY_FREE_REPRINT_TOTAL_REPORT_FILE_EXTENSION_);

				if (!memcmp(uszFileName, szFileNameNCCC, strlen(szFileNameNCCC)))
				{
					memset(uszBuffer1, 0x00, sizeof(uszBuffer1));
					memset(&srBhandle1, 0x00, sizeof(BufferHandle));
					pobTran->uszEverRich_Settle_RepeintBit = VS_TRUE;
					pobTran->uszEverRich_NoDataBit = VS_TRUE;
					inCREDIT_PRINT_Dutyfree_Reprint_Report_NCCC_First(pobTran, uszBuffer1, &srBhandle1.inYcurrent);
					pobTran->uszEverRich_Settle_RepeintBit = VS_FALSE;
					pobTran->uszEverRich_NoDataBit = VS_FALSE;
					inPRINT_Buffer_OutPut(uszBuffer1, &srBhandle1);
				}
				else if (!memcmp(uszFileName, szFileNameDCC, strlen(szFileNameDCC)))
				{
					memset(uszBuffer1, 0x00, sizeof(uszBuffer1));
					memset(&srBhandle1, 0x00, sizeof(BufferHandle));
					pobTran->uszEverRich_Settle_RepeintBit = VS_TRUE;
					pobTran->uszEverRich_NoDataBit = VS_TRUE;
					inCREDIT_PRINT_Dutyfree_Reprint_Report_DCC_First(pobTran, uszBuffer1, &srBhandle1.inYcurrent);
					pobTran->uszEverRich_Settle_RepeintBit = VS_FALSE;
					pobTran->uszEverRich_NoDataBit = VS_FALSE;
					inPRINT_Buffer_OutPut(uszBuffer1, &srBhandle1);
				}
				else if (!memcmp(uszFileName, szFileNameESVC, strlen(szFileNameESVC)))
				{
					memset(uszBuffer1, 0x00, sizeof(uszBuffer1));
					memset(&srBhandle1, 0x00, sizeof(BufferHandle));
					pobTran->uszEverRich_Settle_RepeintBit = VS_TRUE;
					pobTran->uszEverRich_NoDataBit = VS_TRUE;
					inCREDIT_PRINT_Dutyfree_Reprint_Report_ESVC_First(pobTran, uszBuffer1, &srBhandle1.inYcurrent);
					pobTran->uszEverRich_Settle_RepeintBit = VS_FALSE;
					pobTran->uszEverRich_NoDataBit = VS_FALSE;
					inPRINT_Buffer_OutPut(uszBuffer1, &srBhandle1);
				}
			}
		}
		if (inOrgHDTIndex >= 0)
		{
			pobTran->srBRec.inHDTIndex = inOrgHDTIndex;
			inLoadHDTRec(pobTran->srBRec.inHDTIndex);
			inLoadHDPTRec(pobTran->srBRec.inHDTIndex);
		}

		/* 先印總表 */
		inCREDIT_PRINT_Dutyfree_DetailReport_Title_ByBuffer(pobTran, VS_TRUE);

		/* 按順序列印重印明細 */
		for (i = 0;; ++i)
		{
			/* 先LoadHDT */
			if (inLoadHDTRec(i) == VS_ERROR)
			{
				/* 當找不到第i筆資料會回傳VS_ERROR */
				break;
			}

			/* 只有NCCC和DCC要印 */
			memset(szHostName, 0x00, sizeof(szHostName));
			inGetHostLabel(szHostName);
			if (memcmp(szHostName, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)) == 0	||
			    memcmp(szHostName, _HOST_NAME_DCC_, strlen(_HOST_NAME_DCC_)) == 0)
			{

			}
			else
			{
				continue;
			}

			/* GET HOST Enable */
			/* 結帳沒開Host也不跑 */
			memset(szHostEnable, 0x00, sizeof(szHostEnable));
			if (inGetHostEnable(szHostEnable) == VS_ERROR)
			{	
				return (VS_ERROR);
			}
			else
			{
				if (ginDebug == VS_TRUE)
				{
					memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
					sprintf(szDebugMsg, "%d HostEnable: %s", i, szHostEnable);
					inLogPrintf(AT, szDebugMsg);
				}
			}

			/* 看Host開關 */
			if (memcmp(szHostEnable, "Y", 1) != 0)
			{
				/* 如果HostEnable != Y，就continue */
				continue;
			}
			else
			{
				pobTran->srBRec.inHDTIndex = i;
			}

			inLoadHDPTRec(pobTran->srBRec.inHDTIndex);

			/* 看是否結帳成功 */
			memset(szSettleEnable, 0x00, sizeof(szSettleEnable));
			inGetMustSettleBit(szSettleEnable);
			if (memcmp(szSettleEnable, "Y", 1) == 0)
			{
				continue;
			}

			if (memcmp(szHostName, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)) == 0)
			{
				inCREDIT_PRINT_Dutyfree_NCCC_DetailReport_ByBuffer(pobTran);
			}
			else if (memcmp(szHostName, _HOST_NAME_DCC_, strlen(_HOST_NAME_DCC_)) == 0)
			{
				inCREDIT_PRINT_Dutyfree_NCCC_DetailReport_ByBuffer(pobTran);
			}
		}
		if (inOrgHDTIndex >= 0)
		{
			pobTran->srBRec.inHDTIndex = inOrgHDTIndex;
			inLoadHDTRec(pobTran->srBRec.inHDTIndex);
			inLoadHDPTRec(pobTran->srBRec.inHDTIndex);
		}
		
		/* 如果有TMS通知，要印 */
		memset(uszFileName, 0x00, sizeof(uszFileName));
		sprintf((char*)uszFileName, "%s%s", _DUTY_FREE_REPRINT_TMS_NOTIFY_FILE_NAME_, _DUTY_FREE_REPRINT_TOTAL_REPORT_FILE_EXTENSION_);
		inCREDIT_PRINT_Dutyfree_Reprint_Cavas_File_ByBuffer(uszFileName);
	}/* 要重印結帳單 */
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Table_Link_Duty_Free_Pwd
Date&Time       :2022/5/25 上午 10:39
Describe        :
*/
int inNCCC_Func_Table_Link_Duty_Free_Pwd(SQLITE_ALL_TABLE *srAll, int inLinkState, int* inTableID, char* szReprintPwd, char* szDetailedPwd)
{
	SQLITE_INT32T_TABLE TABLE_BATCH_INT[] = 
	{
		{0	,"inTableID"			,inTableID					},	/* inTableID */
		{0	,""				,NULL						}	/* 這行用Null用來知道尾端在哪 */
		
	};
	
	SQLITE_INT32T_TABLE TABLE_BATCH_INT64T[] = 
	{
		{0	,""				,NULL						}	/* 這行用Null用來知道尾端在哪 */
	};
	
	SQLITE_CHAR_TABLE TABLE_BATCH_CHAR[] =
	{
		{0	,""				,NULL						,0							}
	};
	
	SQLITE_CHAR_TABLE TABLE_BATCH_TEXT[] =
	{
		{0	,"szReprintPwd"			,szReprintPwd	,strlen(szReprintPwd)	},
		{0	,"szDetailPwd"			,szDetailedPwd	,strlen(szDetailedPwd)	},
		{0	,""				,NULL		,0			}
	};
	
	if (ginDebug == VS_TRUE)
        {
        	inLogPrintf(AT, "----------------------------------------");
                inLogPrintf(AT, "inNCCC_Func_Table_Link_Duty_Free_Pwd()_START");
        }
	
	SQLITE_LINK_TABLE	srLink;
	memset(&srLink, 0x00, sizeof(SQLITE_LINK_TABLE));
	srLink.psrInt = TABLE_BATCH_INT;
	srLink.psrInt64t = TABLE_BATCH_INT64T;
	srLink.psrChar = TABLE_BATCH_CHAR;
	srLink.psrText = TABLE_BATCH_TEXT;
	
	inSqlite_Table_Link(srAll, inLinkState, &srLink);
	
	if (ginDebug == VS_TRUE)
        {
                inLogPrintf(AT, "inNCCC_Func_Table_Link_Duty_Free_Pwd()_END");
                inLogPrintf(AT, "----------------------------------------");
        }
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Duty_Free_Save_Total_Report_Buffer
Date&Time       :2022/5/27 下午 4:41
Describe        :
*/
int inNCCC_Func_Duty_Free_Save_Total_Report_Buffer(unsigned char* uszFileName, unsigned char* uszBuffer, int inDataLen)
{
	unsigned long	ulHandle = 0;
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Duty_Free_Save_Total_Report_Buffer(%s,%d) START !", uszFileName, inDataLen);
	}
	
	/* 檢查是否有檔 */	
	if (inFILE_Check_Exist(uszFileName) == VS_SUCCESS)
	{
		/* 刪除 */
		inFILE_Delete(uszFileName);
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "Delete %s", uszFileName);
		}
	}
	
	inFILE_Create(&ulHandle, uszFileName);
	inFILE_Seek(ulHandle, 0, _SEEK_BEGIN_);
	inFILE_Write(&ulHandle, uszBuffer, inDataLen);
	
	inFILE_Close(&ulHandle);
	
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Duty_Free_Save_Total_Report_Buffer() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Delete_Cus_075_Files
Date&Time       :2022/6/1 下午 5:16
Describe        :
*/
int inNCCC_Func_Delete_Cus_075_Files(TRANSACTION_OBJECT* pobTran)
{
	char	szCustomIndicator[3 + 1] = {0};
	
	memset(szCustomIndicator, 0x00, sizeof(szCustomIndicator));
	inGetCustomIndicator(szCustomIndicator);
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Delete_Cus_075_Files(%s) START !", szCustomIndicator);
	}
	
	if (!memcmp(szCustomIndicator, _CUSTOMER_INDICATOR_075_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_)	||
	    !memcmp(szCustomIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		inDISP_ChineseFont("刪除結帳報表(重印)", _FONTSIZE_8X16_, _LINE_8_4_, _DISP_LEFT_);
		
		inNCCC_Func_Delete_Reprint_Report(pobTran->srBRec.inHDTIndex);
		/* 重建重印報表和刪除重印明細 */
		inSqlite_Drop_Table(gszReprintDBPath, _TABLE_NAME_REPRINT_TITLE_);
		inSqlite_Create_Table(gszReprintDBPath, _TABLE_NAME_REPRINT_TITLE_, TABLE_REPRINT_TITLE_TAG);
		
		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		inDISP_ChineseFont("刪除結帳報表(重印)", _FONTSIZE_8X16_, _LINE_8_4_, _DISP_LEFT_);
		inDISP_ChineseFont("刪除完畢", _FONTSIZE_8X16_, _LINE_8_5_, _DISP_LEFT_);
		/* 延遲一秒 */
		inDISP_Wait(1000);
		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Delete_Cus_075_Files() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Delete_Cus_075_Files
Date&Time       :2022/6/1 下午 5:16
Describe        :
*/
int inNCCC_Func_Delete_Reprint_Report(int inOrgindex)
{
	int	i = 0;
	int	inOrgHDTIndex = -1;
	char	szHostEnable[1 + 1] = {0};
	char	szHostName[8 + 1] = {0};
	unsigned char	uszFileName[30 + 1] = {0};
	TRANSACTION_OBJECT	pobTran;
	
	memset(&pobTran, 0x00, sizeof(TRANSACTION_OBJECT));
	pobTran.srBRec.inHDTIndex = inOrgindex;
	inOrgHDTIndex = inOrgindex;

	/* (需求單-109327)-vx520客製化需求(昇恆昌客製化) by Russell 2022/5/20 下午 2:26
	* 客製化075 TMS上傳筆數 */
	/* 刪除殘存結帳報表 */
	for (i = 0;; i++)
	{
		if (inLoadHDTRec(i) != VS_SUCCESS)
		{
			break;
		}
		memset(szHostEnable, 0x00, sizeof(szHostEnable));
		inGetHostEnable(szHostEnable);
		if (memcmp(szHostEnable, "Y", 1) != 0)
		{
			continue;
		}
		if (inLoadHDPTRec(i) != VS_SUCCESS)
		{
			break;
		}

		memset(szHostName, 0x00, sizeof(szHostName));
		inGetHostLabel(szHostName);

		memset(uszFileName, 0x00, sizeof(uszFileName));
		inFunc_ComposeFileName(&pobTran, (char*)uszFileName, _DUTY_FREE_REPRINT_TOTAL_REPORT_FILE_EXTENSION_, 0);
		/* 刪除 */
		inFILE_Delete(uszFileName);
	}
	/* 刪除TMS通知 */
	memset(uszFileName, 0x00, sizeof(uszFileName));
	sprintf((char*)uszFileName, "%s%s", _DUTY_FREE_REPRINT_TMS_NOTIFY_FILE_NAME_, _DUTY_FREE_REPRINT_TOTAL_REPORT_FILE_EXTENSION_);
	inFILE_Delete(uszFileName);
	/* 重建重印報表和刪除重印明細 */
	inSqlite_Drop_Table(gszReprintDBPath, _TABLE_NAME_REPRINT_NCCC_);
	inSqlite_Drop_Table(gszReprintDBPath, _TABLE_NAME_REPRINT_DCC_);

	if (inOrgHDTIndex != -1)
	{
		inLoadHDTRec(inOrgHDTIndex);
		inLoadHDPTRec(inOrgHDTIndex);
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Check_TMS_Booting_Flow
Date&Time       :2022/6/1 下午 6:38
Describe        :
*/
int inNCCC_Func_Check_TMS_Booting_Flow(TRANSACTION_OBJECT* pobTran)
{
	int	i = 0;
	int	inTableID = 0;
	char	szCustomIndicator[3 + 1] = {0};
	char	szCampaignNum[2 + 1] = {0};
	char	szEverRichSCDTEnable[1 + 1] = {0};
	char	szSpecialCardRangeEnable[1 + 1] = {0};
	unsigned char	uszCheck_SCDT_075_Bit = VS_FALSE;
	SQLITE_ALL_TABLE	srAll;
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_TMS_Booting_Flow START!");
	
	memset(szCustomIndicator, 0x00, sizeof(szCustomIndicator));
	inGetCustomIndicator(szCustomIndicator);
	
	/* 【需求單 - 106281】昇恆昌聯名卡判斷需求 add by LingHsiung 2017-09-25 上午 10:23:59 */
	/* 開機檢核特殊卡別參數檔及活動代碼05 */
	if (!memcmp(szCustomIndicator, _CUSTOMER_INDICATOR_075_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_)	||
	    !memcmp(szCustomIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_))
	{
		uszCheck_SCDT_075_Bit = VS_FALSE;
		memset(szSpecialCardRangeEnable, 0x00, sizeof(szSpecialCardRangeEnable));
		inGetSpecialCardRangeEnable(szSpecialCardRangeEnable);
		if (memcmp(szSpecialCardRangeEnable, "Y", 1) != 0)
		{
			uszCheck_SCDT_075_Bit = VS_FALSE;
		}
		else
		{
			for (i = 0 ;; i ++)
			{
				if (inLoadSCDTRec(i) < 0)
					break;

				/* 判斷活動代碼05 昇恆昌聯名卡 */
				memset(szCampaignNum, 0x00, sizeof(szCampaignNum));
				inGetCampaignNumber(szCampaignNum);
				if (!memcmp(szCampaignNum, _CAMPAIGNNUMBER_05_EVER_RICH_COMBO_, 2))
				{
					uszCheck_SCDT_075_Bit = VS_TRUE;
					break;
				}
			}
		}

		/* 客製化075 */
		memset(&srAll, 0x00, sizeof(SQLITE_ALL_TABLE));
		inTableID = 0;
		memset(szEverRichSCDTEnable, 0x00, sizeof(szEverRichSCDTEnable));
		inNCCC_Func_Table_Link_Duty_Free_Function(&srAll, _LS_READ_, &inTableID, szEverRichSCDTEnable);
		inSqlite_Get_Table_ByRecordID_All(gszReprintDBPath, _TABLE_NAME_DUTY_FREE_FUNCTION_, 0, &srAll);
		
		if (uszCheck_SCDT_075_Bit == VS_TRUE)
		{
			sprintf(szEverRichSCDTEnable, "Y");
		}
		else
		{
			sprintf(szEverRichSCDTEnable, "N");
		}
		memset(&srAll, 0x00, sizeof(SQLITE_ALL_TABLE));
		inNCCC_Func_Table_Link_Duty_Free_Function(&srAll, _LS_UPDATE_, &inTableID, szEverRichSCDTEnable);
		inSqlite_Insert_Or_Replace_ByRecordID_All(gszReprintDBPath, _TABLE_NAME_DUTY_FREE_FUNCTION_, 0, &srAll);
		
		if (uszCheck_SCDT_075_Bit != VS_TRUE && 
		    !memcmp(szCustomIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_))
		{
			/* 檢核聯名卡 */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			srDispMsgObj.inMsgType = _ENTER_KEY_MSG_;
			srDispMsgObj.inTimeout = 30;
			strcpy(srDispMsgObj.szErrMsg1, "檢核聯名卡");
			strcpy(srDispMsgObj.szErrMsg2, "參數設定有誤");
			strcpy(srDispMsgObj.szErrMsg3, "請報修");
			srDispMsgObj.inErrMsg1Line = _LINE_8_4_;
			srDispMsgObj.inErrMsg2Line = _LINE_8_5_;
			srDispMsgObj.inErrMsg3Line = _LINE_8_6_;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inDISP_Msg_BMP(&srDispMsgObj);
		}
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Table_Link_Duty_Free_Function
Date&Time       :2022/6/1 下午 6:41
Describe        :
*/
int inNCCC_Func_Table_Link_Duty_Free_Function(SQLITE_ALL_TABLE *srAll, int inLinkState, int* inTableID, char* szEverRichSCDTEnable)
{
	SQLITE_INT32T_TABLE TABLE_BATCH_INT[] = 
	{
		{0	,"inTableID"			,inTableID					},	/* inTableID */
		{0	,""				,NULL						}	/* 這行用Null用來知道尾端在哪 */
		
	};
	
	SQLITE_INT32T_TABLE TABLE_BATCH_INT64T[] = 
	{
		{0	,""				,NULL						}	/* 這行用Null用來知道尾端在哪 */
	};
	
	SQLITE_CHAR_TABLE TABLE_BATCH_CHAR[] =
	{
		{0	,""				,NULL						,0							}
	};
	
	SQLITE_CHAR_TABLE TABLE_BATCH_TEXT[] =
	{
		{0	,"szEverRichSCDTEnable"			,szEverRichSCDTEnable	,strlen(szEverRichSCDTEnable)	},
		{0	,""					,NULL			,0				}
	};
	
	if (ginDebug == VS_TRUE)
        {
        	inLogPrintf(AT, "----------------------------------------");
                inLogPrintf(AT, "inNCCC_Func_Table_Link_Duty_Free_Function()_START");
        }
	
	SQLITE_LINK_TABLE	srLink;
	memset(&srLink, 0x00, sizeof(SQLITE_LINK_TABLE));
	srLink.psrInt = TABLE_BATCH_INT;
	srLink.psrInt64t = TABLE_BATCH_INT64T;
	srLink.psrChar = TABLE_BATCH_CHAR;
	srLink.psrText = TABLE_BATCH_TEXT;
	
	inSqlite_Table_Link(srAll, inLinkState, &srLink);
	
	if (ginDebug == VS_TRUE)
        {
                inLogPrintf(AT, "inNCCC_Func_Table_Link_Duty_Free_Function()_END");
                inLogPrintf(AT, "----------------------------------------");
        }
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Check_Special_Card_In_OPT_Flow
Date&Time       :2022/6/1 下午 6:39
Describe        :
*/
int inNCCC_Func_Check_Special_Card_In_OPT_Flow(TRANSACTION_OBJECT* pobTran)
{
	int	inRetVal = VS_SUCCESS;
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Special_Card_In_OPT_Flow START!");
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Check_Special_Card_In_OPT_Flow() START !");
	}
	
	/* 考量到檢核時機，剛過卡應該要有一次，所以加了一個在OPT，
	 * 保留舊的以防舊流程先過卡後輸金額的狀況
	 * 有金額跑前面，沒金額等輸了金額跑後面 */
	if (pobTran->srBRec.lnTxnAmount != 0)
	{
		inRetVal = inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_CHECK_SPECIALCARD_FLOW_);
		pobTran->uszCheck_OPT_Special_CardBit = VS_TRUE;
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "uszCheck_OPT_Special_CardBit:On");
		}
	}
		
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Check_Special_Card_In_OPT_Flow() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Special_Card_In_OPT_Flow END!");
        
	return (inRetVal);
}

/*
Function        :inNCCC_Func_CUS_075_Menu_When_ECR
Date&Time       :2022/7/19 下午 5:52
Describe        :ECR顯示重印選單
*/
int inNCCC_Func_CUS_075_Menu_When_ECR(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = VS_SUCCESS;
	int	inChoice = 0;
	int	inTouchSensorFunc = _Touch_NEWUI_CHOOSE_HOST_;
	char	szKey = 0x00;
	char	szLine1[20 + 1] = {0};
	char	szLine1_2[20 + 1] = {0};
	char	szLine2[20 + 1] = {0};
	char	szLine2_2[20 + 1] = {0};
	char	szCustomerIndicator[3 + 1] = {0};
	
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_CUS_075_Menu_When_ECR START!");
        
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	
	if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_075_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_)	||
	    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inDISP_ClearAll();
		inFunc_Display_LOGO( 0,  _COORDINATE_Y_LINE_16_2_);		/* 第一層顯示 LOGO */
		inDISP_PutGraphic(_MENU_REPRINT_TITLE_, 0,  _COORDINATE_Y_LINE_8_3_);	/* 第三層顯示 ＜重印簽單＞ */

		/* 1.交易帳單 */
		/* 2.結帳帳單 */
		/* 請選擇？ */
		memset(szLine1, 0x00, sizeof(szLine1));
		memset(szLine1_2, 0x00, sizeof(szLine1_2));
		memset(szLine2, 0x00, sizeof(szLine2));
		memset(szLine2_2, 0x00, sizeof(szLine2_2));
		sprintf(szLine1, "交易");
		sprintf(szLine1_2, "帳單1");
		sprintf(szLine2, "結帳");
		sprintf(szLine2_2, "帳單2");

		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		inDISP_PutGraphic(_CHOOSE_HOST_2_, 0, _COORDINATE_Y_LINE_8_4_);
		inDISP_ChineseFont_Point_Color_By_Graphic_Mode(szLine1, _FONTSIZE_16X22_, _COLOR_WHITE_, _COLOR_BUTTON_, _COORDINATE_X_CHOOSE_HOST_1_, _COORDINATE_Y_LINE_16_9_, VS_FALSE);
		inDISP_ChineseFont_Point_Color_By_Graphic_Mode(szLine1_2, _FONTSIZE_16X22_, _COLOR_WHITE_, _COLOR_BUTTON_, _COORDINATE_X_CHOOSE_HOST_1_, _COORDINATE_Y_LINE_16_10_, VS_FALSE);

		inDISP_ChineseFont_Point_Color_By_Graphic_Mode(szLine2, _FONTSIZE_16X22_, _COLOR_WHITE_, _COLOR_BUTTON_, _COORDINATE_X_CHOOSE_HOST_2_, _COORDINATE_Y_LINE_16_9_, VS_FALSE);
		inDISP_ChineseFont_Point_Color_By_Graphic_Mode(szLine2_2, _FONTSIZE_16X22_, _COLOR_WHITE_, _COLOR_BUTTON_, _COORDINATE_X_CHOOSE_HOST_2_, _COORDINATE_Y_LINE_16_10_, VS_FALSE);
		inDISP_ChineseFont("請選擇?", _FONTSIZE_8X16_, _LINE_8_7_, _DISP_LEFT_);
		inDISP_Timer_Start(_TIMER_NEXSYS_1_, _EDC_TIMEOUT_);
		while (1)
		{
			inChoice = inDisTouch_TouchSensor_Click_Slide(inTouchSensorFunc);
			szKey = uszKBD_Key();

			/* Timeout */
			if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
			{
				szKey = _KEY_TIMEOUT_;
			}

			/* 是否列印上一筆 */
			if (szKey == _KEY_1_			||
			    inChoice == _NEWUI_CHOOSE_HOST_Touch_HOST_1_)
			{
				/* 是否列印上一筆 */
				inDISP_ClearAll();
				inFunc_Display_LOGO( 0,  _COORDINATE_Y_LINE_16_2_);		/* 第一層顯示 LOGO */
				inDISP_PutGraphic(_MENU_REPRINT_TITLE_, 0,  _COORDINATE_Y_LINE_8_3_);	/* 第三層顯示 ＜重印簽單＞ */

				inRetVal = inFLOW_RunOperation(pobTran, _OPERATION_REPRINT_CUS_075_);
				break;
			}
			/* 結帳報表 */
			else if (szKey == _KEY_2_			||
				 inChoice == _NEWUI_CHOOSE_HOST_Touch_HOST_2_)
			{
				inRetVal = inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_DUTY_FREE_REPRINT_);
				break;
			}
			else if (szKey == _KEY_CANCEL_)
			{
				inRetVal = VS_USER_CANCEL;
				break;
			}
			else if (szKey == _KEY_TIMEOUT_)
			{
				inRetVal = VS_TIMEOUT;
				break;
			}

		}
		/* 清空Touch資料 */
		inDisTouch_Flush_TouchFile();
	}
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_RePrint_Customer_Flow
Date&Time       :2022/7/20 上午 11:36
Describe        :ECR客製化分流
*/
int inNCCC_Func_RePrint_Customer_Flow(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = VS_SUCCESS;
	char	szCustomIndicator[3 + 1] = {0};
	
        vdUtility_SYSFIN_LogMessage(AT, " START!");
        
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_RePrint_Customer_Flow() START !");
	}
	
	memset(szCustomIndicator, 0x00, sizeof(szCustomIndicator));
	inGetCustomIndicator(szCustomIndicator);
	
	/* (需求單-109327)-vx520客製化需求(昇恆昌客製化) by Russell 2022/5/20 下午 2:26
	 * 客製化075 */
	if (!memcmp(szCustomIndicator, _CUSTOMER_INDICATOR_075_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_)	||
	    !memcmp(szCustomIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inRetVal = inFLOW_RunOperation(pobTran, _OPERATION_REPRINT_CUS_075_MENU_);
	}
	else
	{
		inRetVal = inFLOW_RunOperation(pobTran, _OPERATION_REPRINT_NORMAL_);
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_RePrint_Customer_Flow() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (inRetVal);
}


/*
Function        :inNCCC_Func_CUS_035_MIRAMAR_CINEMAS_Settlement_Flow
Date&Time       :2022/7/12 下午 4:07
Describe        :美麗華連動結帳流程，要等印完帳單再回傳ECR，最後做TMS
*/
int inNCCC_Func_CUS_035_MIRAMAR_CINEMAS_Settlement_Flow(TRANSACTION_OBJECT *pobTran)
{
	int		i = 0;
	int		inRetVal = VS_SUCCESS;
	char		szHostName[42 + 1] = {0};
	char		szHostEnable[2 + 1] = {0};
	char		szDebugMsg[100 + 1] = {0};
	char		szTRTFileName[12 + 1] = {0};
	char		szBatchNum[6 + 1] = {0};
	char		szTemplate[10 + 1] = {0};
	unsigned char	uszSettleFailBit = VS_FALSE;
	unsigned char		uszNeedCreditAccumBit = VS_FALSE;
	unsigned char		uszNeedESVCAccumBit = VS_FALSE;
	ACCUM_TOTAL_REC		srAccumRec;
	TICKET_ACCUM_TOTAL_REC	srTicketAccumRec;
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_CUS_035_MIRAMAR_CINEMAS_Settlement_Flow() START !");
	}
	
	/* 看要結哪個的帳 */
	inLoadHDTRec(pobTran->srBRec.inHDTIndex);
	memset(szTemplate, 0x00, sizeof(szTemplate));
	inGetHostLabel(szTemplate);
	if (pobTran->uszAutoSettleBit == VS_TRUE)
	{
		uszNeedCreditAccumBit = VS_TRUE;
		uszNeedESVCAccumBit = VS_TRUE;
	}
	else if (memcmp(szTemplate, _HOST_NAME_CREDIT_NCCC_, strlen(_HOST_NAME_CREDIT_NCCC_)) == 0)
	{
		uszNeedCreditAccumBit = VS_TRUE;
	}
	else if (memcmp(szTemplate, _HOST_NAME_ESVC_, strlen(_HOST_NAME_ESVC_)) == 0)
	{
		uszNeedESVCAccumBit = VS_TRUE;
	}
	
	/* 要結信用卡帳 */
	if (uszNeedCreditAccumBit == VS_TRUE)
	{
		inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_CREDIT_NCCC_, &pobTran->srBRec.inHDTIndex);
		/* 如果ECR 主機丟不是NCCC的會出問題，所以這裡多load一次 */
		inLoadHDTRec(pobTran->srBRec.inHDTIndex);
		
		memset(&srAccumRec, 0x00, sizeof(srAccumRec));
		inRetVal = inACCUM_GetRecord(pobTran, &srAccumRec);
		if (inRetVal == VS_SUCCESS	||
		    inRetVal == VS_NO_RECORD)
		{
			/* 零元結帳 */
		}
		else
		{
			return (VS_ERROR);
		}
	}
	
	/* 要節電票帳 */
	if (uszNeedESVCAccumBit == VS_TRUE)
	{
		inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_ESVC_, &pobTran->srBRec.inHDTIndex);
		/* 如果ECR 主機丟不是NCCC的會出問題，所以這裡多load一次 */
		inLoadHDTRec(pobTran->srBRec.inHDTIndex);
		
		memset(&srTicketAccumRec, 0x00, sizeof(srTicketAccumRec));
		inRetVal = inACCUM_GetRecord_ESVC(pobTran, &srTicketAccumRec);
		if (inRetVal == VS_SUCCESS	||
		    inRetVal == VS_NO_RECORD)
		{
			/* 零元結帳 */
		}
		else
		{
			return (VS_ERROR);
		}
	}
	
	/* 先撈帳 */
	/* 【需求單 - 109306】卡人自助交易支援信用卡取消及退貨交易需求 更新收銀機結帳回覆規格(支援正負號)by Russell 2020/10/15 下午 5:27 */
	pobTran->lnNCCC_SettleTotalCount = srAccumRec.lnTotalCount;											/* 信用卡結帳總筆數 *//* 邦柏結帳統計 (START) */
	pobTran->llNCCC_SettleTotalAmount = srAccumRec.llTotalAmount;	
	pobTran->lnNCCC_SettleSaleCount = srAccumRec.lnTotalSaleCount;											/* 信用卡結帳總筆數 *//* 邦柏結帳統計 (START) */
	pobTran->llNCCC_SettleSaleAmount = srAccumRec.llTotalSaleAmount + srAccumRec.llTotalTipsAmount;	
	pobTran->lnNCCC_SettleRefundCount = srAccumRec.lnTotalRefundCount;											/* 信用卡結帳總筆數 *//* 邦柏結帳統計 (START) */
	pobTran->llNCCC_SettleRefundAmount = srAccumRec.llTotalRefundAmount;											/* 信用卡結帳總金額 */
	pobTran->lnECC_SettleTotalCount = srTicketAccumRec.lnEASYCARD_DeductTotalCount + srTicketAccumRec.lnEASYCARD_RefundTotalCount;			/* 悠遊卡結帳總筆數 */
	pobTran->llECC_SettleTotalAmount = srTicketAccumRec.llEASYCARD_DeductTotalAmount - srTicketAccumRec.llEASYCARD_RefundTotalAmount;		/* 悠遊卡結帳總金額 */
	pobTran->lnIPASS_SettleTotalCount = srTicketAccumRec.lnIPASS_DeductTotalCount + srTicketAccumRec.lnIPASS_RefundTotalCount;			/* 一卡通結帳總筆數 */
	pobTran->llIPASS_SettleTotalAmount = srTicketAccumRec.llIPASS_DeductTotalAmount - srTicketAccumRec.llIPASS_RefundTotalAmount;			/* 一卡通結帳總金額 */
	pobTran->lnICASH_SettleTotalCount = srTicketAccumRec.lnICASH_DeductTotalCount + srTicketAccumRec.lnICASH_RefundTotalCount;			/* 愛金卡結帳總筆數 */
	pobTran->llICASH_SettleTotalAmount = srTicketAccumRec.llICASH_DeductTotalAmount - srTicketAccumRec.llICASH_RefundTotalAmount;			/* 愛金卡結帳總金額 */
	
	if (pobTran->uszAutoSettleBit == VS_TRUE)
	{
		for (i = 0;; ++i)
		{
			/* 先LoadHDT */
			if (inLoadHDTRec(i) == VS_ERROR)
			{
				/* 當找不到第i筆資料會回傳VS_ERROR */
				break;
			}

			/* ESC要跳過 */
			memset(szHostName, 0x00, sizeof(szHostName));
			inGetHostLabel(szHostName);
			if (memcmp(szHostName, _HOST_NAME_ESC_, strlen(_HOST_NAME_ESC_)) == 0)
			{
				continue;
			}

			/* HG要跳過 */
			memset(szHostName, 0x00, sizeof(szHostName));
			inGetHostLabel(szHostName);
			if (memcmp(szHostName, _HOST_NAME_HG_, strlen(_HOST_NAME_HG_)) == 0)
			{
				continue;
			}

			/* GET HOST Enable */
			/* 結帳沒開也不跑 */
			memset(szHostEnable, 0x00, sizeof(szHostEnable));
			if (inGetHostEnable(szHostEnable) == VS_ERROR)
			{	
				return (VS_ERROR);
			}
			else
			{
				if (ginDebug == VS_TRUE)
				{
					memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
					sprintf(szDebugMsg, "%d HostEnable: %s", i, szHostEnable);
					inLogPrintf(AT, szDebugMsg);
				}
			}

			/* 看結帳開關 */

			if (memcmp(szHostEnable, "Y", 1) != 0)
			{
				/* 如果HostEnable != Y，就continue */
				continue;
			}
			else
			{
				pobTran->srBRec.inHDTIndex = i;
			}

			/* 如果主機有開，才loadHDPT */
			if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) == VS_SUCCESS)
			{
				memset(szBatchNum, 0x00, sizeof(szBatchNum));
				inGetBatchNum(szBatchNum);
				pobTran->srBRec.lnBatchNum = atol(szBatchNum);

				/* 在這裡決定跑那一個host的TRT */
				memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
				inGetTRTFileName(szTRTFileName);

				/* 2018/5/8 下午 2:10 DFS需求不再使用大來主機 */
				if (!memcmp(_TRT_FILE_NAME_CREDIT_, szTRTFileName, strlen(_TRT_FILE_NAME_CREDIT_)))
				{
					inRetVal = inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
				}
				else if (!memcmp(_TRT_FILE_NAME_DCC_, szTRTFileName, strlen(_TRT_FILE_NAME_DCC_)))
				{
					inRetVal = inNCCC_DCC_RunTRT(pobTran, pobTran->inRunTRTID);
				}
				else if (!memcmp(_TRT_FILE_NAME_ESVC_, szTRTFileName, strlen(_TRT_FILE_NAME_ESVC_)))
				{
					inRetVal = inNCCC_Ticket_RunTRT(pobTran, pobTran->inRunTRTID);
				}
                                else if (!memcmp(_TRT_FILE_NAME_TRUST_, szTRTFileName, strlen(_TRT_FILE_NAME_TRUST_)))
                                {
                                        inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
                                }

				if (inRetVal != VS_SUCCESS)
				{
					inFunc_Display_Error(pobTran);

					/* 列印XXXHost結帳失敗 */
					while (inRetVal != VS_SUCCESS)
					{
						uszSettleFailBit = VS_TRUE;
						inRetVal = inCREDIT_PRINT_AutoSettle_Failed_ByBuffer();
					}

				}

			}

		}

		/* ECR回傳等印完帳單後 */
		if (pobTran->uszECRBit == VS_TRUE)
		{
			inFLOW_RunFunction(pobTran, _FUNCTION_ECR_SEND_TRANSACTION_RESULT_);
		}

		/* 連動結帳跑完，把Bit Off，做TMS下載 */
		pobTran->uszAutoSettleBit = VS_FALSE;

		/* 如果結帳失敗，就不跑下載 */
		/* 分ISO和FTP，若是ISO，則有結帳失敗就不下，
		   FTP則是不論結帳是否成功，一律執行 */
		memset(szTemplate, 0x00, sizeof(szTemplate));
		inGetTMSDownloadMode(szTemplate);
		if (memcmp(szTemplate, _TMS_DLMODE_FTPS_, strlen(_TMS_DLMODE_FTPS_)) == 0)
		{
			inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_SCHEDULE_INQUIRE_);
			inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
			/* 提示人工安全認證畫面 */
			inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_DISPLAY_PLEASE_LOGON_FIRST_);
			inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
		}
		else
		{
			/* 結帳失敗，不下載 */
			if (uszSettleFailBit == VS_TRUE)
			{

			}
			else
			{
				/* ISO不用詢問 */
				inNCCCTMS_PRINT_ScheduleMessage_Flow(pobTran);
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
			}
		}
	}
	else
	{
		/* 預防萬一再LoadHDPT一次 */
		if (inLoadHDPTRec(pobTran->srBRec.inHDTIndex) == VS_SUCCESS)
		{
			/* 在這裡決定跑那一個host的TRT */
			inGetTRTFileName(szTRTFileName);

			/* ResetTitle */
			inFunc_ResetTitle(pobTran);

			if (0)
			{
				
			}
			else if (0)
			{
				
			}
			else
			{
				/* 2018/5/8 下午 2:10 DFS需求不再使用大來主機 */
				if (!memcmp(_TRT_FILE_NAME_HG_, szTRTFileName, strlen(_TRT_FILE_NAME_HG_)))
				{
					inRetVal = inHG_RunTRT(pobTran, pobTran->inRunTRTID);
				}
				else if (!memcmp(_TRT_FILE_NAME_CREDIT_, szTRTFileName, strlen(_TRT_FILE_NAME_CREDIT_)))
				{
					inRetVal = inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
				}
				else if (!memcmp(_TRT_FILE_NAME_DCC_, szTRTFileName, strlen(_TRT_FILE_NAME_DCC_)))
				{
					inRetVal = inNCCC_DCC_RunTRT(pobTran, pobTran->inRunTRTID);
				}
				else if (!memcmp(_TRT_FILE_NAME_ESVC_, szTRTFileName, strlen(_TRT_FILE_NAME_ESVC_)))
				{
					inRetVal = inNCCC_Ticket_RunTRT(pobTran, pobTran->inRunTRTID);
				}
                                else if (!memcmp(_TRT_FILE_NAME_TRUST_, szTRTFileName, strlen(_TRT_FILE_NAME_TRUST_)))
                                {
                                        inRetVal = inNCCC_RunTRT(pobTran, pobTran->inRunTRTID);
                                }
			}
		}
		
		if (inRetVal != VS_SUCCESS)
		{
			/* 只有出錯才需SendError */
			if (pobTran->inECRErrorMsg != _ECR_RESPONSE_CODE_NOT_SET_ERROR_)
			{
				inECR_SendError(pobTran, pobTran->inECRErrorMsg);
			}
			else
			{
				inECR_SendError(pobTran, inRetVal);
			}

			/* 要先回傳再顯示錯誤訊息 */
			inFunc_Display_Error(pobTran);
		}
		else
		{
			/* ECR回傳等印完帳單後 */
			if (pobTran->uszECRBit == VS_TRUE)
			{
				inFLOW_RunFunction(pobTran, _FUNCTION_ECR_SEND_TRANSACTION_RESULT_);
			}
		}

		if (pobTran->inRunTRTID == _TRT_SETTLE_ ||
		    pobTran->inRunTRTID == _TRT_TICKET_ECC_SETTLE_)
		{
			/* 如果結帳失敗，就不跑下載 */
			/* 分ISO和FTP，若是ISO，則有結帳失敗就不下，
			   FTP則是不論結帳是否成功，一律執行 */
			memset(szTemplate, 0x00, sizeof(szTemplate));
			inGetTMSDownloadMode(szTemplate);
			if (memcmp(szTemplate, _TMS_DLMODE_FTPS_, strlen(_TMS_DLMODE_FTPS_)) == 0)
			{
				if (inFunc_All_Host_Settle_Check(pobTran, VS_FALSE) == VS_SUCCESS)
				{
					inFLOW_RunFunction(pobTran, _FUNCTION_TMS_SCHEDULE_INQUIRE_);
					inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
					/* 提示人工安全認證畫面 */
					inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_DISPLAY_PLEASE_LOGON_FIRST_);
					inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
				}
			}
			else
			{
				/* ISO維持原流程 */
				if (!memcmp(_TRT_FILE_NAME_CREDIT_, szTRTFileName, strlen(_TRT_FILE_NAME_CREDIT_)))
				{
					/* 結帳失敗，不下載 */
					if (inRetVal != VS_SUCCESS)
					{

					}
					else
					{
						/* ISO不用詢問 */
						inNCCCTMS_PRINT_ScheduleMessage_Flow(pobTran);
						inFLOW_RunFunction(pobTran, _FUNCTION_TMS_DOWNLOAD_SETTLE_);
						inFLOW_RunFunction(pobTran, _FUNCTION_TMS_REBOOT_);
					}
				}
			}
		}
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_CUS_035_MIRAMAR_CINEMAS_Settlement_Flow() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Process_Reversal_Inform
Date&Time       :2022/7/20 下午 6:16
Describe        :重新設定回_OPERATION_REPRINT_，方便控制流程
*/
int inNCCC_Func_Process_Reversal_Inform(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_SUCCESS;
	char		szCustomerIndicator[3 + 1] = {0};
	unsigned char	uszKey = 0;
	
	/* 代表前面已選擇過reversal選單，無須再選 */
	if (pobTran->uszCus099_Already_Decide_Reversal_Bit == VS_TRUE)
	{
		inRetVal = VS_SUCCESS;
	}
	else
	{
		memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
		inGetCustomIndicator(szCustomerIndicator);
		
		if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_099_SINYA_, _CUSTOMER_INDICATOR_SIZE_))
		{
			/* 直接印第二聯 */
			pobTran->srBRec.inPrintOption = _PRT_CUST_;
			inCREDIT_PRINT_Reversal_Print(pobTran);

			inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
			inDISP_ChineseFont("交易失敗將通知發", _FONTSIZE_8X16_, _LINE_8_4_, _DISP_LEFT_);
			inDISP_ChineseFont("卡行進行沖銷處理", _FONTSIZE_8X16_, _LINE_8_5_, _DISP_LEFT_);
			/* 請按確認或清除鍵 */
			inDISP_PutGraphic(_MSG_ENTER_OR_CANCEL_, 0, _COORDINATE_Y_LINE_8_8_);
			inDISP_BEEP(1, 500);
			inFlushKBDBuffer();
			inDISP_Timer_Start(_TIMER_NEXSYS_1_, _EDC_TIMEOUT_);

			while (1)
			{
				uszKey = uszKBD_Key();

				/* Timeout */
				if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
				{
					uszKey = _KEY_TIMEOUT_;
				}

				if (uszKey == _KEY_CANCEL_				|| 
				    uszKey == _KEY_TIMEOUT_				||
				    uszKey == _KEY_ENTER_)
				{
					pobTran->uszCus099_Already_Decide_Reversal_Bit = VS_TRUE;
					break;
				}
				else
				{
					continue;
				}
			}

			/* 按確認鍵才送Reversal */
			if (uszKey == _KEY_ENTER_)
			{
				inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
				inCOMM_End(pobTran);

				if (inFLOW_RunFunction(pobTran, _COMM_START_) == VS_SUCCESS)
				{
					pobTran->uszReversalBit = VS_FALSE;
					inNCCC_Func_Decide_ProcessReversal(pobTran);
				}
			}

			/* 選擇完不在顯示錯誤訊息，直接清零 */
			pobTran->inErrorMsg = 0x00;
		}
		else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_026_TAKA_, _CUSTOMER_INDICATOR_SIZE_) ||
			 !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_021_TAKAWEL_, _CUSTOMER_INDICATOR_SIZE_))
		{
			/* 印第一聯 */
			pobTran->srBRec.inPrintOption = _PRT_MERCH_;
			inCREDIT_PRINT_Reversal_Print(pobTran);
			inCOMM_End(pobTran);
			
			inRetVal = inFLOW_RunFunction(pobTran, _COMM_START_);
			if (inRetVal == VS_SUCCESS)
			{
				pobTran->uszReversalBit = VS_FALSE;
				inNCCC_Func_Decide_ProcessReversal(pobTran);
				pobTran->uszCus099_Already_Decide_Reversal_Bit = VS_TRUE;
			}
			
			inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
			inDISP_ChineseFont("交易失敗將通知發", _FONTSIZE_8X16_, _LINE_8_4_, _DISP_LEFT_);
			inDISP_ChineseFont("卡行進行沖銷處理", _FONTSIZE_8X16_, _LINE_8_5_, _DISP_LEFT_);
			/* 繼續請按確認鍵 */
			inDISP_ChineseFont_Point_Color_By_Graphic_Mode("繼續請按", _FONTSIZE_8X16_, _COLOR_BLACK_, _COLOR_WHITE_, _COORDINATE_X_16_1_, _COORDINATE_Y_LINE_16_14_, VS_FALSE);
			inDISP_ChineseFont_Point_Color_By_Graphic_Mode("確認", _FONTSIZE_8X16_, _COLOR_BLACK_, _COLOR_BUTTON_GREEN_, _COORDINATE_X_16_9_, _COORDINATE_Y_LINE_16_14_, VS_FALSE);
			inDISP_ChineseFont_Point_Color_By_Graphic_Mode("鍵", _FONTSIZE_8X16_, _COLOR_BLACK_, _COLOR_WHITE_, _COORDINATE_X_16_13_, _COORDINATE_Y_LINE_16_14_, VS_FALSE);
			inDISP_BEEP(1, 500);
			inFlushKBDBuffer();
			inDISP_Timer_Start(_TIMER_NEXSYS_1_, _EDC_TIMEOUT_);

			while (1)
			{
				uszKey = uszKBD_Key();

				/* Timeout */
				if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
				{
					uszKey = _KEY_TIMEOUT_;
				}

				if (uszKey == _KEY_TIMEOUT_				||
				    uszKey == _KEY_ENTER_)
				{
					break;
				}
				else
				{
					continue;
				}
			}
			
			/* 印第二聯 */
			pobTran->srBRec.inPrintOption = _PRT_CUST_;
			inCREDIT_PRINT_Reversal_Print(pobTran);
			
			/* 選擇完不在顯示錯誤訊息，直接清零 */
			pobTran->inErrorMsg = 0x00;
		}
	}
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Decide_ProcessReversal
Date&Time       :2022/8/24 下午 1:57
Describe        :分Host流程
*/
int inNCCC_Func_Decide_ProcessReversal(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = {0};
	char	szDebugMsg[100 + 1] = {0};
	char	szTRTFileName[12 + 1] = {0};
	char	szFesMode[2 + 1] = {0};
	char	szCFESMode[2 + 1] = {0};
	
	memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
	inGetTRTFileName(szTRTFileName);
	
	memset(szFesMode, 0x00, sizeof(szFesMode));
	inGetNCCCFESMode(szFesMode);
	memset(szCFESMode, 0x00, sizeof(szCFESMode));
	inGetCloud_MFES(szCFESMode);

	if (!memcmp(szTRTFileName, _TRT_FILE_NAME_CREDIT_, strlen(_TRT_FILE_NAME_CREDIT_)))
	{
		if (0)
		{

		}
		else
		{
			if (memcmp(szFesMode, _NCCC_03_MFES_MODE_, 2) == 0)
			{
				/* (需求單 - 107276)自助交易標準做法 CFES by Russell 2019/3/6 上午 10:32 */
				if (memcmp(szCFESMode, "Y", strlen("Y")) == 0)
				{
					inRetVal = inNCCC_ATS_ProcessReversal(pobTran);
				}
				else
				{
					inRetVal = inNCCC_MFES_ProcessReversal(pobTran);
				}
			}
			else if (memcmp(szFesMode, _NCCC_05_ATS_MODE_, 2) == 0	||
				 memcmp(szFesMode, _NCCC_04_MPAS_MODE_, 2) == 0)
			{
				inRetVal = inNCCC_ATS_ProcessReversal(pobTran);
			}
			else
			{
				if (ginDebug == VS_TRUE)
				{
					memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
					sprintf(szDebugMsg, "inNCCC_Func_Decide_ProcessReversal :EMV無此FES 流程 :%s", szFesMode);
					inLogPrintf(AT, szDebugMsg);
				}
				inRetVal = VS_ERROR;
			}
		}
		
		return (inRetVal);
	}
	else if (!memcmp(szTRTFileName, _TRT_FILE_NAME_DCC_, strlen(_TRT_FILE_NAME_DCC_)))
	{
		inRetVal = inNCCC_DCC_ProcessReversal(pobTran);
		
		return (inRetVal);
	}
	else
	{
		if (ginDebug == VS_TRUE)
		{
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "inNCCC_Func_Decide_ProcessReversal :EMV無此TRT流程 :%s", szTRTFileName);
			inLogPrintf(AT, szDebugMsg);
		}
		return (VS_ERROR);
	}
	
}

/*
Function        :inNCCC_Func_BDAU_DeleteAccumBatch
Date&Time       :2022/9/15 下午 4:35
Describe        :
*/
int inNCCC_Func_BDAU_DeleteAccumBatch(TRANSACTION_OBJECT *pobTran)
{
	char	szCustomerIndicator[3 + 1] = {0};
	
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_BDAU_DeleteAccumBatch START!");
        
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_BDAU_DeleteAccumBatch() START !");
	}

	/* 建設保險公司客製化專屬，交易記錄只保留最後一筆交易，提供重印帳單及取消、小費功能。(除了取消、小費、調帳在明細中，會保留原交易及調整交易的調閱編號提
	   供重印之外，其他交易都只保留後一筆記錄，以提供重印及取消。) (START) */
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_042_BDAU1_, _CUSTOMER_INDICATOR_SIZE_)	||
	    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_043_BDAU9_, _CUSTOMER_INDICATOR_SIZE_))
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "In");
		}
		
		/* 刪除BATCH資料 (START) */
		/* 刪除交易記錄檔檔案 */
		pobTran->uszNotDispMsgBit = VS_TRUE;
		inFLOW_RunFunction(pobTran, _FUNCTION_DELETE_BATCH_FLOW_);
		pobTran->uszNotDispMsgBit = VS_FALSE;

		/* 翰霖: 建設保險公司客製化中，由於沒有結帳，因此若是TC Upload失敗，且之後未做交易或是關機，或是之後只有做晶片交易導致Advice未上傳，
		         想請問一下這會不會影響到清算?
		   升文: 建設公司跟保險公司會以簽帳單請款，不會影響到清算。
		   From mail by 2011.8.1 AM 10:39 */
		/* 刪除BATCH資料 (END) */

		/* 刪除ACCUM資料 (START) */
		pobTran->uszNotDispMsgBit = VS_TRUE;
		inFLOW_RunFunction(pobTran, _FUNCTION_DELETE_ACCUM_FLOW_);
		pobTran->uszNotDispMsgBit = VS_FALSE;
		/* 刪除ACCUM資料 (END) */
		
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "SUEECSS");
		}
	}
	/* Add by hanlin 2011.7.5 AM 9:54 建設保險公司客製化專屬，交易記錄只保留最後一筆交易，提供重
	   印帳單及取消、小費功能。(除了取消、小費、調帳在明細中，會保留原交易及調整交易的調閱編號提
	   供重印之外，其他交易都只保留後一筆記錄，以提供重印及取消。) (END) */
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_BDAU_DeleteAccumBatch() END !");
		inLogPrintf(AT, "----------------------------------------");
	}

        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_BDAU_DeleteAccumBatch END!");
        
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_BDAU_SettlementCheck
Date&Time       :2022/9/16 下午 2:41
Describe        :
*/
int inNCCC_Func_BDAU_Settlement_Check(TRANSACTION_OBJECT *pobTran)
{
	vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_BDAU_Settlement_Check START!");
	
	char	szCustomerIndicator[3 + 1] = {0};
	/* 建設保險公司客製化專屬，不提供結帳功能。不論TMS是否有開結帳，EDC都會關閉此結帳功能 (START) */

	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	
	/* 建設公司客製化參數不支援結帳功能 */
	if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_042_BDAU1_, _CUSTOMER_INDICATOR_SIZE_)	||
	    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_043_BDAU9_, _CUSTOMER_INDICATOR_SIZE_))
	{
		/* 此功能已關閉 */
		pobTran->inErrorMsg = _ERROR_CODE_V3_FUNC_CLOSE_;
		
		return (VS_ERROR);
	}

	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_BDAU_Delete_Batch_Before_TMS
Date&Time       :2022/9/16 下午 6:41
Describe        :
*/
int inNCCC_Func_BDAU_Delete_Batch_Before_TMS(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_SUCCESS;
	char		szCustomerIndicator[3 + 1] = {0};
	unsigned char	uszCheckBatchStillBit = VS_FALSE;
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_BDAU_Delete_Batch_Before_TMS() START !");
	}
	
	/* 建設保險公司客製化專屬，交易記錄只保留最後一筆交易，提供重印帳單及取消、小費功能。(除了取消、小費、調帳在明細中，會保留原交易及調整交易的調閱編號提
	   供重印之外，其他交易都只保留後一筆記錄，以提供重印及取消。) (START) */
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_042_BDAU1_, _CUSTOMER_INDICATOR_SIZE_)	||
	    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_043_BDAU9_, _CUSTOMER_INDICATOR_SIZE_))
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "In");
		}
		
		inRetVal = inFunc_All_Host_Settle_Check(pobTran, VS_FALSE);
		if (inRetVal == VS_ERROR)
		{
			uszCheckBatchStillBit = VS_TRUE;
		}
		
		if (uszCheckBatchStillBit == VS_TRUE)
		{
			/* 畫面出現提示 批次有帳，是否要清除，請按0確認 */
			DISPLAY_OBJECT	srDispMsgObj;
			memset(&srDispMsgObj, 0x00, sizeof(srDispMsgObj));
			strcpy(srDispMsgObj.szDispPic1Name, "");
			srDispMsgObj.inMsgType = _0_KEY_MSG_;
			srDispMsgObj.inTimeout = 30;
			strcpy(srDispMsgObj.szErrMsg1, "批次有帳");
			srDispMsgObj.inErrMsg1Line = _LINE_8_4_;
			strcpy(srDispMsgObj.szErrMsg2, "是否要清除");
			srDispMsgObj.inErrMsg2Line = _LINE_8_5_;
			srDispMsgObj.inBeepTimes = 1;
			srDispMsgObj.inBeepInterval = 0;
			inRetVal = inDISP_Msg_BMP(&srDispMsgObj);
			if (inRetVal == VS_TIMEOUT)
			{
				return (VS_TIMEOUT);
			}
		}
		
		pobTran->srBRec.inHDTIndex = 0;
		inLoadHDTRec(pobTran->srBRec.inHDTIndex);
		
		/* 刪除BATCH資料 (START) */
		/* 刪除交易記錄檔檔案 */
		pobTran->uszNotDispMsgBit = VS_TRUE;
		inFLOW_RunFunction(pobTran, _FUNCTION_DELETE_BATCH_FLOW_);
		pobTran->uszNotDispMsgBit = VS_FALSE;

		/* 翰霖: 建設保險公司客製化中，由於沒有結帳，因此若是TC Upload失敗，且之後未做交易或是關機，或是之後只有做晶片交易導致Advice未上傳，
		         想請問一下這會不會影響到清算?
		   升文: 建設公司跟保險公司會以簽帳單請款，不會影響到清算。
		   From mail by 2011.8.1 AM 10:39 */
		/* 刪除BATCH資料 (END) */

		/* 刪除ACCUM資料 (START) */
		pobTran->uszNotDispMsgBit = VS_TRUE;
		inFLOW_RunFunction(pobTran, _FUNCTION_DELETE_ACCUM_FLOW_);
		pobTran->uszNotDispMsgBit = VS_FALSE;
		/* 刪除ACCUM資料 (END) */
		
		inFLOW_RunFunction(pobTran, _FUNCTION_REST_BATCH_INV_);
		
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "SUEECSS");
		}
		
		/* 刪除BDAU Log*/
		inFILE_Delete((unsigned char*)_CUS_042_BDAU_LOG_FILENAME_);
	}
	/* Add by hanlin 2011.7.5 AM 9:54 建設保險公司客製化專屬，交易記錄只保留最後一筆交易，提供重
	   印帳單及取消、小費功能。(除了取消、小費、調帳在明細中，會保留原交易及調整交易的調閱編號提
	   供重印之外，其他交易都只保留後一筆記錄，以提供重印及取消。) (END) */
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_BDAU_Delete_Batch_Before_TMS() END !");
		inLogPrintf(AT, "----------------------------------------");
	}

	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_OPT_DELETE_BATCH_Customer_Flow
Date&Time       :2022/10/24 下午 3:01
Describe        :刪除批次客製化分流
*/
int inNCCC_Func_OPT_DELETE_BATCH_Customer_Flow(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = VS_SUCCESS;
	char	szCustomerIndicator[3 + 1] = {0};
	
	vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_OPT_DELETE_BATCH_Customer_Flow START!");
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_OPT_DELETE_BATCH_Customer_Flow() START !");
	}
	
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	
	do
	{
		if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_075_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_) ||
		    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_103_DUTY_FREE_, _CUSTOMER_INDICATOR_SIZE_))
		{
			inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_DELETE_BATCH_FLOW_);
			if (inRetVal != VS_SUCCESS)
			{
				break;
			}
			
			inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_DELETE_ACCUM_FLOW_);
			if (inRetVal != VS_SUCCESS)
			{
				break;
			}
			
			inRetVal = inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_DELETE_CUS_075_FILES_);
			if (inRetVal != VS_SUCCESS)
			{
				break;
			}
		}
		else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_042_BDAU1_, _CUSTOMER_INDICATOR_SIZE_))
		{
			inRetVal = inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_BDAU_DELETE_BATCH_BEFORE_TMS_);
			if (inRetVal != VS_SUCCESS)
			{
				break;
			}
		}
		else
		{
			inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_DELETE_BATCH_FLOW_);
			if (inRetVal != VS_SUCCESS)
			{
				break;
			}
			
			inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_DELETE_ACCUM_FLOW_);
			if (inRetVal != VS_SUCCESS)
			{
				break;
			}
		}
		
		break;
	}while(1);
	
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_OPT_DELETE_BATCH_Customer_Flow(%d) END !", inRetVal);
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_All_HOST_MUST_SETTLE_Customer_Flow
Date&Time       :2022/10/25 上午 11:16
Describe        :某些客製化要跳過帳務檢核
*/
int inNCCC_Func_All_HOST_MUST_SETTLE_Customer_Flow(TRANSACTION_OBJECT *pobTran)
{
	int	inRetVal = VS_SUCCESS;
	char	szCustomerIndicator[3 + 1] = {0};
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_All_HOST_MUST_SETTLE_Customer_Flow START!");
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_All_HOST_MUST_SETTLE_Customer_Flow() START !");
	}
	
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	
	if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_042_BDAU1_, _CUSTOMER_INDICATOR_SIZE_) ||
	    !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_043_BDAU9_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inRetVal = VS_SUCCESS;
	}
	else
	{
		inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_All_HOST_MUST_SETTLE_);
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_All_HOST_MUST_SETTLE_Customer_Flow(%d) END !", inRetVal);
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Check_Amount_by_Card
Date&Time       :2022/9/28 上午 10:35
Describe        :【需求單 - 105196】限制每日同一卡號不得連續刷卡，且端末機交易金額累積不得超過15萬元
*/
int inNCCC_Func_Check_Amount_by_Card(TRANSACTION_OBJECT *pobTran)
{
	int	inCnt = 0, i = 0, j = 0;
	int	inRetVal = VS_ERROR;
	long	lnFileSize = 0, lnAmount = 0;
	char	szDate[6 + 1] = {0};
	char	szFileName[24 + 1] = {0}, szCardNumber[19 + 1] = {0};
	char	szTemplate[128 + 1] = {0}, szTemplate2[64 + 1] = {0};
	char    szReadBuf[128 + 1] = {0}, szWriteBuf[128 + 1] = {0};
	char	szCustomerIndicator[3 + 1] = {0};
	unsigned long	ulHandle = 0;
	TotalAmtByCard	srTABC = {};
	RTC_NEXSYS	srRTC = {};

        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Amount_by_Card START!");
        
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Check_Amount_by_Card() START !");
	}
	
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);

	memset(&srRTC, 0x00, sizeof(srRTC));
	
	/* 目前為建設公司需求 */
	if(!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_043_BDAU9_, 3))
	{
		memset(szFileName, 0x00, sizeof(szFileName));
		strcpy(szFileName, _CUS_042_BDAU_LOG_FILENAME_);

		/* 取得今天日期 */
		inFunc_GetSystemDateAndTime(&srRTC);
		memset(szDate, 0x00, sizeof(szDate));
		sprintf(szDate, "%02d%02d%02d", srRTC.uszYear, srRTC.uszMonth, srRTC.uszDay);
		
		/* 開檔 */
		inRetVal = inFILE_Open(&ulHandle, (unsigned char*)szFileName);
		
		if (inRetVal != VS_SUCCESS)
		{
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "inNCCC_Func_Check_Amount_by_Card File Open Error(%s)", szFileName);
			}
		}

		/* 先抓檔案大小 */
		lnFileSize = lnFILE_GetSize(&ulHandle, (unsigned char*)szFileName);
		
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "lnFileSize = %ld", lnFileSize);
		}

		if (lnFileSize > 0)
		{
			memset(szReadBuf, 0x00, sizeof(szReadBuf));
		}
		else
		{
			inFILE_Create(&ulHandle, (unsigned char*)szFileName);
			inFILE_Seek(ulHandle, 0, _SEEK_BEGIN_);
			/* 沒資料，直接判斷正項交易金額 */
			/* 寫今天日期在第一行 */
			memset(szWriteBuf, 0x00, sizeof(szWriteBuf));
			strcpy(szWriteBuf, szDate);
			/* 換行 */
			szWriteBuf[6] = 0x0D;
			szWriteBuf[7] = 0x0A;
			inFILE_Write(&ulHandle, (unsigned char*)szWriteBuf, 8);

			/* 判斷是否正項交易金額大於十五萬 */
			if (pobTran->srBRec.lnTxnAmount > 150000)
			{
				inFILE_Close(&ulHandle);
				
				if (pobTran->uszECRBit == VS_TRUE)
        				inECR_SendError(pobTran, _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_);

				/* 房屋訂金刷卡累計不得超逾十五萬元 */
				unsigned char   uszKey = 0;
				
				inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
				inDISP_ChineseFont("房屋訂金刷卡累計", _FONTSIZE_8X16_, _LINE_8_4_, _DISP_CENTER_);
				inDISP_ChineseFont("不得超逾十五萬元", _FONTSIZE_8X16_, _LINE_8_5_, _DISP_CENTER_);
				inDISP_PutGraphic(_ERR_CLEAR_, 0, _COORDINATE_Y_LINE_8_7_);
				inDISP_BEEP(1, 0);

				while (1)
				{
					uszKey = uszKBD_Key();

					if (uszKey == _KEY_CANCEL_)
					{
						inRetVal = VS_USER_CANCEL;
						break;
					}
					else
					{
						continue;
					}
				}
				
				vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Amount_by_Card Amount > 150,000");
			   	return (VS_ERROR);
			}
			else
			{
				inFILE_Close(&ulHandle);
                                
                                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Amount_by_Card Amt <= 150,000 END!");
				return (VS_SUCCESS);
			}
		}

		inFILE_Seek(ulHandle, 0L, _SEEK_BEGIN_); /* 從 0 開始讀起 */
		
		/* 讀第一行日期 */
		inFILE_Read(&ulHandle, (unsigned char*)szReadBuf, 8);
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "szReadBuf = [%s]", szReadBuf);
		}
		memset(&srTABC, 0x00, sizeof(TotalAmtByCard));
		memcpy(&srTABC.szDate[0], &szReadBuf[0], 6);

		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "srTABC.szDate = [%s]", srTABC.szDate);
			inLogPrintf(AT, "szDate = [%s]", szDate);
		}
		
		/* 日期相同 */
		if (!memcmp(srTABC.szDate, szDate, 6))
		{
			/* 存卡號到srTABC.szCardNumber */
			strcpy(srTABC.szCardNumber, pobTran->srBRec.szPAN);
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "pobTran->srBRec.szPAN = [%s]", pobTran->srBRec.szPAN);
				inLogPrintf(AT, "srTABC.szCardNumber = [%s]", srTABC.szCardNumber);
			}
			/* 繼續讀完剩下的資料 */
		}
		/* 日期不同 */
		else
		{
			/* 刪除檔案 */
			inFILE_Close(&ulHandle);
			inFILE_Delete((unsigned char*)szFileName);

			/* 判斷是否正項交易金額大於十五萬 */
			if (pobTran->srBRec.lnTxnAmount > 150000)
			{
				if (pobTran->uszECRBit == VS_TRUE)
        				inECR_SendError(pobTran, _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_);

				/* 房屋訂金刷卡累計不得超逾十五萬元 */
				unsigned char   uszKey = 0;
				
				inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
				inDISP_ChineseFont("房屋訂金刷卡累計", _FONTSIZE_8X16_, _LINE_8_4_, _DISP_CENTER_);
				inDISP_ChineseFont("不得超逾十五萬元", _FONTSIZE_8X16_, _LINE_8_5_, _DISP_CENTER_);
				inDISP_PutGraphic(_ERR_CLEAR_, 0, _COORDINATE_Y_LINE_8_7_);
				inDISP_BEEP(1, 0);

				while (1)
				{
					uszKey = uszKBD_Key();

					if (uszKey == _KEY_CANCEL_)
					{
						inRetVal = VS_USER_CANCEL;
						break;
					}
					else
					{
						continue;
					}
				}
				
				vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Amount_by_Card Amount > 150,000");
			   	return (VS_ERROR);
			}
			else
			{
                                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Amount_by_Card Amount <= 150,000 END!");
				return (VS_SUCCESS);
			}
		}

		/* 讀剩下資料後分析 一行一行讀固定64Bytes */
		inCnt = lnFileSize / 64;

		for (i = 0; i < inCnt; i++)
		{
			memset(szReadBuf, 0x00, sizeof(szReadBuf));
			inFILE_Read(&ulHandle, (unsigned char*)szReadBuf, 64);

			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "szReadBuf = [%s]", szReadBuf);
			}

			memset(szTemplate, 0x00, sizeof(szTemplate));
			memcpy(&szTemplate[0], &szReadBuf[0], 64);

			/* Time */
			memset(srTABC.szTime, 0x00, sizeof(srTABC.szTime));
			memcpy(&srTABC.szTime[0], &szTemplate[0], 8);

			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "srTABC.szTime = [%s]", srTABC.szTime);
			}

			/* CardNumber */
			memset(szCardNumber, 0x00, sizeof(szCardNumber));
			memcpy(&szCardNumber[0], &szTemplate[9], 20);

			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "szCardNumber = [%s]", szCardNumber);
			}

			for (j = 0; j < 20; j ++)
			{
				if (szCardNumber[j] == 0x20)
					szCardNumber[j] = 0x00;
			}

			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "szCardNumber2 = [%s]", szCardNumber);
			}

			/* Amount */
			memset(szTemplate2, 0x00, sizeof(szTemplate2));
			memcpy(&szTemplate2[0], &szTemplate[30], 11);
			lnAmount = atol(szTemplate2);

			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "lnAmount = [%ld]", lnAmount);
			}

			/* TransType */
			memset(srTABC.szTransType, 0x00, sizeof(srTABC.szTransType));
			memcpy(&srTABC.szTransType[0], &szTemplate[42], 20);

			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "srTABC.szTransType = [%s]", srTABC.szTransType);
			}

			/* 比對卡號及金額累加 */
			if (!memcmp(srTABC.szCardNumber, szCardNumber, strlen(srTABC.szCardNumber)))
			{
				srTABC.lnTotalAmount = srTABC.lnTotalAmount + lnAmount;
			}
		}

		/* 關檔 */
		inFILE_Close(&ulHandle);

		/* 同一卡號不能連續刷正向 */
		if (lnAmount > 0)
		{
			if (!memcmp(srTABC.szCardNumber, szCardNumber, strlen(srTABC.szCardNumber)))
			{
				if (pobTran->uszECRBit == VS_TRUE)
        				inECR_SendError(pobTran, _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_);

				/* 連續刷正項交易的警語 */
				int		inFinalTimeOut = 0;
				char		szTimeOut[3 + 1] = {0};
				unsigned char   uszKey = 0;
				
				memset(szTimeOut, 0x00, sizeof(szTimeOut));
				inGetEnterTimeout(szTimeOut);
				inFinalTimeOut = atoi(szTimeOut);

				inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
				inDISP_ChineseFont("交易失敗:", _FONTSIZE_8X16_, _LINE_8_4_, _DISP_LEFT_);
				inDISP_ChineseFont("連續交易", _FONTSIZE_8X16_, _LINE_8_5_, _DISP_LEFT_);
				inDISP_ChineseFont_Point_Color_By_Graphic_Mode("請按", _FONTSIZE_8X16_, _COLOR_BLACK_, _COLOR_WHITE_, _COORDINATE_X_16_1_, _COORDINATE_Y_LINE_16_14_, VS_FALSE);
				inDISP_ChineseFont_Point_Color_By_Graphic_Mode("清除", _FONTSIZE_8X16_, _COLOR_BLACK_, _COLOR_RED_, _COORDINATE_X_16_5_, _COORDINATE_Y_LINE_16_14_, VS_FALSE);
				inDISP_ChineseFont_Point_Color_By_Graphic_Mode("鍵", _FONTSIZE_8X16_, _COLOR_BLACK_, _COLOR_WHITE_, _COORDINATE_X_16_9_, _COORDINATE_Y_LINE_16_14_, VS_FALSE);
				inDISP_BEEP(1, 0);
				
				while (1)
				{
					uszKey = uszKBD_GetKey(inFinalTimeOut);

					if (uszKey == _KEY_CANCEL_)
					{
						inRetVal = VS_USER_CANCEL;
						break;
					}
					else if (uszKey == _KEY_TIMEOUT_)
					{
						inRetVal = VS_TIMEOUT;
						break;
					}
					else
					{
						continue;
					}
				}

				vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Amount_by_Card PAN Same");
				
			   	return (VS_ERROR);
			}
		}

		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "pobTran->srBRec.lnBaseTransactionAmount = [%ld]", pobTran->srBRec.lnTxnAmount);
		}
		/* 加上要做的交易判斷是否超過十五萬 */
		/* 日期相同又做小費 累加小費金額比對 */
		if (pobTran->srBRec.inCode == _TIP_)
			srTABC.lnTotalAmount = srTABC.lnTotalAmount + pobTran->srBRec.lnTipTxnAmount;
		else
			srTABC.lnTotalAmount = srTABC.lnTotalAmount + pobTran->srBRec.lnTxnAmount;

		if (srTABC.lnTotalAmount > 150000)
		{
			if (pobTran->uszECRBit == VS_TRUE)
				inECR_SendError(pobTran, _ECR_RESPONSE_CODE_TRANS_FLOW_ERROR_);

			/* 房屋訂金刷卡累計不得超逾十五萬元 */
			unsigned char   uszKey = 0;

			inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
			inDISP_ChineseFont("房屋訂金刷卡累計", _FONTSIZE_8X16_, _LINE_8_4_, _DISP_CENTER_);
			inDISP_ChineseFont("不得超逾十五萬元", _FONTSIZE_8X16_, _LINE_8_5_, _DISP_CENTER_);
			inDISP_PutGraphic(_ERR_CLEAR_, 0, _COORDINATE_Y_LINE_8_7_);
			inDISP_BEEP(1, 0);

			while (1)
			{
				uszKey = uszKBD_Key();

				if (uszKey == _KEY_CANCEL_)
				{
					inRetVal = VS_USER_CANCEL;
					break;
				}
				else
				{
					continue;
				}
			}

			vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Amount_by_Card Amount > 150,000");
			return (VS_ERROR);
		}
		else
		{
                        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Amount_by_Card Amount <= 150,000 END!");
			return (VS_SUCCESS);
		}

	}
	else
	{
                vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Amount_by_Card(NOT 043 or 065) END!");
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "inNCCC_Func_Check_Amount_by_Card(NOT 043 or 065) END!!");
		}
		return (VS_SUCCESS);
	}
}

/*
Function        :inNCCC_Func_Store_Amount_by_Card
Date&Time       :2022/9/28 下午 5:08
Describe        :
*/
int inNCCC_Func_Store_Amount_by_Card(TRANSACTION_OBJECT *pobTran)
{
	int	inCnt = 0;
	long	lnFileSize;
	char	szFileName[24 + 1] = {0};
	char	szAmount[12 + 1] = {0};
	char	szWriteBuf[128 + 1] = {0}, szReadBuf[128 + 1] = {0};
	char	szAddMinus[2 + 1] = {0};
	unsigned long	ulHandle = 0;
	TotalAmtByCard	srTABC;

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Store_Amount_by_Card() START !");
	}

	/* 取得所有要儲存的資料 */
	memset(&srTABC, 0x00, sizeof(TotalAmtByCard));
	/* 日期 */
	strcpy(srTABC.szDate, &pobTran->srBRec.szDate[2]);
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "srTABC.szDate : [%s]",srTABC.szDate);
	}
	
	/* 時間 */
	memcpy(&srTABC.szTime[0], &pobTran->srBRec.szTime[0], 2);
	strcat(srTABC.szTime, ":");
	memcpy(&srTABC.szTime[3], &pobTran->srBRec.szTime[2], 2);
	strcat(srTABC.szTime, ":");
	memcpy(&srTABC.szTime[6], &pobTran->srBRec.szTime[4], 2);
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "srTABC.szTime : [%s]",srTABC.szTime);
	}
	/* 卡號左靠右補空白到20bytes */
	strcpy(srTABC.szCardNumber, pobTran->srBRec.szPAN);
	inFunc_PAD_ASCII(srTABC.szCardNumber, srTABC.szCardNumber, ' ', 20, _PADDING_RIGHT_);
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "srTABC.szCardNumber : [%s]",srTABC.szCardNumber);
	}
	/* 交易別及判斷正負號 */
	memset(szAddMinus, 0x00, sizeof(szAddMinus));
	vdNCCC_Func_BDAU_GetTransType(pobTran, &srTABC.szTransType[0], &szAddMinus[0]);
	inFunc_PAD_ASCII(srTABC.szTransType, srTABC.szTransType, ' ', 20, _PADDING_RIGHT_);
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "srTABC.szTransType : [%s] inAddMinus : [%s]",srTABC.szTransType, szAddMinus);
	}

	/* 判斷金額是否要加上負號 */
	if (szAddMinus[0] == 'Y')
	{
		memset(szAmount, 0x00, sizeof(szAmount));
		sprintf(szAmount,"-%010ld", pobTran->srBRec.lnTxnAmount);
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "szAmount : [%s]", szAmount);
		}
	}
	else
	{
		memset(szAmount, 0x00, sizeof(szAmount));

		if (pobTran->srBRec.inCode == _TIP_)
			sprintf(szAmount,"0%010ld", pobTran->srBRec.lnTipTxnAmount);
		else
			sprintf(szAmount,"0%010ld", pobTran->srBRec.lnTxnAmount);

		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "szAmount : [%s]",szAmount);
		}
	}

	/* 開檔 */
	memset(szFileName, 0x00, sizeof(szFileName));
	strcpy(szFileName, _CUS_042_BDAU_LOG_FILENAME_);

	/* 開檔 */
	inFILE_Open(&ulHandle, (unsigned char*)szFileName);

	/* 判斷資料日期 */
	/* 先抓檔案大小 */
	lnFileSize = lnFILE_GetSize(&ulHandle, (unsigned char*)szFileName);
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "lnFileSize = [%ld]", lnFileSize);
	}

	/* 開新檔先存日期 */
	if (lnFileSize == VS_ERROR)
	{
		inFILE_Create(&ulHandle, (unsigned char*)szFileName);
		inFILE_Seek(ulHandle, 0L, _SEEK_BEGIN_); /* 從 0 開始讀起 */
		memset(szWriteBuf, 0x00, sizeof(szWriteBuf));
		memcpy(&szWriteBuf[0], &srTABC.szDate[0], 6);
		szWriteBuf[6] = 0x0D;
		szWriteBuf[7] = 0x0A;
		inFILE_Write(&ulHandle, (unsigned char*)szWriteBuf, 8);
	}
	else
	{
		inFILE_Seek(ulHandle, 0L, _SEEK_BEGIN_); /* 從 0 開始讀起 */
		memset(szReadBuf, 0x00, sizeof(szReadBuf));
		/* 讀第一行日期 */
		inFILE_Read(&ulHandle, (unsigned char*)szReadBuf, 6);

		/* 日期相同 */
		if (!memcmp(&szReadBuf[0], &srTABC.szDate[0], 6))
		{
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "Same Date");
			}
			/* 移到檔案最後 */
			inFILE_Seek(ulHandle, 0, _SEEK_END_);
		}
		/* 日期不同 */
		else
		{
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "NOT Same Date");
			}

			/* 關檔刪檔 */
			inFILE_Close(&ulHandle);
			inFILE_Delete((unsigned char*)szFileName);

			/* 開檔 */
			inFILE_Create(&ulHandle, (unsigned char*)szFileName);

			memset(szWriteBuf, 0x00, sizeof(szWriteBuf));
			memcpy(&szWriteBuf[0], &srTABC.szDate[0], 6);
			szWriteBuf[6] = 0x0D;
			szWriteBuf[7] = 0x0A;
			inFILE_Write(&ulHandle, (unsigned char*)szWriteBuf, 8);
		}
	}

	/* 組要寫檔的資料 */
	memset(szWriteBuf, 0x00, sizeof(szWriteBuf));
	memcpy(&szWriteBuf[0], &srTABC.szTime[0], 8);
	inCnt = 8;
	strcat(szWriteBuf, ",");
	inCnt = inCnt + 1;
	memcpy(&szWriteBuf[inCnt], &srTABC.szCardNumber[0], 20);
	inCnt = inCnt + 20;
	strcat(szWriteBuf, ",");
	inCnt = inCnt + 1;
	memcpy(&szWriteBuf[inCnt], &szAmount[0], 11);
	inCnt = inCnt + 11;
	strcat(szWriteBuf, ",");
	inCnt = inCnt + 1;
	memcpy(&szWriteBuf[inCnt], &srTABC.szTransType[0], 20);
	inCnt = inCnt + 20;
	szWriteBuf[inCnt] = 0x0D;
	inCnt ++;
	szWriteBuf[inCnt] = 0x0A;
	inCnt ++;
	inFILE_Write(&ulHandle, (unsigned char*)szWriteBuf, inCnt);
	/* 關檔 */
	inFILE_Close(&ulHandle);

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Store_Amount_by_Card() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (VS_SUCCESS);
}

/*
Function        :vdNCCC_Func_BDAU_GetTransType
Date&Time       :2022/9/28 下午 6:18
Describe        :
*/
void vdNCCC_Func_BDAU_GetTransType(TRANSACTION_OBJECT *pobTran, char *szPrintBuf, char *szAddMinus)
{
	memset(szPrintBuf, 0x00, sizeof(szPrintBuf));

	if (pobTran->srBRec.uszVOIDBit == VS_FALSE)
	{
		switch (pobTran->srBRec.inCode)
		{
			case _SALE_ :
			case _CUP_SALE_ :
				strcpy(szPrintBuf, "SALE");
				strcpy(szAddMinus, "N");
				break;
			case _SALE_OFFLINE_ :
			case _FORCE_CASH_ADVANCE_ :
				strcpy(szPrintBuf, "FORCE");
				strcpy(szAddMinus, "N");
				break;
			case _REFUND_ :
			case _CUP_REFUND_ :
				strcpy(szPrintBuf, "REFUND");
				strcpy(szAddMinus, "Y");
				break;
			case _CUP_MAIL_ORDER_REFUND_ :
				strcpy(szPrintBuf, "REFUND MAIL ORDER");
				strcpy(szAddMinus, "Y");
				break;
			case _INST_SALE_ :
				strcpy(szPrintBuf, "INSTALLMENT");
				strcpy(szAddMinus, "N");
				break;
			case _INST_REFUND_ :
				strcpy(szPrintBuf, "REFUND INST.");
				strcpy(szAddMinus, "Y");
				break;
			case _REDEEM_SALE_ :
				strcpy(szPrintBuf, "REDEMPTION");
				strcpy(szAddMinus, "N");
				break;
			case _REDEEM_REFUND_ :
				strcpy(szPrintBuf, "REFUND REDEEM");
				strcpy(szAddMinus, "Y");
				break;
			case _TIP_ :
				strcpy(szPrintBuf, "TIPS");
				strcpy(szAddMinus, "N");
				break;
			case _REDEEM_ADJUST_ :
				strcpy(szPrintBuf, "ADJUST REDEEM");
				strcpy(szAddMinus, "N");
				break;
			case _INST_ADJUST_ :
				strcpy(szPrintBuf, "ADJUST INST.");
				strcpy(szAddMinus, "N");
				break;
			case _PRE_AUTH_ :
			case _CUP_PRE_AUTH_ :
				strcpy(szPrintBuf, "PREAUTH");
				strcpy(szAddMinus, "N");
				break;
			case _PRE_COMP_ :
			case _CUP_PRE_COMP_ :
				strcpy(szPrintBuf, "PREAUTH COMPLETE");
				strcpy(szAddMinus, "N");
				break;
			case _MAIL_ORDER_ :
			case _CUP_MAIL_ORDER_ :
				strcpy(szPrintBuf, "MAIL ORDER");
				strcpy(szAddMinus, "N");
				break;
			case _CASH_ADVANCE_ :
				strcpy(szPrintBuf, "CASH ADVANCE");
				strcpy(szAddMinus, "N");
				break;
			case _FISC_SALE_ :
				strcpy(szPrintBuf, "FISC SALE");
				strcpy(szAddMinus, "N");
				break;
			case _FISC_REFUND_ :
				strcpy(szPrintBuf, "FISC REFUND");
				strcpy(szAddMinus, "Y");
				break;
			default :
				strcpy(szPrintBuf, "TransType ERROR");
				break;
		}
	}
	else
	{
		switch (pobTran->srBRec.inOrgCode)
		{
			case _SALE_ :
			case _CUP_SALE_ :
				strcpy(szPrintBuf, "VOID");
				strcpy(szAddMinus, "Y");
				break;
			case _SALE_OFFLINE_ :
			case _FORCE_CASH_ADVANCE_ :
				strcpy(szPrintBuf, "VOID FORCE");
				strcpy(szAddMinus, "Y");
				break;
			case _REFUND_ :
			case _CUP_REFUND_ :
				strcpy(szPrintBuf, "VOID REFUND");
				strcpy(szAddMinus, "N");
				break;
			case _CUP_MAIL_ORDER_REFUND_ :
				strcpy(szPrintBuf, "VOID REFUND MAIL ORDER");
				strcpy(szAddMinus, "N");
				break;
			case _INST_SALE_ :
				strcpy(szPrintBuf, "VOID INST.");
				strcpy(szAddMinus, "Y");
				break;
			case _REDEEM_SALE_ :
				strcpy(szPrintBuf, "VOID REDEEM");
				strcpy(szAddMinus, "Y");
				break;
			case _REDEEM_ADJUST_ :
				strcpy(szPrintBuf, "VOID ADJUST REDEEM");
				strcpy(szAddMinus, "Y");
				break;
			case _INST_ADJUST_ :
				strcpy(szPrintBuf, "VOID ADJUST INST.");
				strcpy(szAddMinus, "Y");
				break;
			case _REDEEM_REFUND_ :
				strcpy(szPrintBuf, "VOID REFUND REDEEM");
				strcpy(szAddMinus, "N");
				break;
			case _INST_REFUND_ :
				strcpy(szPrintBuf, "VOID REFUND INST.");
				strcpy(szAddMinus, "N");
				break;
			case _CUP_PRE_AUTH_ :
				strcpy(szPrintBuf, "VOID PREAUTH");
				strcpy(szAddMinus, "Y");
				break;
			case _CUP_PRE_COMP_ :
			case _PRE_COMP_ :
				strcpy(szPrintBuf, "VOID PREAUTH COMPLETE");
				strcpy(szAddMinus, "Y");
				break;
			case _CASH_ADVANCE_ :
				strcpy(szPrintBuf, "VOID CASH ADVANCE");
				strcpy(szAddMinus, "Y");
				break;
			case _MAIL_ORDER_ :
			case _CUP_MAIL_ORDER_ :
				strcpy(szPrintBuf, "VOID MAIL ORDER");
				strcpy(szAddMinus, "Y");
				break;
			case _FISC_SALE_ :
				strcpy(szPrintBuf, "FISC VOID");
				strcpy(szAddMinus, "Y");
				break;
			default :
				strcpy(szPrintBuf, "TransType ERROR");
				break;
		}
	}
}

/*
Function        :inNCCC_Func_ICC_FPG_FTC_InsertCard
Date&Time       :2022/9/27 上午 11:42
Describe        :客製化【005】、【006】讀聯名卡用，這邊只確認卡槽有卡
*/
int inNCCC_Func_ICC_FPG_FTC_InsertCard(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_SUCCESS;
	char		szDispMsg[48 + 1] = {0};
	unsigned char	uszKey = 0;
	unsigned char	uszCardInBit = VS_FALSE;
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_ICC_FPG_FTC_InsertCard() START !");
	}

	inRetVal = inEMV_ICCEvent(); 
        if (inRetVal == VS_SUCCESS)
        {
		uszCardInBit = VS_TRUE;
        }
        else
        {
		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
                memset(szDispMsg, 0x00, sizeof(szDispMsg));
                inDISP_ChineseFont("請插入聯名卡", _FONTSIZE_8X16_, _LINE_8_6_, _DISP_CENTER_); /* 請插入聯名卡 */
        }

	inDISP_Timer_Start(_TIMER_NEXSYS_1_, 30);
	do
	{
		uszKey = uszKBD_Key();
		inRetVal = inEMV_ICCEvent();
		
		if (inRetVal == VS_SUCCESS)
		{
			uszCardInBit = VS_TRUE;
			break;
		}
		
		if (uszKey == _KEY_CANCEL_)
		{
			break;
		}
		else if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
		{
			break;
		}

		
	}while(1);

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_ICC_FPG_FTC_InsertCard(%d) END !", uszCardInBit);
		inLogPrintf(AT, "----------------------------------------");
	}
	
	if (uszCardInBit == VS_TRUE)
	{
		return (VS_SUCCESS);
	}
	else
	{
		return (VS_ERROR);
	}
}

/*
Function        :inNCCC_Func_ICC_FPG_FTC_GetChipCardData
Date&Time       :2022/9/27 下午 5:35
Describe        :客製化【005】、【006】聯名卡晶片用
*/
int inNCCC_Func_ICC_FPG_FTC_GetChipCardData(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_ERROR;
	int		inCnt = 0;
	char		szBCD[12] = {0}, szASCII[24] = {0};
	BYTE		btFPG_FTC_CardAID[] = {0xA0, 0x00, 0x00, 0x01, 0x53, 0x00, 0x01, 0x00, 0x08, 0x05, 0x00, 0x01};
	APDU_COMMAND	srAPDUData = {};
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_ICC_FPG_FTC_GetChipCardData() START !");
	}
	
	memset(&srAPDUData, 0x00, sizeof(srAPDUData));

	/* 聯名卡 POWER ON */
	if (inFISC_PowerON(pobTran) != VS_SUCCESS)
	{
		/* 請檢查聯名卡 */
		pobTran->inErrorMsg = _ERROR_CODE_V3_FPG_FTC_ICC_CHECK_CARD;
		return (VS_ERROR);
	}
	else
	{
		/* Select AID */
		memset(&srAPDUData, 0x00, sizeof(srAPDUData));
		srAPDUData.uszCommandCLAData[0] = ICC_FPG_FTC_SELECT_AID_CLA;	/* CLA */
		srAPDUData.uszCommandINSData[0] = ICC_FPG_FTC_SELECT_AID_INS;	/* INS */
		srAPDUData.uszCommandP1Data[0] = ICC_FPG_FTC_SELECT_AID_P1;		/* P1 */
		srAPDUData.uszCommandP2Data[0] = ICC_FPG_FTC_SELECT_AID_P2;		/* P2 */
		memcpy(&srAPDUData.uszCommandData[0], btFPG_FTC_CardAID, sizeof(btFPG_FTC_CardAID));
		srAPDUData.inCommandDataLen = 12;

		if (inAPDU_BuildAPDU(&srAPDUData) != VS_SUCCESS)
		{
			return (VS_ERROR);
		}

		/* 收送Command */
		inRetVal = inAPDU_Send_APDU_User_Slot_Process(&srAPDUData);
		if (inRetVal == VS_SUCCESS)
		{
			if (!(srAPDUData.uszRecevData[srAPDUData.inRecevLen -2] == 0x90 && srAPDUData.uszRecevData[srAPDUData.inRecevLen -1] == 0x00))
			{
				if (ginDebug == VS_TRUE)
					inLogPrintf(AT, "Response != 9000");
				/* 請檢查聯名卡 */
				pobTran->inErrorMsg = _ERROR_CODE_V3_FPG_FTC_ICC_CHECK_CARD;

				return (VS_ERROR);
			}
			else
			{
				if (ginDebug == VS_TRUE)
					inLogPrintf(AT, "確認為聯名卡");
			}
		}
		else
		{
			/* SEND APDU FAIL */
			pobTran->inErrorMsg = _ERROR_CODE_V3_FISC_12_SEND_APDU_FAIL_;
			/* 下Command失敗 */
			if (ginDebug == VS_TRUE)
				inLogPrintf(AT, "APDU Command Error");

			return (inRetVal);
		}
		
		
		/* Select EF 基本資料檔【FE01】 */
		memset(&srAPDUData, 0x00, sizeof(srAPDUData));
		srAPDUData.uszCommandCLAData[0] = ICC_FPG_FTC_SELECT_EF_CLA;	/* CLA */
		srAPDUData.uszCommandINSData[0] = ICC_FPG_FTC_SELECT_EF_INS;	/* INS */
		srAPDUData.uszCommandP1Data[0] = ICC_FPG_FTC_SELECT_EF_P1;		/* P1 */
		srAPDUData.uszCommandP2Data[0] = ICC_FPG_FTC_SELECT_EF_P2;		/* P2 */
		memcpy(&srAPDUData.uszCommandData[0], ICC_FPG_FTC_EFID_01, 2);
		srAPDUData.inCommandDataLen = 2;

		if (inAPDU_BuildAPDU(&srAPDUData) != VS_SUCCESS)
		{
			return (VS_ERROR);
		}

		/* 收送Command */
		inRetVal = inAPDU_Send_APDU_User_Slot_Process(&srAPDUData);
		if (inRetVal == VS_SUCCESS)
		{
			if (!(srAPDUData.uszRecevData[srAPDUData.inRecevLen -2] == 0x90 && srAPDUData.uszRecevData[srAPDUData.inRecevLen -1] == 0x00))
			{
				if (ginDebug == VS_TRUE)
					inLogPrintf(AT, "Response != 9000");
				/* 請檢查聯名卡 */
				pobTran->inErrorMsg = _ERROR_CODE_V3_FPG_FTC_ICC_CHECK_CARD;

				return (VS_ERROR);
			}
			else
			{
				if (ginDebug == VS_TRUE)
					inLogPrintf(AT, "select EF Success");
			}
		}
		else
		{
			/* SEND APDU FAIL */
			pobTran->inErrorMsg = _ERROR_CODE_V3_FISC_12_SEND_APDU_FAIL_;
			/* 下Command失敗 */
			if (ginDebug == VS_TRUE)
				inLogPrintf(AT, "APDU Command Error");

			return (inRetVal);
		}


		/* Read Record 基本資料檔【FE01】 */
		memset(&srAPDUData, 0x00, sizeof(srAPDUData));
		srAPDUData.uszCommandCLAData[0] = ICC_FPG_FTC_READ_RECORD_CLA;	/* CLA */
		srAPDUData.uszCommandINSData[0] = ICC_FPG_FTC_READ_RECORD_INS;	/* INS */
		srAPDUData.uszCommandP1Data[0] = ICC_FPG_FTC_READ_RECORD_P1;		/* P1 */
		srAPDUData.uszCommandP2Data[0] = ICC_FPG_FTC_READ_RECORD_P2;		/* P2 */
		srAPDUData.inCommandDataLen = 0;

		if (inAPDU_BuildAPDU(&srAPDUData) != VS_SUCCESS)
		{
			return (VS_ERROR);
		}

		/* 收送Command */
		inRetVal = inAPDU_Send_APDU_User_Slot_Process(&srAPDUData);
		if (inRetVal != VS_SUCCESS)
		{
			/* SEND APDU FAIL */
			pobTran->inErrorMsg = _ERROR_CODE_V3_FISC_12_SEND_APDU_FAIL_;
			/* 下Command失敗 */
			if (ginDebug == VS_TRUE)
				inLogPrintf(AT, "APDU Command Error");

			return (inRetVal);
		}
		else
		{
			if (!(srAPDUData.uszRecevData[srAPDUData.inRecevLen -2] == 0x90 && srAPDUData.uszRecevData[srAPDUData.inRecevLen -1] == 0x00))
			{
				if (ginDebug == VS_TRUE)
					inLogPrintf(AT, "Response != 9000");
				/* 請檢查聯名卡 */
				pobTran->inErrorMsg = _ERROR_CODE_V3_FPG_FTC_ICC_CHECK_CARD;

				return (VS_ERROR);
			}
			else
			{
				if (ginDebug == VS_TRUE)
					inLogPrintf(AT, "Read record Success");
				
				inCnt = 0;
				inCnt ++; /* Rec No */
				inCnt ++; /* Rec Len */
				memset(gsrFPG_FTC_Rec.usEFID, 0x00, sizeof(gsrFPG_FTC_Rec.usEFID));
				/* FE01_會員編號 */
				memset(szBCD, 0x00, sizeof(szBCD));
				memset(szASCII, 0x00, sizeof(szASCII));
				memcpy(&szBCD[0], &srAPDUData.uszRecevData[inCnt], 5);
				inFunc_BCD_to_ASCII(&szASCII[0], (unsigned char*)&szBCD[0], 5);
				memset(gsrFPG_FTC_Rec.usMemberNO, 0x00, sizeof(gsrFPG_FTC_Rec.usMemberNO));
				memcpy(&gsrFPG_FTC_Rec.usMemberNO[0], &szASCII[0], FPG_FTC_MEMBER_ID_SIZE);
				inCnt += 5;
				/* FE01_卡別 */
				memset(gsrFPG_FTC_Rec.usCardType, 0x00, sizeof(gsrFPG_FTC_Rec.usCardType));
				memcpy(&gsrFPG_FTC_Rec.usCardType[0], &srAPDUData.uszRecevData[inCnt], FPG_FTC_CARD_TYPE_SIZE);
				inCnt += FPG_FTC_CARD_TYPE_SIZE;
				/* FE01_身分代號 */
				memset(gsrFPG_FTC_Rec.usMemberCode, 0x00, sizeof(gsrFPG_FTC_Rec.usMemberCode));
				memcpy(&gsrFPG_FTC_Rec.usMemberCode[0], &srAPDUData.uszRecevData[inCnt], FPG_FTC_MEMBER_CODE_SIZE);
				inCnt += FPG_FTC_MEMBER_CODE_SIZE;
				/* FE01_等級 */
				memset(gsrFPG_FTC_Rec.usRange, 0x00, sizeof(gsrFPG_FTC_Rec.usRange));
				memcpy(&gsrFPG_FTC_Rec.usRange[0], &srAPDUData.uszRecevData[inCnt], FPG_FTC_RANGE_SIZE);
				inCnt += FPG_FTC_RANGE_SIZE;
				/* FE01_發票列印統編 */
				memset(gsrFPG_FTC_Rec.usInvoiceNO, 0x00, sizeof(gsrFPG_FTC_Rec.usInvoiceNO));
				memcpy(&gsrFPG_FTC_Rec.usInvoiceNO[0], &srAPDUData.uszRecevData[inCnt], FPG_FTC_INVOICE_NO_SIZE);
				inCnt += FPG_FTC_INVOICE_NO_SIZE;
				/* FE01_車號 */
				memset(gsrFPG_FTC_Rec.usCardNum, 0x00, sizeof(gsrFPG_FTC_Rec.usCardNum));
				memcpy(&gsrFPG_FTC_Rec.usCardNum[0], &srAPDUData.uszRecevData[inCnt], FPG_FTC_CARD_NUM_SIZE);
				inCnt += FPG_FTC_CARD_NUM_SIZE;
				/* FE01_油品代號 */
				memset(gsrFPG_FTC_Rec.usOilCode, 0x00, sizeof(gsrFPG_FTC_Rec.usOilCode));
				memcpy(&gsrFPG_FTC_Rec.usOilCode[0], &srAPDUData.uszRecevData[inCnt], FPG_FTC_OIL_CODE_SIZE);
				inCnt += FPG_FTC_OIL_CODE_SIZE;
				/* FE01_Basic_Data_1 */
				memset(gsrFPG_FTC_Rec.usBasicData1, 0x00, sizeof(gsrFPG_FTC_Rec.usBasicData1));
				memcpy(&gsrFPG_FTC_Rec.usBasicData1[0], &srAPDUData.uszRecevData[inCnt], FPG_FTC_BASIC_DATA_SIZE);
				inCnt += FPG_FTC_BASIC_DATA_SIZE;
			}
		}
		
		/* Read Balance【FE90】*/
		memset(&srAPDUData, 0x00, sizeof(srAPDUData));
		srAPDUData.uszCommandCLAData[0] = ICC_FPG_FTC_READ_BALANCE_CLA;	/* CLA */
		srAPDUData.uszCommandINSData[0] = ICC_FPG_FTC_READ_BALANCE_INS;	/* INS */
		srAPDUData.uszCommandP1Data[0] = ICC_FPG_FTC_READ_BALANCE_P1;		/* P1 */
		srAPDUData.uszCommandP2Data[0] = ICC_FPG_FTC_READ_BALANCE_90_P2;		/* P2 */
		srAPDUData.inCommandDataLen = 0;

		if (inAPDU_BuildAPDU(&srAPDUData) != VS_SUCCESS)
		{
			return (VS_ERROR);
		}

		/* 收送Command */
		inRetVal = inAPDU_Send_APDU_User_Slot_Process(&srAPDUData);
		if (inRetVal != VS_SUCCESS)
		{
			/* SEND APDU FAIL */
			pobTran->inErrorMsg = _ERROR_CODE_V3_FISC_12_SEND_APDU_FAIL_;
			/* 下Command失敗 */
			if (ginDebug == VS_TRUE)
				inLogPrintf(AT, "APDU Command Error");

			return (inRetVal);
		}
		else
		{
			if (!(srAPDUData.uszRecevData[srAPDUData.inRecevLen -2] == 0x90 && srAPDUData.uszRecevData[srAPDUData.inRecevLen -1] == 0x00))
			{
				if (ginDebug == VS_TRUE)
					inLogPrintf(AT, "Response != 9000");
				/* 請檢查聯名卡 */
				pobTran->inErrorMsg = _ERROR_CODE_V3_FPG_FTC_ICC_CHECK_CARD;

				return (VS_ERROR);
			}
			else
			{
				if (ginDebug == VS_TRUE)
					inLogPrintf(AT, "Read Balance Success");
			}
		}

		/* Read Balance【FE91】*/
		memset(&srAPDUData, 0x00, sizeof(srAPDUData));
		srAPDUData.uszCommandCLAData[0] = ICC_FPG_FTC_READ_BALANCE_CLA;	/* CLA */
		srAPDUData.uszCommandINSData[0] = ICC_FPG_FTC_READ_BALANCE_INS;	/* INS */
		srAPDUData.uszCommandP1Data[0] = ICC_FPG_FTC_READ_BALANCE_P1;		/* P1 */
		srAPDUData.uszCommandP2Data[0] = ICC_FPG_FTC_READ_BALANCE_91_P2;		/* P2 */
		srAPDUData.inCommandDataLen = 0;

		if (inAPDU_BuildAPDU(&srAPDUData) != VS_SUCCESS)
		{
			return (VS_ERROR);
		}

		/* 收送Command */
		inRetVal = inAPDU_Send_APDU_User_Slot_Process(&srAPDUData);
		if (inRetVal != VS_SUCCESS)
		{
			/* SEND APDU FAIL */
			pobTran->inErrorMsg = _ERROR_CODE_V3_FISC_12_SEND_APDU_FAIL_;
			/* 下Command失敗 */
			if (ginDebug == VS_TRUE)
				inLogPrintf(AT, "APDU Command Error");

			return (inRetVal);
		}
		else
		{
			if (!(srAPDUData.uszRecevData[srAPDUData.inRecevLen -2] == 0x90 && srAPDUData.uszRecevData[srAPDUData.inRecevLen -1] == 0x00))
			{
				if (ginDebug == VS_TRUE)
					inLogPrintf(AT, "Response != 9000");
				/* 請檢查聯名卡 */
				pobTran->inErrorMsg = _ERROR_CODE_V3_FPG_FTC_ICC_CHECK_CARD;

				return (VS_ERROR);
			}
			else
			{
				if (ginDebug == VS_TRUE)
					inLogPrintf(AT, "Read Balance FE91 Success");
			}
		}

		/* Select EF 基本資料檔【FE02】 */
		memset(&srAPDUData, 0x00, sizeof(srAPDUData));
		srAPDUData.uszCommandCLAData[0] = ICC_FPG_FTC_READ_RECORD_CLA;	/* CLA */
		srAPDUData.uszCommandINSData[0] = ICC_FPG_FTC_READ_RECORD_INS;	/* INS */
		srAPDUData.uszCommandP1Data[0] = ICC_FPG_FTC_READ_RECORD_P1;		/* P1 */
		srAPDUData.uszCommandP2Data[0] = ICC_FPG_FTC_READ_RECORD_P2;		/* P2 */
		srAPDUData.inCommandDataLen = 0;

		if (inAPDU_BuildAPDU(&srAPDUData) != VS_SUCCESS)
		{
			return (VS_ERROR);
		}

		/* 收送Command */
		inRetVal = inAPDU_Send_APDU_User_Slot_Process(&srAPDUData);
		if (inRetVal != VS_SUCCESS)
		{
			/* SEND APDU FAIL */
			pobTran->inErrorMsg = _ERROR_CODE_V3_FISC_12_SEND_APDU_FAIL_;
			/* 下Command失敗 */
			if (ginDebug == VS_TRUE)
				inLogPrintf(AT, "APDU Command Error");

			return (inRetVal);
		}
		else
		{
			if (!(srAPDUData.uszRecevData[srAPDUData.inRecevLen -2] == 0x90 && srAPDUData.uszRecevData[srAPDUData.inRecevLen -1] == 0x00))
			{
				if (ginDebug == VS_TRUE)
					inLogPrintf(AT, "Response != 9000");
				/* 請檢查聯名卡 */
				pobTran->inErrorMsg = _ERROR_CODE_V3_FPG_FTC_ICC_CHECK_CARD;

				return (VS_ERROR);
			}
			else
			{
				if (ginDebug == VS_TRUE)
					inLogPrintf(AT, "Read record  FE02 Success");
				
				inCnt = 0;
				inCnt ++; /* Rec No */
				inCnt ++; /* Rec Len */
				/* FE02_姓名 */
				memset(gsrFPG_FTC_Rec.usCustName, 0x00, sizeof(gsrFPG_FTC_Rec.usMemberNO));
				memcpy(&gsrFPG_FTC_Rec.usCustName[0], &srAPDUData.uszRecevData[inCnt], FPG_FTC_FE02_CUSTOMER_NAME_SIZE);
				inCnt += FPG_FTC_FE02_CUSTOMER_NAME_SIZE;
				/* FE02_生日 */
				memset(szBCD, 0x00, sizeof(szBCD));
				memset(szASCII, 0x00, sizeof(szASCII));
				memcpy(&szBCD[0], &srAPDUData.uszRecevData[inCnt], 4);
				inFunc_BCD_to_ASCII(&szASCII[0], (unsigned char*)&szBCD[0], 4);
				memset(gsrFPG_FTC_Rec.usBirthday, 0x00, sizeof(gsrFPG_FTC_Rec.usMemberNO));
				memcpy(&gsrFPG_FTC_Rec.usBirthday[0], &szASCII[0], FPG_FTC_BIRTHDAY_SIZE);
				inCnt += 4;
				/* FE02_會員卡號 */
				memset(szBCD, 0x00, sizeof(szBCD));
				memset(szASCII, 0x00, sizeof(szASCII));
				memcpy(&szBCD[0], &srAPDUData.uszRecevData[inCnt], 5);
				inFunc_BCD_to_ASCII(&szASCII[0], (unsigned char*)&szBCD[0], 5);
				memset(gsrFPG_FTC_Rec.usMemberID, 0x00, sizeof(gsrFPG_FTC_Rec.usMemberNO));
				memcpy(&gsrFPG_FTC_Rec.usMemberID[0], &szASCII[0], FPG_FTC_MEMBER_ID_SIZE);
				inCnt += 5;
			}
		}
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_ICC_FPG_FTC_GetChipCardData() END !");
		inLogPrintf(AT, "----------------------------------------");
	}

	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_ICC_FPG_FTC_GetChipCardBalanceData
Date&Time       :2022/9/29 下午 8:44
Describe        :客製化【005】、【006】聯名卡晶片資料用
*/
int inNCCC_Func_ICC_FPG_FTC_GetChipCardBalanceData(TRANSACTION_OBJECT *pobTran, char *szEFID)
{
	int		inRetVal = VS_ERROR;
	char		szBCD[8] = {0};
	APDU_COMMAND	srAPDUData = {};

	/* Pack FEID */
	memset(szBCD, 0x00, sizeof(szBCD));
	inFunc_ASCII_to_BCD((unsigned char*)&szBCD[0], &szEFID[0], 4);
	/* Read Balance【FE90】*/
	memset(&srAPDUData, 0x00, sizeof(srAPDUData));
	srAPDUData.uszCommandCLAData[0] = ICC_FPG_FTC_READ_BALANCE_CLA;		/* CLA */
	srAPDUData.uszCommandINSData[0] = ICC_FPG_FTC_READ_BALANCE_INS;		/* INS */
	srAPDUData.uszCommandP1Data[0] = szBCD[0];		/* P1 */
	srAPDUData.uszCommandP2Data[0] = szBCD[1];		/* P2 */
	srAPDUData.inCommandDataLen = 0;

	if (inAPDU_BuildAPDU(&srAPDUData) != VS_SUCCESS)
	{
		return (VS_ERROR);
	}

	/* 收送Command */
	inRetVal = inAPDU_Send_APDU_User_Slot_Process(&srAPDUData);
	if (inRetVal != VS_SUCCESS)
	{
		/* SEND APDU FAIL */
		pobTran->inErrorMsg = _ERROR_CODE_V3_FISC_12_SEND_APDU_FAIL_;
		/* 下Command失敗 */
		if (ginDebug == VS_TRUE)
			inLogPrintf(AT, "APDU Command Error");

		return (inRetVal);
	}
	else
	{
		if (!(srAPDUData.uszRecevData[srAPDUData.inRecevLen -2] == 0x90 && srAPDUData.uszRecevData[srAPDUData.inRecevLen -1] == 0x00))
		{
			if (ginDebug == VS_TRUE)
				inLogPrintf(AT, "Response != 9000");
			/* 請檢查聯名卡 */
			pobTran->inErrorMsg = _ERROR_CODE_V3_FPG_FTC_ICC_CHECK_CARD;

			return (VS_ERROR);
		}
		else
		{
			if (ginDebug == VS_TRUE)
				inLogPrintf(AT, "Read Balance Success");
			
			memset(gsrFPG_FTC_Rec.usEFID1, 0x00, sizeof(gsrFPG_FTC_Rec.usEFID1));
			memcpy(&gsrFPG_FTC_Rec.usEFID1[0], &srAPDUData.uszRecevData[0], 8);
		}
	}

	/* Read Balance【FE91】*/
	memset(&srAPDUData, 0x00, sizeof(srAPDUData));
	srAPDUData.uszCommandCLAData[0] = ICC_FPG_FTC_READ_BALANCE_CLA;		/* CLA */
	srAPDUData.uszCommandINSData[0] = ICC_FPG_FTC_READ_BALANCE_INS;		/* INS */
	srAPDUData.uszCommandP1Data[0] = szBCD[2];		/* P1 */
	srAPDUData.uszCommandP2Data[0] = szBCD[3];		/* P2 */
	srAPDUData.inCommandDataLen = 0;
	
	
	if (inAPDU_BuildAPDU(&srAPDUData) != VS_SUCCESS)
	{
		return (VS_ERROR);
	}

	/* 收送Command */
	inRetVal = inAPDU_Send_APDU_User_Slot_Process(&srAPDUData);
	if (inRetVal != VS_SUCCESS)
	{
		/* SEND APDU FAIL */
		pobTran->inErrorMsg = _ERROR_CODE_V3_FISC_12_SEND_APDU_FAIL_;
		/* 下Command失敗 */
		if (ginDebug == VS_TRUE)
			inLogPrintf(AT, "APDU Command Error");

		return (inRetVal);
	}
	else
	{
		if (!(srAPDUData.uszRecevData[srAPDUData.inRecevLen -2] == 0x90 && srAPDUData.uszRecevData[srAPDUData.inRecevLen -1] == 0x00))
		{
			if (ginDebug == VS_TRUE)
				inLogPrintf(AT, "Response != 9000");
			/* 請檢查聯名卡 */
			pobTran->inErrorMsg = _ERROR_CODE_V3_FPG_FTC_ICC_CHECK_CARD;

			return (VS_ERROR);
		}
		else
		{
			if (ginDebug == VS_TRUE)
				inLogPrintf(AT, "Read Balance Success");
			
			memset(gsrFPG_FTC_Rec.usEFID2, 0x00, sizeof(gsrFPG_FTC_Rec.usEFID2));
			memcpy(&gsrFPG_FTC_Rec.usEFID2[0], &srAPDUData.uszRecevData[0], 8);
		}
	}

	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Display_Review_Settle_TAKA
Date&Time       :2022/10/17 下午 2:29
Describe        :
*/
int inNCCC_Func_Display_Review_Settle_TAKA(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_SUCCESS;
	int		inChoice = 0;
	int		inTouchSensorFunc = _Touch_BATCH_END_;
	char		szTemplate1[44 + 1] = {0};
	char		szTemplate2[44 + 1] = {0};
	char		szDispBuffer1[44 + 1] = {0};
	char		szDispBuffer2[44 + 1] = {0};
	long long	llSum = 0;
	unsigned char	uszKey = 0x00;
	TAKA_ACCUM_TOTAL_REC	srAccumRec = {0};
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Display_Review_Settle_TAKA() START !");
	}
	
	/* 讀交易資料，並放交易查詢Title */
	memset(&srAccumRec, 0x00, sizeof(srAccumRec));
	inACCUM_GetRecord_General(pobTran, &srAccumRec, sizeof(TAKA_ACCUM_TOTAL_REC));
	inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
	inDISP_PutGraphic(_REVIEW_SETTLE_, 0, _COORDINATE_Y_LINE_8_4_);
	
	/* 聯合版本五卡合一，AMEX走NCCC */

	/* 銷售筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.lnTotalSaleCount;

	sprintf(szTemplate1, "%03lld", llSum);	
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 7);

	/* 銷售金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	/* NCCC的要分別加起來 */
	/* 若總金額大於等於9位數，則縮小字體 */
	llSum = srAccumRec.llTotalSaleAmount;
	if (abs(llSum) < 100000000)
	{
		sprintf(szTemplate2, "%01lld", llSum);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01lld", llSum);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}

	/* 退貨筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.lnTotalRefundCount;

	sprintf(szTemplate1, "%03lld", llSum);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 7);
	
	/* 退貨金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.llTotalRefundAmount;
	if (abs(llSum) < 100000000)
	{
		sprintf(szTemplate2, "%01lld", (0 - llSum));
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01lld", (0 - llSum));
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}

	/* 淨額筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.lnTotalCount;

	sprintf(szTemplate1, "%03lld", llSum);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 7);
	
	/* 淨額金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.llTotalAmount;
	if (abs(llSum) < 100000000)
	{
		sprintf(szTemplate2, "%01lld", llSum);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 11, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 10);
	}
	else
	{
		sprintf(szTemplate2, "%01lld", llSum);
		inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
		sprintf(szDispBuffer2, "%s", szTemplate2);
		inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	}

	inDISP_Timer_Start(_TIMER_NEXSYS_1_, _EDC_TIMEOUT_);
	
	uszKey = 0x00;
	while (1)
	{
		inChoice = inDisTouch_TouchSensor_Click_Slide(inTouchSensorFunc);
		uszKey = uszKBD_Key();

		/* Timeout */
		if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
		{
			uszKey = _KEY_TIMEOUT_;
		}

		if (uszKey == _KEY_CANCEL_)
		{
			inRetVal = VS_USER_CANCEL;
			break;
		}
		else if (uszKey == _KEY_TIMEOUT_)
		{
			inRetVal = VS_TIMEOUT;
			break;
		}
		else if (inChoice == _BATCH_END_Touch_ENTER_BUTTON_	||
			 uszKey == _KEY_0_)
		{
			inRetVal = VS_SUCCESS;
			break;
		}
	}
	/* 清空Touch資料 */
	inDisTouch_Flush_TouchFile();
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Display_Review_Settle_TAKA() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Display_Review_TAKA
Date&Time       :2022/10/17 下午 2:23
Describe        :
*/
int inNCCC_Func_Display_Review_TAKA(TRANSACTION_OBJECT *pobTran)
{
	int		inRetVal = VS_SUCCESS;
	int		inChoice = 0;
	int		inTouchSensorFunc = _Touch_NEWUI_REVIEW_TOTAL_;
	char		szTemplate1[44 + 1] = {0};
	char		szTemplate2[44 + 1] = {0};
	char		szDispBuffer1[44 + 1] = {0};
	char		szDispBuffer2[44 + 1] = {0};
	long long	llSum = 0;
	unsigned char	uszKey = 0x00;
	TAKA_ACCUM_TOTAL_REC	srAccumRec = {0};
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Display_Review_TAKA() START !");
	}
	
	/* 讀交易資料，並放交易查詢Title */
	memset(&srAccumRec, 0x00, sizeof(srAccumRec));
	inACCUM_GetRecord_General(pobTran, &srAccumRec, sizeof(TAKA_ACCUM_TOTAL_REC));
	inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
	inDISP_PutGraphic(_REVIEW_TOTAL_2_, 0, _COORDINATE_Y_LINE_8_4_);
	if (ginHalfLCD == VS_TRUE)
	{

	}
	else
	{
		if (guszNoChooseHostBit != VS_TRUE)
		{
			inDISP_PutGraphic(_ICON_BUTTON_LAST_PAGE_, _Distouch_NEWUI_LAST_PAGE_BUTTON_X1_, _Distouch_NEWUI_LAST_PAGE_BUTTON_Y1_);
		}
		inDISP_PutGraphic(_ICON_BUTTON_RETURN_IDLE_, _Distouch_NEWUI_RETURN_IDLE_BUTTON_X1_, _Distouch_NEWUI_RETURN_IDLE_BUTTON_Y1_);
	}
	
	/* 聯合版本五卡合一，AMEX走NCCC */

	/* 銷售筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.lnTotalSaleCount;

	sprintf(szTemplate1, "%03lld", llSum);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 7);

	/* 銷售金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.llTotalSaleAmount;

        sprintf(szTemplate2, "%01lld", llSum);
        inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
        sprintf(szDispBuffer2, "%s", szTemplate2);
        inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_4_, _COLOR_BLACK_,_COLOR_WHITE_, 13);

	/* 退貨筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.lnTotalRefundCount;

	sprintf(szTemplate1, "%03lld", llSum);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 7);
	
	/* 退貨金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.llTotalRefundAmount;
        
        sprintf(szTemplate2, "%01lld", (0 - llSum));
        inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
        sprintf(szDispBuffer2, "%s", szTemplate2);
        inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_5_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	
	/* 淨額筆數 */
	memset(szDispBuffer1, 0x00, sizeof(szDispBuffer1));
	memset(szTemplate1, 0x00, sizeof(szTemplate1));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.lnTotalCount;

	sprintf(szTemplate1, "%03lld", llSum);
	sprintf(szDispBuffer1, "%s", szTemplate1);
	inDISP_EnglishFont_Point_Color(szDispBuffer1, _FONTSIZE_8X22_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 7);

	/* 淨額金額 */
	memset(szDispBuffer2, 0x00, sizeof(szDispBuffer2));
	memset(szTemplate2, 0x00, sizeof(szTemplate2));

	/* NCCC的要分別加起來 */
	llSum = srAccumRec.llTotalAmount;

        sprintf(szTemplate2, "%01lld", llSum);
        inFunc_Amount_Comma(szTemplate2, "$", ' ', _SIGNED_NONE_, 14, _PADDING_LEFT_);
        sprintf(szDispBuffer2, "%s", szTemplate2);
        inDISP_EnglishFont_Point_Color(szDispBuffer2, _FONTSIZE_8X33_, _LINE_8_6_, _COLOR_BLACK_,_COLOR_WHITE_, 13);
	
	uszKey = 0x00;
	inTouchSensorFunc = _Touch_NEWUI_REVIEW_TOTAL_;
	inDISP_Timer_Start(_TIMER_NEXSYS_1_, _EDC_TIMEOUT_);
	
	while (1)
	{
		inChoice = inDisTouch_TouchSensor_Click_Slide(inTouchSensorFunc);
		uszKey = uszKBD_Key();
		
		/* Timeout */
		if (inTimerGet(_TIMER_NEXSYS_1_) == VS_SUCCESS)
		{
			uszKey = _KEY_TIMEOUT_;
		}

		if (uszKey == _KEY_ENTER_)
		{
			inRetVal = VS_SUCCESS;
			break;
		}
		else if (inChoice == _NEWUI_REVIEW_TOTAL_Touch_RETURN_IDLE_BUTTON_	||
			 uszKey == _KEY_CANCEL_)
		{
			inRetVal = VS_ERROR;
			break;
		}
		else if (uszKey == _KEY_TIMEOUT_)
		{
			inRetVal = VS_TIMEOUT;
			break;
		}
		else if (inChoice == _NEWUI_REVIEW_TOTAL_Touch_LAST_PAGE_BUTTON_	||
			 uszKey == _KEY_CLEAR_)
		{
			if (guszNoChooseHostBit != VS_TRUE)
			{
				inRetVal = VS_LAST_PAGE;
				pobTran->srBRec.inHDTIndex = -1;
				break;
			}
		}
	}
	/* 清空Touch資料 */
	inDisTouch_Flush_TouchFile();
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Display_Review_TAKA() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Get_POS_ID
Date&Time       :2022/10/17 下午 8:10
Describe        :
*/
int inNCCC_Func_Get_POS_ID()
{
	int	inRetVal = VS_SUCCESS;
	char	szPOS_ID[6 + 1] = {0};
	char	szNew_POS_ID[6 + 1] = {0};
	
	while (1)
	{
		inDISP_ClearAll();
		
		memset(szPOS_ID, 0x00, sizeof(szPOS_ID));
		inGetPOS_ID(szPOS_ID);
		inDISP_ChineseFont("POS_ID", _FONTSIZE_8X16_, _LINE_8_2_, _DISP_LEFT_);
		inDISP_ChineseFont_Color(szPOS_ID, _FONTSIZE_8X16_, _LINE_8_3_, _COLOR_RED_, _DISP_LEFT_);
		inDISP_ChineseFont("NEW POS_ID?", _FONTSIZE_8X16_, _LINE_8_5_, _DISP_LEFT_);
		
		DISPLAY_OBJECT srDispObj;
		memset(&srDispObj, 0x00, DISPLAY_OBJECT_SIZE);

		/* 設定顯示變數 */
		srDispObj.inMaxLen = 6;
		srDispObj.inY = _LINE_8_7_;
		srDispObj.inR_L = _DISP_RIGHT_;
		srDispObj.inColor = _COLOR_RED_;

		memset(srDispObj.szOutput, 0x00, sizeof(srDispObj.szOutput));
		srDispObj.inOutputLen = 0;

		inRetVal = inDISP_Enter8x16(&srDispObj);
		if (inRetVal == VS_TIMEOUT)
		{
			break;
		}
		else if (inRetVal == VS_USER_CANCEL)
		{
			break;
		}
		else if (srDispObj.inOutputLen > 0 && memcmp(srDispObj.szOutput, "000000", srDispObj.inOutputLen))
		{
			memset(szNew_POS_ID, 0x00, sizeof(szNew_POS_ID));
			memset(szNew_POS_ID, 0x20, 6);
			memcpy(szNew_POS_ID, srDispObj.szOutput, srDispObj.inOutputLen);
			inSetPOS_ID(szNew_POS_ID);
			inSaveEDCRec(0);
		}
	}
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Find_SAM_TID
Date&Time       :2022/12/1 上午 11:37
Describe        :用註冊命令找TID（要確定該SAM已註冊過）
*/
int inNCCC_Func_Find_SAM_TID(void)
{
	int		i = 0;
	int		inRetVal2 = VS_SUCCESS;
	char		szTID1[8 + 1] = {0};
	char		szTID2[8 + 1] = {0};
	char		szTIDNow[8 + 1] = {0};
	char		szTIDNow_Hex[8 + 1] = {0};
	char		szMessage[100 + 1] = {0};
	unsigned char	uszSlot = _SAM_SLOT_1_;
	unsigned char	uszKey = 0x00;
	
	inDISP_ClearAll();
	do
	{
		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		inDISP_ChineseFont("請確認該SAM卡已註冊過", _FONTSIZE_8X22_, _LINE_8_4_, _DISP_CENTER_);
		inDISP_ChineseFont("否則請按取消", _FONTSIZE_8X22_, _LINE_8_5_, _DISP_CENTER_);
		uszKey = uszKBD_GetKey(30);
		if (uszKey == _KEY_TIMEOUT_ || uszKey == _KEY_CANCEL_)
		{
			break;
		}
		
		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		inDISP_ChineseFont("請選SAM SLOT(1~4)", _FONTSIZE_8X22_, _LINE_8_4_, _DISP_CENTER_);
		uszKey = uszKBD_GetKey(30);
		if (uszKey == _KEY_TIMEOUT_ || uszKey == _KEY_CANCEL_)
		{
			break;
		}
		else
		{
			if (uszKey == _KEY_1_)
			{
				uszSlot = _SAM_SLOT_1_;
			}
			else if (uszKey == _KEY_2_)
			{
				uszSlot = _SAM_SLOT_2_;
			}
			else if (uszKey == _KEY_3_)
			{
				uszSlot = _SAM_SLOT_3_;
			}
			else if (uszKey == _KEY_4_)
			{
				uszSlot = _SAM_SLOT_4_;
			}
			else
			{
				break;
			}
		}
		
		DISPLAY_OBJECT  srDispObj;
		memset(&srDispObj, 0x00, sizeof(DISPLAY_OBJECT));
		/* 不可輸入0，不可ByPass */
		srDispObj.inY = _LINE_8_7_;
		srDispObj.inR_L = _DISP_RIGHT_;
		srDispObj.inCanNotBypass = VS_TRUE;
		srDispObj.inColor = _COLOR_RED_;
		srDispObj.inMaxLen = 8;

		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		inDISP_ChineseFont("請輸入起始端代", _FONTSIZE_8X16_, _LINE_8_4_, _DISP_CENTER_);
		inRetVal2 = inDISP_Enter8x16(&srDispObj);
		if (inRetVal2 == VS_TIMEOUT || inRetVal2 == VS_USER_CANCEL)
		{
			break;
		}
		else
		{
			sprintf(szTID1, srDispObj.szOutput);
		}

		memset(&srDispObj, 0x00, sizeof(DISPLAY_OBJECT));
		/* 不可輸入0，不可ByPass */
		srDispObj.inY = _LINE_8_7_;
		srDispObj.inR_L = _DISP_RIGHT_;
		srDispObj.inCanNotBypass = VS_TRUE;
		srDispObj.inColor = _COLOR_RED_;
		srDispObj.inMaxLen = 8;

		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		inDISP_ChineseFont("請輸入結束端代", _FONTSIZE_8X16_, _LINE_8_4_, _DISP_CENTER_);
		inRetVal2 = inDISP_Enter8x16(&srDispObj);
		if (inRetVal2 == VS_TIMEOUT || inRetVal2 == VS_USER_CANCEL)
		{
			break;
		}
		else
		{
			sprintf(szTID2, srDispObj.szOutput);
		}

		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		for (i = atoi(szTID1); i <= atoi(szTID2); i++)
		{
			sprintf((char*)szTIDNow, "%08d", i);
			inDISP_ChineseFont((char*)szTIDNow, _FONTSIZE_8X16_, _LINE_8_6_, _DISP_CENTER_);
			memset(szTIDNow_Hex, 0x00, sizeof(szTIDNow_Hex));
			inFunc_ASCII_to_BCD((unsigned char*)szTIDNow_Hex, szTIDNow, 4);
			if (inNCCC_tSAM_APDURegisterTID(uszSlot, (unsigned char*)szTIDNow_Hex) == VS_SUCCESS)
			{
				sprintf(szMessage, "SAM is %s", szTIDNow);
				inDISP_ChineseFont(szMessage, _FONTSIZE_8X16_, _LINE_8_7_, _DISP_CENTER_);
				break;
			}
			else
			{
				if (i == atoi(szTID2))
				{
					inDISP_ChineseFont("No TID Match", _FONTSIZE_8X16_, _LINE_8_7_, _DISP_CENTER_);
					break;
				}
			}
		}
		uszKBD_GetKey(30);

		break;
	}while(1);
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Beep_After_Auth
Date&Time       :2023/6/20 下午 4:04
Describe        :考慮到EMV流程和其他非交易流程都可能送電文，決定獨立出來，避免搞混流程
*/
int inNCCC_Func_Beep_After_Auth(TRANSACTION_OBJECT* pobTran)
{
	char	szCustomIndicator[3 + 1] = {0};
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Beep_After_Auth START!");
	
	memset(szCustomIndicator, 0x00, sizeof(szCustomIndicator));
	inGetCustomIndicator(szCustomIndicator);
	/* (需求單-112101)-IKEA新增客製化參數需 by Russell 2023/6/20 下午 3:44 */
	/* 主機回覆授權加入提示音 */
	if (!memcmp(szCustomIndicator, _CUSTOMER_INDICATOR_123_IKEA_, _CUSTOMER_INDICATOR_SIZE_) ||
	    !memcmp(szCustomIndicator, _CUSTOMER_INDICATOR_124_EVER_RICH_, _CUSTOMER_INDICATOR_SIZE_))
	{
		inDISP_BEEP(1, 0);
	}
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Beep_After_Auth END!");
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Get_STAN_Flow
Date&Time       :2023/6/20 下午 1:44
Describe        :
*/
int inNCCC_Func_Get_STAN_Flow(TRANSACTION_OBJECT * pobTran)
{
	int	inRetVal = VS_ERROR;
	int	inNCCCIndex = -1;
	int	inDCCIndex = -1;
	int	inTAKAIndex = -1;
	char	szDebugMsg[100 + 1] = {0};
	char	szFesMode[2 + 1] = {0};
	char	szCFESMode[2 + 1] = {0};
	
	if (ginFindRunTime == VS_TRUE)
	{
		inFunc_RecordTime_Append("%d %s", __LINE__, __FUNCTION__);
	}
	
	memset(szFesMode, 0x00, sizeof(szFesMode));
	inGetNCCCFESMode(szFesMode);
	memset(szCFESMode, 0x00, sizeof(szCFESMode));
	inGetCloud_MFES(szCFESMode);
	
	inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_CREDIT_NCCC_, &inNCCCIndex);
	inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_DCC_, &inDCCIndex);
	inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_TAKA_, &inTAKAIndex);
	
	if (pobTran->srBRec.inHDTIndex == inNCCCIndex)
	{
		if (memcmp(szFesMode, _NCCC_03_MFES_MODE_, 2) == 0)
		{
			if (pobTran->srBRec.uszDCCTransBit == VS_TRUE)
			{
				inRetVal = inNCCC_DCC_GetSTAN(pobTran);
			}
			else
			{
				/* (需求單 - 107276)自助交易標準做法 by Russell 2019/3/6 上午 10:32 */
				if (memcmp(szCFESMode, "Y", strlen("Y")) == 0)
				{
					inRetVal = inNCCC_ATS_GetSTAN(pobTran);
				}
				else
				{
					inRetVal = inNCCC_MFES_GetSTAN(pobTran);
				}
			}
		}
		else if (memcmp(szFesMode, _NCCC_05_ATS_MODE_, 2) == 0	||
			 memcmp(szFesMode, _NCCC_04_MPAS_MODE_, 2) == 0)
		{
			if (pobTran->srBRec.uszDCCTransBit == VS_TRUE)
			{
				inRetVal = inNCCC_DCC_GetSTAN(pobTran);
			}
			else
			{
				inRetVal = inNCCC_ATS_GetSTAN(pobTran);
			}
		}
		else
		{
			if (ginDebug == VS_TRUE)
			{
				memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
				sprintf(szDebugMsg, "inNCCC_Func_Get_STAN_Flow :無此FES 流程 :%s", szFesMode);
				inLogPrintf(AT, szDebugMsg);
			}
			inRetVal = VS_ERROR;
		}
		
		return (inRetVal);
	}
	else if (pobTran->srBRec.inHDTIndex == inDCCIndex)
	{
		inRetVal = inNCCC_DCC_GetSTAN(pobTran);
		
		return (inRetVal);
	}
	else if (pobTran->srBRec.inHDTIndex == inTAKAIndex)
	{
		inRetVal = inTAKA_GetSTAN(pobTran);
		
		return (inRetVal);
	}
	else
	{
		if (ginDebug == VS_TRUE)
		{
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "inNCCC_Func_Get_STAN_Flow :無此HDT流程 :%d", pobTran->srBRec.inHDTIndex);
			inLogPrintf(AT, szDebugMsg);
		}
		return (VS_ERROR);
	}
	
}

/*
Function        :inNCCC_Func_Set_STAN_Flow
Date&Time       :2023/6/20 下午 1:44
Describe        :
*/
int inNCCC_Func_Set_STAN_Flow(TRANSACTION_OBJECT * pobTran)
{
	int	inRetVal = VS_ERROR;
	int	inNCCCIndex = -1;
	int	inDCCIndex = -1;
	int	inTAKAIndex = -1;
	char	szDebugMsg[100 + 1] = {0};
	char	szFesMode[2 + 1] = {0};
	char	szCFESMode[2 + 1] = {0};
	
	if (ginFindRunTime == VS_TRUE)
	{
		inFunc_RecordTime_Append("%d %s", __LINE__, __FUNCTION__);
	}
	
	memset(szFesMode, 0x00, sizeof(szFesMode));
	inGetNCCCFESMode(szFesMode);
	memset(szCFESMode, 0x00, sizeof(szCFESMode));
	inGetCloud_MFES(szCFESMode);
	
	inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_CREDIT_NCCC_, &inNCCCIndex);
	inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_DCC_, &inDCCIndex);
	inFunc_Find_Specific_HDTindex(pobTran->srBRec.inHDTIndex, _HOST_NAME_TAKA_, &inTAKAIndex);
	
	if (pobTran->srBRec.inHDTIndex == inNCCCIndex)
	{
		if (memcmp(szFesMode, _NCCC_03_MFES_MODE_, 2) == 0)
		{
			if (pobTran->srBRec.uszDCCTransBit == VS_TRUE)
			{
				inRetVal = inNCCC_DCC_SetSTAN(pobTran);
			}
			else
			{
				/* (需求單 - 107276)自助交易標準做法 by Russell 2019/3/6 上午 10:32 */
				if (memcmp(szCFESMode, "Y", strlen("Y")) == 0)
				{
					inRetVal = inNCCC_ATS_SetSTAN(pobTran);
				}
				else
				{
					inRetVal = inNCCC_MFES_SetSTAN(pobTran);
				}
			}
		}
		else if (memcmp(szFesMode, _NCCC_05_ATS_MODE_, 2) == 0	||
			 memcmp(szFesMode, _NCCC_04_MPAS_MODE_, 2) == 0)
		{
			if (pobTran->srBRec.uszDCCTransBit == VS_TRUE)
			{
				inRetVal = inNCCC_DCC_SetSTAN(pobTran);
			}
			else
			{
				inRetVal = inNCCC_ATS_SetSTAN(pobTran);
			}
		}
		else
		{
			if (ginDebug == VS_TRUE)
			{
				memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
				sprintf(szDebugMsg, "inNCCC_Func_Set_STAN_Flow :無此FES 流程 :%s", szFesMode);
				inLogPrintf(AT, szDebugMsg);
			}
			inRetVal = VS_ERROR;
		}
		
		return (inRetVal);
	}
	else if (pobTran->srBRec.inHDTIndex == inDCCIndex)
	{
		inRetVal = inNCCC_DCC_SetSTAN(pobTran);
		
		return (inRetVal);
	}
	else if (pobTran->srBRec.inHDTIndex == inTAKAIndex)
	{
		inRetVal = inTAKA_SetSTAN(pobTran);
		
		return (inRetVal);
	}
	else
	{
		if (ginDebug == VS_TRUE)
		{
			memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
			sprintf(szDebugMsg, "inNCCC_Func_Set_STAN_Flow :無此HDT流程 :%d", pobTran->srBRec.inHDTIndex);
			inLogPrintf(AT, szDebugMsg);
		}
		return (VS_ERROR);
	}
	
}

/*
Function        :inNCCC_Func_Check_Update_Batch_Num
Date&Time       :2023/8/18 下午 4:47
Describe        :
*/
int inNCCC_Func_Check_Update_Batch_Num(TRANSACTION_OBJECT* pobTran)
{
	int	inRetVal = VS_SUCCESS;
        
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Update_Batch_Num START!");
	
	if (pobTran->uszUpdateBatchNumBit == VS_TRUE)
	{
		pobTran->uszUpdateBatchNumBit = VS_FALSE;
		inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_UPDATE_BATCH_NUM_);
	}
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Customer_123_Edit_Signpad_Beep_Interval
Date&Time       :2023/9/1 下午 6:56
Describe        :
*/
int inNCCC_Func_Customer_123_Edit_Signpad_Beep_Interval()
{
	int		inRetVal = VS_SUCCESS;
	int		inInterval_Unit = 10;
	int		inSignpad_Beep_Interval_Now = 0;
	int		inSignpad_Beep_Interval_Set = 0;
	int		inSignpad_Beep_Interval_MAX = atoi(_SIGNPAD_BEEP_INTERVAL_CUS_123_MAX_);
	int		inSignpad_Beep_Interval_MIN = atoi(_SIGNPAD_BEEP_INTERVAL_CUS_123_MIN_);
	char		szSignpad_Beep_Interval[3 + 1] = {0};
	char		szTemplate[50 + 1] = {0};
	unsigned char	uszKey = 0x00;
	
	inRetVal = VS_SUCCESS;
	
	memset(szSignpad_Beep_Interval, 0x00, sizeof(szSignpad_Beep_Interval));
	inGetSignpadBeepInterval(szSignpad_Beep_Interval);
	inSignpad_Beep_Interval_Set = atoi(szSignpad_Beep_Interval);
	inSignpad_Beep_Interval_Now = atoi(szSignpad_Beep_Interval);
	
	inDISP_ClearAll();
	do
	{
		memset(szTemplate, 0x00, sizeof(szTemplate));
		sprintf(szTemplate, "當前時間間隔:%d.%01d s", inSignpad_Beep_Interval_Now / 100, (inSignpad_Beep_Interval_Now % 100) / 10);
		inDISP_ChineseFont(szTemplate, _FONTSIZE_8X33_, _LINE_8_4_, _DISP_LEFT_);
		memset(szTemplate, 0x00, sizeof(szTemplate));
		sprintf(szTemplate, "設定時間間隔:%d.%01d s", inSignpad_Beep_Interval_Set / 100, (inSignpad_Beep_Interval_Set % 100) / 10);
		inDISP_ChineseFont(szTemplate, _FONTSIZE_8X33_, _LINE_8_5_, _DISP_LEFT_);
		inDISP_ChineseFont("OK確定修改，X取消此次修改", _FONTSIZE_8X33_, _LINE_8_6_, _DISP_LEFT_);
		inDISP_ChineseFont("↑鍵向上調整，#鍵向下調整", _FONTSIZE_8X33_, _LINE_8_7_, _DISP_LEFT_);
		
		uszKey = uszKBD_GetKey(15);
		if (uszKey == _KEY_ENTER_)
		{
			memset(szSignpad_Beep_Interval, 0x00, sizeof(szSignpad_Beep_Interval));
			sprintf(szSignpad_Beep_Interval, "%03d", inSignpad_Beep_Interval_Set);
			inSetSignpadBeepInterval(szSignpad_Beep_Interval);
			inSaveEDCRec(0);
			break;
		}
		else if (uszKey == _KEY_UP_)
		{
			if ((inSignpad_Beep_Interval_Set + inInterval_Unit) > inSignpad_Beep_Interval_MAX)
			{
				/* 會超過就不加 */
			}
			else
			{
				inSignpad_Beep_Interval_Set += inInterval_Unit;
			}
		}
		else if (uszKey == _KEY_DOWN_)
		{
			if ((inSignpad_Beep_Interval_Set - inInterval_Unit) < inSignpad_Beep_Interval_MIN)
			{
				/* 會低過就不減 */
			}
			else
			{
				inSignpad_Beep_Interval_Set -= inInterval_Unit;
			}
		}
		else if (uszKey == _KEY_CANCEL_)
		{
			inRetVal = VS_USER_CANCEL;
			break;
		}
		
	}while(1);
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Save_Temp_PobTran_For_ECR_Missing_Data
Date&Time       :2024/2/6 下午 4:50
Describe        :
*/
int inNCCC_Func_Save_Temp_PobTran_For_ECR_Missing_Data(TRANSACTION_OBJECT* pobTran)
{
	char		szCusomerIndicator[3 + 1] = {0};
	unsigned long	ulHandle = 0;
	unsigned char	uszFileName[50 + 1] = {0};
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Save_Temp_PobTran_For_ECR_Missing_Data() START !");
	}
	
	if (pobTran->uszECRBit != VS_TRUE)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "Not ECR,No need to save Temp_PobTran");
		}
		return (VS_SUCCESS);
	}
	
	memset(szCusomerIndicator, 0x00, sizeof(szCusomerIndicator));
	inGetCustomIndicator(szCusomerIndicator);
	if (memcmp(szCusomerIndicator,  _CUSTOMER_INDICATOR_111_KIOSK_STANDARD_, _CUSTOMER_INDICATOR_SIZE_) != 0)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "Not Cus-111,No need to save Temp_PobTran");
		}
		return (VS_SUCCESS);
	}
	
	memset(uszFileName, 0x00, sizeof(uszFileName));
	strcpy((char*)uszFileName, _POBTRAN_TEMP_FILE_NAME_);
	
	if (inFILE_Check_Exist(uszFileName) == VS_SUCCESS)
	{
		inFILE_Delete(uszFileName);
	}
	
	do
	{
		if (inFILE_Open(&ulHandle, uszFileName) != VS_SUCCESS)
		{
			inUtility_StoreTraceLog_OneStep("inNCCC_Func_Save_Temp_PobTran_For_ECR_Missing_Data Open fail:%s", uszFileName);
		}

		if (inFILE_Seek(ulHandle, 0, _SEEK_END_) != VS_SUCCESS)
		{
			inUtility_StoreTraceLog_OneStep("inNCCC_Func_Save_Temp_PobTran_For_ECR_Missing_Data Seek fail:%lu", ulHandle);
			break;
		}
		
		if (inFILE_Write(&ulHandle, (unsigned char*)&pobTran, sizeof(TRANSACTION_OBJECT)) != VS_SUCCESS)
		{
			inUtility_StoreTraceLog_OneStep("inNCCC_Func_Save_Temp_PobTran_For_ECR_Missing_Data Write fail:%lu", ulHandle);
			break;
		}
		
		break;
	}while (1);
	
	inFILE_Close(&ulHandle);
	
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Save_Temp_PobTran_For_ECR_Missing_Data() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Get_Temp_PobTran_For_ECR_Missing_Data
Date&Time       :2024/2/7 下午 2:03
Describe        :
*/
int inNCCC_Func_Get_Temp_PobTran_For_ECR_Missing_Data(TRANSACTION_OBJECT* pobTran)
{
	int		inRetVal = VS_SUCCESS;
	char		szCusomerIndicator[3 + 1] = {0};
	unsigned long	ulHandle = 0;
	unsigned long	ulsize = 0;
	unsigned char	uszFileName[50 + 1] = {0};
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Get_Temp_PobTran_For_ECR_Missing_Data() START !");
	}
	
	memset(szCusomerIndicator, 0x00, sizeof(szCusomerIndicator));
	inGetCustomIndicator(szCusomerIndicator);
	if (memcmp(szCusomerIndicator,  _CUSTOMER_INDICATOR_111_KIOSK_STANDARD_, _CUSTOMER_INDICATOR_SIZE_) != 0)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "Not Cus-111,No need to Read Temp_PobTran");
		}
		return (VS_ERROR);
	}
	
	memset(uszFileName, 0x00, sizeof(uszFileName));
	strcpy((char*)uszFileName, _POBTRAN_TEMP_FILE_NAME_);
	
	do
	{
		if (inFILE_Check_Exist(uszFileName) != VS_SUCCESS)
		{
			inRetVal = VS_ERROR;
			break;
		}
			
		if (inFILE_Open(&ulHandle, uszFileName) != VS_SUCCESS)
		{
			inUtility_StoreTraceLog_OneStep("inNCCC_Func_Get_Temp_PobTran_For_ECR_Missing_Data Open fail:%s", uszFileName);
			inRetVal = VS_ERROR;
			break;
		}

		if (inFILE_Seek(ulHandle, 0, _SEEK_BEGIN_) != VS_SUCCESS)
		{
			inUtility_StoreTraceLog_OneStep("inNCCC_Func_Get_Temp_PobTran_For_ECR_Missing_Data Seek fail:%lu", ulHandle);
			inRetVal = VS_ERROR;
			break;
		}
		
		ulsize = lnFILE_GetSize(&ulHandle, uszFileName);
		
		if (inFILE_Read(&ulHandle, (unsigned char*)&pobTran, ulsize) != VS_SUCCESS)
		{
			inUtility_StoreTraceLog_OneStep("inNCCC_Func_Get_Temp_PobTran_For_ECR_Missing_Data Read fail:%lu", ulHandle);
			inRetVal = VS_ERROR;
			break;
		}
		
		break;
	}while (1);
	
	inFILE_Close(&ulHandle);
	
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Get_Temp_PobTran_For_ECR_Missing_Data() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Delete_Temp_PobTran_For_ECR_Missing_Data
Date&Time       :2024/2/7 下午 2:59
Describe        :
*/
int inNCCC_Func_Delete_Temp_PobTran_For_ECR_Missing_Data(TRANSACTION_OBJECT* pobTran)
{
	int		inRetVal = VS_SUCCESS;
	char		szCusomerIndicator[3 + 1] = {0};
	unsigned char	uszFileName[50 + 1] = {0};
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Delete_Temp_PobTran_For_ECR_Missing_Data() START !");
	}
	
	if (pobTran->uszECRBit != VS_TRUE)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "Not ECR,No need to delete Temp_PobTran");
		}
		return (VS_SUCCESS);
	}
	
	memset(szCusomerIndicator, 0x00, sizeof(szCusomerIndicator));
	inGetCustomIndicator(szCusomerIndicator);
	if (memcmp(szCusomerIndicator,  _CUSTOMER_INDICATOR_111_KIOSK_STANDARD_, _CUSTOMER_INDICATOR_SIZE_) != 0)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "Not Cus-111,No need to delete Temp_PobTran");
		}
		return (VS_SUCCESS);
	}
	
	memset(uszFileName, 0x00, sizeof(uszFileName));
	strcpy((char*)uszFileName, _POBTRAN_TEMP_FILE_NAME_);
	
	if (inFILE_Check_Exist(uszFileName) == VS_SUCCESS)
	{
		inFILE_Delete(uszFileName);
		sync();
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Delete_Temp_PobTran_For_ECR_Missing_Data() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (inRetVal);
}

/*
Function        :inNCCC_Func_Fix_Inv_Problem_At_Reboot
Date&Time       :2024/1/31 上午 11:40
Describe        :
*/
int inNCCC_Func_Fix_Inv_Problem_At_Reboot(TRANSACTION_OBJECT* pobTran)
{
	int	inHostNum = 2;
	int	inRetVal = VS_SUCCESS;
	int	i = 0;
	int	inHDTIndex[inHostNum];
	int	inHDPTInvoiceNum = 0;
	int	inRecordInvoiceNum = 0;
	int	inTempRetVal = VS_SUCCESS;
	int	inMaxInv = 0;
	char	szHostEnable[inHostNum][1 + 1];
	char	szInvoiceNum[6 + 1] = {0};
	char	szTableName[30 + 1] = {0};
	char	szQuerySql[200 + 1];	/* INSERT INTO	szTableName( */
	char	szHostName[8 + 1] = {0};
	char	szHostMustSettle[inHostNum][1 + 1];
	unsigned char	uszUpdatedBit = VS_FALSE;
	SQLITE_ALL_TABLE	srAll;
	TRANSACTION_OBJECT	pobDataTran;
	
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Fix_Inv_Problem_At_Reboot START!");
        
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Fix_Inv_Problem_At_Reboot() START !");
	}
	
	/* initial */
	for (i = 0; i < inHostNum; i++)
	{
		inHDTIndex[i] = -1;
		memset(szHostEnable[i], 0x00, sizeof(szHostEnable[i]));
		memset(szHostMustSettle[i], 0x00, sizeof(szHostMustSettle[i]));
	}
	
	/* 取兩主機內最大Inv. */
	for (i = 0; i < inHostNum; i++)
	{
		memset(szHostName, 0x00, sizeof(szHostName));
		if (i == 0)
		{
			strcpy(szHostName, _HOST_NAME_CREDIT_NCCC_);
		}
		else if (i == 1)
		{
			/* DCC */
			strcpy(szHostName, _HOST_NAME_DCC_);
		}
		
		inFunc_Find_Specific_HDTindex(0, szHostName, &inHDTIndex[i]);
		do
		{
			if (inHDTIndex[i] == -1)
			{
				break;
			}

			inLoadHDTRec(inHDTIndex[i]);
			inLoadHDPTRec(inHDTIndex[i]);
			
			memset(&szHostEnable[i][0], 0x00, sizeof(szHostEnable[i]));
			inGetHostEnable(&szHostEnable[i][0]);
			if (memcmp(&szHostEnable[i][0], "Y", 1) != 0)
			{
				break;
			}
			
			memset(&szHostMustSettle[i][0], 0x00, sizeof(szHostMustSettle[i]));
			inGetMustSettleBit(&szHostMustSettle[i][0]);
			if (memcmp(&szHostMustSettle[i][0], "Y", 1) == 0)
			{
				break;
			}
			
			/* 抓信用卡主機調閱編號最大值 */
			memset(&srAll, 0x00, sizeof(SQLITE_ALL_TABLE));
			memset(&pobDataTran, 0x00, sizeof(TRANSACTION_OBJECT));
			memset(szTableName, 0x00, sizeof(szTableName));
			inRecordInvoiceNum = 0;
			pobDataTran.srBRec.inHDTIndex = inHDTIndex[i];
			inFunc_ComposeFileName(&pobDataTran, szTableName, "", 6);
			strcat(szTableName, _BATCH_TABLE_SUFFIX_);
			inSqlite_Table_Link_BRec(&pobDataTran, &srAll, _LS_READ_);
			/* 取得NCCC和sDCC最大的lnorgInvnum和HDTIndex */
			memset(szQuerySql, 0x00, sizeof(szQuerySql));
			sprintf(szQuerySql, "SELECT lnOrgInvNum FROM %s WHERE (uszUpdated = 0) ORDER BY lnOrgInvNum DESC LIMIT 1", szTableName);
			inTempRetVal = inSqlite_Get_Data_By_External_SQL(gszTranDBPath, &srAll, szQuerySql);
			if (inTempRetVal == VS_SUCCESS)
			{
				inRecordInvoiceNum = pobDataTran.srBRec.lnOrgInvNum;
			}
			else
			{
				inRecordInvoiceNum = 0;
			}
			
			/* 如果比目前最大調閱編號大，則替換 */
			if (inRecordInvoiceNum > inMaxInv)
			{
				inMaxInv = inRecordInvoiceNum;
			}

			break;
		}while(1);
	}
	
	/* 調整Inv */
	for (i = 0; i < inHostNum; i++)
	{
		do
		{
			if (inHDTIndex[i] == -1)
			{
				break;
			}

			inLoadHDTRec(inHDTIndex[i]);
			inLoadHDPTRec(inHDTIndex[i]);
			
			if (memcmp(&szHostEnable[i][0], "Y", 1) != 0)
			{
				break;
			}
			
			if (memcmp(&szHostMustSettle[i][0], "Y", 1) == 0)
			{
				break;
			}
			
			/* 撈出Table調閱編號 */
			memset(szInvoiceNum, 0x00, sizeof(szInvoiceNum));
			inGetInvoiceNum(szInvoiceNum);
			inHDPTInvoiceNum = atoi(szInvoiceNum);
		
			/* 比對下一筆Inv是否小於當前NCCC和DCC的交易紀錄，若小於等於當前交易紀錄調閱編號時，則自動補到下一號 */
			if (inHDPTInvoiceNum <= inMaxInv)
			{
				pobDataTran.srBRec.lnOrgInvNum = inMaxInv;
				inFLOW_RunFunction(&pobDataTran, _FUNCTION_UPDATE_INV_);
				inUtility_StoreTraceLog_OneStep("Batch Fix,Host:%d,Inv:%d,MaxInv:%d", pobDataTran.srBRec.inHDTIndex, inHDPTInvoiceNum, inMaxInv);
				inUtility_StoreTraceLog_OneStep("Amt:%ld", pobDataTran.srBRec.lnTxnAmount);
				vdUtility_SYSFIN_LogMessage(AT, "Batch Fix,Host:%d,Inv:%d,MaxInv:%d", pobDataTran.srBRec.inHDTIndex, inHDPTInvoiceNum, inMaxInv);
				vdUtility_SYSFIN_LogMessage(AT, "Amt:%ld", pobDataTran.srBRec.lnTxnAmount);
			}
			break;
		}while(1);
	}
	
	/* 補ESC */
	for (i = 0; i < inHostNum; i++)
	{
		do
		{
			if (inHDTIndex[i] == -1)
			{
				break;
			}
			
			inLoadHDTRec(inHDTIndex[i]);
			inLoadHDPTRec(inHDTIndex[i]);
			if (memcmp(&szHostEnable[i][0], "Y", 1) != 0)
			{
				break;
			}
			
			/* 抓主機調閱編號最大值 */
			memset(&srAll, 0x00, sizeof(SQLITE_ALL_TABLE));
			memset(&pobDataTran, 0x00, sizeof(TRANSACTION_OBJECT));
			memset(szTableName, 0x00, sizeof(szTableName));
			inRecordInvoiceNum = 0;
			pobDataTran.srBRec.inHDTIndex = inHDTIndex[i];
			inFunc_ComposeFileName(&pobDataTran, szTableName, "", 6);
			strcat(szTableName, _BATCH_TABLE_SUFFIX_);
			inSqlite_Table_Link_BRec(&pobDataTran, &srAll, _LS_READ_);
			/* 取得NCCC和DCC最大的lnorgInvnum和HDTIndex */
			memset(szQuerySql, 0x00, sizeof(szQuerySql));
			sprintf(szQuerySql, "SELECT lnOrgInvNum FROM %s WHERE (uszUpdated = 0) ORDER BY lnOrgInvNum DESC LIMIT 1", szTableName);
			inTempRetVal = inSqlite_Get_Data_By_External_SQL(gszTranDBPath, &srAll, szQuerySql);
			if (inTempRetVal == VS_SUCCESS)
			{
				inRecordInvoiceNum = pobDataTran.srBRec.lnOrgInvNum;
			}
			else
			{
				inRecordInvoiceNum = 0;
			}
			
			/* 撈出當筆全部資料，看是否需補送ESC(註:僅能應對一般交易狀況，不考慮取消等交易斷電無ESC問題) */
			inRetVal = inBATCH_Get_Batch_ByInvNum_Flow(&pobDataTran, _TN_BATCH_TABLE_, pobDataTran.srBRec.lnOrgInvNum);

			if (pobDataTran.srBRec.inChipStatus != 0		|| 
			    pobDataTran.srBRec.uszContactlessBit == VS_TRUE	|| 
			    pobDataTran.srBRec.uszEMVFallBackBit == VS_TRUE     ||
                            pobTran->srBRec.uszCUPEMVQRCodeBit == VS_TRUE)
			{
				inRetVal = inBATCH_Get_Batch_ByInvNum_Flow(&pobDataTran, _TN_EMV_TABLE_, pobDataTran.srBRec.lnOrgInvNum);
			}

			/* 如果有開ESC要視情況補送 */
			do
			{
				/* 沒有交易資料 */
				if (inRetVal != VS_SUCCESS)
				{
					break;
				}
				
				/* 不是尚未上傳狀態 */
				if (pobDataTran.srBRec.inESCUploadStatus != _ESC_UPLOAD_STATUS_UPLOAD_NOT_YET_)
				{
					break;
				}

				/* 而且不在重送區 */
				if (inNCCC_ESC_Check_Again_Record_Inv_Exist(&pobDataTran) == VS_SUCCESS)
				{
					break;
				}

				/* 也不在失敗區 */
				if (inNCCC_ESC_Check_Fail_Record_Inv_Exist(&pobDataTran) == VS_SUCCESS)
				{
					break;
				}

				/* 補ESC */
				inFLOW_RunFunction(&pobDataTran, _NCCC_FUNCTION_ESC_FUNCPROCESS_);
				inUtility_StoreTraceLog_OneStep("ESC Fix,Host:%d,Inv:%d", pobDataTran.srBRec.inHDTIndex, pobDataTran.srBRec.lnOrgInvNum);
				inUtility_StoreTraceLog_OneStep("Amt:%ld", pobDataTran.srBRec.lnTxnAmount);
				vdUtility_SYSFIN_LogMessage(AT, "ESC Fix,Host:%d,Inv:%d", pobDataTran.srBRec.inHDTIndex, pobDataTran.srBRec.lnOrgInvNum);
				vdUtility_SYSFIN_LogMessage(AT, "Amt:%ld", pobDataTran.srBRec.lnTxnAmount);

				break;
			}while(1);

			break;
		}while(1);
	}
	
	/* 2024/6/24 下午 3:12新增 開機無條件調閱編號加二 */
	for (i = 0; i < inHostNum; i++)
	{
		do
		{
			/* 如果信用卡主機已增加過，則DCC主機可以不用跑 */
			if (uszUpdatedBit == VS_TRUE)
			{
				break;
			}
			
			if (inHDTIndex[i] == -1)
			{
				break;
			}

			inLoadHDTRec(inHDTIndex[i]);
			inLoadHDPTRec(inHDTIndex[i]);
			
			if (memcmp(&szHostEnable[i][0], "Y", 1) != 0)
			{
				break;
			}
			
			if (memcmp(&szHostMustSettle[i][0], "Y", 1) == 0)
			{
				break;
			}
			
			/* 撈出HDPT調閱編號，並調整到調閱編號+2，_FUNCTION_UPDATE_INV_內會加一，故inHDPTInvoiceNum僅加一 */
			memset(szInvoiceNum, 0x00, sizeof(szInvoiceNum));
			inGetInvoiceNum(szInvoiceNum);
			inHDPTInvoiceNum = atoi(szInvoiceNum);

			pobDataTran.srBRec.lnOrgInvNum = inHDPTInvoiceNum + 1;
			inFLOW_RunFunction(&pobDataTran, _FUNCTION_UPDATE_INV_);
			
			uszUpdatedBit = VS_TRUE;
			break;
		}while(1);
	}
	
	if (pobTran->srBRec.inHDTIndex >= 0)
	{
		inLoadHDTRec(pobTran->srBRec.inHDTIndex);
		inLoadHDPTRec(pobTran->srBRec.inHDTIndex);
	}
	else
	{
		inLoadHDTRec(0);
		inLoadHDPTRec(0);
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Fix_Inv_Problem_At_Reboot() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Check_Inv_Problem_Before_Txn
Date&Time       :2024/2/1 上午 11:39
Describe        :
*/
int inNCCC_Func_Check_Inv_Problem_Before_Txn(TRANSACTION_OBJECT* pobTran)
{
	int	i = 0;
	int	inHostNum = 2;
	int	inHDTIndex[inHostNum];
	int	inHDPTInvoiceNum = 0;
	int	inRecordInvoiceNum = 0;
	int	inRetVal = VS_SUCCESS;
	int	inMaxInv = 0;
	char	szHostEnable[inHostNum][1 + 1];
	char	szInvoiceNum[6 + 1] = {0};
	char	szHostName[8 + 1] = {0};
	char	szHostMustSettle[inHostNum][1 + 1];
	unsigned char	uszKey = 0;
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Check_Inv_Problem_Before_Txn() START !");
	}
	
	/* initial */
	for (i = 0; i < inHostNum; i++)
	{
		inHDTIndex[i] = -1;
		memset(szHostEnable[i], 0x00, sizeof(szHostEnable[i]));
		memset(szHostMustSettle[i], 0x00, sizeof(szHostMustSettle[i]));
	}
	
	/* 取兩主機內最大Inv. */
	for (i = 0; i < inHostNum; i++)
	{
		memset(szHostName, 0x00, sizeof(szHostName));
		if (i == 0)
		{
			strcpy(szHostName, _HOST_NAME_CREDIT_NCCC_);
		}
		else if (i == 1)
		{
			/* DCC */
			strcpy(szHostName, _HOST_NAME_DCC_);
		}
		
		inFunc_Find_Specific_HDTindex(0, szHostName, &inHDTIndex[i]);
		do
		{
			if (inHDTIndex[i] == -1)
			{
				break;
			}

			inLoadHDTRec(inHDTIndex[i]);
			inLoadHDPTRec(inHDTIndex[i]);
			
			memset(&szHostEnable[i][0], 0x00, sizeof(szHostEnable[i]));
			inGetHostEnable(&szHostEnable[i][0]);
			if (memcmp(&szHostEnable[i][0], "Y", 1) != 0)
			{
				break;
			}
			
			memset(&szHostMustSettle[i][0], 0x00, sizeof(szHostMustSettle[i]));
			inGetMustSettleBit(&szHostMustSettle[i][0]);
			if (memcmp(&szHostMustSettle[i][0], "Y", 1) == 0)
			{
				break;
			}
			
			/* 抓主機調閱編號最大值 */
                        if (i == 0 ||
                            i == 1)
                        {
                                inRecordInvoiceNum = ginNCCCDCCInvoice;
                        }
			
			/* 如果比目前最大調閱編號大，則替換 */
			if (inRecordInvoiceNum > inMaxInv)
			{
				inMaxInv = inRecordInvoiceNum;
			}

			break;
		}while(1);
	}
	
	for (i = 0; i < 2; i++)
	{
		do
		{
			if (inHDTIndex[i] == -1)
			{
				break;
			}

			inLoadHDTRec(inHDTIndex[i]);
			inLoadHDPTRec(inHDTIndex[i]);
			
			if (memcmp(&szHostEnable[i][0], "Y", 1) != 0)
			{
				break;
			}

			if (memcmp(&szHostMustSettle[i][0], "Y", 1) == 0)
			{
				break;
			}
			
			/* 撈出NCCC調閱編號 */
			memset(szInvoiceNum, 0x00, sizeof(szInvoiceNum));
			inGetInvoiceNum(szInvoiceNum);
			inHDPTInvoiceNum = atoi(szInvoiceNum);

			/* 比對調閱編號是否不為下一號 */
			if (inHDPTInvoiceNum <= inMaxInv)
			{
				vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Check_Inv_Problem_Before_Txn failed");
				vdUtility_SYSFIN_LogMessage(AT, "(%d) <= (%d)", inHDPTInvoiceNum, inMaxInv);
				
				inDISP_Clear_Line(_LINE_8_1_, _LINE_8_8_);
				inDISP_ChineseFont("系統須重新整理", _FONTSIZE_8X16_, _LINE_8_1_, _DISP_CENTER_);
				inDISP_ChineseFont("10秒後重新開機", _FONTSIZE_8X16_, _LINE_8_2_, _DISP_CENTER_);
				inDISP_ChineseFont("按確認鍵立即重開", _FONTSIZE_8X16_, _LINE_8_3_, _DISP_CENTER_);
				inDISP_PutGraphic(_ERR_OK_, 0, _COORDINATE_Y_LINE_8_7_);

				inDISP_TimeoutStart(10);
				do
				{
					uszKey = uszKBD_Key();

					/* 感應倒數時間 && Display Countdown */
					if (inDISP_TimeoutCheck(_FONTSIZE_8X16_, _LINE_8_6_, _DISP_RIGHT_) == VS_TIMEOUT)
					{
						/* 感應時間到Timeout */
						uszKey = _KEY_TIMEOUT_;
					}

					if (uszKey == _KEY_TIMEOUT_)
					{
						inRetVal = VS_TIMEOUT;
						break;
					}
					else if (uszKey == _KEY_CANCEL_)
					{
						inRetVal = VS_USER_CANCEL;
						break;
					}
					else if (uszKey == _KEY_ENTER_)
					{
						inRetVal = VS_TIMEOUT;
						break;
					}

				}while (1);

				if (inRetVal == VS_TIMEOUT)
				{
					inFunc_Reboot();
				}
				else
				{
					return (VS_ERROR);
				}
			}
			break;
		}while(1);
	}
	
	
	if (pobTran->srBRec.inHDTIndex >= 0)
	{
		inLoadHDTRec(pobTran->srBRec.inHDTIndex);
		inLoadHDPTRec(pobTran->srBRec.inHDTIndex);
	}
	else
	{
		inLoadHDTRec(0);
		inLoadHDPTRec(0);
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Check_Inv_Problem_Before_Txn() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Display_Please_LOGON_First_Only_ISO
Date&Time       :2024/3/20 下午 5:25
Describe        :保留只有ISO會馬上提示請先安全結帳
*/
int inNCCC_Func_Display_Please_LOGON_First_Only_ISO(TRANSACTION_OBJECT *pobTran)
{
	char	szTemplate[10 + 1] = {0};
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Display_Please_LOGON_First_Only_ISO() START !");
	}
	
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Display_Please_LOGON_First_Only_ISO START!");
        
	memset(szTemplate, 0x00, sizeof(szTemplate));
	inGetTMSDownloadMode(szTemplate);
	if (memcmp(szTemplate, _TMS_DLMODE_FTPS_, strlen(_TMS_DLMODE_FTPS_)) == 0)
	{
		/* download server */
	}
	else
	{
		inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_DISPLAY_PLEASE_LOGON_FIRST_);
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Display_Please_LOGON_First_Only_ISO() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Gernerate_PEM
Date&Time       :2024/5/16 下午 4:34
Describe        :將szFileName寫入至szMergeFileName的結尾
*/
int inNCCC_Func_Gernerate_PEM(char* szGernerateName, char* szAddFileName)
{
	int		inRetVal = VS_SUCCESS;
	char		*pReadData = NULL;
	long		lnReadSize = 0;
	long		lnOrgSize = 0;
	unsigned long	ulGernerateFileHandle = 0;
	unsigned long	ulAddFileHandle = 0;
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Gernerate_PEM() START !");
	}
	
	do
	{
		/* 開啟欲寫入檔*/
		inRetVal = inFILE_Open(&ulAddFileHandle, (unsigned char*)szAddFileName);
		if (inRetVal != VS_SUCCESS)
		{
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "inNCCC_Func_Gernerate_PEM Fail Open:%s", szAddFileName);
			}
			break;
		}
		
		/*移動欲寫入檔指針 */
		inRetVal = inFILE_Seek(ulAddFileHandle, 0l, _SEEK_BEGIN_);
		if (inRetVal != VS_SUCCESS)
		{
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "inNCCC_Func_Gernerate_PEM Fail Seek:%s", szAddFileName);
			}
			break;
		}
		
		lnReadSize = lnFILE_GetSize(&ulAddFileHandle, (unsigned char*)szAddFileName);
		pReadData = malloc(lnReadSize + 1);
		
		/* 讀檔 */
		inRetVal = inFILE_Read(&ulAddFileHandle, (unsigned char*)pReadData, lnReadSize);
		if (inRetVal != VS_SUCCESS)
		{
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "inNCCC_Func_Gernerate_PEM Fail Seek:%s", szAddFileName);
			}
			break;
		}
		
		/* 關檔 */
		inFILE_Close(&ulAddFileHandle);
		
		/* 確認檔案存不存在 */
		inRetVal = inFILE_Check_Exist((unsigned char*)szGernerateName);

		/* 存在就開檔 */
		if (inRetVal == VS_SUCCESS)
		{
			inRetVal = inFILE_Open(&ulGernerateFileHandle, (unsigned char*)szGernerateName);
			if (inRetVal != VS_SUCCESS)
			{
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "inNCCC_Func_Gernerate_PEM Fail Open:%s", szGernerateName);
				}
				break;
			}
			lnOrgSize = lnFILE_GetSize(&ulGernerateFileHandle, (unsigned char*)szGernerateName);
		}/* 不存在就建立檔案 */
		else
		{
			inRetVal = inFILE_Create(&ulGernerateFileHandle, (unsigned char*)szGernerateName);
			if (inRetVal != VS_SUCCESS)
			{
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "inNCCC_Func_Gernerate_PEM Fail Create:%s", szGernerateName);
				}
				break;
			}
			lnOrgSize = 0;
		}
		
		/*移動合併檔指針 */
		inRetVal = inFILE_Seek(ulGernerateFileHandle, 0l, _SEEK_END_);
		if (inRetVal != VS_SUCCESS)
		{
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "inNCCC_Func_Gernerate_PEM Fail Seek:%lu", ulGernerateFileHandle);
			}
			break;
		}
		
		/* 原檔案有值，須加入換行符號 */
		/* 經測試結果，換行符號linux系統和windows系統格式沒有差，這邊直接塞linux格式 */
		if (lnOrgSize > 0)
		{
			inRetVal = inFILE_Write(&ulGernerateFileHandle, (unsigned char*)"\x0A", 1);
			if (inRetVal != VS_SUCCESS)
			{
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "inNCCC_Func_Gernerate_PEM Fail write:%ld,%ld", ulGernerateFileHandle, 1);
				}
				break;
			}
		}

		/* 寫入合併檔 */
		inRetVal = inFILE_Write(&ulGernerateFileHandle, (unsigned char*)pReadData, lnReadSize);
		if (inRetVal != VS_SUCCESS)
		{
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "inNCCC_Func_Gernerate_PEM Fail write:%ld,%ld", ulGernerateFileHandle, lnReadSize);
			}
			break;
		}
				
		break;
	}while(1);
	
	if (pReadData != NULL)
	{
		free(pReadData);
	}
	/* 關閉檔案 */
	if (ulGernerateFileHandle > 0)
	{
		inFILE_Close(&ulGernerateFileHandle);
	}
	
	if (ulAddFileHandle > 0)
	{
		inFILE_Close(&ulAddFileHandle);
	}

	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Gernerate_PEM() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	
	if (inRetVal != VS_SUCCESS)
	{
		return (VS_ERROR);
	}
	else
	{
		return (VS_SUCCESS);
	}
}

/*
Function        :inNCCC_Func_Update_PEM_Before_TMS_Manual_Download
Date&Time       :2024/5/20 上午 10:43
Describe        :1.機器內預先load 憑證 LDSS Product和IFES PRODUCT和測試憑證。
 *		 2.先查看是否_PEM_NEW_TLS_FILE_NAME_(新憑證)和_PEM_PRESERVE_TLS_FILE_NAME_(舊憑證)檔案不存在，若不存在則以對應憑證代替之(IFES、LDSS)。
 *		   若開啟DEMOMode或T測試版，則優先以測試憑證代替之，無視是否檔案存在與否。此流程於手動TMS下載前執行。
 *		 3.檢查是否下載憑證檔，若有下載憑證檔與舊憑證檔比對，若相同則不進行替換，若不同則刪除(舊憑證)，(新憑證)改名為_PEM_PRESERVE_TLS_FILE_NAME_(舊憑證)，下載憑證組合成_PEM_NEW_TLS_FILE_NAME_(新憑證)
 *		   此流程於更新TMS檔案時進行。
 *		 
*/
int inNCCC_Func_Update_PEM_Before_TMS_Manual_Download(TRANSACTION_OBJECT *pobTran)
{
	char		szFilePath[200 + 1] = {0};
	char		szFilePathNew[200 + 1] = {0};
	char		szFilePathOld[200 + 1] = {0}; 
	char		szIFESMode[2 + 1] = {0};
	char		szCFESMode[2 + 1] = {0};
	char		szDemoMode[2 + 1] = {0};
	
        vdUtility_SYSFIN_LogMessage(AT, "inNCCC_Func_Update_PEM_Before_TMS_Manual_Download START!");
        
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Update_PEM_Before_TMS_Manual_Download() START !");
	}
	
	memset(szIFESMode, 0x00, sizeof(szIFESMode));
	inGetI_FES_Mode(szIFESMode);
	memset(szCFESMode, 0x00, sizeof(szCFESMode));
	inGetCloud_MFES(szCFESMode);
	
	memset(szFilePathOld, 0x00, sizeof(szFilePathOld));
	sprintf(szFilePathOld, "%s%s", _CA_DATA_PATH_FROM_FS_DATA_, _PEM_PRESERVE_TLS_FILE_NAME_);
	memset(szFilePathNew, 0x00, sizeof(szFilePathNew));
	sprintf(szFilePathNew, "%s%s", _CA_DATA_PATH_FROM_FS_DATA_, _PEM_NEW_TLS_FILE_NAME_);
	
	/* 先看情形，若_PEM_PRESERVE_TLS_FILE_NAME_不存在，先將_PEM_IFES_FILE_NAME_或_PEM_LDSS_FILE_NAME_複製一份並改檔名為_PEM_PRESERVE_TLS_FILE_NAME_ */
	memset(szDemoMode, 0x00, sizeof(szDemoMode));
	inGetDemoMode(szDemoMode);
	if (!memcmp(szDemoMode, "Y", 1))
	{
		/* 一律刪除替換成測試憑證 */
		if (inFILE_Check_Exist((unsigned char*)szFilePathOld) == VS_SUCCESS)
		{
			inFILE_Delete((unsigned char*)szFilePathOld);
		}
		if (inFILE_Check_Exist((unsigned char*)szFilePathNew) == VS_SUCCESS)
		{
			inFILE_Delete((unsigned char*)szFilePathNew);
		}
		
		memset(szFilePath, 0x00, sizeof(szFilePath));
		if (memcmp(szCFESMode, "Y", strlen("Y")) == 0	||
		    pobTran->uszFTP_TMS_Download == _TMS_DOWNLOAD_SECURE_MODE_SFTP_)
		{
			sprintf(szFilePath, "%s%s", _CA_DATA_PATH_FROM_FS_DATA_, _PEM_LDSS_DEMO_FILE_NAME_);
		}
		else if (memcmp(szIFESMode, "Y", strlen("Y")) == 0)
		{
			sprintf(szFilePath, "%s%s", _CA_DATA_PATH_FROM_FS_DATA_, _PEM_IFES_DEMO_FILE_NAME_);
		}
		else
		{
			sprintf(szFilePath, "%s%s", _CA_DATA_PATH_FROM_FS_DATA_, _PEM_IFES_DEMO_FILE_NAME_);
		}
		inFILE_Copy_File((unsigned char*)szFilePath, (unsigned char*)szFilePathOld);
		inFILE_Copy_File((unsigned char*)szFilePath, (unsigned char*)szFilePathNew);
		
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "一律替換測試憑證");
		}
	}
	else
	{
		if (inFILE_Check_Exist((unsigned char*)szFilePathOld) != VS_SUCCESS)
		{
			memset(szFilePath, 0x00, sizeof(szFilePath));
			if (memcmp(szCFESMode, "Y", strlen("Y")) == 0	||
			    pobTran->uszFTP_TMS_Download == _TMS_DOWNLOAD_SECURE_MODE_SFTP_)
			{
				sprintf(szFilePath, "%s%s", _CA_DATA_PATH_FROM_FS_DATA_, _PEM_LDSS_DEMO_FILE_NAME_);
			}
			else if (memcmp(szIFESMode, "Y", strlen("Y")) == 0)
			{
				sprintf(szFilePath, "%s%s", _CA_DATA_PATH_FROM_FS_DATA_, _PEM_IFES_DEMO_FILE_NAME_);
			}
			else
			{
				sprintf(szFilePath, "%s%s", _CA_DATA_PATH_FROM_FS_DATA_, _PEM_IFES_DEMO_FILE_NAME_);
			}
			inFILE_Copy_File((unsigned char*)szFilePath, (unsigned char*)szFilePathOld);
			
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "缺少舊憑證,替換為%s", szFilePath);
			}
		}
		
		if (inFILE_Check_Exist((unsigned char*)szFilePathNew) != VS_SUCCESS)
		{
			memset(szFilePath, 0x00, sizeof(szFilePath));
			if (memcmp(szCFESMode, "Y", strlen("Y")) == 0	||
			    pobTran->uszFTP_TMS_Download == _TMS_DOWNLOAD_SECURE_MODE_SFTP_)
			{
				sprintf(szFilePath, "%s%s", _CA_DATA_PATH_FROM_FS_DATA_, _PEM_LDSS_DEMO_FILE_NAME_);
			}
			else if (memcmp(szIFESMode, "Y", strlen("Y")) == 0)
			{
				sprintf(szFilePath, "%s%s", _CA_DATA_PATH_FROM_FS_DATA_, _PEM_IFES_DEMO_FILE_NAME_);
			}
			else
			{
				sprintf(szFilePath, "%s%s", _CA_DATA_PATH_FROM_FS_DATA_, _PEM_IFES_DEMO_FILE_NAME_);
			}
			inFILE_Copy_File((unsigned char*)szFilePath, (unsigned char*)szFilePathNew);
			
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "缺少新憑證,替換為%s", szFilePath);
			}
		}
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Update_PEM_Before_TMS_Manual_Download() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Update_PEM_After_Para_Update
Date&Time       :2024/5/20 上午 10:43
Describe        :1.機器內預先load 憑證 LDSS Product和IFES PRODUCT和測試憑證。
 *		 2.先查看是否_PEM_NEW_TLS_FILE_NAME_(新憑證)和_PEM_PRESERVE_TLS_FILE_NAME_(舊憑證)檔案不存在，若不存在則以對應憑證代替之(IFES、LDSS)。
 *		   若開啟DEMOMode或T測試版，則優先以測試憑證代替之，無視是否檔案存在與否。此流程於手動TMS下載前執行。
 *		 3.檢查是否下載憑證檔，若有下載憑證檔與舊憑證檔比對，若相同則不進行替換，若不同則刪除(舊憑證)，(新憑證)改名為_PEM_PRESERVE_TLS_FILE_NAME_(舊憑證)，下載憑證組合成_PEM_NEW_TLS_FILE_NAME_(新憑證)
 *		   此流程於更新TMS檔案時進行。
 *		 
*/
int inNCCC_Func_Update_PEM_After_Para_Update(void)
{	
	char	szFilePath[200 + 1] = {0};
	char	szFilePathNew[200 + 1] = {0};
	char	szFilePathOld[200 + 1] = {0};
	char	szFilePath_Read[200 + 1] = {0};
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Update_PEM_After_Para_Update() START !");
	}
	
	memset(szFilePathOld, 0x00, sizeof(szFilePathOld));
	sprintf(szFilePathOld, "%s%s", _CA_DATA_PATH_FROM_FS_DATA_, _PEM_PRESERVE_TLS_FILE_NAME_);
	memset(szFilePathNew, 0x00, sizeof(szFilePathNew));
	sprintf(szFilePathNew, "%s%s", _CA_DATA_PATH_FROM_FS_DATA_, _PEM_NEW_TLS_FILE_NAME_);
	
	if (inFILE_Check_Exist((unsigned char*)_CER_UCA_FILE_NAME_) == VS_SUCCESS &&
	    inFILE_Check_Exist((unsigned char*)_CER_ROOT_FILE_NAME_) == VS_SUCCESS)
	{
		/* 製作憑證檔 */
		memset(szFilePath, 0x00, sizeof(szFilePath));
		sprintf(szFilePath, "%s%s", _CA_DATA_PATH_FROM_FS_DATA_, _PEM_NEW_TLS_BACKUP_FILE_NAME_);
		inFILE_Delete((unsigned char*)szFilePath);
		
		memset(szFilePath_Read, 0x00, sizeof(szFilePath_Read));
		sprintf(szFilePath_Read, "%s%s", _FS_DATA_PATH_FROM_FS_DATA_, _CER_UCA_FILE_NAME_);
		inNCCC_Func_Gernerate_PEM(szFilePath, szFilePath_Read);
		
		memset(szFilePath_Read, 0x00, sizeof(szFilePath_Read));
		sprintf(szFilePath_Read, "%s%s", _FS_DATA_PATH_FROM_FS_DATA_, _CER_ROOT_FILE_NAME_);
		inNCCC_Func_Gernerate_PEM(szFilePath, szFilePath_Read);
		
		/* 比對憑證檔 */
		if (inFunc_Compare_Files(szFilePath, szFilePathNew) == VS_SUCCESS)
		{
			/* 一樣就不處理 */
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "PEM Same , No Change");
			}
		}
		else
		{
			/* 若一樣不進行替換，若不同則刪除(舊憑證)，(新憑證)改名為_PEM_PRESERVE_TLS_FILE_NAME_(舊憑證) */
			inFILE_Delete((unsigned char*)szFilePathOld);
			inFILE_Rename((unsigned char*)szFilePathNew, (unsigned char*)szFilePathOld);
			inFILE_Rename((unsigned char*)szFilePath, (unsigned char*)szFilePathNew);
			
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "PEM Not Same, Change");
			}
		}
	}
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Update_PEM_After_Para_Update() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Check_CFES_Need_Change_PEM
Date&Time       :2024/5/21 下午 5:32
Describe        :確認是否為手動下載CFES使用IFES憑證，若比對與default PEM不同，則以default PEM取代之
 *		 
*/
int inNCCC_Func_Check_CFES_Need_Change_PEM(void)
{
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Check_CFES_Need_Change_PEM() START !");
	}

	char	szFilePath[200 + 1] = {0};
	char	szFilePathDefault[200 + 1] = {0};
	char	szLastDownloadMode[1 + 1] = {0};
	char	szCFESMode[1+ 1] = {0};
	char	szTempalate[50 + 1] = {0};
	char	szDemoMode[2 + 1] = {0};
	
	do
	{
		memset(szDemoMode, 0x00, sizeof(szDemoMode));
		inGetDemoMode(szDemoMode);
		if (!memcmp(szDemoMode, "Y", 1))
		{
			break;
		}
		
		/* 檢查是否為手動下載 */
		memset(szLastDownloadMode, 0x00, sizeof(szLastDownloadMode));
		inGetLastDownloadMode(szLastDownloadMode);
		memset(szTempalate, 0x00, sizeof(szTempalate));
		sprintf(szTempalate, "%02d", _TMS_MANUAL_DOWNLOAD_);
		
		if (memcmp(szLastDownloadMode, szTempalate, 2) != 0)
		{
			break;
		}
		
		/* 非CFES Mode */
		memset(szCFESMode, 0x00, sizeof(szCFESMode));
		inGetCloud_MFES(szCFESMode);
	
		if (memcmp(szCFESMode, "Y", 1) != 0)
		{
			break;
		}
	
		memset(szFilePath, 0x00, sizeof(szFilePath));
		sprintf(szFilePath, "%s%s", _CA_DATA_PATH_FROM_FS_DATA_, _PEM_NEW_TLS_FILE_NAME_);
		memset(szFilePathDefault, 0x00, sizeof(szFilePathDefault));
		sprintf(szFilePathDefault, "%s%s", _CA_DATA_PATH_FROM_FS_DATA_, _PEM_LDSS_FILE_NAME_);
	
		if (inFILE_Check_Exist((unsigned char*)_CER_UCA_FILE_NAME_) != VS_SUCCESS &&
		    inFILE_Check_Exist((unsigned char*)_CER_ROOT_FILE_NAME_) != VS_SUCCESS)
		{
			if (inFunc_Compare_Files(szFilePath, szFilePathDefault) != VS_SUCCESS)
			{
				inFILE_Delete((unsigned char*)szFilePath);
				inFILE_Copy_File((unsigned char*)szFilePathDefault, (unsigned char*)szFilePath);
			}
		}
		
		break;
	}
	while (1);
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Check_CFES_Need_Change_PEM() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	return (VS_SUCCESS);
}

/*
Function	:inNCCC_Func_Is_CUP_UPLAN_ONLY
Date&Time	:2024/8/23 上午 10:47
Describe        :確認格式是否為純銀聯優計畫格式
 *		不含EMV Code的優惠代碼，一般為18碼的純數字
*/
int inNCCC_Func_Is_CUP_UPLAN_ONLY(char* szString, int inStringLen)
{
	int	i = 0;
	
	/* 依照電文規格 優惠訊息長度只到19 且不是QRCode付款要過銀聯卡 */
	if (inStringLen >= 20)
	{
		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "length == %d >= 20 illegal", inStringLen);
		}
		
		return	(VS_FALSE);
	}
	
	for (i = 0; i < inStringLen; i++)
	{
		if ((szString[i] - '0') >= 0 &&
		    (szString[i] - '0') <= 9)
		{

		}
		else
		{
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "szString[%d] == %c illegal", i, szString[i]);
			}
			return (VS_FALSE);
		}
	}
	
	return	(VS_TRUE);
}

/*
Function	:inNCCC_Func_Analyse_UPlan_QRCODE
Date&Time	:2024/8/22 下午 3:39
Describe        :確認格式是否為CUP_EMV格式
 *		先從base64轉回資料，接著用TLV格式檢查，0x85開頭
*/
int inNCCC_Func_Analyse_UPlan_QRCODE(TRANSACTION_OBJECT * pobTran, char* szString, int inStringLen)
{
	int	i = 0;
	int	inLen = 0;
	int	inQRLen = 0;
	int	inRetVal = VS_SUCCESS;
	char	szQRCode_Template[512 + 1] = {0};
	char	szQRCode_ASCII[1024 + 1] = {0};
        unsigned char	uszQRCode_BCD[1024 + 1] = {0};
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Analyse_UPlan_QRCODE() START !");
		inLogPrintf(AT, "szString : [%s]", szString);
		inLogPrintf(AT, "inStringLen : [%d]", inStringLen);
	}
	
	memset(szQRCode_Template, 0x00, sizeof(szQRCode_Template));
	memcpy(&szQRCode_Template[0], szString, inStringLen);
	
	inQRLen = inStringLen;

	i = inQRLen % 4;

	switch (i)
	{
		case 1:
			strcat(szQRCode_Template, "===");
			inQRLen += 3;
			break;
		case 2:
			strcat(szQRCode_Template, "==");
			inQRLen += 2;
			break;
		case 3:
			strcat(szQRCode_Template, "=");
			inQRLen ++;
			break;
		default:
			break;
	}
	
	memset(uszQRCode_BCD, 0x00, sizeof(uszQRCode_BCD));

	/* 反解base64 */
	inLen = inFunc_Base64_Decryption((char*)uszQRCode_BCD, szQRCode_Template, inQRLen);
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inLen = %d", inLen);
	}

	if (inLen < 0)
	{
		return (VS_ERROR);
	}
	
	if (ginISODebug == VS_TRUE)
	{
		inPRINT_ChineseFont("base64反解", _PRT_ISO_);
		inPRINT_ChineseFont("--------------------", _PRT_ISO_);
		memset(szQRCode_ASCII, 0x00, sizeof(szQRCode_ASCII));
		inFunc_BCD_to_ASCII(szQRCode_ASCII, (unsigned char*)uszQRCode_BCD, inLen);
		inPRINT_ChineseFont(szQRCode_ASCII, _PRT_ISO_);
		inPRINT_ChineseFont("--------------------", _PRT_ISO_);
	}
	
	if (uszQRCode_BCD[0] == 0x85)
	{
		inRetVal = VS_SUCCESS;
	}
	else
	{
		inRetVal = VS_ERROR;
	}
        
        inNCCC_Func_Process_CUP_QRCODE(pobTran, (unsigned char*)uszQRCode_BCD, inLen);
	
	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inNCCC_Func_Analyse_UPlan_QRCODE() END !");
		inLogPrintf(AT, "----------------------------------------");
	}
	
	if (inRetVal == VS_SUCCESS)
	{
		return	(VS_SUCCESS);
	}
	else
	{
		return	(VS_ERROR);
	}
} 

/*
Function	:inNCCC_Func_Process_CUP_QRCODE
Date&Time	:2024/8/23 下午 3:29
Describe        :CUP QRCODE 解析
*/
int inNCCC_Func_Process_CUP_QRCODE(TRANSACTION_OBJECT *pobTran, unsigned char *szInputTLVData, int inDataSizes)
{
	int		inCnt = 0;
	int		inTLVName = 0;
	int		inOtherTLVLen = 0;
	unsigned int	uinTagName = 0;
	unsigned short	ushTagLen = 0;
	char		szTemplate[128 + 1] = {0}, szASCII[256 + 1] = {0};
	BYTE		btTagData[256 + 1] = {0};
	VS_BOOL		f9F37 = VS_FALSE, f95 = VS_FALSE, f9A = VS_FALSE, f9C = VS_FALSE, f9F02 = VS_FALSE,
			f5F2A = VS_FALSE, f9F1A = VS_FALSE, f9F03 = VS_FALSE, f9F33 = VS_FALSE;

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "----------------------------------------");
		inLogPrintf(AT, "inNCCC_Func_Process_CUP_QRCODE()_[%d]_START", inDataSizes);
	}

	if (ginISODebug == VS_TRUE)
	{
	        inPRINT_ChineseFont("==========================================", _PRT_ISO_);
		inPRINT_ChineseFont("QRCode Tag", _PRT_ISO_);
	}

	for ( ; inCnt < inDataSizes ;)
	{
		inTLVName = 0;

		if ((szInputTLVData[inCnt] & 0x1F) == 0x1F)
		{
			uinTagName = (szInputTLVData[inCnt] << 8) + szInputTLVData[inCnt + 1];
			/* 2-Byte Tag */
			inTLVName = 2;
		}
		else
		{
			uinTagName = szInputTLVData[inCnt];
			/* 1-Byte Tag */
			inTLVName = 1;
		}

		/* 處理 EMV TLV 長度是【0】 */
		if (inTLVName == 1)
		{
			if (szInputTLVData[inCnt + 1] == 0x00)
			{
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "           CHECK_TAG_ZERO_[%02X][%02X]", szInputTLVData[inCnt], szInputTLVData[inCnt + 1]);
				}
				inCnt += 2;
				continue;
			}
		}
		else
		{
			if (szInputTLVData[inCnt + 2] == 0x00)
			{
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "           CHECK_TAG_ZERO_[%02X][%02X][%02X]", szInputTLVData[inCnt], szInputTLVData[inCnt + 1], szInputTLVData[inCnt + 2]);
				}
				inCnt += 3;
				continue;
			}
		}

		switch (uinTagName)
		{
			case 0x4F :
				inCnt += 1;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				if (ginDebug == VS_TRUE)
				{
					/* Print debug */
					memset(szASCII, 0x00, sizeof(szASCII));
					inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);
					inLogPrintf(AT, "  TAG_4F[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 4F (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x50 :
				inCnt += 1;
				ushTagLen = szInputTLVData[inCnt ++];

				if (ushTagLen > 75)
					pobTran->srEMVRec.in50_APLabelLen = 75;
				else
					pobTran->srEMVRec.in50_APLabelLen = ushTagLen;

				memset(pobTran->srEMVRec.usz50_APLabel, 0x00, sizeof(pobTran->srEMVRec.usz50_APLabel));
				memcpy(&pobTran->srEMVRec.usz50_APLabel[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_50[%02d][%s]", ushTagLen, pobTran->srEMVRec.usz50_APLabel);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 50 (%02d) [%s]", ushTagLen, pobTran->srEMVRec.usz50_APLabel);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x55 :
				inCnt += 1;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;

				if (ginDebug == VS_TRUE)
				{
					/* Print debug */
					memset(szASCII, 0x00, sizeof(szASCII));
					inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);
					inLogPrintf(AT, "  TAG_55[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 55 (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x57 :
				inCnt += 1;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);
                                /* 組TAG_57 */
                                memset(pobTran->usz57_Track2, 0x00, sizeof(pobTran->usz57_Track2));
                                memcpy(&pobTran->usz57_Track2[0], (char *)&btTagData[0], ushTagLen);
                                pobTran->in57_Track2Len = ushTagLen;
                                
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_57[%02d][%s]", ushTagLen, szASCII);
				}

                		if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 57 (%02d) [%s]", ushTagLen, "-----");
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x5A :
				inCnt += 1;
				pobTran->srEMVRec.in5A_ApplPanLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz5A_ApplPan, 0x00, sizeof(pobTran->srEMVRec.usz5A_ApplPan));
				memcpy((char *)&pobTran->srEMVRec.usz5A_ApplPan[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in5A_ApplPanLen);
				inCnt += pobTran->srEMVRec.in5A_ApplPanLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz5A_ApplPan[0], pobTran->srEMVRec.in5A_ApplPanLen);
				{
					inLogPrintf(AT, "  TAG_5A[%02d][%s]", pobTran->srEMVRec.in5A_ApplPanLen, "-----");
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 5A (%02d) [%s]", pobTran->srEMVRec.in5A_ApplPanLen, "-----");
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x5F20 :
				inCnt += 2;
				ushTagLen = szInputTLVData[inCnt ++];
                                memset(pobTran->srEMVRec.usz5F20_CardholderName, 0x00, sizeof(pobTran->srEMVRec.usz5F20_CardholderName));
                                memcpy(&pobTran->srEMVRec.usz5F20_CardholderName[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_5F20[%02d][%s]", ushTagLen, pobTran->srEMVRec.usz5F20_CardholderName);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 5F20 (%02d) [%s]", ushTagLen, pobTran->srEMVRec.usz5F20_CardholderName);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x5F24 :
				inCnt += 2;
				pobTran->srEMVRec.in5F24_ExpireDateLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz5F24_ExpireDate, 0x00, sizeof(pobTran->srEMVRec.usz5F24_ExpireDate));
				memcpy((char *)&pobTran->srEMVRec.usz5F24_ExpireDate[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in5F24_ExpireDateLen);
				inCnt += pobTran->srEMVRec.in5F24_ExpireDateLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz5F24_ExpireDate[0], pobTran->srEMVRec.in5F24_ExpireDateLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_5F24[%02d][%s]", pobTran->srEMVRec.in5F24_ExpireDateLen, "-----");
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 5F24 (%02d) [%s]", pobTran->srEMVRec.in5F24_ExpireDateLen, "-----");
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			/* 【需求單 - 106252】DCC交易新增感應及BIN11碼 add by LingHsiung 2018/7/12 下午 02:53:29 */
			case 0x5F28 :
				inCnt += 2;
				pobTran->srEMVRec.in5F28_IssuerCountryCodeLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz5F28_IssuerCountryCode, 0x00, sizeof(pobTran->srEMVRec.usz5F28_IssuerCountryCode));
				memcpy((char *)&pobTran->srEMVRec.usz5F28_IssuerCountryCode[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in5F28_IssuerCountryCodeLen);
				inCnt += pobTran->srEMVRec.in5F28_IssuerCountryCodeLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz5F28_IssuerCountryCode[0], pobTran->srEMVRec.in5F28_IssuerCountryCodeLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_5F28[%02d][%s]", pobTran->srEMVRec.in5F28_IssuerCountryCodeLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 5F28 (%02d) [%s]", pobTran->srEMVRec.in5F28_IssuerCountryCodeLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x5F2A :
				f5F2A = VS_TRUE;
				inCnt += 2;
				pobTran->srEMVRec.in5F2A_TransCurrCodeLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz5F2A_TransCurrCode, 0x00, sizeof(pobTran->srEMVRec.usz5F2A_TransCurrCode));
				memcpy((char *)&pobTran->srEMVRec.usz5F2A_TransCurrCode[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in5F2A_TransCurrCodeLen);
				inCnt += pobTran->srEMVRec.in5F2A_TransCurrCodeLen;

				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz5F2A_TransCurrCode[0], pobTran->srEMVRec.in5F2A_TransCurrCodeLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_5F2A[%02d][%s]", pobTran->srEMVRec.in5F2A_TransCurrCodeLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 5F2A (%02d) [%s]", pobTran->srEMVRec.in5F2A_TransCurrCodeLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x5F2D :
                                /* 【需求單 - 104094】銀聯閃付需求 by Wei Hsiu - 2015/8/13 下午 10:12:06 */
				inCnt += 2;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_5F2D[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 5F2D (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x5F34 :
				inCnt += 2;
				pobTran->srEMVRec.in5F34_ApplPanSeqnumLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz5F34_ApplPanSeqnum, 0x00, sizeof(pobTran->srEMVRec.usz5F34_ApplPanSeqnum));
				memcpy((char *)&pobTran->srEMVRec.usz5F34_ApplPanSeqnum[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in5F34_ApplPanSeqnumLen);
				inCnt += pobTran->srEMVRec.in5F34_ApplPanSeqnumLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz5F34_ApplPanSeqnum[0], pobTran->srEMVRec.in5F34_ApplPanSeqnumLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_5F34[%02d][%s]", pobTran->srEMVRec.in5F34_ApplPanSeqnumLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 5F34 (%02d) [%s]", pobTran->srEMVRec.in5F34_ApplPanSeqnumLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x82 :
				inCnt += 1;
				pobTran->srEMVRec.in82_AIPLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz82_AIP, 0x00, sizeof(pobTran->srEMVRec.usz82_AIP));
				memcpy((char *)&pobTran->srEMVRec.usz82_AIP[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in82_AIPLen);
				inCnt += pobTran->srEMVRec.in82_AIPLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz82_AIP[0], pobTran->srEMVRec.in82_AIPLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_82[%02d][%s]", pobTran->srEMVRec.in82_AIPLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 82 (%02d) [%s]", pobTran->srEMVRec.in82_AIPLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x61 :
				/* 後面會接總長度 */
				inCnt ++;
				inOtherTLVLen = szInputTLVData[inCnt ++];
				/* Print debug */
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_61[%03d]", inOtherTLVLen);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 61 (%03d)", inOtherTLVLen);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x63 :
				/* 後面會接總長度 */
				inCnt ++;
				inOtherTLVLen = szInputTLVData[inCnt ++];
				/* Print debug */
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_63[%03d]", inOtherTLVLen);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 63 (%03d)", inOtherTLVLen);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x84 :
				inCnt += 1;
				pobTran->srEMVRec.in84_DFNameLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz84_DF_NAME, 0x00, sizeof(pobTran->srEMVRec.usz84_DF_NAME));
				memcpy((char *)&pobTran->srEMVRec.usz84_DF_NAME[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in84_DFNameLen);
				inCnt += pobTran->srEMVRec.in84_DFNameLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz84_DF_NAME[0], pobTran->srEMVRec.in84_DFNameLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_84[%02d][%s]", pobTran->srEMVRec.in84_DFNameLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 84 (%02d) [%s]", pobTran->srEMVRec.in84_DFNameLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x85 :
				/* 目前沒有用處的Tag */
				inCnt ++;
				inOtherTLVLen = szInputTLVData[inCnt ++];
				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy(&szTemplate[0], &szInputTLVData[inCnt], inOtherTLVLen);
				inCnt += inOtherTLVLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, (unsigned char*)&szTemplate[0], inOtherTLVLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_85[%02d][%s]", inOtherTLVLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 85 (%02d) [%s]", inOtherTLVLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x8A :
				inCnt += 1;
				pobTran->srEMVRec.in8A_AuthRespCodeLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz8A_AuthRespCode, 0x00, sizeof(pobTran->srEMVRec.usz8A_AuthRespCode));
				memcpy((char *)&pobTran->srEMVRec.usz8A_AuthRespCode[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in8A_AuthRespCodeLen);
				inCnt += pobTran->srEMVRec.in8A_AuthRespCodeLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz8A_AuthRespCode[0], pobTran->srEMVRec.in8A_AuthRespCodeLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_8A[%02d][%s]", pobTran->srEMVRec.in8A_AuthRespCodeLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 8A (%02d) [%s]", pobTran->srEMVRec.in8A_AuthRespCodeLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x8E :
				inCnt += 1;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_8E[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 8E (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x8F :
				inCnt += 1;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_8F[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 8F (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x95 :
				f95 = VS_TRUE;
				inCnt += 1;
				pobTran->srEMVRec.in95_TVRLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz95_TVR, 0x00, sizeof(pobTran->srEMVRec.usz95_TVR));
				memcpy((char *)&pobTran->srEMVRec.usz95_TVR[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in95_TVRLen);
				inCnt += pobTran->srEMVRec.in95_TVRLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz95_TVR[0], pobTran->srEMVRec.in95_TVRLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_95[%02d][%s]", pobTran->srEMVRec.in95_TVRLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 95 (%02d) [%s]", pobTran->srEMVRec.in95_TVRLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9A :
				f9A = VS_TRUE;
				inCnt += 1;
				pobTran->srEMVRec.in9A_TranDateLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9A_TranDate, 0x00, sizeof(pobTran->srEMVRec.usz9A_TranDate));
				memcpy((char *)&pobTran->srEMVRec.usz9A_TranDate[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9A_TranDateLen);
				inCnt += pobTran->srEMVRec.in9A_TranDateLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9A_TranDate[0], pobTran->srEMVRec.in9A_TranDateLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9A[%02d][%s]", pobTran->srEMVRec.in9A_TranDateLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9A (%02d) [%s]", pobTran->srEMVRec.in9A_TranDateLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9B :
				inCnt += 1;
				pobTran->srEMVRec.in9B_TSILen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9B_TSI, 0x00, sizeof(pobTran->srEMVRec.usz9B_TSI));
				memcpy((char *)&pobTran->srEMVRec.usz9B_TSI[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9B_TSILen);
				inCnt += pobTran->srEMVRec.in9B_TSILen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9B_TSI[0], pobTran->srEMVRec.in9B_TSILen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9B[%02d][%s]", pobTran->srEMVRec.in9B_TSILen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9B (%02d) [%s]", pobTran->srEMVRec.in9B_TSILen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9C :
				f9C = VS_TRUE;
				inCnt += 1;
				pobTran->srEMVRec.in9C_TranTypeLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9C_TranType, 0x00, sizeof(pobTran->srEMVRec.usz9C_TranType));
				memcpy((char *)&pobTran->srEMVRec.usz9C_TranType[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9C_TranTypeLen);
				inCnt += pobTran->srEMVRec.in9C_TranTypeLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9C_TranType[0], pobTran->srEMVRec.in9C_TranTypeLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9C[%02d][%s]", pobTran->srEMVRec.in9C_TranTypeLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9C (%02d) [%s]", pobTran->srEMVRec.in9C_TranTypeLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F02 :
				f9F02 = VS_TRUE;
				inCnt += 2;
				pobTran->srEMVRec.in9F02_AmtAuthNumLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F02_AmtAuthNum, 0x00, sizeof(pobTran->srEMVRec.usz9F02_AmtAuthNum));
				memcpy((char *)&pobTran->srEMVRec.usz9F02_AmtAuthNum[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F02_AmtAuthNumLen);
				inCnt += pobTran->srEMVRec.in9F02_AmtAuthNumLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F02_AmtAuthNum[0], pobTran->srEMVRec.in9F02_AmtAuthNumLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F02[%02d][%s]", pobTran->srEMVRec.in9F02_AmtAuthNumLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F02 (%02d) [%s]", pobTran->srEMVRec.in9F02_AmtAuthNumLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F03 :
				f9F03 = VS_TRUE;
				inCnt += 2;
				pobTran->srEMVRec.in9F03_AmtOtherNumLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F03_AmtOtherNum, 0x00, sizeof(pobTran->srEMVRec.usz9F03_AmtOtherNum));
				memcpy((char *)&pobTran->srEMVRec.usz9F03_AmtOtherNum[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F03_AmtOtherNumLen);
				inCnt += pobTran->srEMVRec.in9F03_AmtOtherNumLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F03_AmtOtherNum[0], pobTran->srEMVRec.in9F03_AmtOtherNumLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F03[%02d][%s]", pobTran->srEMVRec.in9F03_AmtOtherNumLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F03 (%02d) [%s]", pobTran->srEMVRec.in9F03_AmtOtherNumLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F06 :
                                /* 【需求單 - 104094】銀聯閃付需求 by Wei Hsiu - 2015/8/13 下午 10:12:06 */
				inCnt += 2;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F06[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F06 (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F08 :
				inCnt += 2;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F08[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F08 (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F09 :
				inCnt += 2;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F09[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F09 (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F10 :
				inCnt += 2;
				pobTran->srEMVRec.in9F10_IssuerAppDataLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F10_IssuerAppData, 0x00, sizeof(pobTran->srEMVRec.usz9F10_IssuerAppData));
				memcpy((char *)&pobTran->srEMVRec.usz9F10_IssuerAppData[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F10_IssuerAppDataLen);
				inCnt += pobTran->srEMVRec.in9F10_IssuerAppDataLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F10_IssuerAppData[0], pobTran->srEMVRec.in9F10_IssuerAppDataLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F10[%02d][%s]", pobTran->srEMVRec.in9F10_IssuerAppDataLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F10 (%02d) [%s]", pobTran->srEMVRec.in9F10_IssuerAppDataLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F12 :
                                /* 【需求單 - 104094】銀聯閃付需求 by Wei Hsiu - 2015/8/13 下午 10:12:06 */
				inCnt += 2;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F12[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F12 (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F1A :
				f9F1A = VS_TRUE;
				inCnt += 2;
				pobTran->srEMVRec.in9F1A_TermCountryCodeLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F1A_TermCountryCode, 0x00, sizeof(pobTran->srEMVRec.usz9F1A_TermCountryCode));
				memcpy((char *)&pobTran->srEMVRec.usz9F1A_TermCountryCode[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F1A_TermCountryCodeLen);
				inCnt += pobTran->srEMVRec.in9F1A_TermCountryCodeLen;

				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F1A_TermCountryCode[0], pobTran->srEMVRec.in9F1A_TermCountryCodeLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F1A[%02d][%s]", pobTran->srEMVRec.in9F1A_TermCountryCodeLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F1A (%02d) [%s]", pobTran->srEMVRec.in9F1A_TermCountryCodeLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F1E :
				inCnt += 2;
				pobTran->srEMVRec.in9F1E_IFDNumLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F1E_IFDNum, 0x00, sizeof(pobTran->srEMVRec.usz9F1E_IFDNum));
				memcpy((char *)&pobTran->srEMVRec.usz9F1E_IFDNum[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F1E_IFDNumLen);
				inCnt += pobTran->srEMVRec.in9F1E_IFDNumLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F1E_IFDNum[0], pobTran->srEMVRec.in9F1E_IFDNumLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F1E[%02d][%s]", pobTran->srEMVRec.in9F1E_IFDNumLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F1E (%02d) [%s]", pobTran->srEMVRec.in9F1E_IFDNumLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F21 :
				inCnt += 2;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F21[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F21 (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F26 :
				inCnt += 2;
				pobTran->srEMVRec.in9F26_ApplCryptogramLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F26_ApplCryptogram, 0x00, sizeof(pobTran->srEMVRec.usz9F26_ApplCryptogram));
				memcpy((char *)&pobTran->srEMVRec.usz9F26_ApplCryptogram[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F26_ApplCryptogramLen);
				inCnt += pobTran->srEMVRec.in9F26_ApplCryptogramLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F26_ApplCryptogram[0], pobTran->srEMVRec.in9F26_ApplCryptogramLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F26[%02d][%s]", pobTran->srEMVRec.in9F26_ApplCryptogramLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F26 (%02d) [%s]", pobTran->srEMVRec.in9F26_ApplCryptogramLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F27 :
				inCnt += 2;
				pobTran->srEMVRec.in9F27_CIDLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F27_CID, 0x00, sizeof(pobTran->srEMVRec.usz9F27_CID));
				memcpy((char *)&pobTran->srEMVRec.usz9F27_CID[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F27_CIDLen);
				inCnt += pobTran->srEMVRec.in9F27_CIDLen;

				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F27_CID[0], pobTran->srEMVRec.in9F27_CIDLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F27[%02d][%s]", pobTran->srEMVRec.in9F27_CIDLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F27 (%02d) [%s]", pobTran->srEMVRec.in9F27_CIDLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F33 :
				f9F33 = VS_TRUE;
				inCnt += 2;
				pobTran->srEMVRec.in9F33_TermCapabilitiesLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F33_TermCapabilities, 0x00, sizeof(pobTran->srEMVRec.usz9F33_TermCapabilities));
				memcpy((char *)&pobTran->srEMVRec.usz9F33_TermCapabilities[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F33_TermCapabilitiesLen);
				inCnt += pobTran->srEMVRec.in9F33_TermCapabilitiesLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F33_TermCapabilities[0], pobTran->srEMVRec.in9F33_TermCapabilitiesLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F33[%02d][%s]", pobTran->srEMVRec.in9F33_TermCapabilitiesLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F33 (%02d) [%s]", pobTran->srEMVRec.in9F33_TermCapabilitiesLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F34 :
				inCnt += 2;
				pobTran->srEMVRec.in9F34_CVMLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F34_CVM, 0x00, sizeof(pobTran->srEMVRec.usz9F34_CVM));
				memcpy((char *)&pobTran->srEMVRec.usz9F34_CVM[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F34_CVMLen);
				inCnt += pobTran->srEMVRec.in9F34_CVMLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F34_CVM[0], pobTran->srEMVRec.in9F34_CVMLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F34[%02d][%s]", pobTran->srEMVRec.in9F34_CVMLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F34 (%02d) [%s]", pobTran->srEMVRec.in9F34_CVMLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F35 :
				inCnt += 2;
				pobTran->srEMVRec.in9F35_TermTypeLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F35_TermType, 0x00, sizeof(pobTran->srEMVRec.usz9F35_TermType));
				memcpy((char *)&pobTran->srEMVRec.usz9F35_TermType[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F35_TermTypeLen);
				inCnt += pobTran->srEMVRec.in9F35_TermTypeLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F35_TermType[0], pobTran->srEMVRec.in9F35_TermTypeLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F35[%02d][%s]", pobTran->srEMVRec.in9F35_TermTypeLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F35 (%02d) [%s]", pobTran->srEMVRec.in9F35_TermTypeLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F36 :
				inCnt += 2;
				pobTran->srEMVRec.in9F36_ATCLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F36_ATC, 0x00, sizeof(pobTran->srEMVRec.usz9F36_ATC));
				memcpy((char *)&pobTran->srEMVRec.usz9F36_ATC[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F36_ATCLen);
				inCnt += pobTran->srEMVRec.in9F36_ATCLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F36_ATC[0], pobTran->srEMVRec.in9F36_ATCLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F36[%02d][%s]", pobTran->srEMVRec.in9F36_ATCLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F36 (%02d) [%s]", pobTran->srEMVRec.in9F36_ATCLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F37 :
				f9F37 = VS_TRUE;
				inCnt += 2;
				pobTran->srEMVRec.in9F37_UnpredictNumLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F37_UnpredictNum, 0x00, sizeof(pobTran->srEMVRec.usz9F37_UnpredictNum));
				memcpy((char *)&pobTran->srEMVRec.usz9F37_UnpredictNum[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F37_UnpredictNumLen);
				inCnt += pobTran->srEMVRec.in9F37_UnpredictNumLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F37_UnpredictNum[0], pobTran->srEMVRec.in9F37_UnpredictNumLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F37[%02d][%s]", pobTran->srEMVRec.in9F37_UnpredictNumLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F37 (%02d) [%s]", pobTran->srEMVRec.in9F37_UnpredictNumLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F41 :
				inCnt += 2;
				pobTran->srEMVRec.in9F41_TransSeqCounterLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F41_TransSeqCounter, 0x00, sizeof(pobTran->srEMVRec.usz9F41_TransSeqCounter));
				memcpy((char *)&pobTran->srEMVRec.usz9F41_TransSeqCounter[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F41_TransSeqCounterLen);
				inCnt += pobTran->srEMVRec.in9F41_TransSeqCounterLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F41_TransSeqCounter[0], pobTran->srEMVRec.in9F41_TransSeqCounterLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F41[%02d][%s]", pobTran->srEMVRec.in9F41_TransSeqCounterLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F41 (%02d) [%s]", pobTran->srEMVRec.in9F41_TransSeqCounterLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F42 :
				inCnt += 2;
				pobTran->srEMVRec.in9F42_ApplicationCurrencyCodeLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F42_ApplicationCurrencyCode, 0x00, sizeof(pobTran->srEMVRec.usz9F42_ApplicationCurrencyCode));
				memcpy((char *)&pobTran->srEMVRec.usz9F42_ApplicationCurrencyCode[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F42_ApplicationCurrencyCodeLen);
				inCnt += pobTran->srEMVRec.in9F42_ApplicationCurrencyCodeLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F42_ApplicationCurrencyCode[0], pobTran->srEMVRec.in9F42_ApplicationCurrencyCodeLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F42[%02d][%s]", pobTran->srEMVRec.in9F42_ApplicationCurrencyCodeLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F42 (%02d) [%s]", pobTran->srEMVRec.in9F42_ApplicationCurrencyCodeLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F45 :
				inCnt += 2;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F45[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F45 (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F51 :
				inCnt += 2;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F51[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F51 (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F53 :
				inCnt += 2;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F53[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F53 (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F5D :
				inCnt += 2;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F5D[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F5D (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F60 :
				inCnt += 2;
				ushTagLen = szInputTLVData[inCnt ++];

				/* Field 55送9F60 */
				pobTran->srEMVRec.in9F60_CouponInformationLen = ushTagLen;
				memset(pobTran->srEMVRec.usz9F60_CouponInformation, 0x00, sizeof(pobTran->srEMVRec.usz9F60_CouponInformation));
				memcpy((char *)&pobTran->srEMVRec.usz9F60_CouponInformation[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F60_CouponInformationLen);

				memset(szASCII, 0x00, sizeof(szASCII));
				memcpy(&szASCII[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F60[%02d][%s]", ushTagLen, szASCII);
				}

				/* 銀聯優計畫的二碼合一 優惠內容在tag 9F60 */
				memset(pobTran->srBRec.szUPlan_Coupon, 0x00, sizeof(pobTran->srBRec.szUPlan_Coupon));
				memcpy(&pobTran->srBRec.szUPlan_Coupon[0], &szASCII[4], (ushTagLen - 4));

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F60 (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Coupon data [%s]", pobTran->srBRec.szUPlan_Coupon);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F63 :
				inCnt += 2;
				pobTran->srEMVRec.in9F63_CardProductLabelInformationLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F63_CardProductLabelInformation, 0x00, sizeof(pobTran->srEMVRec.usz9F63_CardProductLabelInformation));
				memcpy((char *)&pobTran->srEMVRec.usz9F63_CardProductLabelInformation[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F63_CardProductLabelInformationLen);
				inCnt += pobTran->srEMVRec.in9F63_CardProductLabelInformationLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F63_CardProductLabelInformation[0], pobTran->srEMVRec.in9F63_CardProductLabelInformationLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F63[%02d][%s]", pobTran->srEMVRec.in9F63_CardProductLabelInformationLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F63 (%02d) [%s]", pobTran->srEMVRec.in9F63_CardProductLabelInformationLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F66 :
				inCnt += 2;
				pobTran->srEMVRec.in9F66_QualifiersLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F66_Qualifiers, 0x00, sizeof(pobTran->srEMVRec.usz9F66_Qualifiers));
				memcpy((char *)&pobTran->srEMVRec.usz9F66_Qualifiers[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F66_QualifiersLen);
				inCnt += pobTran->srEMVRec.in9F66_QualifiersLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F66_Qualifiers[0], pobTran->srEMVRec.in9F66_QualifiersLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F66[%02d][%s]", pobTran->srEMVRec.in9F66_QualifiersLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F66 (%02d) [%s]", pobTran->srEMVRec.in9F66_QualifiersLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F68 :
				inCnt += 2;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F68[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F68 (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F6C :
				inCnt += 2;
				pobTran->srEMVRec.in9F6C_Card_Transaction_QualifiersLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F6C_Card_Transaction_Qualifiers, 0x00, sizeof(pobTran->srEMVRec.usz9F6C_Card_Transaction_Qualifiers));
				memcpy((char *)&pobTran->srEMVRec.usz9F6C_Card_Transaction_Qualifiers[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F6C_Card_Transaction_QualifiersLen);
				inCnt += pobTran->srEMVRec.in9F6C_Card_Transaction_QualifiersLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F6C_Card_Transaction_Qualifiers[0], pobTran->srEMVRec.in9F6C_Card_Transaction_QualifiersLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F6C[%02d][%s]", pobTran->srEMVRec.in9F6C_Card_Transaction_QualifiersLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F6C (%02d) [%s]", pobTran->srEMVRec.in9F6C_Card_Transaction_QualifiersLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F6D :
				inCnt += 2;
				ushTagLen = szInputTLVData[inCnt ++];
				memset(btTagData, 0x00, sizeof(btTagData));
				memcpy((char *)&btTagData[0], &szInputTLVData[inCnt], ushTagLen);
				inCnt += ushTagLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &btTagData[0], ushTagLen);

				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F6D[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F6D (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F6E :
				inCnt += 2;
				pobTran->srEMVRec.in9F6E_From_Factor_IndicatorLen = szInputTLVData[inCnt ++];
				memset(pobTran->srEMVRec.usz9F6E_From_Factor_Indicator, 0x00, sizeof(pobTran->srEMVRec.usz9F6E_From_Factor_Indicator));
				memcpy((char *)&pobTran->srEMVRec.usz9F6E_From_Factor_Indicator[0], &szInputTLVData[inCnt], pobTran->srEMVRec.in9F6E_From_Factor_IndicatorLen);
				inCnt += pobTran->srEMVRec.in9F6E_From_Factor_IndicatorLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, &pobTran->srEMVRec.usz9F6E_From_Factor_Indicator[0], pobTran->srEMVRec.in9F6E_From_Factor_IndicatorLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F6E[%02d][%s]", pobTran->srEMVRec.in9F6E_From_Factor_IndicatorLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F6E (%02d) [%s]", pobTran->srEMVRec.in9F6E_From_Factor_IndicatorLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0x9F74 :
				inCnt += 2;
				ushTagLen = szInputTLVData[inCnt ++];

				/* 感應退貨不能塞VLP */
				if (pobTran->inTransactionCode == _REFUND_	||
				    pobTran->inTransactionCode == _CUP_REFUND_)
				{
					
				}
				else
				{
					memset(pobTran->srBRec.szAuthCode, 0x00, sizeof(pobTran->srBRec.szAuthCode));
					memcpy((char *)&pobTran->srBRec.szAuthCode[0], &szInputTLVData[inCnt], ushTagLen);
				}

				/* Debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				memcpy((char *)&szASCII[0], &szInputTLVData[inCnt], ushTagLen);

				inCnt += ushTagLen;

				/* Print debug */
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_9F74[%02d][%s]", ushTagLen, szASCII);
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag 9F74 (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			case 0xDF55 :
				/* Transaction Mode (DF55) */
				/* The transaction mode describes in which mode (EMV, Legacy, or Magstripe) the transaction was performed.  */
				inCnt += 2;
				ushTagLen = szInputTLVData[inCnt ++];

				memset(szTemplate, 0x00, sizeof(szTemplate));
				memcpy((char *)&szTemplate[0], &szInputTLVData[inCnt], ushTagLen);

				inCnt += ushTagLen;
				/* Print debug */
				memset(szASCII, 0x00, sizeof(szASCII));
				inFunc_BCD_to_ASCII(szASCII, (unsigned char*)&szTemplate[0], ushTagLen);
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "  TAG_DF55[%02d][%s]", ushTagLen, szASCII);
				}

				/* New Jspeedy 1.3 add by LingHsiung 2016-04-18 下午 05:29:48 */
				/* VX820是使用DF55來區分New Jspeedy卡片種類 沿用原判斷式的DF69 NewJspeedyMode */
				if (!memcmp(&szASCII[0], "0200" , 2))
				{
					memset(pobTran->srEMVRec.uszDF69_NewJspeedyMode, 0x00, sizeof(pobTran->srEMVRec.uszDF69_NewJspeedyMode));
					pobTran->srEMVRec.uszDF69_NewJspeedyMode[0] = 0x02;

				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  Tag DF55 (%02d) [%s]", ushTagLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
			default :
				/* 列印沒有定義的【Tag】 */
				if (inTLVName == 1)
				{
					inCnt ++;
					inOtherTLVLen = szInputTLVData[inCnt ++];
					memset(szTemplate, 0x00, sizeof(szTemplate));
					memcpy(&szTemplate[0], &szInputTLVData[inCnt], inOtherTLVLen);
					inCnt += inOtherTLVLen;
					/* Print debug */
					memset(szASCII, 0x00, sizeof(szASCII));
					inFunc_BCD_to_ASCII(szASCII, (unsigned char*)&szTemplate[0], inOtherTLVLen);
					if (ginDebug == VS_TRUE)
					{
						inLogPrintf(AT, "           OTHER_TAG_[%02X][%03d][%s]", szInputTLVData[inCnt - 2 - inOtherTLVLen], inOtherTLVLen, szASCII);
					}
				}
				else
				{
					inCnt += 2;
					inOtherTLVLen = szInputTLVData[inCnt ++];
					memset(szTemplate, 0x00, sizeof(szTemplate));
					memcpy(&szTemplate[0], &szInputTLVData[inCnt], inOtherTLVLen);
					inCnt += inOtherTLVLen;
					/* Print debug */
					memset(szASCII, 0x00, sizeof(szASCII));
					inFunc_BCD_to_ASCII(szASCII, (unsigned char*)&szTemplate[0], inOtherTLVLen);
					if (ginDebug == VS_TRUE)
					{
						inLogPrintf(AT, "           OTHER_TAG_[%02X %02X][%03d][%s]", szInputTLVData[inCnt - 3 - inOtherTLVLen], szInputTLVData[inCnt - 2 - inOtherTLVLen], inOtherTLVLen, szASCII);
					}
				}

				if (ginISODebug == VS_TRUE)
				{
				        memset(szTemplate, 0x00, sizeof(szTemplate));
					sprintf(szTemplate, "  OTHER_TAG [%02X %02X] (%02d) [%s]", szInputTLVData[inCnt - 3 - inOtherTLVLen], szInputTLVData[inCnt - 2 - inOtherTLVLen], inOtherTLVLen, szASCII);
					inPRINT_ChineseFont(szTemplate, _PRT_ISO_);
				}

				break;
		}
	} /* End for () .... */

        if (ginISODebug == VS_TRUE)
	{
	        inPRINT_ChineseFont("==========================================", _PRT_ISO_);
	}

	/* 銀聯U計畫規格 QRC如果沒值要帶入預設值 */
	if (f9F37 == VS_FALSE)
	{
		pobTran->srEMVRec.in9F37_UnpredictNumLen = 4;
		memset(pobTran->srEMVRec.usz9F37_UnpredictNum, 0x00, sizeof(pobTran->srEMVRec.usz9F37_UnpredictNum));
		memcpy((char *)&pobTran->srEMVRec.usz9F37_UnpredictNum[0], "\x12\x23\x56\x78", pobTran->srEMVRec.in9F37_UnpredictNumLen);
	}

	if (f95 == VS_FALSE)
	{
		pobTran->srEMVRec.in95_TVRLen = 5;
		memset(pobTran->srEMVRec.usz95_TVR, 0x00, sizeof(pobTran->srEMVRec.usz95_TVR));
		memcpy((char *)&pobTran->srEMVRec.usz95_TVR[0], "\x00\x00\x00\x08\x00", pobTran->srEMVRec.in95_TVRLen);
	}

	if (f9A == VS_FALSE)
	{
		pobTran->srEMVRec.in9A_TranDateLen = 3;
		memset(pobTran->srEMVRec.usz9A_TranDate, 0x00, sizeof(pobTran->srEMVRec.usz9A_TranDate));
		memcpy((char *)&pobTran->srEMVRec.usz9A_TranDate[0], "\x01\x01\x01", pobTran->srEMVRec.in9A_TranDateLen);
	}

	if (f9C == VS_FALSE)
	{
		pobTran->srEMVRec.in9C_TranTypeLen = 1;
		memset(pobTran->srEMVRec.usz9C_TranType, 0x00, sizeof(pobTran->srEMVRec.usz9C_TranType));
		memcpy((char *)&pobTran->srEMVRec.usz9C_TranType[0], "\x00", pobTran->srEMVRec.in9C_TranTypeLen);
	}

	if (f9F02 == VS_FALSE)
	{
		pobTran->srEMVRec.in9F02_AmtAuthNumLen = 6;
		memset(pobTran->srEMVRec.usz9F02_AmtAuthNum, 0x00, sizeof(pobTran->srEMVRec.usz9F02_AmtAuthNum));
		memcpy((char *)&pobTran->srEMVRec.usz9F02_AmtAuthNum[0], "\x00\x00\x00\x00\x00\x01", pobTran->srEMVRec.in9F02_AmtAuthNumLen);
	}

	if (f5F2A == VS_FALSE)
	{
		pobTran->srEMVRec.in5F2A_TransCurrCodeLen = 2;
		memset(pobTran->srEMVRec.usz5F2A_TransCurrCode, 0x00, sizeof(pobTran->srEMVRec.usz5F2A_TransCurrCode));
		memcpy((char *)&pobTran->srEMVRec.usz5F2A_TransCurrCode[0], "\x09\x01", pobTran->srEMVRec.in5F2A_TransCurrCodeLen);
	}

	if (f9F1A == VS_FALSE)
	{
		pobTran->srEMVRec.in9F1A_TermCountryCodeLen = 2;
		memset(pobTran->srEMVRec.usz9F1A_TermCountryCode, 0x00, sizeof(pobTran->srEMVRec.usz9F1A_TermCountryCode));
		memcpy((char *)&pobTran->srEMVRec.usz9F1A_TermCountryCode[0], "\x01\x58", pobTran->srEMVRec.in9F1A_TermCountryCodeLen);
	}

	if (f9F03 == VS_FALSE)
	{
		pobTran->srEMVRec.in9F03_AmtOtherNumLen = 6;
		memset(pobTran->srEMVRec.usz9F03_AmtOtherNum, 0x00, sizeof(pobTran->srEMVRec.usz9F03_AmtOtherNum));
		memcpy((char *)&pobTran->srEMVRec.usz9F03_AmtOtherNum[0], "\x00\x00\x00\x00\x00\x00", pobTran->srEMVRec.in9F03_AmtOtherNumLen);
	}

	if (f9F33 == VS_FALSE)
	{
		pobTran->srEMVRec.in9F33_TermCapabilitiesLen = 3;
		memset(pobTran->srEMVRec.usz9F33_TermCapabilities, 0x00, sizeof(pobTran->srEMVRec.usz9F33_TermCapabilities));
		memcpy((char *)&pobTran->srEMVRec.usz9F33_TermCapabilities[0], "\xE0\xE8\xC0", pobTran->srEMVRec.in9F33_TermCapabilitiesLen);
	}

	/* 要組【DFEE】【DEEF】 */
	memset(szTemplate, 0x00, sizeof(szTemplate));
	if (inFunc_TWNAddDataToEMVPacket(pobTran, TAG_DFEE_TERMINAL_ENTRY_CAPABILITY, (unsigned char *)&szTemplate[0]) > 0)
	{
		pobTran->srEMVRec.inDFEE_TerEntryCapLen = szTemplate[2];
		memcpy((char *)&pobTran->srEMVRec.uszDFEE_TerEntryCap[0], &szTemplate[3], pobTran->srEMVRec.inDFEE_TerEntryCapLen);
	}

	memset(szTemplate, 0x00, sizeof(szTemplate));
	if (inFunc_TWNAddDataToEMVPacket(pobTran, TAG_DFEF_REASON_ONLINE_CODE, (unsigned char *)&szTemplate[0]) > 0)
	{
		pobTran->srEMVRec.inDFEF_ReasonOnlineCodeLen = szTemplate[2];
		memcpy((char *)&pobTran->srEMVRec.uszDFEF_ReasonOnlineCode[0], &szTemplate[3], pobTran->srEMVRec.inDFEF_ReasonOnlineCodeLen);
	}

	if (ginDebug == VS_TRUE)
	{
		inLogPrintf(AT, "inQRCODE_ProcessEMV_TLV()_END");
	}
	
	return (VS_SUCCESS);
}

/*
Function	:inNCCC_Func_Check_NoSignature_Final
Date&Time	:2024/9/25 上午 11:43
Describe        :
*/
int inNCCC_Func_Check_NoSignature_Final(TRANSACTION_OBJECT *pobTran)
{
	char	szCustomerIndicator[3 + 1] = {0};
	
	/* 客製化111 一律免簽名 */
	memset(szCustomerIndicator, 0x00, sizeof(szCustomerIndicator));
	inGetCustomIndicator(szCustomerIndicator);
	if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_107_BUMPER_, _CUSTOMER_INDICATOR_SIZE_)         ||
            !memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_111_KIOSK_STANDARD_, _CUSTOMER_INDICATOR_SIZE_))
	{
		pobTran->srBRec.uszNoSignatureBit = VS_TRUE;
	}
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_123_IKEA_, _CUSTOMER_INDICATOR_SIZE_))
	{
		/* 2.	一般交易金額無限制，NT$3,000元(含)以下所有交易(含插卡/刷卡/感應)顯示免簽名；NT$3,000元以上所有交易(含插卡/刷卡/感應)顯示電子簽名 */
		if (pobTran->inTransactionCode == _SALE_ ||
		    pobTran->inTransactionCode == _CUP_SALE_)
		{
			if (pobTran->srBRec.lnTxnAmount > 3000)
			{
				/* 排除掉Table NQ 的影響 */
				if (pobTran->srBRec.uszVEPS_SignatureBit == VS_TRUE)
				{
					if (ginDebug == VS_TRUE)
					{
						inLogPrintf(AT, "REQ_112101 NQ 免簽");
					}
					if (ginISODebug == VS_TRUE)
					{
						char	szDebugMsg[100 + 1] = {0};

						memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
						sprintf(szDebugMsg, "REQ_112101 NQ 免簽");
						inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
					}
					pobTran->srBRec.uszNoSignatureBit = VS_TRUE;
				}
				else if (pobTran->srBRec.uszMobilePayBit == VS_TRUE)
				{
					if (ginDebug == VS_TRUE)
					{
						inLogPrintf(AT, "REQ_112101 行支 免簽");
					}
					if (ginISODebug == VS_TRUE)
					{
						char	szDebugMsg[100 + 1] = {0};

						memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
						sprintf(szDebugMsg, "REQ_112101 行支 免簽");
						inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
					}
					pobTran->srBRec.uszNoSignatureBit = VS_TRUE;
				}
				else
				{
					if (ginDebug == VS_TRUE)
					{
						inLogPrintf(AT, "REQ_112101 大於3000 要簽");
					}
					if (ginISODebug == VS_TRUE)
					{
						char	szDebugMsg[100 + 1] = {0};

						memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
						sprintf(szDebugMsg, "REQ_112101 大於3000 要簽");
						inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
					}
					pobTran->srBRec.uszNoSignatureBit = VS_FALSE;
				}
			}
			else
			{
				if (ginDebug == VS_TRUE)
				{
					inLogPrintf(AT, "REQ_112101 小等於3000 免簽");
				}
				if (ginISODebug == VS_TRUE)
				{
					char	szDebugMsg[100 + 1] = {0};

					memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
					sprintf(szDebugMsg, "REQ_112101 小等於3000 免簽");
					inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
				}
				pobTran->srBRec.uszNoSignatureBit = VS_TRUE;
			}
		}
	}
        else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_124_EVER_RICH_, _CUSTOMER_INDICATOR_SIZE_))
        {
                /* 本案磁條/晶片/感應交易NT$ 3000元(含)以下免簽名，故取消交易也依原交易邏輯免簽名，另行動支付(如:Apple Pay...等)一律免簽名(維持現行邏輯)，取消交易也免簽名，
                 * NT$ 3000元以上需簽名的交易，取消交易也需要簽名 */
                if (pobTran->srBRec.lnTxnAmount > 3000)
                {
                        /* 排除掉Table NQ 的影響 */
                        if (pobTran->srBRec.uszVEPS_SignatureBit == VS_TRUE)
                        {
                                if (ginDebug == VS_TRUE)
                                {
                                        inLogPrintf(AT, "REQ_112389 NQ 免簽");
                                }
                                if (ginISODebug == VS_TRUE)
                                {
                                        char	szDebugMsg[100 + 1] = {0};

                                        memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
                                        sprintf(szDebugMsg, "REQ_112389 NQ 免簽");
                                        inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
                                }
                                pobTran->srBRec.uszNoSignatureBit = VS_TRUE;
                        }
                        else if (pobTran->srBRec.uszMobilePayBit == VS_TRUE)
                        {
                                if (ginDebug == VS_TRUE)
                                {
                                        inLogPrintf(AT, "REQ_112389 行支 免簽");
                                }
                                if (ginISODebug == VS_TRUE)
                                {
                                        char	szDebugMsg[100 + 1] = {0};

                                        memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
                                        sprintf(szDebugMsg, "REQ_112389 行支 免簽");
                                        inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
                                }
                                pobTran->srBRec.uszNoSignatureBit = VS_TRUE;
                        }
                        else
                        {
                                if (ginDebug == VS_TRUE)
                                {
                                        inLogPrintf(AT, "REQ_112389 大於3000 要簽");
                                }
                                if (ginISODebug == VS_TRUE)
                                {
                                        char	szDebugMsg[100 + 1] = {0};

                                        memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
                                        sprintf(szDebugMsg, "REQ_112389 大於3000 要簽");
                                        inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
                                }
                                pobTran->srBRec.uszNoSignatureBit = VS_FALSE;
                        }
                }
                else
                {
                        if (ginDebug == VS_TRUE)
                        {
                                inLogPrintf(AT, "REQ_112389 小等於3000 免簽");
                        }
                        if (ginISODebug == VS_TRUE)
                        {
                                char	szDebugMsg[100 + 1] = {0};

                                memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
                                sprintf(szDebugMsg, "REQ_112389 小等於3000 免簽");
                                inPRINT_ChineseFont(szDebugMsg, _PRT_ISO_);
                        }
                        pobTran->srBRec.uszNoSignatureBit = VS_TRUE;
                }
        }
	else if (!memcmp(szCustomerIndicator, _CUSTOMER_INDICATOR_041_CASH_, _CUSTOMER_INDICATOR_SIZE_))
	{
		if (pobTran->inTransactionCode == _CASH_ADVANCE_ ||
		    pobTran->inTransactionCode == _FORCE_CASH_ADVANCE_)
		{
			pobTran->srBRec.uszNoSignatureBit = VS_FALSE;
		}
	}
        //update更新 資料庫 uszNoSignatureBit的值
        inBATCH_Update_NoSignature_By_Sqlite(pobTran);
	
	return (VS_SUCCESS);
}

/*
 Function        :vdNCCC_Func_Test_Out_Of_Handle
 Date&Time       :2024/10/28 下午 4:41
 Describe        :
 */
void vdNCCC_Func_Test_Out_Of_Handle()
{
	int	inRetVal = VS_SUCCESS;
	int	inFirst = 0;
	int	inSecond = 0;
	char	szTimes[10 + 1] = {0};
	unsigned long	ulHandle = 0;
	unsigned long	ulHandleLast = 0;
	
	inRetVal = inFILE_Create(&ulHandle, (unsigned char*)"test_out_of_handle.txt");
	if (inRetVal == VS_SUCCESS)
	{
		inFILE_Close(&ulHandle);
	}
	
	while (1) 
	{
		ulHandleLast = ulHandle;
		ulHandle = 0;
		inFirst++;
		inRetVal = inFILE_Open(&ulHandle, (unsigned char*)"test_out_of_handle.txt");
		if (inRetVal == VS_SUCCESS)
		{
			inFILE_Seek(ulHandle, 0, _SEEK_BEGIN_);
			sprintf(szTimes, "%06d", inFirst);
			inFILE_Write(&ulHandle, (unsigned char*)szTimes, 6);
			inFILE_Seek(ulHandle, 0, _SEEK_BEGIN_);
			memset(szTimes, 0x00, sizeof(szTimes));
			inFILE_Read(&ulHandle, (unsigned char*)szTimes, 6);
			inSecond = atoi(szTimes);
		}

		if (inFirst != inSecond) 
		{
			inFILE_Close(&ulHandleLast);
			if (ginDebug == VS_TRUE)
			{
				inLogPrintf(AT, "無法再開啟檔案！開啟次數：%d, File Rec:%d", inFirst, inSecond);
			}
			break;
		}
		else
		{
			if (ginDebug == VS_TRUE)
			{
				if (inFirst % 100 == 0)
				{
					inLogPrintf(AT, "inFirst Now:%d", inFirst);
				}
			}
		}
	}

}

/*
 Function        :vdNCCC_Func_Test_Out_Of_Handle_Native
 Date&Time       :2024/10/28 下午 4:41
 Describe        :
 */
void vdNCCC_Func_Test_Out_Of_Handle_Native()
{
	int	inRetVal = VS_SUCCESS;
	int	inFirst = 0;
	int	inSecond = 0;
	char	szTimes[10 + 1] = {0};
	int	inFd = 0;
	int	inSize = 0;
	
	inRetVal = inFile_Linux_Create(&inFd, "test_out_of_handle.txt");
	if (inRetVal == VS_SUCCESS)
	{
		inFile_Linux_Close(inFd);
	}
	
	inFunc_Data_Chmod("u+rwx", "test_out_of_handle.txt", _AP_ROOT_PATH_);
	while (1) 
	{
		inFd = 0;
		inFirst++;
		inRetVal = inFile_Linux_Open(&inFd, "test_out_of_handle.txt");
		if (inRetVal == VS_SUCCESS)
		{
			inFile_Linux_Seek(inFd, 0, _SEEK_BEGIN_);
			sprintf(szTimes, "%06d", inFirst);
			inSize = 6;
			inFile_Linux_Write(inFd, szTimes, &inSize);
			inFile_Linux_Seek(inFd, 0, _SEEK_BEGIN_);
			memset(szTimes, 0x00, sizeof(szTimes));
			inSize = 6;
			inFile_Linux_Read(inFd, szTimes, &inSize);
			inSecond = atoi(szTimes);
		}

		if (inFirst != inSecond) 
		{
		    if (ginDebug == VS_TRUE)
		    {
			    inLogPrintf(AT, "無法再開啟檔案！開啟次數：%d, File Rec:%d", inFirst, inSecond);
		    }
		    break;
		}
		else
		{
			if (ginDebug == VS_TRUE)
			{
				if (inFirst % 100 == 0)
				{
					inLogPrintf(AT, "inFirst Now:%d", inFirst);
				}
			}
		}
	}

}

/*
 Function        :vdNCCC_Func_Test_Out_Of_Memory
 Date&Time       :2024/10/28 下午 4:41
 Describe        :
 */
void vdNCCC_Func_Test_Out_Of_Memory(void)
{
	int allocation_size = 1024 * 1024;
	int allocation_count = 0;
	void *ptr;

	while (1) 
	{
		ptr = malloc(allocation_size);

		if (ptr == NULL) 
		{
                        if (ginDebug == VS_TRUE)
                        {
                            inLogPrintf(AT, "記憶體分配失敗！已分配 %d Byte", allocation_count * allocation_size);
                        }   
                        break;
		}

		// 將分配的記憶體填滿，防止操作系統的延遲分配機制
		memset(ptr, 0, allocation_size);
		allocation_count++;

		if (ginDebug == VS_TRUE)
		{
			inLogPrintf(AT, "成功分配 %d Byte", allocation_count * allocation_size);
		}
	}
}

/*
 Function        :inNCCC_Func_Delete_Signature_By_Shell_Command
 Date&Time       :2025/1/3 下午 3:32
 Describe        :
 */
int inNCCC_Func_Delete_Signature_By_Shell_Command(char* szDirPath, char* szHostName)
{
        int     inRetVal = VS_SUCCESS;
        char    szCommand[512 + 1] = {0};
        /*find 指令在指定目錄中搜尋符合條件的 BMP 圖檔，並將其刪除。*/
        memset(szCommand, 0x00, sizeof(szCommand));
        snprintf(szCommand, sizeof(szCommand), "find %s -type f -regex '.*/%s[0-9]\\{6\\}\\(_[0-9]\\)?\\.bmp' -exec rm -f {} +", szDirPath, szHostName);
        inRetVal = inFunc_ShellCommand_System(szCommand);
        
        return (inRetVal);
}

/*
 Function        :inNCCC_Func_Create_Settlement_XML_NCCC
 Date&Time       :2025/1/6 下午 4:13
 Describe        :
 */
int inNCCC_Func_Create_Settlement_XML_NCCC(TRANSACTION_OBJECT * pobTran)
{
	char		szTRTFileName[12 + 1] = {0};
	char		szFileName[256 + 1] = {0};
        char            szFuncEnable[2 + 1] = {0};
        char            szTemplate[256 + 1] = {0};
	xmlDocPtr       srDoc = NULL;
        xmlNodePtr      srRoot_Node = NULL;
	
	memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
	inGetTRTFileName(szTRTFileName);
	memset(szFileName, 0x00, sizeof(szFileName));
		
	/* 建立一個新的檔案 */
        srDoc = xmlNewDoc(BAD_CAST "1.0");
        srRoot_Node = xmlNewNode(NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ROOT_NODE_);
        xmlDocSetRootElement (srDoc, srRoot_Node);
	
	if (!memcmp(szTRTFileName, _TRT_FILE_NAME_DCC_, _TRT_FILE_NAME_DCC_LEN_))
	{
		sprintf(szFileName, "%s", _SETTLENMENT_RECOVER_DCC_XML_);
		
                /* inSaleUploadCnt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%d", pobTran->inESC_Sale_UploadCnt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_UPLOAD_CNT_, BAD_CAST szTemplate);
                
                /* inESC_Refund_UploadCnt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%d", pobTran->inESC_Refund_UploadCnt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_UPLOAD_CNT_, BAD_CAST szTemplate);
                
                /* inESC_Sale_PaperCnt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%d", pobTran->inESC_Sale_PaperCnt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_PAPER_CNT_, BAD_CAST szTemplate);
                
                /* inESC_Refund_PaperCnt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%d", pobTran->inESC_Refund_PaperCnt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_PAPER_CNT_, BAD_CAST szTemplate);
                
                /* lnESC_Sale_UploadAmt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%ld", pobTran->lnESC_Sale_UploadAmt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_UPLOAD_AMT_, BAD_CAST szTemplate);
                
                /* lnESC_Refund_PaperAmt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%ld", pobTran->lnESC_Refund_UploadAmt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_UPLOAD_AMT_, BAD_CAST szTemplate);
                
                /* lnESC_Sale_PaperAmt v */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%ld", pobTran->lnESC_Sale_PaperAmt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_PAPER_AMT_, BAD_CAST szTemplate);
                
                /* lnESC_Refund_PaperAmt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%ld", pobTran->lnESC_Refund_PaperAmt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_PAPER_AMT_, BAD_CAST szTemplate);
                
		/* _FUNCTION_DELETE_BATCH_FLOW_ */
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_DELETE_BATCH_FLOW_, BAD_CAST "N");

		/* _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_PRINT_TOTAL_REPORT_BY_BUFFER_ */
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_PRINT_TOTAL_REPORT_BY_BUFFER_, BAD_CAST "N");

		/* _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_DELETE_ACCUM_FLOW_ */
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_DELETE_ACCUM_FLOW_, BAD_CAST "N");

		/* _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_REST_BATCH_INV_ */
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_REST_BATCH_INV_, BAD_CAST "N");

		/* _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_UPDATE_BATCH_NUM_ */
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_UPDATE_BATCH_NUM_, BAD_CAST "N");
		
		/* _SETTLENMENT_RECOVER_XML_TAG__NCCC_FUNCTION_DCC_SETTLE_DOWNLOAD_ */
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_NCCC_FUNCTION_DCC_SETTLE_DOWNLOAD_, BAD_CAST "N");
	}
	else if (!memcmp(szTRTFileName, _TRT_FILE_NAME_ESVC_, _TRT_FILE_NAME_ESVC_LEN_))
	{
		sprintf(szFileName, "%s", _SETTLENMENT_RECOVER_ESVC_XML_);
                
                /* inSaleUploadCnt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%d", pobTran->inESC_Sale_UploadCnt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_UPLOAD_CNT_, BAD_CAST szTemplate);
                
                /* inESC_Refund_UploadCnt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%d", pobTran->inESC_Refund_UploadCnt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_UPLOAD_CNT_, BAD_CAST szTemplate);
                
                /* inESC_Sale_PaperCnt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%d", pobTran->inESC_Sale_PaperCnt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_PAPER_CNT_, BAD_CAST szTemplate);
                
                /* inESC_Refund_PaperCnt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%d", pobTran->inESC_Refund_PaperCnt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_PAPER_CNT_, BAD_CAST szTemplate);
                
                /* lnESC_Sale_UploadAmt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%ld", pobTran->lnESC_Sale_UploadAmt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_UPLOAD_AMT_, BAD_CAST szTemplate);
                
                /* lnESC_Refund_PaperAmt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%ld", pobTran->lnESC_Refund_UploadAmt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_UPLOAD_AMT_, BAD_CAST szTemplate);
                
                /* lnESC_Sale_PaperAmt v */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%ld", pobTran->lnESC_Sale_PaperAmt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_PAPER_AMT_, BAD_CAST szTemplate);
                
                /* lnESC_Refund_PaperAmt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%ld", pobTran->lnESC_Refund_PaperAmt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_PAPER_AMT_, BAD_CAST szTemplate);
                
                /* _FUNCTION_DELETE_BATCH_FLOW_ */
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_DELETE_BATCH_FLOW_, BAD_CAST "N");

		/* _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_PRINT_TOTAL_REPORT_BY_BUFFER_ */
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_PRINT_TOTAL_REPORT_BY_BUFFER_, BAD_CAST "N");

		/* _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_DELETE_ACCUM_FLOW_ */
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_DELETE_ACCUM_FLOW_, BAD_CAST "N");

		/* _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_REST_BATCH_INV_ */
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_REST_BATCH_INV_, BAD_CAST "N");

		/* _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_UPDATE_BATCH_NUM_ */
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_UPDATE_BATCH_NUM_, BAD_CAST "N");
                
                inLoadTDTRec(_TDT_INDEX_01_ECC_);
		memset(szFuncEnable, 0x00, sizeof(szFuncEnable));
		inGetTicket_HostEnable(szFuncEnable);
		if (memcmp(szFuncEnable, "Y", strlen("Y")) == 0)
		{
                        /* _SETTLENMENT_RECOVER_XML_TAG_TICKET_ECC_SET_UPDATE_BATCH_FLAG_ */
                        xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_TICKET_ECC_SET_UPDATE_BATCH_FLAG_, BAD_CAST "N");
                }
	}
	else
	{
		sprintf(szFileName, "%s", _SETTLENMENT_RECOVER_NCCC_XML_);
		
                /* inSaleUploadCnt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%d", pobTran->inESC_Sale_UploadCnt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_UPLOAD_CNT_, BAD_CAST szTemplate);
                
                /* inESC_Refund_UploadCnt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%d", pobTran->inESC_Refund_UploadCnt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_UPLOAD_CNT_, BAD_CAST szTemplate);
                
                /* inESC_Sale_PaperCnt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%d", pobTran->inESC_Sale_PaperCnt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_PAPER_CNT_, BAD_CAST szTemplate);
                
                /* inESC_Refund_PaperCnt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%d", pobTran->inESC_Refund_PaperCnt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_PAPER_CNT_, BAD_CAST szTemplate);
                
                /* lnESC_Sale_UploadAmt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%ld", pobTran->lnESC_Sale_UploadAmt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_UPLOAD_AMT_, BAD_CAST szTemplate);
                
                /* lnESC_Refund_PaperAmt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%ld", pobTran->lnESC_Refund_UploadAmt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_UPLOAD_AMT_, BAD_CAST szTemplate);
                
                /* lnESC_Sale_PaperAmt v */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%ld", pobTran->lnESC_Sale_PaperAmt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_PAPER_AMT_, BAD_CAST szTemplate);
                
                /* lnESC_Refund_PaperAmt */
                memset(szTemplate, 0x00, sizeof(szTemplate));
                snprintf(szTemplate, sizeof(szTemplate), "%ld", pobTran->lnESC_Refund_PaperAmt);
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_PAPER_AMT_, BAD_CAST szTemplate);
                
		/* _FUNCTION_DELETE_BATCH_FLOW_ */
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_DELETE_BATCH_FLOW_, BAD_CAST "N");

		/* _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_PRINT_TOTAL_REPORT_BY_BUFFER_ */
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_PRINT_TOTAL_REPORT_BY_BUFFER_, BAD_CAST "N");

		/* _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_DELETE_ACCUM_FLOW_ */
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_DELETE_ACCUM_FLOW_, BAD_CAST "N");

		/* _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_REST_BATCH_INV_ */
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_REST_BATCH_INV_, BAD_CAST "N");

		/* _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_UPDATE_BATCH_NUM_ */
		xmlNewChild(srRoot_Node, NULL, BAD_CAST _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_UPDATE_BATCH_NUM_, BAD_CAST "N");
	}
	// 將 XML 文件依指定編碼與格式寫入檔案
        inXML_SaveFile(szFileName, &srDoc, "utf-8", 1);
	
	/* 清空佔用記憶體 */
	inXML_End(&srDoc);
        
	return (VS_SUCCESS);
}

/*
 Function        :inNCCC_Func_Check_And_Recover_Settlement_XML_NCCC
 Date&Time       :2025/1/20 下午 2:59
 Describe        :
 */
int inNCCC_Func_Check_And_Recover_Settlement_XML(TRANSACTION_OBJECT *pobTran, char* szFileName, char* szPath)
{
	int		inRetVal = VS_ERROR;
	int		inFinalRetVal = VS_SUCCESS;
	char		szFileName_New[50 + 1] = {0};
	char		szDebugMsg[100 + 1] = {0};
	char		szTagData[1536 + 1] = {0};
	xmlChar*	szTagPtr = NULL;
        xmlDocPtr	srDoc = NULL;
	xmlNodePtr	srCur = NULL;		/* (第二層) */
	xmlNodePtr	srTextNode = NULL;	/* 因為ElementNode的子節點TextNode才有內容(第三層) */
	
	sprintf(szFileName_New, "%s%s", szPath, szFileName);
	
	do
	{
		if (inFile_Linux_Check_File_Exist(szPath, szFileName) != VS_SUCCESS)
		{
			/* 檔案不存在，直接結束 */
			inRetVal = VS_SUCCESS;
			break;
		}
		
		inRetVal = inXML_ReadFile(szFileName_New, &srDoc, NULL, XML_PARSE_RECOVER | XML_PARSE_PEDANTIC);
		if (inRetVal != VS_SUCCESS)
		{
			if (ginDebug == VS_TRUE)
			{
				memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
				sprintf(szDebugMsg, "Parse Failed, %s", szFileName);
				inLogPrintf(AT, szDebugMsg);
			}
			
			break;
		}
		
		/* srCur = StepBool*/
		inRetVal = inXML_Get_RootElement(&srDoc, &srCur);
		/* 異常 */
		if (inRetVal != VS_SUCCESS)
		{
			vdUtility_SYSFIN_LogMessage(AT, "inXML_Get_RootElement failed inRetVal=(%d)", inRetVal);
			break; 
		}
		
		/* srCur = _FUNCTION_DELETE_BATCH_FLOW_ */
		srCur = srCur->children;
		
		while(srCur != NULL)
		{
			srTextNode = srCur->children;
			memset(szTagData, 0x00, sizeof(szTagData));
			szTagPtr = xmlNodeListGetString(srDoc, srTextNode, 1);
			if (szTagPtr != NULL	&&
			    xmlStrlen(szTagPtr) != 0)
			{
				if (ginDebug == VS_TRUE)
				{
					memset(szDebugMsg, 0x00, sizeof(szDebugMsg));
					sprintf(szDebugMsg, "%s : %s", srCur->name, szTagPtr);
					inLogPrintf(AT, szDebugMsg);
				}

				strcat(szTagData, (char*)szTagPtr);
				xmlFree(szTagPtr);
			}
			
                        if (!memcmp(srCur->name, _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_UPLOAD_CNT_, max(xmlStrlen(srCur->name), strlen(_SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_UPLOAD_CNT_))))
			{
				pobTran->inESC_Sale_UploadCnt = atoi(szTagData);
			}
                        
                        if (!memcmp(srCur->name, _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_UPLOAD_CNT_, max(xmlStrlen(srCur->name), strlen(_SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_UPLOAD_CNT_))))
			{
				pobTran->inESC_Refund_UploadCnt = atoi(szTagData);
			}
                        
                        if (!memcmp(srCur->name, _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_PAPER_CNT_, max(xmlStrlen(srCur->name), strlen(_SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_PAPER_CNT_))))
			{
				pobTran->inESC_Sale_PaperCnt = atoi(szTagData);
			}
                        
                        if (!memcmp(srCur->name, _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_PAPER_CNT_, max(xmlStrlen(srCur->name), strlen(_SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_PAPER_CNT_))))
			{
				pobTran->inESC_Refund_PaperCnt = atoi(szTagData);
			}
                        
                        if (!memcmp(srCur->name, _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_UPLOAD_AMT_, max(xmlStrlen(srCur->name), strlen(_SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_UPLOAD_AMT_))))
			{
				pobTran->lnESC_Sale_UploadAmt = atol(szTagData);
			}
                        
                        if (!memcmp(srCur->name, _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_UPLOAD_AMT_, max(xmlStrlen(srCur->name), strlen(_SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_UPLOAD_AMT_))))
			{
				pobTran->lnESC_Refund_UploadAmt = atol(szTagData);
			}
                        
                        if (!memcmp(srCur->name, _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_PAPER_AMT_, max(xmlStrlen(srCur->name), strlen(_SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_SALE_PAPER_AMT_))))
			{
				pobTran->lnESC_Sale_PaperAmt = atol(szTagData);
			}
                        
                        if (!memcmp(srCur->name, _SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_PAPER_AMT_, max(xmlStrlen(srCur->name), strlen(_SETTLENMENT_RECOVER_XML_TAG_ESC_DATA_REFUND_PAPER_AMT_))))
			{
				pobTran->lnESC_Refund_PaperAmt = atol(szTagData);
			}
                        
			if (!memcmp(srCur->name, _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_DELETE_BATCH_FLOW_, max(xmlStrlen(srCur->name), strlen(_SETTLENMENT_RECOVER_XML_TAG_FUNCTION_DELETE_BATCH_FLOW_))) &&
			    !memcmp(szTagData, "N", 1))
			{
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_DELETE_BATCH_FLOW_);
				if (inRetVal != VS_SUCCESS)
				{
					inFinalRetVal = VS_ERROR;
				}
			}
			
			if (!memcmp(srCur->name, _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_PRINT_TOTAL_REPORT_BY_BUFFER_, max(xmlStrlen(srCur->name), strlen(_SETTLENMENT_RECOVER_XML_TAG_FUNCTION_PRINT_TOTAL_REPORT_BY_BUFFER_))) &&
			    !memcmp(szTagData, "N", 1))
			{
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_PRINT_TOTAL_REPORT_BY_BUFFER_);
				if (inRetVal != VS_SUCCESS)
				{
					inFinalRetVal = VS_ERROR;
				}
			}
			
			if (!memcmp(srCur->name, _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_DELETE_ACCUM_FLOW_, max(xmlStrlen(srCur->name), strlen(_SETTLENMENT_RECOVER_XML_TAG_FUNCTION_DELETE_ACCUM_FLOW_))) &&
			    !memcmp(szTagData, "N", 1))
			{
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_DELETE_ACCUM_FLOW_);
				if (inRetVal != VS_SUCCESS)
				{
					inFinalRetVal = VS_ERROR;
				}
			}
			
			if (!memcmp(srCur->name, _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_REST_BATCH_INV_, max(xmlStrlen(srCur->name), strlen(_SETTLENMENT_RECOVER_XML_TAG_FUNCTION_REST_BATCH_INV_))) &&
			    !memcmp(szTagData, "N", 1))
			{
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_REST_BATCH_INV_);
				if (inRetVal != VS_SUCCESS)
				{
					inFinalRetVal = VS_ERROR;
				}
			}
			
			if (!memcmp(srCur->name, _SETTLENMENT_RECOVER_XML_TAG_FUNCTION_UPDATE_BATCH_NUM_, max(xmlStrlen(srCur->name), strlen(_SETTLENMENT_RECOVER_XML_TAG_FUNCTION_UPDATE_BATCH_NUM_))) &&
			    !memcmp(szTagData, "N", 1))
			{
				inRetVal = inFLOW_RunFunction(pobTran, _FUNCTION_UPDATE_BATCH_NUM_);
				if (inRetVal != VS_SUCCESS)
				{
					inFinalRetVal = VS_ERROR;
				}
			}
			
			if (!memcmp(srCur->name, _SETTLENMENT_RECOVER_XML_TAG_NCCC_FUNCTION_DCC_SETTLE_DOWNLOAD_, max(xmlStrlen(srCur->name), strlen(_SETTLENMENT_RECOVER_XML_TAG_NCCC_FUNCTION_DCC_SETTLE_DOWNLOAD_))) &&
			    !memcmp(szTagData, "N", 1))
			{
				inRetVal = inFLOW_RunFunction(pobTran, _NCCC_FUNCTION_DCC_SETTLE_DOWNLOAD_);
				if (inRetVal != VS_SUCCESS)
				{
					inFinalRetVal = VS_ERROR;
				}
			}
                        
                        if (!memcmp(srCur->name, _SETTLENMENT_RECOVER_XML_TAG_TICKET_ECC_SET_UPDATE_BATCH_FLAG_, max(xmlStrlen(srCur->name), strlen(_SETTLENMENT_RECOVER_XML_TAG_TICKET_ECC_SET_UPDATE_BATCH_FLAG_))) &&
			    !memcmp(szTagData, "N", 1))
			{
				inRetVal = inFLOW_RunFunction(pobTran, _TICKET_ECC_SET_UPDATE_BATCH_FLAG_);
				if (inRetVal != VS_SUCCESS)
				{
					inFinalRetVal = VS_ERROR;
				}
			}
			
			srCur = srCur->next;
		}
		
		break;
	}while(1);
	
	if (srDoc != NULL)
	{
		inXML_End(&srDoc);
	}
	
	if (inFinalRetVal != VS_SUCCESS)
	{
		return (VS_ERROR);
	}
	else
	{
		/* 刪除xml檔 */
		inFile_Unlink_File(szFileName, szPath);
                sync();
		
		return (VS_SUCCESS);
	}
}

/*
 Function        :inNCCC_Func_Settlement_XML_NCCC_START
 Date&Time       :2025/1/23 上午 11:26
 Describe        :
 */
int inNCCC_Func_Settlement_XML_NCCC_START(TRANSACTION_OBJECT *pobTran)
{
        inNCCC_Func_Create_Settlement_XML_NCCC(pobTran);
        sync();
	
	return (VS_SUCCESS);
}

/*
 Function        :inNCCC_Func_Settlement_XML_NCCC_END
 Date&Time       :2025/1/23 上午 11:26
 Describe        :
 */
int inNCCC_Func_Settlement_XML_NCCC_END(TRANSACTION_OBJECT *pobTran)
{
	char	szTRTFileName[12 + 1] = {0};
	char	szFileName[256 + 1] = {0};
	
	memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
	inGetTRTFileName(szTRTFileName);
	memset(szFileName, 0x00, sizeof(szFileName));
	
	if (!memcmp(szTRTFileName, _TRT_FILE_NAME_DCC_, _TRT_FILE_NAME_DCC_LEN_))
	{
		sprintf(szFileName, "%s", _SETTLENMENT_RECOVER_DCC_XML_);
	}
	else if (!memcmp(szTRTFileName, _TRT_FILE_NAME_ESVC_, _TRT_FILE_NAME_ESVC_LEN_))
	{
		sprintf(szFileName, "%s", _SETTLENMENT_RECOVER_ESVC_XML_);
	}
	else
	{
		sprintf(szFileName, "%s", _SETTLENMENT_RECOVER_NCCC_XML_);
	}
	
	/* 刪除xml檔 */
	inFile_Unlink_File(szFileName, _AP_ROOT_PATH_);
        sync();
	
        
	return (VS_SUCCESS);
}

/*
 Function        :inNCCC_Func_Settlement_XML_Edit
 Date&Time       :2025/1/23 下午 6:41
 Describe        :
 */
int inNCCC_Func_Settlement_XML_Edit(char* szEditTag, char* szEditVal)
{
	char        szTRTFileName[12 + 1] = {0};
	char        szFileName[256 + 1] = {0};
        xmlNode     srTargetParentNode = {0};
        xmlNode     srTargetNode = {0};
	
	memset(szTRTFileName, 0x00, sizeof(szTRTFileName));
	inGetTRTFileName(szTRTFileName);
	memset(szFileName, 0x00, sizeof(szFileName));
	
	if (!memcmp(szTRTFileName, _TRT_FILE_NAME_DCC_, _TRT_FILE_NAME_DCC_LEN_))
	{
		snprintf(szFileName, sizeof(szFileName), "%s", _SETTLENMENT_RECOVER_DCC_XML_);
	}
	else if (!memcmp(szTRTFileName, _TRT_FILE_NAME_ESVC_, _TRT_FILE_NAME_ESVC_LEN_))
	{
		snprintf(szFileName, sizeof(szFileName), "%s", _SETTLENMENT_RECOVER_ESVC_XML_);
	}
	else if (!memcmp(szTRTFileName, _TRT_FILE_NAME_CREDIT_, _TRT_FILE_NAME_CREDIT_LEN_))
	{
		snprintf(szFileName, sizeof(szFileName), "%s", _SETTLENMENT_RECOVER_NCCC_XML_);
	}
        
	srTargetParentNode.name = xmlStrdup((xmlChar*)_SETTLENMENT_RECOVER_XML_TAG_ROOT_NODE_);
        srTargetNode.name = xmlStrdup((xmlChar*)szEditTag);
        srTargetNode.parent = &srTargetParentNode;
	
        if (&srTargetNode != NULL)
        {   
                
                inXML_Edit_Properties(_AP_ROOT_PATH_, szFileName, &srTargetNode, szEditVal);
                sync();
        }

        xmlFree((xmlChar*)srTargetParentNode.name);
        xmlFree((xmlChar*)srTargetNode.name);
        
        
	return (VS_SUCCESS);
}

/*
 Function        :inNCCC_Func_Update_Memory_Invoice
 Date&Time       :2025/2/4 下午 2:20
 Describe        :
 */
int inNCCC_Func_Update_Memory_Invoice(TRANSACTION_OBJECT *pobTran)
{
	/* 紀錄已送到主機的調閱編號 */
	/* 取消的交易別，不用更新 */
	if (pobTran->srBRec.inCode == _TIP_			||
	    pobTran->srBRec.inCode == _VOID_			||
	    pobTran->srBRec.inCode == _CUP_VOID_		||
	    pobTran->srBRec.inCode == _CUP_PRE_AUTH_VOID_	||
	    pobTran->srBRec.inCode == _CUP_PRE_COMP_VOID_	||
	    pobTran->srBRec.inCode == _FISC_VOID_		||
	    pobTran->srBRec.inCode == _VOID_LOYALTY_REDEEM_	||
	    pobTran->inISOTxnCode == _SETTLE_			||
	    pobTran->inTransactionCode == _CLS_SETTLE_)
	{

	}
	else
	{
		ginNCCCDCCInvoice = pobTran->srBRec.lnOrgInvNum;
	}
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Didp_Mem_Inv
Date&Time       :2025/2/4 下午 4:21
Describe        :
*/
int inNCCC_Func_Didp_Mem_Inv(void)
{
	char		szMessage[100 + 1] = {0};
	unsigned char	uszKey = 0x00;
	
	inDISP_ClearAll();
	do
	{
		inDISP_Clear_Line(_LINE_8_4_, _LINE_8_8_);
		memset(szMessage, 0x00, sizeof(szMessage));
		sprintf(szMessage, "NCCC Mem Inv, = %06d", ginNCCCDCCInvoice);
		inDISP_ChineseFont(szMessage, _FONTSIZE_8X22_, _LINE_8_4_, _DISP_CENTER_);
		uszKey = uszKBD_GetKey(30);
		break;
	}while(1);
	
	return (VS_SUCCESS);
}

/*
Function        :inNCCC_Func_Card_Inquery_Issuer_Bank_Fisc
Date&Time       :2025/2/4 下午 4:21
Describe        :
*/
int inNCCC_Func_Card_Inquery_Issuer_Bank_Fisc(TRANSACTION_OBJECT *pobTran)
{
	/* MCP Indicator (1 Bytes) */
	memcpy(&pobTran->srBRec.szMCP_BANKID[0], " ", 1);
	
	/* 金融機構代碼 (3 Bytes) */
	memcpy(&pobTran->srBRec.szMCP_BANKID[1], pobTran->srBRec.szFiscIssuerID, 3);
	
	return (VS_SUCCESS);
}